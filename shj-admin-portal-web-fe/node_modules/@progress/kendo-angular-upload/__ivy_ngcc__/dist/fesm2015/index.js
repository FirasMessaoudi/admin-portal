/**-----------------------------------------------------------------------------------------
* Copyright © 2020 Progress Software Corporation. All rights reserved.
* Licensed under commercial license. See LICENSE.md in the project root for more information
*-------------------------------------------------------------------------------------------*/
import { EventEmitter, Injectable, Directive, TemplateRef, forwardRef, Component, NgZone, Renderer2, ChangeDetectorRef, ElementRef, Input, ContentChild, ViewChild, Output, HostBinding, HostListener, ViewChildren, ViewContainerRef, isDevMode, NgModule } from '@angular/core';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { LocalizationService, L10N_PREFIX, ComponentMessages } from '@progress/kendo-angular-l10n';
import { guid, Keys, isDocumentAvailable, KendoInput, isChanged } from '@progress/kendo-angular-common';
import { fromEvent, merge } from 'rxjs';
import { filter } from 'rxjs/operators';
import { HttpHeaders, HttpRequest, HttpEventType, HttpResponse, HttpClient } from '@angular/common/http';
import { CommonModule } from '@angular/common';
import { trigger, state, style, transition, animate } from '@angular/animations';

/**
 * Lists the possible states of a file.
 */
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common/http';
import * as ɵngcc2 from '@progress/kendo-angular-l10n';
import * as ɵngcc3 from '@angular/common';

const _c0 = ["fileSelect"];
const _c1 = ["fileSelectButton"];
var I18N_2;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The drop zone hint
     * @meaning kendo.fileselect.dropFilesHere
     */ 
    const MSG_EXTERNAL_660278350824582724$$DIST_FESM2015_INDEX_JS_3 = goog.getMsg("Drop files here to select");
    I18N_2 = MSG_EXTERNAL_660278350824582724$$DIST_FESM2015_INDEX_JS_3;
}
else {
    I18N_2 = $localize `:kendo.fileselect.dropFilesHere|The drop zone hint␟fc9dc41483f5cb38bd14b6c7003fb09ef73aa357␟660278350824582724:Drop files here to select`;
}
var I18N_4;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the invalid allowed extensions restriction message
     * @meaning kendo.fileselect.invalidFileExtension
     */ 
    const MSG_EXTERNAL_4664331691591215211$$DIST_FESM2015_INDEX_JS_5 = goog.getMsg("File type not allowed.");
    I18N_4 = MSG_EXTERNAL_4664331691591215211$$DIST_FESM2015_INDEX_JS_5;
}
else {
    I18N_4 = $localize `:kendo.fileselect.invalidFileExtension|The text for the invalid allowed extensions restriction message␟cd37b839ea9e6b35f63d735544dee56d4380e2f9␟4664331691591215211:File type not allowed.`;
}
var I18N_6;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the invalid max file size restriction message
     * @meaning kendo.fileselect.invalidMaxFileSize
     */ 
    const MSG_EXTERNAL_7793317101233274017$$DIST_FESM2015_INDEX_JS_7 = goog.getMsg("File size too large.");
    I18N_6 = MSG_EXTERNAL_7793317101233274017$$DIST_FESM2015_INDEX_JS_7;
}
else {
    I18N_6 = $localize `:kendo.fileselect.invalidMaxFileSize|The text for the invalid max file size restriction message␟98382b80d6551de7650912776b22a6c70a80f7fd␟7793317101233274017:File size too large.`;
}
var I18N_8;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the invalid min file size restriction message
     * @meaning kendo.fileselect.invalidMinFileSize
     */ 
    const MSG_EXTERNAL_6852116465202092102$$DIST_FESM2015_INDEX_JS_9 = goog.getMsg("File size too small.");
    I18N_8 = MSG_EXTERNAL_6852116465202092102$$DIST_FESM2015_INDEX_JS_9;
}
else {
    I18N_8 = $localize `:kendo.fileselect.invalidMinFileSize|The text for the invalid min file size restriction message␟448bd77b7081ff65298df29ebcfe776401613b21␟6852116465202092102:File size too small.`;
}
var I18N_10;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Remove button
     * @meaning kendo.fileselect.remove
     */ 
    const MSG_EXTERNAL_8968399983135301359$$DIST_FESM2015_INDEX_JS_11 = goog.getMsg("Remove");
    I18N_10 = MSG_EXTERNAL_8968399983135301359$$DIST_FESM2015_INDEX_JS_11;
}
else {
    I18N_10 = $localize `:kendo.fileselect.remove|The text for the Remove button␟19fcca3d504982c668a7a793a545930003c7a0a7␟8968399983135301359:Remove`;
}
var I18N_12;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Select button
     * @meaning kendo.fileselect.select
     */ 
    const MSG_EXTERNAL_3297892120691863975$$DIST_FESM2015_INDEX_JS_13 = goog.getMsg("Select files...");
    I18N_12 = MSG_EXTERNAL_3297892120691863975$$DIST_FESM2015_INDEX_JS_13;
}
else {
    I18N_12 = $localize `:kendo.fileselect.select|The text for the Select button␟fb88c598155545d9cb1e15ff76bdec63d72c03c9␟3297892120691863975:Select files...`;
}
const _c14 = ["dropFilesHere", I18N_2, "invalidFileExtension", I18N_4, "invalidMaxFileSize", I18N_6, "invalidMinFileSize", I18N_8, "remove", I18N_10, "select", I18N_12];
function FileSelectComponent_ul_11_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "ul", 8);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r2.disabled)("fileList", ctx_r2.fileList.files)("fileTemplate", ctx_r2.fileTemplate);
} }
const _c15 = ["kendo-upload-file-list", ""];
function FileListComponent_ng_template_0_kendo_upload_file_list_single_item_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-upload-file-list-single-item", 5);
} if (rf & 2) {
    const files_r1 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r3.disabled)("file", files_r1[0]);
} }
function FileListComponent_ng_template_0_kendo_upload_file_list_multiple_items_2_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-upload-file-list-multiple-items", 6);
} if (rf & 2) {
    const files_r1 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r4.disabled)("files", files_r1);
} }
function FileListComponent_ng_template_0_3_ng_template_0_Template(rf, ctx) { }
const _c16 = function (a0, a1, a2) { return { templateRef: a0, state: a1, $implicit: a2 }; };
function FileListComponent_ng_template_0_3_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵtemplate(0, FileListComponent_ng_template_0_3_ng_template_0_Template, 0, 0, "ng-template", 7);
} if (rf & 2) {
    const files_r1 = ɵngcc0.ɵɵnextContext().$implicit;
    const ctx_r5 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("templateContext", ɵngcc0.ɵɵpureFunction3(1, _c16, ctx_r5.fileTemplate.templateRef, files_r1[0].state, files_r1));
} }
function FileListComponent_ng_template_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "li", 1);
    ɵngcc0.ɵɵtemplate(1, FileListComponent_ng_template_0_kendo_upload_file_list_single_item_1_Template, 1, 2, "kendo-upload-file-list-single-item", 2);
    ɵngcc0.ɵɵtemplate(2, FileListComponent_ng_template_0_kendo_upload_file_list_multiple_items_2_Template, 1, 2, "kendo-upload-file-list-multiple-items", 3);
    ɵngcc0.ɵɵtemplate(3, FileListComponent_ng_template_0_3_Template, 1, 5, undefined, 4);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const files_r1 = ctx.$implicit;
    const index_r2 = ctx.index;
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("files", files_r1)("index", index_r2);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", files_r1.length === 1 && !ctx_r0.fileTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", files_r1.length > 1 && !ctx_r0.fileTemplate);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.fileTemplate);
} }
function FileListItemActionButtonComponent_span_1_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 3);
    ɵngcc0.ɵɵtext(1);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1("", ctx_r0.progress, "%");
} }
const _c17 = function (a0) { return { "k-state-focused": a0 }; };
function FileListItemActionButtonComponent_button_2_Template(rf, ctx) { if (rf & 1) {
    const _r5 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 4);
    ɵngcc0.ɵɵlistener("focus", function FileListItemActionButtonComponent_button_2_Template_button_focus_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r4 = ɵngcc0.ɵɵnextContext(); return ctx_r4.onFocus("retry"); })("blur", function FileListItemActionButtonComponent_button_2_Template_button_blur_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r6 = ɵngcc0.ɵɵnextContext(); return ctx_r6.onBlur("retry"); })("click", function FileListItemActionButtonComponent_button_2_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r5); const ctx_r7 = ɵngcc0.ɵɵnextContext(); return ctx_r7.onRetryClick(); });
    ɵngcc0.ɵɵelement(1, "span", 5);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(4, _c17, ctx_r1.retryFocused));
    ɵngcc0.ɵɵattribute("tabIndex", 0 - 1);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵattribute("aria-label", ctx_r1.retryButtonTitle)("title", ctx_r1.retryButtonTitle);
} }
const _c18 = function (a0, a1) { return { "k-i-play-sm": a0, "k-i-pause-sm": a1 }; };
function FileListItemActionButtonComponent_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r9 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 4);
    ɵngcc0.ɵɵlistener("focus", function FileListItemActionButtonComponent_button_3_Template_button_focus_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r8 = ɵngcc0.ɵɵnextContext(); return ctx_r8.onFocus("pauseResume"); })("blur", function FileListItemActionButtonComponent_button_3_Template_button_blur_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r10 = ɵngcc0.ɵɵnextContext(); return ctx_r10.onBlur("pauseResume"); })("click", function FileListItemActionButtonComponent_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r9); const ctx_r11 = ɵngcc0.ɵɵnextContext(); return ctx_r11.onPauseResumeClick(); });
    ɵngcc0.ɵɵelement(1, "span", 6);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(5, _c17, ctx_r2.pauseResumeFocused));
    ɵngcc0.ɵɵattribute("tabIndex", 0 - 1);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction2(7, _c18, ctx_r2.isPaused, !ctx_r2.isPaused));
    ɵngcc0.ɵɵattribute("aria-label", ctx_r2.pauseResumeButtonTitle)("title", ctx_r2.pauseResumeButtonTitle);
} }
const _c19 = function (a0, a1) { return { "k-i-cancel": a0, "k-delete k-i-x": a1 }; };
function FileListItemActionButtonComponent_button_4_Template(rf, ctx) { if (rf & 1) {
    const _r13 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 4);
    ɵngcc0.ɵɵlistener("focus", function FileListItemActionButtonComponent_button_4_Template_button_focus_0_listener() { ɵngcc0.ɵɵrestoreView(_r13); const ctx_r12 = ɵngcc0.ɵɵnextContext(); return ctx_r12.onFocus("action"); })("blur", function FileListItemActionButtonComponent_button_4_Template_button_blur_0_listener() { ɵngcc0.ɵɵrestoreView(_r13); const ctx_r14 = ɵngcc0.ɵɵnextContext(); return ctx_r14.onBlur("action"); })("click", function FileListItemActionButtonComponent_button_4_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r13); const ctx_r15 = ɵngcc0.ɵɵnextContext(); return ctx_r15.onRemoveCancelClick(); });
    ɵngcc0.ɵɵelement(1, "span", 6);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction1(5, _c17, ctx_r3.actionFocused));
    ɵngcc0.ɵɵattribute("tabIndex", 0 - 1);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction2(7, _c19, ctx_r3.isUploading, !ctx_r3.isUploading));
    ɵngcc0.ɵɵattribute("aria-label", ctx_r3.actionButtonTitle)("title", ctx_r3.actionButtonTitle);
} }
const _c20 = function (a0, a1, a2) { return { "k-text-error": a0, "k-file-validation-message": a1, "k-file-size": a2 }; };
function FileListMultipleItemsComponent_span_5_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "span", 8);
    ɵngcc0.ɵɵelementStart(1, "span", 9);
    ɵngcc0.ɵɵtext(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementStart(3, "span", 10);
    ɵngcc0.ɵɵtext(4);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const file_r1 = ctx.$implicit;
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("title", file_r1.name);
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate1(" ", file_r1.name, " ");
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction3(4, _c20, file_r1.validationErrors, file_r1.validationErrors, !file_r1.validationErrors));
    ɵngcc0.ɵɵadvance(1);
    ɵngcc0.ɵɵtextInterpolate(ctx_r0.fileStatusText(file_r1));
} }
const _c21 = function (a0, a1) { return { "k-text-success": a0, "k-text-error": a1 }; };
const _c22 = function (a0, a1, a2, a3, a4) { return { "k-file-validation-message": a0, "k-file-size": a1, "k-text-success": a2, "k-text-error": a3, "k-file-information": a4 }; };
var I18N_23;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Cancel button
     * @meaning kendo.upload.cancel
     */ 
    const MSG_EXTERNAL_1628868291685658590$$DIST_FESM2015_INDEX_JS_24 = goog.getMsg("Cancel");
    I18N_23 = MSG_EXTERNAL_1628868291685658590$$DIST_FESM2015_INDEX_JS_24;
}
else {
    I18N_23 = $localize `:kendo.upload.cancel|The text for the Cancel button␟262a7a2e1c2c01f72e494499e4031ca52bfb6c62␟1628868291685658590:Cancel`;
}
var I18N_25;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Clear button
     * @meaning kendo.upload.clearSelectedFiles
     */ 
    const MSG_EXTERNAL_3149650400352762187$$DIST_FESM2015_INDEX_JS_26 = goog.getMsg("Clear");
    I18N_25 = MSG_EXTERNAL_3149650400352762187$$DIST_FESM2015_INDEX_JS_26;
}
else {
    I18N_25 = $localize `:kendo.upload.clearSelectedFiles|The text for the Clear button␟47d53c4c549530374586d580a1fffb90509aa114␟3149650400352762187:Clear`;
}
var I18N_27;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The drop zone hint
     * @meaning kendo.upload.dropFilesHere
     */ 
    const MSG_EXTERNAL_6841325639465061593$$DIST_FESM2015_INDEX_JS_28 = goog.getMsg("Drop files here to upload");
    I18N_27 = MSG_EXTERNAL_6841325639465061593$$DIST_FESM2015_INDEX_JS_28;
}
else {
    I18N_27 = $localize `:kendo.upload.dropFilesHere|The drop zone hint␟ed0e4f0924eb8ac2dfc0a30d0852da2f0a356e8f␟6841325639465061593:Drop files here to upload`;
}
var I18N_29;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The status message for a batch of files
     * @meaning kendo.upload.filesBatchStatus
     */ 
    const MSG_EXTERNAL_1052757211842837603$$DIST_FESM2015_INDEX_JS_30 = goog.getMsg("files");
    I18N_29 = MSG_EXTERNAL_1052757211842837603$$DIST_FESM2015_INDEX_JS_30;
}
else {
    I18N_29 = $localize `:kendo.upload.filesBatchStatus|The status message for a batch of files␟c6ce7b0d23357eba501fa8e17eb2e2c8ce2ca81a␟1052757211842837603:files`;
}
var I18N_31;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The status message for a batch of files after failed upload
     * @meaning kendo.upload.filesBatchStatusFailed
     */ 
    const MSG_EXTERNAL_5934737755327152932$$DIST_FESM2015_INDEX_JS_32 = goog.getMsg("files failed to upload.");
    I18N_31 = MSG_EXTERNAL_5934737755327152932$$DIST_FESM2015_INDEX_JS_32;
}
else {
    I18N_31 = $localize `:kendo.upload.filesBatchStatusFailed|The status message for a batch of files after failed upload␟1b556c65fa0c566e50ca9a29984c0f2c1299f1a1␟5934737755327152932:files failed to upload.`;
}
var I18N_33;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The status message for a batch of files after successful upload
     * @meaning kendo.upload.filesBatchStatusUploaded
     */ 
    const MSG_EXTERNAL_4678582374156884660$$DIST_FESM2015_INDEX_JS_34 = goog.getMsg("files successfully uploaded.");
    I18N_33 = MSG_EXTERNAL_4678582374156884660$$DIST_FESM2015_INDEX_JS_34;
}
else {
    I18N_33 = $localize `:kendo.upload.filesBatchStatusUploaded|The status message for a batch of files after successful upload␟799ee1c7cad3b2114cfbf5cdc4811d87261a2ed8␟4678582374156884660:files successfully uploaded.`;
}
var I18N_35;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The file status message after failed upload
     * @meaning kendo.upload.fileStatusFailed
     */ 
    const MSG_EXTERNAL_372927175642445287$$DIST_FESM2015_INDEX_JS_36 = goog.getMsg("File failed to upload.");
    I18N_35 = MSG_EXTERNAL_372927175642445287$$DIST_FESM2015_INDEX_JS_36;
}
else {
    I18N_35 = $localize `:kendo.upload.fileStatusFailed|The file status message after failed upload␟4a3deae307b634742b5b7d7790c22e60ddd83668␟372927175642445287:File failed to upload.`;
}
var I18N_37;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The file status message after successful upload
     * @meaning kendo.upload.fileStatusUploaded
     */ 
    const MSG_EXTERNAL_6873833183057253097$$DIST_FESM2015_INDEX_JS_38 = goog.getMsg("File successfully uploaded.");
    I18N_37 = MSG_EXTERNAL_6873833183057253097$$DIST_FESM2015_INDEX_JS_38;
}
else {
    I18N_37 = $localize `:kendo.upload.fileStatusUploaded|The file status message after successful upload␟967a89b151d61724cee57583e4c5f50cd5419369␟6873833183057253097:File successfully uploaded.`;
}
var I18N_39;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The header status message when the file upload is paused
     * @meaning kendo.upload.headerStatusPaused
     */ 
    const MSG_EXTERNAL_3443987862990095035$$DIST_FESM2015_INDEX_JS_40 = goog.getMsg("Paused");
    I18N_39 = MSG_EXTERNAL_3443987862990095035$$DIST_FESM2015_INDEX_JS_40;
}
else {
    I18N_39 = $localize `:kendo.upload.headerStatusPaused|The header status message when the file upload is paused␟940cf4e04c5b4fd5e98b4affd35a4b2c9c3036a4␟3443987862990095035:Paused`;
}
var I18N_41;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The header status message after file upload completion
     * @meaning kendo.upload.headerStatusUploaded
     */ 
    const MSG_EXTERNAL_9210921126598204924$$DIST_FESM2015_INDEX_JS_42 = goog.getMsg("Done");
    I18N_41 = MSG_EXTERNAL_9210921126598204924$$DIST_FESM2015_INDEX_JS_42;
}
else {
    I18N_41 = $localize `:kendo.upload.headerStatusUploaded|The header status message after file upload completion␟30d5eeceb66bae90056d593fcf90eecd851b36a4␟9210921126598204924:Done`;
}
var I18N_43;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The header status message during file upload
     * @meaning kendo.upload.headerStatusUploading
     */ 
    const MSG_EXTERNAL_6336385612571616916$$DIST_FESM2015_INDEX_JS_44 = goog.getMsg("Uploading...");
    I18N_43 = MSG_EXTERNAL_6336385612571616916$$DIST_FESM2015_INDEX_JS_44;
}
else {
    I18N_43 = $localize `:kendo.upload.headerStatusUploading|The header status message during file upload␟be0775f64ce53906c132f6b5a50280ff5b948b35␟6336385612571616916:Uploading...`;
}
var I18N_45;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the invalid allowed extensions restriction message
     * @meaning kendo.upload.invalidFileExtension
     */ 
    const MSG_EXTERNAL_2924979995055776233$$DIST_FESM2015_INDEX_JS_46 = goog.getMsg("File type not allowed.");
    I18N_45 = MSG_EXTERNAL_2924979995055776233$$DIST_FESM2015_INDEX_JS_46;
}
else {
    I18N_45 = $localize `:kendo.upload.invalidFileExtension|The text for the invalid allowed extensions restriction message␟8292c7f6c967dcade8639d0dd477a67ad08457c7␟2924979995055776233:File type not allowed.`;
}
var I18N_47;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the invalid max file size restriction message
     * @meaning kendo.upload.invalidMaxFileSize
     */ 
    const MSG_EXTERNAL_6669611501469754964$$DIST_FESM2015_INDEX_JS_48 = goog.getMsg("File size too large.");
    I18N_47 = MSG_EXTERNAL_6669611501469754964$$DIST_FESM2015_INDEX_JS_48;
}
else {
    I18N_47 = $localize `:kendo.upload.invalidMaxFileSize|The text for the invalid max file size restriction message␟1d3c53a4169aceb03929a0dcdd2f4c5436aa4470␟6669611501469754964:File size too large.`;
}
var I18N_49;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the invalid min file size restriction message
     * @meaning kendo.upload.invalidMinFileSize
     */ 
    const MSG_EXTERNAL_4319370666600195324$$DIST_FESM2015_INDEX_JS_50 = goog.getMsg("File size too small.");
    I18N_49 = MSG_EXTERNAL_4319370666600195324$$DIST_FESM2015_INDEX_JS_50;
}
else {
    I18N_49 = $localize `:kendo.upload.invalidMinFileSize|The text for the invalid min file size restriction message␟dde6c68c96cf06aab654c8054c516d0d12f6309a␟4319370666600195324:File size too small.`;
}
var I18N_51;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Pause button
     * @meaning kendo.upload.pause
     */ 
    const MSG_EXTERNAL_2303075305806756763$$DIST_FESM2015_INDEX_JS_52 = goog.getMsg("Pause");
    I18N_51 = MSG_EXTERNAL_2303075305806756763$$DIST_FESM2015_INDEX_JS_52;
}
else {
    I18N_51 = $localize `:kendo.upload.pause|The text for the Pause button␟8a0a61519fec031579cf6b1c4f31c94578bd0981␟2303075305806756763:Pause`;
}
var I18N_53;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Remove button
     * @meaning kendo.upload.remove
     */ 
    const MSG_EXTERNAL_8941644637700654622$$DIST_FESM2015_INDEX_JS_54 = goog.getMsg("Remove");
    I18N_53 = MSG_EXTERNAL_8941644637700654622$$DIST_FESM2015_INDEX_JS_54;
}
else {
    I18N_53 = $localize `:kendo.upload.remove|The text for the Remove button␟1e81e5de447f5792cd15c18c435360a7b946ac70␟8941644637700654622:Remove`;
}
var I18N_55;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Resume button
     * @meaning kendo.upload.resume
     */ 
    const MSG_EXTERNAL_4056147860620862675$$DIST_FESM2015_INDEX_JS_56 = goog.getMsg("Resume");
    I18N_55 = MSG_EXTERNAL_4056147860620862675$$DIST_FESM2015_INDEX_JS_56;
}
else {
    I18N_55 = $localize `:kendo.upload.resume|The text for the Resume button␟f9ef89f76dd3d8c5a3184830d60e4d4f9c4dc998␟4056147860620862675:Resume`;
}
var I18N_57;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Retry button
     * @meaning kendo.upload.retry
     */ 
    const MSG_EXTERNAL_8567960350691997515$$DIST_FESM2015_INDEX_JS_58 = goog.getMsg("Retry");
    I18N_57 = MSG_EXTERNAL_8567960350691997515$$DIST_FESM2015_INDEX_JS_58;
}
else {
    I18N_57 = $localize `:kendo.upload.retry|The text for the Retry button␟9150dfa816d23dfa75f231ca6f053f5e0ae26713␟8567960350691997515:Retry`;
}
var I18N_59;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Select button
     * @meaning kendo.upload.select
     */ 
    const MSG_EXTERNAL_2943392613806104166$$DIST_FESM2015_INDEX_JS_60 = goog.getMsg("Select files...");
    I18N_59 = MSG_EXTERNAL_2943392613806104166$$DIST_FESM2015_INDEX_JS_60;
}
else {
    I18N_59 = $localize `:kendo.upload.select|The text for the Select button␟24063b06532dc5303d28524d6245ba6d3eed80c1␟2943392613806104166:Select files...`;
}
var I18N_61;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc The text for the Upload files button
     * @meaning kendo.upload.uploadSelectedFiles
     */ 
    const MSG_EXTERNAL_4936937427147701307$$DIST_FESM2015_INDEX_JS_62 = goog.getMsg("Upload");
    I18N_61 = MSG_EXTERNAL_4936937427147701307$$DIST_FESM2015_INDEX_JS_62;
}
else {
    I18N_61 = $localize `:kendo.upload.uploadSelectedFiles|The text for the Upload files button␟3449491aa76964a8dceb9ed3957b6fc4c17f568f␟4936937427147701307:Upload`;
}
const _c63 = ["cancel", I18N_23, "clearSelectedFiles", I18N_25, "dropFilesHere", I18N_27, "filesBatchStatus", I18N_29, "filesBatchStatusFailed", I18N_31, "filesBatchStatusUploaded", I18N_33, "fileStatusFailed", I18N_35, "fileStatusUploaded", I18N_37, "headerStatusPaused", I18N_39, "headerStatusUploaded", I18N_41, "headerStatusUploading", I18N_43, "invalidFileExtension", I18N_45, "invalidMaxFileSize", I18N_47, "invalidMinFileSize", I18N_49, "pause", I18N_51, "remove", I18N_53, "resume", I18N_55, "retry", I18N_57, "select", I18N_59, "uploadSelectedFiles", I18N_61];
function UploadComponent_kendo_upload_status_total_9_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-upload-status-total", 10);
} if (rf & 2) {
    const ctx_r2 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("fileList", ctx_r2.fileList);
} }
function UploadComponent_ul_12_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "ul", 11);
} if (rf & 2) {
    const ctx_r3 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r3.disabled)("fileList", ctx_r3.fileList.files)("fileTemplate", ctx_r3.fileTemplate);
} }
function UploadComponent_kendo_upload_action_buttons_13_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelement(0, "kendo-upload-action-buttons", 12);
} if (rf & 2) {
    const ctx_r4 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵproperty("disabled", ctx_r4.disabled)("actionsLayout", ctx_r4.actionsLayout);
} }
var I18N_64;
if (typeof ngI18nClosureMode !== "undefined" && ngI18nClosureMode) {
    /**
     * @desc Sets the external drop-zone hint
     * @meaning kendo.uploaddropzone.externalDropFilesHere
     */ 
    const MSG_EXTERNAL_4908353240416682626$$DIST_FESM2015_INDEX_JS_65 = goog.getMsg("Drag and drop files here to upload");
    I18N_64 = MSG_EXTERNAL_4908353240416682626$$DIST_FESM2015_INDEX_JS_65;
}
else {
    I18N_64 = $localize `:kendo.uploaddropzone.externalDropFilesHere|Sets the external drop-zone hint␟0b9299bc1023ea6dce824348625df34e3ca92374␟4908353240416682626:Drag and drop files here to upload`;
}
const _c66 = ["externalDropFilesHere", I18N_64];
const _c67 = ["*"];
const _c68 = ["clearButton"];
const _c69 = ["uploadButton"];
const _c70 = function (a0, a1, a2, a3) { return { "k-i-checkmark": a0, "k-i-exception": a1, "k-i-upload": a2, "k-i-pause-sm": a3 }; };
var FileState;
(function (FileState) {
    /**
     * The file upload process has failed.
     */
    FileState[FileState["Failed"] = 0] = "Failed";
    /**
     * An initially selected fake file without a set state.
     */
    FileState[FileState["Initial"] = 1] = "Initial";
    /**
     * The file is selected.
     */
    FileState[FileState["Selected"] = 2] = "Selected";
    /**
     * The file is successfully uploaded.
     */
    FileState[FileState["Uploaded"] = 3] = "Uploaded";
    /**
     * The file is in the process of uploading.
     */
    FileState[FileState["Uploading"] = 4] = "Uploading";
    /**
     * The file upload process has been paused.
     */
    FileState[FileState["Paused"] = 5] = "Paused";
})(FileState || (FileState = {}));

/**
 * @hidden
 */
class FileMap {
    constructor() {
        this._files = {};
    }
    add(file) {
        let uid = file.uid;
        if (this.has(uid)) {
            if (file.validationErrors && file.validationErrors.length > 0) {
                this._files[uid].unshift(file);
            }
            else {
                this._files[uid].push(file);
            }
        }
        else {
            this._files[uid] = [file];
        }
    }
    remove(uid) {
        if (this.has(uid)) {
            this._files[uid] = null;
            delete this._files[uid];
        }
    }
    clear() {
        let allFiles = this._files;
        for (let uid in allFiles) {
            if (allFiles.hasOwnProperty(uid)) {
                for (let file of allFiles[uid]) {
                    if (file.httpSubscription) {
                        file.httpSubscription.unsubscribe();
                    }
                }
                allFiles[uid] = null;
                delete allFiles[uid];
            }
        }
    }
    has(uid) {
        return uid in this._files;
    }
    get(uid) {
        return this._files[uid];
    }
    setFilesState(files, state$$1) {
        for (let file of files) {
            this.setFilesStateByUid(file.uid, state$$1);
        }
    }
    setFilesStateByUid(uid, state$$1) {
        this.get(uid).forEach((f) => {
            f.state = state$$1;
        });
    }
    get count() {
        return Object.getOwnPropertyNames(this._files).length;
    }
    get files() {
        let initial = this._files;
        let transformed = [];
        for (let uid in initial) {
            if (initial.hasOwnProperty(uid)) {
                transformed.push(initial[uid]);
            }
        }
        return transformed;
    }
    get filesFlat() {
        let initial = this._files;
        let transformed = [];
        for (let uid in initial) {
            if (initial.hasOwnProperty(uid)) {
                let current = initial[uid];
                current.forEach((file) => {
                    transformed.push(file);
                });
            }
        }
        return transformed;
    }
    get filesToUpload() {
        let files = this._files;
        let notUploaded = [];
        for (let uid in files) {
            if (files.hasOwnProperty(uid)) {
                let currentFiles = files[uid];
                let currentFilesValid = true;
                for (let file of currentFiles) {
                    if (file.state !== FileState.Selected || (file.validationErrors && file.validationErrors.length > 0)) {
                        currentFilesValid = false;
                    }
                }
                if (currentFilesValid) {
                    notUploaded.push(currentFiles);
                }
            }
        }
        return notUploaded;
    }
    get firstFileToUpload() {
        let files = this._files;
        for (let uid in files) {
            if (files.hasOwnProperty(uid)) {
                let currentFiles = files[uid];
                let currentFilesValid = true;
                for (let file of currentFiles) {
                    if (file.state !== FileState.Selected || (file.validationErrors && file.validationErrors.length > 0)) {
                        currentFilesValid = false;
                    }
                }
                if (currentFilesValid) {
                    return currentFiles;
                }
            }
        }
        return null;
    }
    hasFileWithState(fileStates) {
        let files = this._files;
        for (let uid in files) {
            if (files.hasOwnProperty(uid)) {
                let currentFiles = files[uid];
                for (let file of currentFiles) {
                    if (fileStates.indexOf(file.state) >= 0) {
                        return true;
                    }
                }
            }
        }
        return false;
    }
}

/**
 * Arguments for the `cancel` event. The `cancel` event fires when
 * the user cancels the process of uploading a file or a batch of files.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <p>Click the <span class='k-icon k-i-cancel'></span> icon during upload to trigger the event</p>
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (cancel)="cancelEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    cancelEventHandler(e: CancelEvent) {
 *      console.log('Canceling file upload', e.files);
 *    }
 *  }
 * ```
 */
class CancelEvent {
    /**
     * Constructs the event arguments for the `cancel` event.
     * @param files - The list of the files that were going to be uploaded.
     */
    constructor(files) {
        this.files = files;
    }
}

/**
 * @hidden
 */
class PreventableEvent {
    constructor() {
        this.prevented = false;
    }
    /**
     * Prevents the default action for a specified event.
     * In this way, the source component suppresses the built-in behavior that follows the event.
     */
    preventDefault() {
        this.prevented = true;
    }
    /**
     * If the event is prevented by any of its subscribers, returns `true`.
     *
     * @returns `true` if the default action was prevented. Otherwise, returns `false`.
     */
    isDefaultPrevented() {
        return this.prevented;
    }
}

/**
 * Arguments for the `clear` event. The `clear` event fires when
 * the **Clear** button is clicked. At this point, the selected files are about to be cleared.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [autoUpload]="false"
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (clear)="clearEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    clearEventHandler(e: ClearEvent) {
 *      console.log('Clearing the file upload');
 *    }
 *  }
 * ```
 */
class ClearEvent extends PreventableEvent {
    /**
     * Constructs the event arguments for the `clear` event.
     */
    constructor() { super(); }
}

/**
 * Arguments for the `error` event. The `error` event fires when
 * an `upload` or `remove` operation fails.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (error)="errorEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    errorEventHandler(e: ErrorEvent) {
 *      console.log('An error occurred');
 *    }
 *  }
 * ```
 */
class ErrorEvent {
    /**
     * Constructs the event arguments for the `error` event.
     *
     * @param files - The list of the files that failed to be uploaded or removed.
     * @param operation - The operation type (`upload` or `remove`).
     * @param response - The response object returned by the server.
     */
    constructor(files, operation, response) {
        this.files = files;
        this.operation = operation;
        this.response = response;
    }
}

/**
 * Arguments for the `pause` event. The `pause` event fires when the user
 * pauses a file that is currently uploading.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [chunkable]="true"
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (pause)="pauseEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    pauseEventHandler(ev: PauseEvent) {
 *      console.log('File paused');
 *    }
 *  }
 * ```
 *
 */
class PauseEvent {
    /**
     * Constructs the event arguments for the `pause` event.
     * @param file - The file that is going to be paused.
     */
    constructor(file) {
        this.file = file;
    }
}

/**
 * Arguments for the `remove` event. The `remove` event fires when an uploaded
 * or selected file is about to be removed. If you cancel the event, the removal is prevented.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (remove)="removeEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    removeEventHandler(e: RemoveEvent) {
 *      console.log('Removing a file');
 *    }
 *  }
 * ```
 */
class RemoveEvent extends PreventableEvent {
    /**
     * Constructs the event arguments for the `remove` event.
     * @param files - The list of the files that will be removed.
     * @param headers - The headers of the request.
     */
    constructor(files, headers) {
        super();
        this.files = files;
        this.headers = headers;
    }
}

/**
 * Arguments for the `resume` event. The `resume` event fires when the user
 * resumes the upload of a file that has been previously paused.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [chunkable]="true"
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (resume)="resumeEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    resumeEventHandler(ev: ResumeEvent) {
 *      console.log('File resumed');
 *    }
 *  }
 * ```
 *
 */
class ResumeEvent {
    /**
     * Constructs the event arguments for the `resume` event.
     * @param file - The file that is going to be resumed.
     */
    constructor(file) {
        this.file = file;
    }
}

/**
 * Arguments for the `select` event. The `select` event fires when the user
 * selects a file or multiple files for upload. If you cancel the event, the selection is prevented.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (select)="selectEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    selectEventHandler(e: SelectEvent) {
 *      console.log('File selected');
 *    }
 *  }
 * ```
 */
class SelectEvent extends PreventableEvent {
    /**
     * Constructs the event arguments for the `select` event.
     * @param files - The list of the selected files.
     */
    constructor(files) {
        super();
        this.files = files;
    }
}

/**
 * Arguments for the `success` event. The `success` event fires when
 * the selected files are successfully uploaded or removed.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (success)="successEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    successEventHandler(e: SuccessEvent) {
 *      console.log('The ' + e.operation + ' was successful!');
 *    }
 *  }
 * ```
 */
class SuccessEvent extends PreventableEvent {
    /**
     * Constructs the event arguments for the `success` event.
     * @param files - The list of the files that were uploaded or removed.
     * @param operation - The operation type (`upload` or `remove`).
     * @param response - The response object returned by the server.
     */
    constructor(files, operation, response) {
        super();
        this.files = files;
        this.operation = operation;
        this.response = response;
    }
}

/**
 * Arguments for the `upload` event. The `upload` event fires when one or more files are about
 * to be uploaded. If you cancel the event, the upload is prevented. You can add headers to the request.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (upload)="uploadEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    uploadEventHandler(e: UploadEvent) {
 *      e.headers = e.headers.append('X-Foo', 'Bar');
 *    }
 *  }
 * ```
 */
class UploadEvent extends PreventableEvent {
    /**
     * Constructs the event arguments for the `upload` event.
     * @param files - The list of the files that will be uploaded.
     * @param headers - The headers of the request.
     */
    constructor(files, headers) {
        super();
        this.files = files;
        this.headers = headers;
    }
}

/**
 * Arguments for the `uploadprogress` event. The `uploadprogress` event
 * fires when the files are in the process of uploading.
 *
 * ```ts-no-run
 *  @Component({
 *    selector: 'my-upload',
 *    template: `
 *    <kendo-upload
 *      [saveUrl]="uploadSaveUrl"
 *      [removeUrl]="uploadRemoveUrl"
 *      (uploadProgress)="uploadProgressEventHandler($event)">
 *    </kendo-upload>
 *    `
 *  })
 *  export class UploadComponent {
 *    uploadSaveUrl = 'saveUrl'; // should represent an actual API endpoint
 *    uploadRemoveUrl = 'removeUrl'; // should represent an actual API endpoint
 *
 *    uploadProgressEventHandler(e: UploadProgressEvent) {
 *      console.log(e.files[0].name + ' is ' + e.percentComplete + ' uploaded');
 *    }
 *  }
 * ```
 */
class UploadProgressEvent {
    /**
     * Constructs the event arguments for the `uploadprogress` event.
     * @param files - The list of files that are being uploaded.
     * @param percentComplete - The portion that has been uploaded.
     */
    constructor(files, percentComplete) {
        this.files = files;
        this.percentComplete = percentComplete;
    }
}

/**
 * @hidden
 */
const fileGroupMap = {
    audio: [
        ".aif", ".iff", ".m3u", ".m4a", ".mid", ".mp3", ".mpa", ".wav", ".wma", ".ogg", ".wav", ".wma", ".wpl"
    ],
    video: [
        ".3g2", ".3gp", ".avi", ".asf", ".flv", ".m4u", ".rm", ".h264", ".m4v", ".mkv", ".mov", ".mp4", ".mpg", ".rm", ".swf", ".vob", ".wmv"
    ],
    image: [
        ".ai", ".dds", ".heic", ".jpe", "jfif", ".jif", ".jp2", ".jps", ".eps", ".bmp", ".gif", ".jpeg", ".jpg", ".png", ".ps", ".psd", ".svg", ".svgz", ".tif", ".tiff"
    ],
    txt: [
        ".doc", ".docx", ".log", ".pages", ".tex", ".wpd", ".wps", ".odt", ".rtf", ".text", ".txt", ".wks"
    ],
    presentation: [
        ".key", ".odp", ".pps", ".ppt", ".pptx"
    ],
    data: [
        ".xlr", ".xls", ".xlsx"
    ],
    programming: [
        ".tmp", ".bak", ".msi", ".cab", ".cpl", ".cur", ".dll", ".dmp", ".drv", ".icns", ".ico", ".link", ".sys", ".cfg",
        ".ini", ".asp", ".aspx", ".cer", ".csr", ".css", ".dcr", ".htm", ".html", ".js", ".php", ".rss", ".xhtml"
    ],
    pdf: [
        ".pdf"
    ],
    config: [
        ".apk", ".app", ".bat", ".cgi", ".com", ".exe", ".gadget", ".jar", ".wsf"
    ],
    zip: [
        ".7z", ".cbr", ".gz", ".sitx", ".arj", ".deb", ".pkg", ".rar", ".rpm", ".tar.gz", ".z", ".zip", ".zipx"
    ],
    discImage: [
        ".dmg", ".iso", ".toast", ".vcd", ".bin", ".cue", ".mdf"
    ]
};

/* tslint:disable: no-bitwise */
/**
 * @hidden
 */
const getTotalFilesSizeMessage = (files) => {
    let totalSize = 0;
    let i;
    if (typeof files[0].size === "number") {
        for (i = 0; i < files.length; i++) {
            if (files[i].size) {
                totalSize += files[i].size;
            }
        }
    }
    else {
        return "";
    }
    totalSize /= 1024;
    if (totalSize < 1024) {
        return totalSize.toFixed(2) + " KB";
    }
    else {
        return (totalSize / 1024).toFixed(2) + " MB";
    }
};
const stripPath = (name) => {
    let slashIndex = name.lastIndexOf("\\");
    return (slashIndex !== -1) ? name.substr(slashIndex + 1) : name;
};
const getFileExtension = (fileName) => {
    const rFileExtension = /\.([^\.]+)$/;
    const matches = fileName.match(rFileExtension);
    return matches ? matches[0] : "";
};
/**
 * @hidden
 */
const validateInitialFileInfo = (file) => {
    if (file instanceof Object && file.hasOwnProperty("name")) {
        return true;
    }
    return false;
};
/**
 * @hidden
 */
const validateInitialFileSelectFile = (file) => {
    if (file instanceof File || validateInitialFileInfo(file)) {
        return true;
    }
    return false;
};
/**
 * @hidden
 */
const getInitialFileInfo = (fakeFile) => {
    fakeFile.extension = fakeFile.extension || getFileExtension(fakeFile.name);
    fakeFile.name = fakeFile.name;
    fakeFile.size = fakeFile.size || 0;
    if (!fakeFile.hasOwnProperty("state")) {
        fakeFile.state = FileState.Initial;
    }
    if (!fakeFile.hasOwnProperty("uid")) {
        fakeFile.uid = guid();
    }
    return fakeFile;
};
/**
 * @hidden
 */
const convertFileToFileInfo = (file) => {
    let fileInfo = getFileInfo(file);
    fileInfo.uid = guid();
    // Used to differentiate initial FileInfo objects and actual Files
    fileInfo.state = FileState.Selected;
    return fileInfo;
};
const getFileInfo = (rawFile) => {
    const fileName = rawFile.name;
    const fileSize = rawFile.size;
    return {
        extension: getFileExtension(fileName),
        name: fileName,
        rawFile: rawFile,
        size: fileSize,
        state: FileState.Selected
    };
};
/**
 * @hidden
 */
const getAllFileInfo = (rawFiles) => {
    let allFileInfo = new Array();
    let i;
    for (i = 0; i < rawFiles.length; i++) {
        allFileInfo.push(getFileInfo(rawFiles[i]));
    }
    return allFileInfo;
};
/**
 * @hidden
 */
const fileHasValidationErrors = (file) => {
    if (file.validationErrors && file.validationErrors.length > 0) {
        return true;
    }
    return false;
};
/**
 * @hidden
 */
const filesHaveValidationErrors = (files) => {
    for (let file of files) {
        if (fileHasValidationErrors(file)) {
            return true;
        }
    }
    return false;
};
/**
 * @hidden
 */
const inputFiles = (input) => {
    if (input.files) {
        return getAllFileInfo(input.files);
    }
    else {
        //Required for testing
        let fileNames = input.value.split("|").map((file, index) => {
            let fileName = file.trim();
            return {
                extension: getFileExtension(fileName),
                name: stripPath(fileName),
                rawFile: null,
                size: (index + 1) * 1000,
                state: FileState.Selected
            };
        });
        return fileNames;
    }
};
/**
 * @hidden
 */
const assignGuidToFiles = (files, isUnique) => {
    const uid = guid();
    return files.map((file) => {
        file.uid = isUnique ? guid() : uid;
        return file;
    });
};
const focusableRegex = /^(?:a|input|select|textarea|button|object)$/i;
/**
 * @hidden
 */
const IGNORE_TARGET_CLASSES = 'k-icon k-select k-input k-multiselect-wrap';
/**
 * @hidden
 */
const UPLOAD_CLASSES = 'k-upload-button k-clear-selected k-upload-selected k-upload-action';
const isVisible = (element) => {
    const rect = element.getBoundingClientRect();
    return !!(rect.width && rect.height) && window.getComputedStyle(element).visibility !== 'hidden';
};
const toClassList = (classNames) => String(classNames).trim().split(' ');
/**
 * @hidden
 */
const hasClasses = (element, classNames) => {
    const namesList = toClassList(classNames);
    return Boolean(toClassList(element.className).find((className) => namesList.indexOf(className) >= 0));
};
/**
 * @hidden
 */
const isFocusable = (element, checkVisibility = true) => {
    if (element.tagName) {
        const tagName = element.tagName.toLowerCase();
        const tabIndex = element.getAttribute('tabIndex');
        const validTabIndex = tabIndex !== null && !isNaN(tabIndex) && tabIndex > -1;
        let focusable = false;
        if (focusableRegex.test(tagName)) {
            focusable = !element.disabled;
        }
        else {
            focusable = validTabIndex;
        }
        return focusable && (!checkVisibility || isVisible(element));
    }
    return false;
};
/**
 * @hidden
 */
const getFileGroupCssClass = (fileExtension) => {
    const initial = 'k-i-file';
    for (let group in fileGroupMap) {
        if (fileGroupMap[group].indexOf(fileExtension) >= 0) {
            return `${initial}-${group}`;
        }
    }
    return initial;
};
/**
 * @hidden
 */
const isPresent = (value) => value !== null && value !== undefined;

/**
 * @hidden
 */
class ChunkMap {
    constructor() {
        this._files = {};
    }
    add(uid, totalChunks) {
        const initialChunkInfo = {
            index: 0,
            position: 0,
            retries: 0,
            totalChunks: totalChunks
        };
        this._files[uid] = initialChunkInfo;
        return initialChunkInfo;
    }
    remove(uid) {
        if (this.has(uid)) {
            this._files[uid] = null;
            delete this._files[uid];
        }
    }
    has(uid) {
        return uid in this._files;
    }
    get(uid) {
        return this._files[uid];
    }
}

/**
 * @hidden
 */
class UploadService {
    constructor(http) {
        this.http = http;
        this.cancelEvent = new EventEmitter();
        this.clearEvent = new EventEmitter();
        this.completeEvent = new EventEmitter();
        this.errorEvent = new EventEmitter();
        this.pauseEvent = new EventEmitter();
        this.removeEvent = new EventEmitter();
        this.resumeEvent = new EventEmitter();
        this.selectEvent = new EventEmitter();
        this.successEvent = new EventEmitter();
        this.uploadEvent = new EventEmitter();
        this.uploadProgressEvent = new EventEmitter();
        /**
         * Required for the `ControlValueAccessor` integration
         */
        this.changeEvent = new EventEmitter();
        /**
         * Default async settings
         */
        this.async = {
            autoUpload: true,
            batch: false,
            chunk: false,
            concurrent: true,
            removeField: "fileNames",
            removeHeaders: new HttpHeaders(),
            removeMethod: "POST",
            removeUrl: "",
            responseType: "json",
            saveField: "files",
            saveHeaders: new HttpHeaders(),
            saveMethod: "POST",
            saveUrl: "",
            withCredentials: true
        };
        /**
         * Default chunk settings
         */
        this.chunk = {
            autoRetryAfter: 100,
            size: 1024 * 1024,
            maxAutoRetries: 1,
            resumable: true
        };
        this.component = 'Upload';
        this.chunkMap = new ChunkMap();
        this.fileList = new FileMap();
    }
    get files() {
        return this.fileList;
    }
    setChunkSettings(settings) {
        if (settings !== false) {
            this.async.chunk = true;
            if (typeof settings === "object") {
                this.chunk = Object.assign({}, this.chunk, settings);
            }
        }
    }
    onChange() {
        let files = this.fileList.filesFlat.filter((file) => {
            return file.state === FileState.Initial ||
                file.state === FileState.Uploaded;
        });
        this.changeEvent.emit(files.length > 0 ? files : null);
    }
    addFiles(files) {
        let selectEventArgs = new SelectEvent(files);
        this.selectEvent.emit(selectEventArgs);
        if (!selectEventArgs.isDefaultPrevented()) {
            for (let file of files) {
                this.fileList.add(file);
            }
            if (this.async.autoUpload) {
                this.uploadFiles();
            }
        }
        if (this.component === 'FileSelect') {
            const flatFiles = this.fileList.filesFlat;
            this.changeEvent.emit(flatFiles.length > 0 ? flatFiles : null);
        }
    }
    addInitialFiles(initialFiles) {
        this.fileList.clear();
        initialFiles.forEach((file) => {
            let fakeFile = getInitialFileInfo(file);
            this.fileList.add(fakeFile);
        });
    }
    addInitialFileSelectFiles(initialFiles) {
        this.fileList.clear();
        initialFiles.forEach((file) => {
            if (file instanceof File) {
                this.fileList.add(convertFileToFileInfo(file));
            }
            else {
                this.fileList.add(getInitialFileInfo(file));
            }
        });
    }
    resumeFile(uid) {
        const fileToResume = this.fileList.get(uid);
        this.resumeEvent.emit(new ResumeEvent(fileToResume[0]));
        this.fileList.setFilesStateByUid(uid, FileState.Uploading);
        this._uploadFiles([fileToResume]);
    }
    pauseFile(uid) {
        let pausedFile = this.fileList.get(uid)[0];
        this.pauseEvent.emit(new PauseEvent(pausedFile));
        this.fileList.setFilesStateByUid(uid, FileState.Paused);
    }
    removeFiles(uid) {
        let removedFiles = this.fileList.get(uid);
        // Clone the Headers so that the default ones are not overridden
        let removeEventArgs = new RemoveEvent(removedFiles, this.cloneRequestHeaders(this.async.removeHeaders));
        this.removeEvent.emit(removeEventArgs);
        if (!removeEventArgs.isDefaultPrevented()) {
            if (this.component === 'Upload' &&
                (removedFiles[0].state === FileState.Uploaded ||
                    removedFiles[0].state === FileState.Initial)) {
                this.performRemove(removedFiles, removeEventArgs);
            }
            else {
                this.fileList.remove(uid);
                if (this.component === 'FileSelect') {
                    const flatFiles = this.fileList.filesFlat;
                    this.changeEvent.emit(flatFiles.length > 0 ? flatFiles : null);
                }
            }
        }
    }
    cancelFiles(uid) {
        let canceledFiles = this.fileList.get(uid);
        let cancelEventArgs = new CancelEvent(canceledFiles);
        this.cancelEvent.emit(cancelEventArgs);
        for (let file of canceledFiles) {
            if (file.httpSubscription) {
                file.httpSubscription.unsubscribe();
            }
        }
        this.fileList.remove(uid);
        this.checkAllComplete();
    }
    clearFiles() {
        let clearEventArgs = new ClearEvent();
        this.clearEvent.emit(clearEventArgs);
        if (!clearEventArgs.isDefaultPrevented()) {
            let triggerChange = this.fileList.hasFileWithState([
                FileState.Initial,
                FileState.Uploaded
            ]);
            this.fileList.clear();
            if (triggerChange) {
                this.onChange();
            }
        }
    }
    uploadFiles() {
        let filesToUpload = [];
        if (this.async.concurrent) {
            filesToUpload = this.fileList.filesToUpload;
        }
        if (!this.async.concurrent && !this.fileList.hasFileWithState([FileState.Uploading])) {
            filesToUpload = [this.fileList.firstFileToUpload];
        }
        if (filesToUpload && filesToUpload.length > 0) {
            this._uploadFiles(filesToUpload);
        }
    }
    retryFiles(uid) {
        let filesToRetry = [this.fileList.get(uid)];
        if (filesToRetry) {
            this._uploadFiles(filesToRetry);
        }
    }
    _uploadFiles(allFiles) {
        for (let filesToUpload of allFiles) {
            if (filesToUpload[0].state === FileState.Paused) {
                return;
            }
            // Clone the Headers so that the default ones are not overridden
            let uploadEventArgs = new UploadEvent(filesToUpload, this.cloneRequestHeaders(this.async.saveHeaders));
            this.uploadEvent.emit(uploadEventArgs);
            if (!uploadEventArgs.isDefaultPrevented()) {
                this.fileList.setFilesState(filesToUpload, FileState.Uploading);
                let httpSubcription = this.performUpload(filesToUpload, uploadEventArgs);
                filesToUpload.forEach((file) => {
                    file.httpSubscription = httpSubcription;
                });
            }
            else {
                this.fileList.remove(filesToUpload[0].uid);
            }
        }
    }
    performRemove(files, removeEventArgs) {
        const async = this.async;
        let fileNames = files.map((file) => {
            return file.name;
        });
        let formData = this.populateRemoveFormData(fileNames, removeEventArgs.data);
        let options = this.populateRequestOptions(removeEventArgs.headers);
        let removeRequest = new HttpRequest(async.removeMethod, async.removeUrl, formData, options);
        this.http.request(removeRequest)
            .subscribe(success => {
            this.onSuccess(success, files, "remove");
        }, error => {
            this.onError(error, files, "remove");
        });
    }
    performUpload(files, uploadEventArgs) {
        const async = this.async;
        let formData = this.populateUploadFormData(files, uploadEventArgs.data);
        let options = this.populateRequestOptions(uploadEventArgs.headers);
        let uploadRequest = new HttpRequest(async.saveMethod, async.saveUrl, formData, options);
        let httpSubscription = this.http.request(uploadRequest)
            .subscribe(event => {
            if (event.type === HttpEventType.UploadProgress && !this.async.chunk) {
                this.onProgress(event, files);
            }
            else if (event instanceof HttpResponse) {
                this.onSuccess(event, files, "upload");
                this.checkAllComplete();
            }
        }, error => {
            this.onError(error, files, "upload");
            this.checkAllComplete();
        });
        return httpSubscription;
    }
    onSuccess(successResponse, files, operation) {
        if (operation === "upload" && this.async.chunk) {
            this.onChunkProgress(files);
            if (this.isChunkUploadComplete(files[0].uid)) {
                this.removeChunkInfo(files[0].uid);
            }
            else {
                this.updateChunkInfo(files[0].uid);
                this._uploadFiles([files]);
                return;
            }
        }
        const successArgs = new SuccessEvent(files, operation, successResponse);
        this.successEvent.emit(successArgs);
        if (operation === "upload") {
            this.fileList.setFilesState(files, successArgs.isDefaultPrevented() ? FileState.Failed : FileState.Uploaded);
        }
        else {
            if (!successArgs.isDefaultPrevented()) {
                this.fileList.remove(files[0].uid);
            }
        }
        if (!successArgs.isDefaultPrevented()) {
            this.onChange();
        }
    }
    onError(errorResponse, files, operation) {
        if (operation === "upload" && this.async.chunk) {
            const maxRetries = this.chunk.maxAutoRetries;
            const chunkInfo = this.chunkMap.get(files[0].uid);
            if (chunkInfo.retries < maxRetries) {
                chunkInfo.retries += 1;
                setTimeout(() => {
                    this.retryFiles(files[0].uid);
                }, this.chunk.autoRetryAfter);
                return;
            }
        }
        const errorArgs = new ErrorEvent(files, operation, errorResponse);
        this.errorEvent.emit(errorArgs);
        if (operation === "upload") {
            this.fileList.setFilesState(files, FileState.Failed);
        }
    }
    onProgress(event, files) {
        const percentComplete = Math.round(100 * event.loaded / event.total);
        const progressArgs = new UploadProgressEvent(files, percentComplete < 100 ? percentComplete : 100);
        this.uploadProgressEvent.emit(progressArgs);
    }
    onChunkProgress(files) {
        const chunkInfo = this.chunkMap.get(files[0].uid);
        let percentComplete = 0;
        if (chunkInfo) {
            if (chunkInfo.index === chunkInfo.totalChunks - 1) {
                percentComplete = 100;
            }
            else {
                percentComplete = Math.round(((chunkInfo.index + 1) / chunkInfo.totalChunks) * 100);
            }
        }
        const progressArgs = new UploadProgressEvent(files, percentComplete < 100 ? percentComplete : 100);
        this.uploadProgressEvent.emit(progressArgs);
    }
    checkAllComplete() {
        if (!this.fileList.hasFileWithState([
            FileState.Selected,
            FileState.Uploading,
            FileState.Paused
        ])) {
            this.completeEvent.emit();
        }
        else if (this.shouldUploadNextFile()) {
            this.uploadFiles();
        }
    }
    shouldUploadNextFile() {
        return !this.async.concurrent &&
            this.fileList.hasFileWithState([FileState.Selected]) &&
            !this.fileList.hasFileWithState([FileState.Uploading]);
    }
    cloneRequestHeaders(headers) {
        let cloned = {};
        if (headers) {
            headers.keys().forEach((key) => {
                cloned[key] = headers.get(key);
            });
        }
        return new HttpHeaders(cloned);
    }
    populateRequestOptions(headers) {
        return {
            headers: headers,
            reportProgress: true,
            responseType: this.async.responseType,
            withCredentials: this.async.withCredentials
        };
    }
    populateUploadFormData(files, clientData) {
        const saveField = this.async.saveField;
        let data = new FormData();
        this.populateClientFormData(data, clientData);
        if (this.async.chunk) {
            data.append(saveField, this.getNextChunk(files[0]));
            data.append("metadata", this.getChunkMetadata(files[0]));
        }
        else {
            for (let file of files) {
                data.append(saveField, file.rawFile);
            }
        }
        return data;
    }
    populateRemoveFormData(fileNames, clientData) {
        let data = new FormData();
        this.populateClientFormData(data, clientData);
        for (let fileName of fileNames) {
            data.append(this.async.removeField, fileName);
        }
        return data;
    }
    populateClientFormData(data, clientData) {
        for (var key in clientData) {
            if (clientData.hasOwnProperty(key)) {
                data.append(key, clientData[key]);
            }
        }
    }
    /* Chunking Helper Methods Section */
    getNextChunk(file) {
        const info = this.getChunkInfo(file);
        const newPosition = info.position + this.chunk.size;
        return file.rawFile.slice(info.position, newPosition);
    }
    getChunkInfo(file) {
        let chunkInfo = this.chunkMap.get(file.uid);
        if (!chunkInfo) {
            const totalChunks = Math.ceil(file.size / this.chunk.size);
            chunkInfo = this.chunkMap.add(file.uid, totalChunks);
        }
        return chunkInfo;
    }
    updateChunkInfo(uid) {
        const chunkInfo = this.chunkMap.get(uid);
        if (chunkInfo.index < chunkInfo.totalChunks - 1) {
            chunkInfo.index += 1;
            chunkInfo.position += this.chunk.size;
            chunkInfo.retries = 0;
        }
    }
    removeChunkInfo(uid) {
        this.chunkMap.remove(uid);
    }
    getChunkMetadata(file) {
        const chunkInfo = this.chunkMap.get(file.uid);
        const chunkMetadata = {
            chunkIndex: chunkInfo.index,
            contentType: file.rawFile.type,
            fileName: file.name,
            fileSize: file.size,
            fileUid: file.uid,
            totalChunks: chunkInfo.totalChunks
        };
        return JSON.stringify(chunkMetadata);
    }
    isChunkUploadComplete(uid) {
        const chunkInfo = this.chunkMap.get(uid);
        if (chunkInfo) {
            return chunkInfo.index + 1 === chunkInfo.totalChunks;
        }
        return false;
    }
}
UploadService.ɵfac = function UploadService_Factory(t) { return new (t || UploadService)(ɵngcc0.ɵɵinject(ɵngcc1.HttpClient)); };
UploadService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: UploadService, factory: UploadService.ɵfac });
/** @nocollapse */
UploadService.ctorParameters = () => [
    { type: HttpClient }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadService, [{
        type: Injectable
    }], function () { return [{ type: ɵngcc1.HttpClient }]; }, null); })();

/**
 * @hidden
 */
class NavigationService {
    constructor(uploadService) {
        this.uploadService = uploadService;
        this.onActionButtonAction = new EventEmitter();
        this.onActionButtonFocus = new EventEmitter();
        this.onFileAction = new EventEmitter();
        this.onFileFocus = new EventEmitter();
        this.onTab = new EventEmitter();
        this.onWrapperFocus = new EventEmitter();
        this.onSelectButtonFocus = new EventEmitter();
        this.actionButtonsVisible = false;
        this.focused = false;
        this._focusedIndex = -1;
    }
    action(event) {
        const key = event.keyCode;
        return this.keyBindings[key];
    }
    process(event) {
        const handler = this.action(event);
        if (handler) {
            handler(event.shiftKey);
        }
    }
    computeKeys(direction) {
        this.keyBindings = {
            [Keys.Enter]: () => this.handleEnter(),
            [Keys.Escape]: () => this.handleEscape(),
            [Keys.Delete]: () => this.handleDelete(),
            [Keys.Tab]: (shifted) => this.handleTab(shifted),
            [Keys.ArrowUp]: () => this.handleUp(),
            [Keys.ArrowDown]: () => this.handleDown(),
            [this.invertKeys(direction, Keys.ArrowLeft, Keys.ArrowRight)]: () => this.handleLeft(),
            [this.invertKeys(direction, Keys.ArrowRight, Keys.ArrowLeft)]: () => this.handleRight()
        };
    }
    invertKeys(direction, original, inverted) {
        return direction === 'rtl' ? inverted : original;
    }
    focusSelectButton() {
        this.focused = true;
        this._focusedIndex = -1;
        this.onSelectButtonFocus.emit();
    }
    handleEnter() {
        if (this.lastIndex >= 0) {
            if (this.focusedIndex <= this.lastFileIndex) {
                this.onFileAction.emit(Keys.Enter);
                return;
            }
            if (this.actionButtonsVisible && this.focusedIndex <= this.lastIndex) {
                this.onActionButtonAction.emit(this.focusedIndex < this.lastIndex ? "clear" : "upload");
            }
        }
    }
    handleDelete() {
        if (this.focusedIndex >= 0 && this.focusedIndex <= this.lastFileIndex) {
            this.onFileAction.emit(Keys.Delete);
        }
    }
    handleEscape() {
        if (this.focusedIndex >= 0 && this.focusedIndex <= this.lastFileIndex) {
            this.onFileAction.emit(Keys.Escape);
        }
    }
    handleLeft() {
        if (this.actionButtonsVisible && this.focusedIndex === this.lastIndex) {
            this.focusedIndex -= 1;
            this.onActionButtonFocus.emit("clear");
        }
    }
    handleRight() {
        if (this.actionButtonsVisible && this.focusedIndex === this.lastIndex - 1) {
            this.focusedIndex += 1;
            this.onActionButtonFocus.emit("upload");
        }
    }
    handleTab(shifted) {
        if (this.focusedIndex >= 0 && shifted) {
            this.focusedIndex = -1;
            return;
        }
        this.onTab.emit();
    }
    handleDown() {
        if (this.lastIndex >= 0 && this.focusedIndex < this.lastIndex) {
            if (this.focusedIndex < this.lastFileIndex) {
                this.focusedIndex += 1;
                this.onFileFocus.emit(this.focusedIndex);
                return;
            }
            if (this.actionButtonsVisible && this.focusedIndex === this.lastFileIndex) {
                this.focusedIndex += 1;
                this.onActionButtonFocus.emit("clear");
            }
        }
    }
    handleUp() {
        if (this.lastIndex >= 0 && this.focusedIndex > -1) {
            this.focusedIndex -= 1;
            if (this.focusedIndex === -1) {
                this.onSelectButtonFocus.emit();
                return;
            }
            if (this.focusedIndex <= this.lastFileIndex) {
                this.onFileFocus.emit(this.focusedIndex);
                return;
            }
            if (this.actionButtonsVisible && this.focusedIndex <= this.lastIndex) {
                this.focusedIndex = this.lastFileIndex;
                this.onFileFocus.emit(this.focusedIndex);
            }
        }
    }
    get focusedIndex() {
        return this._focusedIndex;
    }
    set focusedIndex(index) {
        if (!this.focused) {
            this.onWrapperFocus.emit();
        }
        this._focusedIndex = index;
        this.focused = true;
        if (this._focusedIndex >= 0 && this._focusedIndex <= this.lastFileIndex) {
            this.onFileFocus.emit(index);
        }
    }
    get lastFileIndex() {
        return this.actionButtonsVisible ? this.lastIndex - 2 : this.lastIndex;
    }
    get lastIndex() {
        const fileCount = this.uploadService.files.count;
        return this.actionButtonsVisible ? fileCount + 1 : fileCount - 1;
    }
}
NavigationService.ɵfac = function NavigationService_Factory(t) { return new (t || NavigationService)(ɵngcc0.ɵɵinject(UploadService)); };
NavigationService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: NavigationService, factory: NavigationService.ɵfac });
/** @nocollapse */
NavigationService.ctorParameters = () => [
    { type: UploadService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(NavigationService, [{
        type: Injectable
    }], function () { return [{ type: UploadService }]; }, null); })();

/**
 * Used to customize the rendering of the files in the list ([see example]({% slug templates_upload %})).
 */
class FileTemplateDirective {
    constructor(templateRef) {
        this.templateRef = templateRef;
    }
}
FileTemplateDirective.ɵfac = function FileTemplateDirective_Factory(t) { return new (t || FileTemplateDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.TemplateRef)); };
FileTemplateDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FileTemplateDirective, selectors: [["", "kendoUploadFileTemplate", ""], ["", "kendoFileSelectFileTemplate", ""]] });
/** @nocollapse */
FileTemplateDirective.ctorParameters = () => [
    { type: TemplateRef }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileTemplateDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoUploadFileTemplate], [kendoFileSelectFileTemplate]' // tslint:disable-line:directive-selector-prefix
            }]
    }], function () { return [{ type: ɵngcc0.TemplateRef }]; }, null); })();

let components = {};
/**
 * @hidden
 */
class DropZoneService {
    addComponent(component, zoneId) {
        if (this.has(zoneId)) {
            components[zoneId].push(component);
        }
        else {
            components[zoneId] = [component];
        }
    }
    getComponents(zoneId) {
        return components[zoneId];
    }
    has(id) {
        return id in components;
    }
}
DropZoneService.ɵfac = function DropZoneService_Factory(t) { return new (t || DropZoneService)(); };
DropZoneService.ɵprov = ɵngcc0.ɵɵdefineInjectable({ token: DropZoneService, factory: DropZoneService.ɵfac });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DropZoneService, [{
        type: Injectable
    }], null, null); })();

/**
 * @hidden
 */
const FILESELECT_VALUE_ACCESSOR = {
    multi: true,
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => FileSelectComponent) // tslint:disable-line:no-forward-ref
};
class FileSelectComponent {
    constructor(uploadService, localization, navigation, dropZoneService, ngZone, renderer, cdr, wrapper) {
        this.uploadService = uploadService;
        this.localization = localization;
        this.navigation = navigation;
        this.dropZoneService = dropZoneService;
        this.ngZone = ngZone;
        this.renderer = renderer;
        this.cdr = cdr;
        /**
         * Disables the FileSelect.
         * The default value is `false`.
         */
        this.disabled = false;
        /**
         * Enables the selection of multiple files
         * ([see example]({% slug fileprocessing_upload %}#toc-upload-of-sinlge-or-multiple-files)).
         * If set to `false`, only one file can be selected at a time.
         */
        this.multiple = true;
        /**
         * Toggles the visibility of the file list.
         */
        this.showFileList = true;
        /**
         * Specifies the [`tabindex`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/tabindex) of the FileSelect.
         */
        this.tabindex = 0;
        /**
         * @hidden
         */
        this.focusableId = `k-${guid()}`;
        /**
         * Fires when the user navigates outside the component.
         */
        this.onBlur = new EventEmitter();
        /**
         * Fires when the component is focused.
         */
        this.onFocus = new EventEmitter();
        /**
         * Fires when files are selected. If prevented, the selected files will not be added to the list.
         */
        this.select = new EventEmitter();
        /**
         * Fires when a file is about to be removed. If prevented, the file will remain in the list.
         */
        this.remove = new EventEmitter();
        /**
         * Fires when the value of the component has changed as a result of a successful `select` or `remove` operation.
         */
        this.valueChange = new EventEmitter();
        this.hostDefaultClasses = true;
        /**
         * @hidden
         */
        this._restrictions = {
            allowedExtensions: [],
            maxFileSize: 0,
            minFileSize: 0
        };
        this.onTouchedCallback = (_) => { };
        this.onChangeCallback = (_) => { };
        this.wrapper = wrapper.nativeElement;
        this.direction = localization.rtl ? 'rtl' : 'ltr';
        this.navigation.computeKeys(this.direction);
        this.fileList = this.uploadService.files;
        this.localizationChangeSubscription = localization.changes.subscribe(({ rtl }) => {
            this.direction = rtl ? 'rtl' : 'ltr';
            this.navigation.computeKeys(this.direction);
        });
        this.subscribeBlur();
        this.subscribeFocus();
        this.attachEventHandlers();
        this.setDefaultSettings();
    }
    /**
     * Sets the `name` attribute of the `input` element of the FileSelect.
     */
    set name(name) {
        this.uploadService.async.saveField = name;
    }
    get name() {
        return this.uploadService.async.saveField;
    }
    /**
     * Sets the restrictions for selected files.
     */
    set restrictions(restrictions) {
        let parsedRestrictions = Object.assign({}, this._restrictions, restrictions);
        this._restrictions = parsedRestrictions;
    }
    get restrictions() {
        return this._restrictions;
    }
    get hostDisabledClass() {
        return this.disabled;
    }
    get dir() {
        return this.direction;
    }
    ngOnInit() {
        this.renderer.removeAttribute(this.wrapper, "tabindex");
        if (this.zoneId) {
            this.dropZoneService.addComponent(this, this.zoneId);
        }
    }
    /**
     * @hidden
     */
    textFor(key) {
        return this.localization.get(key);
    }
    /**
     * Focuses the underlying input element.
     */
    focus() {
        setTimeout(() => {
            this.fileSelectButton.nativeElement.focus();
        });
    }
    ngOnDestroy() {
        this.fileList.clear();
        if (this.blurSubscription) {
            this.blurSubscription.unsubscribe();
        }
        if (this.wrapperFocusSubscription) {
            this.wrapperFocusSubscription.unsubscribe();
        }
        if (this.selectButtonFocusSubscription) {
            this.selectButtonFocusSubscription.unsubscribe();
        }
        if (this.localizationChangeSubscription) {
            this.localizationChangeSubscription.unsubscribe();
        }
        if (this.subs) {
            this.subs.unsubscribe();
        }
    }
    /**
     * @hidden
     */
    handleKeydown(event) {
        if (this.disabled) {
            return;
        }
        if ((event.keyCode === Keys.Enter || event.keyCode === Keys.Space) &&
            event.target === this.fileSelectButton.nativeElement) {
            event.preventDefault();
            this.fileSelect.nativeElement.click();
            return;
        }
        if (hasClasses(event.target, UPLOAD_CLASSES) ||
            (!isFocusable(event.target) && !hasClasses(event.target, IGNORE_TARGET_CLASSES))) {
            this.navigation.process(event);
        }
    }
    /**
     * @hidden
     */
    writeValue(newValue) {
        let isValid = true;
        if (newValue instanceof Array) {
            newValue.forEach((file) => {
                if (!validateInitialFileSelectFile(file)) {
                    isValid = false;
                }
            });
            if (isValid) {
                this.uploadService.addInitialFileSelectFiles(newValue);
            }
        }
        if (newValue === null) {
            this.fileList.clear();
        }
        this.cdr.markForCheck();
    }
    /**
     * @hidden
     */
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    /**
     * @hidden
     */
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    /**
     * @hidden
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * Removes specific file from the file list.
     */
    removeFileByUid(uid) {
        this.uploadService.removeFiles(uid);
    }
    /**
     * Visually clears all files from the UI.
     */
    clearFiles() {
        this.uploadService.clearFiles();
    }
    /**
     * @hidden
     * Used to determine if the component is empty.
     */
    isEmpty() {
        return false;
    }
    /**
     * @hidden
     * Used by the external dropzone to add files to the FileSelect
     */
    addFiles(files) {
        this.uploadService.addFiles(files);
    }
    /**
     * @hidden
     */
    get selectButtonTabIndex() {
        return this.disabled ? undefined : this.tabindex;
    }
    /**
     * @hidden
     */
    onFileSelectButtonFocus(_event) {
        this.renderer.addClass(this.fileSelectButton.nativeElement, 'k-state-focused');
        if (!this.navigation.focused) {
            this.navigation.focusedIndex = -1;
        }
    }
    /**
     * @hidden
     */
    onFileSelectButtonBlur(_event) {
        this.renderer.removeClass(this.fileSelectButton.nativeElement, 'k-state-focused');
    }
    subscribeBlur() {
        if (!isDocumentAvailable()) {
            return;
        }
        this.ngZone.runOutsideAngular(() => {
            this.documentClick = fromEvent(document, 'click').pipe(filter((event) => {
                return !(this.wrapper !== event.target && this.wrapper.contains(event.target));
            }));
            this.blurSubscription = merge(this.documentClick, this.navigation.onTab).subscribe(() => {
                if (this.navigation.focused) {
                    this.ngZone.run(() => {
                        this.navigation.focused = false;
                        this.onTouchedCallback();
                        this.onBlur.emit();
                    });
                }
            });
        });
    }
    subscribeFocus() {
        this.wrapperFocusSubscription = this.navigation.onWrapperFocus.subscribe(() => {
            this.onFocus.emit();
        });
        this.selectButtonFocusSubscription = this.navigation.onSelectButtonFocus.subscribe(() => {
            this.fileSelectButton.nativeElement.focus();
        });
    }
    attachEventHandlers() {
        this.subs = this.uploadService.changeEvent.subscribe((files) => {
            let model = [];
            if (files !== null) {
                files.forEach((file) => {
                    if (file.state === FileState.Initial) {
                        model.push(file);
                    }
                    if (file.state === FileState.Selected && file.rawFile && !file.validationErrors) {
                        model.push(file.rawFile);
                    }
                });
            }
            if (model.length === 0) {
                model = null;
            }
            this.onChangeCallback(model);
            this.valueChange.emit(model);
        });
        this.subs.add(this.uploadService.removeEvent.subscribe((args) => {
            this.remove.emit(args);
        }));
        this.subs.add(this.uploadService.selectEvent.subscribe((args) => {
            this.select.emit(args);
        }));
    }
    setDefaultSettings() {
        this.uploadService.async.autoUpload = false;
        this.uploadService.component = 'FileSelect';
    }
}
FileSelectComponent.ɵfac = function FileSelectComponent_Factory(t) { return new (t || FileSelectComponent)(ɵngcc0.ɵɵdirectiveInject(UploadService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(DropZoneService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
FileSelectComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FileSelectComponent, selectors: [["kendo-fileselect"]], contentQueries: function FileSelectComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, FileTemplateDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileTemplate = _t.first);
    } }, viewQuery: function FileSelectComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
        ɵngcc0.ɵɵviewQuery(_c1, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileSelect = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileSelectButton = _t.first);
    } }, hostVars: 7, hostBindings: function FileSelectComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function FileSelectComponent_keydown_HostBindingHandler($event) { return ctx.handleKeydown($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("dir", ctx.dir);
        ɵngcc0.ɵɵclassProp("k-widget", ctx.hostDefaultClasses)("k-upload", ctx.hostDefaultClasses)("k-state-disabled", ctx.hostDisabledClass);
    } }, inputs: { disabled: "disabled", multiple: "multiple", showFileList: "showFileList", tabindex: "tabindex", focusableId: "focusableId", name: "name", restrictions: "restrictions", accept: "accept", zoneId: "zoneId" }, outputs: { onBlur: "blur", onFocus: "focus", select: "select", remove: "remove", valueChange: "valueChange" }, exportAs: ["kendoFileSelect"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            NavigationService,
            UploadService,
            DropZoneService,
            FILESELECT_VALUE_ACCESSOR,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.fileselect'
            },
            {
                provide: KendoInput,
                useExisting: forwardRef(() => FileSelectComponent)
            }
        ])], decls: 12, vars: 14, consts: [["kendoFileSelectLocalizedMessages", "", 6, "dropFilesHere", "invalidFileExtension", "invalidMaxFileSize", "invalidMinFileSize", "remove", "select"], ["kendoFileSelectInternalDropZone", "", 3, "restrictions", "multiple", "disabled"], ["role", "button", 1, "k-button", "k-upload-button", 3, "id", "focus", "blur"], ["fileSelectButton", ""], ["kendoFileSelect", "", 3, "dir", "restrictions", "multiple", "disabled"], ["fileSelect", ""], [1, "k-dropzone-hint"], ["kendo-upload-file-list", "", "class", "k-upload-files k-reset", 3, "disabled", "fileList", "fileTemplate", 4, "ngIf"], ["kendo-upload-file-list", "", 1, "k-upload-files", "k-reset", 3, "disabled", "fileList", "fileTemplate"]], template: function FileSelectComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵi18nAttributes(1, _c14);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵelementStart(3, "div", 2, 3);
        ɵngcc0.ɵɵlistener("focus", function FileSelectComponent_Template_div_focus_3_listener($event) { return ctx.onFileSelectButtonFocus($event); })("blur", function FileSelectComponent_Template_div_blur_3_listener($event) { return ctx.onFileSelectButtonBlur($event); });
        ɵngcc0.ɵɵelement(5, "input", 4, 5);
        ɵngcc0.ɵɵelementStart(7, "span");
        ɵngcc0.ɵɵtext(8);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(9, "div", 6);
        ɵngcc0.ɵɵtext(10);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(11, FileSelectComponent_ul_11_Template, 1, 3, "ul", 7);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("restrictions", ctx.restrictions)("multiple", ctx.multiple)("disabled", ctx.disabled);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("id", ctx.focusableId);
        ɵngcc0.ɵɵattribute("aria-label", ctx.textFor("select"))("tabindex", ctx.selectButtonTabIndex);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("dir", ctx.direction)("restrictions", ctx.restrictions)("multiple", ctx.multiple)("disabled", ctx.disabled);
        ɵngcc0.ɵɵattribute("accept", ctx.accept ? ctx.accept : null);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ctx.textFor("select"));
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ctx.textFor("dropFilesHere"));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showFileList && ctx.fileList.count > 0);
    } }, directives: function () { return [LocalizedMessagesDirective,
        DropZoneInternalDirective,
        FileSelectDirective, ɵngcc3.NgIf, FileListComponent]; }, encapsulation: 2 });
/** @nocollapse */
FileSelectComponent.ctorParameters = () => [
    { type: UploadService },
    { type: LocalizationService },
    { type: NavigationService },
    { type: DropZoneService },
    { type: NgZone },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: ElementRef }
];
FileSelectComponent.propDecorators = {
    accept: [{ type: Input }],
    disabled: [{ type: Input }],
    multiple: [{ type: Input }],
    name: [{ type: Input }],
    showFileList: [{ type: Input }],
    tabindex: [{ type: Input }],
    restrictions: [{ type: Input }],
    zoneId: [{ type: Input }],
    focusableId: [{ type: Input }],
    fileTemplate: [{ type: ContentChild, args: [FileTemplateDirective,] }],
    fileSelect: [{ type: ViewChild, args: ['fileSelect',] }],
    fileSelectButton: [{ type: ViewChild, args: ['fileSelectButton',] }],
    onBlur: [{ type: Output, args: ['blur',] }],
    onFocus: [{ type: Output, args: ['focus',] }],
    select: [{ type: Output }],
    remove: [{ type: Output }],
    valueChange: [{ type: Output }],
    hostDefaultClasses: [{ type: HostBinding, args: ['class.k-widget',] }, { type: HostBinding, args: ['class.k-upload',] }],
    hostDisabledClass: [{ type: HostBinding, args: ['class.k-state-disabled',] }],
    dir: [{ type: HostBinding, args: ['attr.dir',] }],
    handleKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileSelectComponent, [{
        type: Component,
        args: [{
                exportAs: 'kendoFileSelect',
                providers: [
                    LocalizationService,
                    NavigationService,
                    UploadService,
                    DropZoneService,
                    FILESELECT_VALUE_ACCESSOR,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.fileselect'
                    },
                    {
                        provide: KendoInput,
                        useExisting: forwardRef(() => FileSelectComponent)
                    }
                ],
                selector: 'kendo-fileselect',
                template: `
        <ng-container kendoFileSelectLocalizedMessages
            i18n-dropFilesHere="kendo.fileselect.dropFilesHere|The drop zone hint"
            dropFilesHere="Drop files here to select"

            i18n-invalidFileExtension="kendo.fileselect.invalidFileExtension|The text for the invalid allowed extensions restriction message"
            invalidFileExtension="File type not allowed."

            i18n-invalidMaxFileSize="kendo.fileselect.invalidMaxFileSize|The text for the invalid max file size restriction message"
            invalidMaxFileSize="File size too large."

            i18n-invalidMinFileSize="kendo.fileselect.invalidMinFileSize|The text for the invalid min file size restriction message"
            invalidMinFileSize="File size too small."

            i18n-remove="kendo.fileselect.remove|The text for the Remove button"
            remove="Remove"

            i18n-select="kendo.fileselect.select|The text for the Select button"
            select="Select files..."
        >
        </ng-container>
        <div kendoFileSelectInternalDropZone
            [restrictions]="restrictions"
            [multiple]="multiple"
            [disabled]="disabled">
            <div role="button" #fileSelectButton
                [id]="focusableId"
                [attr.aria-label]="textFor('select')"
                [attr.tabindex]="selectButtonTabIndex"
                (focus)="onFileSelectButtonFocus($event)"
                (blur)="onFileSelectButtonBlur($event)"
                class="k-button k-upload-button">
                <input #fileSelect kendoFileSelect
                    [attr.accept]="accept ? accept : null"
                    [dir]="direction"
                    [restrictions]="restrictions"
                    [multiple]="multiple"
                    [disabled]="disabled" />
                <span>{{textFor('select')}}</span>
            </div>
            <div class="k-dropzone-hint">{{textFor('dropFilesHere')}}</div>
        </div>
        <ul kendo-upload-file-list
            class="k-upload-files k-reset"
            *ngIf="showFileList && fileList.count > 0"
            [disabled]="disabled"
            [fileList]="fileList.files"
            [fileTemplate]="fileTemplate">
        </ul>
    `
            }]
    }], function () { return [{ type: UploadService }, { type: ɵngcc2.LocalizationService }, { type: NavigationService }, { type: DropZoneService }, { type: ɵngcc0.NgZone }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.ElementRef }]; }, { disabled: [{
            type: Input
        }], multiple: [{
            type: Input
        }], showFileList: [{
            type: Input
        }], tabindex: [{
            type: Input
        }], focusableId: [{
            type: Input
        }], onBlur: [{
            type: Output,
            args: ['blur']
        }], onFocus: [{
            type: Output,
            args: ['focus']
        }], select: [{
            type: Output
        }], remove: [{
            type: Output
        }], valueChange: [{
            type: Output
        }], hostDefaultClasses: [{
            type: HostBinding,
            args: ['class.k-widget']
        }, {
            type: HostBinding,
            args: ['class.k-upload']
        }], name: [{
            type: Input
        }], restrictions: [{
            type: Input
        }], hostDisabledClass: [{
            type: HostBinding,
            args: ['class.k-state-disabled']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], handleKeydown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], accept: [{
            type: Input
        }], zoneId: [{
            type: Input
        }], fileTemplate: [{
            type: ContentChild,
            args: [FileTemplateDirective]
        }], fileSelect: [{
            type: ViewChild,
            args: ['fileSelect']
        }], fileSelectButton: [{
            type: ViewChild,
            args: ['fileSelectButton']
        }] }); })();

/**
 * @hidden
 */
class Messages extends ComponentMessages {
}
Messages.ɵfac = function Messages_Factory(t) { return ɵMessages_BaseFactory(t || Messages); };
Messages.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: Messages, inputs: { cancel: "cancel", clearSelectedFiles: "clearSelectedFiles", dropFilesHere: "dropFilesHere", externalDropFilesHere: "externalDropFilesHere", filesBatchStatus: "filesBatchStatus", filesBatchStatusFailed: "filesBatchStatusFailed", filesBatchStatusUploaded: "filesBatchStatusUploaded", fileStatusFailed: "fileStatusFailed", fileStatusUploaded: "fileStatusUploaded", headerStatusPaused: "headerStatusPaused", headerStatusUploaded: "headerStatusUploaded", headerStatusUploading: "headerStatusUploading", invalidFileExtension: "invalidFileExtension", invalidMaxFileSize: "invalidMaxFileSize", invalidMinFileSize: "invalidMinFileSize", pause: "pause", remove: "remove", resume: "resume", retry: "retry", select: "select", uploadSelectedFiles: "uploadSelectedFiles" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
Messages.propDecorators = {
    cancel: [{ type: Input }],
    clearSelectedFiles: [{ type: Input }],
    dropFilesHere: [{ type: Input }],
    externalDropFilesHere: [{ type: Input }],
    filesBatchStatus: [{ type: Input }],
    filesBatchStatusFailed: [{ type: Input }],
    filesBatchStatusUploaded: [{ type: Input }],
    fileStatusFailed: [{ type: Input }],
    fileStatusUploaded: [{ type: Input }],
    headerStatusPaused: [{ type: Input }],
    headerStatusUploaded: [{ type: Input }],
    headerStatusUploading: [{ type: Input }],
    invalidFileExtension: [{ type: Input }],
    invalidMaxFileSize: [{ type: Input }],
    invalidMinFileSize: [{ type: Input }],
    pause: [{ type: Input }],
    remove: [{ type: Input }],
    resume: [{ type: Input }],
    retry: [{ type: Input }],
    select: [{ type: Input }],
    uploadSelectedFiles: [{ type: Input }]
};
const ɵMessages_BaseFactory = ɵngcc0.ɵɵgetInheritedFactory(Messages);

/**
 * Custom component messages override default component messages ([more information and example]({% slug globalization_upload %})).
 *
 * @example
 * ```html-no-run
 * <kendo-fileselect>
 *     <kendo-fileselect-messages
 *         [dropFilesHere]="'Drop your file here'"
 *         [select]="'Upload file'">
 *     </kendo-fileselect-messages>
 * </kendo-fileselect>
 * ```
 */
class CustomMessagesComponent extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
    get override() {
        return true;
    }
}
CustomMessagesComponent.ɵfac = function CustomMessagesComponent_Factory(t) { return new (t || CustomMessagesComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
CustomMessagesComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: CustomMessagesComponent, selectors: [["kendo-upload-messages"], ["kendo-fileselect-messages"], ["kendo-uploaddropzone-messages"]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => CustomMessagesComponent) // tslint:disable-line:no-forward-ref
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature], decls: 0, vars: 0, template: function CustomMessagesComponent_Template(rf, ctx) { }, encapsulation: 2 });
/** @nocollapse */
CustomMessagesComponent.ctorParameters = () => [
    { type: LocalizationService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(CustomMessagesComponent, [{
        type: Component,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => CustomMessagesComponent) // tslint:disable-line:no-forward-ref
                    }
                ],
                selector: 'kendo-upload-messages, kendo-fileselect-messages, kendo-uploaddropzone-messages',
                template: ``
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();

/**
 * @hidden
 */
const INVALIDMAXFILESIZE = "invalidMaxFileSize";
/**
 * @hidden
 */
const INVALIDMINFILESIZE = "invalidMinFileSize";
/**
 * @hidden
 */
const INVALIDFILEEXTENSION = "invalidFileExtension";
const validateFileExtension = (file, allowedExtensions) => {
    if (allowedExtensions.length > 0) {
        if (allowedExtensions.indexOf(file.extension.toLowerCase()) < 0) {
            file.validationErrors = file.validationErrors || [];
            if (file.validationErrors.indexOf(INVALIDFILEEXTENSION) < 0) {
                file.validationErrors.push(INVALIDFILEEXTENSION);
            }
        }
    }
};
const validateFileSize = (file, minFileSize, maxFileSize) => {
    if (minFileSize !== 0 && file.size < minFileSize) {
        file.validationErrors = file.validationErrors || [];
        if (file.validationErrors.indexOf(INVALIDMINFILESIZE) < 0) {
            file.validationErrors.push(INVALIDMINFILESIZE);
        }
    }
    if (maxFileSize !== 0 && file.size > maxFileSize) {
        file.validationErrors = file.validationErrors || [];
        if (file.validationErrors.indexOf(INVALIDMAXFILESIZE) < 0) {
            file.validationErrors.push(INVALIDMAXFILESIZE);
        }
    }
};
const parseAllowedExtensions = (extensions) => {
    const allowedExtensions = extensions.map((ext) => {
        var parsedExt = (ext.substring(0, 1) === ".") ? ext : ("." + ext);
        return parsedExt.toLowerCase();
    });
    return allowedExtensions;
};
/**
 * @hidden
 */
const validateFiles = (files, restrictionInfo) => {
    const allowedExtensions = parseAllowedExtensions(restrictionInfo.allowedExtensions);
    const maxFileSize = restrictionInfo.maxFileSize;
    const minFileSize = restrictionInfo.minFileSize;
    let i;
    for (i = 0; i < files.length; i++) {
        validateFileExtension(files[i], allowedExtensions);
        validateFileSize(files[i], minFileSize, maxFileSize);
    }
};

/**
 * @hidden
 */
class DropZoneBase {
    constructor(element, renderer, hoverClass) {
        this.element = element;
        this.renderer = renderer;
        this.hideIntervalElement = null;
        this.hoverClass = hoverClass;
    }
    /**
     * @hidden
     */
    onElementDragEnterListener() {
        this.addClass(this.hoverClass);
        this.lastDragElement = new Date();
        if (!this.hideIntervalElement) {
            this.hideIntervalElement = setInterval(() => {
                if (this.calculateTimeDiff(this.lastDragElement) < 100) {
                    return;
                }
                this.removeClass(this.hoverClass);
                clearInterval(this.hideIntervalElement);
                this.hideIntervalElement = null;
            }, 100);
        }
        return false;
    }
    /**
     * @hidden
     */
    onElementDragOverListener() {
        this.lastDragElement = new Date();
        return false;
    }
    calculateTimeDiff(prevEvent) {
        return new Date().getTime() - prevEvent.getTime();
    }
    addClass(className) {
        this.renderer.addClass(this.element.nativeElement, className);
    }
    removeClass(className) {
        this.renderer.removeClass(this.element.nativeElement, className);
    }
}
DropZoneBase.ɵfac = function DropZoneBase_Factory(t) { ɵngcc0.ɵɵinvalidFactory(); };
DropZoneBase.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DropZoneBase, hostBindings: function DropZoneBase_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("dragenter", function DropZoneBase_dragenter_HostBindingHandler() { return ctx.onElementDragEnterListener(); })("dragover", function DropZoneBase_dragover_HostBindingHandler() { return ctx.onElementDragOverListener(); });
    } } });
DropZoneBase.propDecorators = {
    onElementDragEnterListener: [{ type: HostListener, args: ['dragenter',] }],
    onElementDragOverListener: [{ type: HostListener, args: ['dragover',] }]
};


/**
 * @hidden
 */
class DropZoneInternalDirective extends DropZoneBase {
    constructor(element, renderer, ngZone, uploadService) {
        super(element, renderer, 'k-dropzone-hover');
        this.ngZone = ngZone;
        this.uploadService = uploadService;
        this.initialClassName = true;
        this.hideIntervalDocument = null;
        this.activeClass = 'k-dropzone-active';
        this.ngZone.runOutsideAngular(() => {
            this.unsubscribeDocumentDragEnter = this.renderer.listen('document', 'dragenter', () => this.onDocumentDragEnter());
            this.unsubscribeDocumentDragOver = this.renderer.listen('document', 'dragover', () => this.onDocumentDragOver());
        });
    }
    ngOnDestroy() {
        this.ngZone.runOutsideAngular(() => {
            if (this.unsubscribeDocumentDragEnter) {
                this.unsubscribeDocumentDragEnter();
            }
            if (this.unsubscribeDocumentDragOver) {
                this.unsubscribeDocumentDragOver();
            }
        });
    }
    onDocumentDragEnter() {
        this.addClass(this.activeClass);
        this.lastDragDocument = new Date();
        if (!this.hideIntervalDocument) {
            this.hideIntervalDocument = setInterval(() => {
                if (this.calculateTimeDiff(this.lastDragDocument) < 100) {
                    return;
                }
                this.removeClass(this.activeClass);
                clearInterval(this.hideIntervalDocument);
                this.hideIntervalDocument = null;
            }, 100);
        }
        return false;
    }
    /**
     * @hidden
     */
    onDocumentDragOver() {
        this.lastDragDocument = new Date();
        return false;
    }
    onDropListener(event) {
        let droppedFiles = event.dataTransfer.files;
        if (droppedFiles.length > 0 && !this.disabled) {
            let files = getAllFileInfo(droppedFiles);
            files = assignGuidToFiles(files, !this.uploadService.async.batch);
            if (!this.multiple) {
                files.splice(1, files.length - 1);
                this.uploadService.clearFiles();
            }
            validateFiles(files, this.restrictions);
            this.uploadService.addFiles(files);
        }
        return false;
    }
}
DropZoneInternalDirective.ɵfac = function DropZoneInternalDirective_Factory(t) { return new (t || DropZoneInternalDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(UploadService)); };
DropZoneInternalDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: DropZoneInternalDirective, selectors: [["", "kendoUploadInternalDropZone", ""], ["", "kendoFileSelectInternalDropZone", ""]], hostVars: 2, hostBindings: function DropZoneInternalDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("drop", function DropZoneInternalDirective_drop_HostBindingHandler($event) { return ctx.onDropListener($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-dropzone", ctx.initialClassName);
    } }, inputs: { disabled: "disabled", multiple: "multiple", restrictions: "restrictions" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
DropZoneInternalDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: NgZone },
    { type: UploadService }
];
DropZoneInternalDirective.propDecorators = {
    disabled: [{ type: Input }],
    multiple: [{ type: Input }],
    restrictions: [{ type: Input }],
    initialClassName: [{ type: HostBinding, args: ['class.k-dropzone',] }],
    onDropListener: [{ type: HostListener, args: ['drop', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(DropZoneInternalDirective, [{
        type: Directive,
        args: [{
                selector: `
      [kendoUploadInternalDropZone],
      [kendoFileSelectInternalDropZone]
    `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.NgZone }, { type: UploadService }]; }, { initialClassName: [{
            type: HostBinding,
            args: ['class.k-dropzone']
        }], onDropListener: [{
            type: HostListener,
            args: ['drop', ['$event']]
        }], disabled: [{
            type: Input
        }], multiple: [{
            type: Input
        }], restrictions: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class FileListItemDirective {
    constructor(el, navigationService, uploadService) {
        this.navigationService = navigationService;
        this.uploadService = uploadService;
        this.fileClass = true;
        this.focused = false;
        this.element = el;
    }
    focus() {
        this.element.nativeElement.focus();
    }
    get uidAttribute() {
        return this.files[0].uid;
    }
    get tabIndex() {
        return "-1";
    }
    get kFileError() {
        return this.files[0].state === FileState.Failed;
    }
    get kFileInvalid() {
        return filesHaveValidationErrors(this.files);
    }
    get kFileProgress() {
        return this.files[0].state === FileState.Uploading ||
            this.files[0].state === FileState.Paused;
    }
    get kFileSuccess() {
        if (this.uploadService.component === 'Upload') {
            return this.files[0].state === FileState.Uploaded ||
                this.files[0].state === FileState.Initial;
        }
        return false;
    }
    get kStateFocused() {
        return this.focused;
    }
    onFocus() {
        this.focused = true;
    }
    onBlur() {
        this.focused = false;
    }
    onClick(event) {
        if (!isFocusable(event.target) && !hasClasses(event.target, IGNORE_TARGET_CLASSES)) {
            this.navigationService.focusedIndex = this.index;
        }
    }
}
FileListItemDirective.ɵfac = function FileListItemDirective_Factory(t) { return new (t || FileListItemDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(UploadService)); };
FileListItemDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FileListItemDirective, selectors: [["", "kendoUploadFileListItem", ""]], hostVars: 14, hostBindings: function FileListItemDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("focus", function FileListItemDirective_focus_HostBindingHandler() { return ctx.onFocus(); })("blur", function FileListItemDirective_blur_HostBindingHandler() { return ctx.onBlur(); })("click", function FileListItemDirective_click_HostBindingHandler($event) { return ctx.onClick($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("data-uid", ctx.uidAttribute)("tabIndex", ctx.tabIndex);
        ɵngcc0.ɵɵclassProp("k-file", ctx.fileClass)("k-file-error", ctx.kFileError)("k-file-invalid", ctx.kFileInvalid)("k-file-progress", ctx.kFileProgress)("k-file-success", ctx.kFileSuccess)("k-state-focused", ctx.kStateFocused);
    } }, inputs: { files: "files", index: "index" } });
/** @nocollapse */
FileListItemDirective.ctorParameters = () => [
    { type: ElementRef },
    { type: NavigationService },
    { type: UploadService }
];
FileListItemDirective.propDecorators = {
    files: [{ type: Input }],
    index: [{ type: Input }],
    fileClass: [{ type: HostBinding, args: ['class.k-file',] }],
    uidAttribute: [{ type: HostBinding, args: ['attr.data-uid',] }],
    tabIndex: [{ type: HostBinding, args: ['attr.tabIndex',] }],
    kFileError: [{ type: HostBinding, args: ['class.k-file-error',] }],
    kFileInvalid: [{ type: HostBinding, args: ['class.k-file-invalid',] }],
    kFileProgress: [{ type: HostBinding, args: ['class.k-file-progress',] }],
    kFileSuccess: [{ type: HostBinding, args: ['class.k-file-success',] }],
    kStateFocused: [{ type: HostBinding, args: ['class.k-state-focused',] }],
    onFocus: [{ type: HostListener, args: ["focus",] }],
    onBlur: [{ type: HostListener, args: ["blur",] }],
    onClick: [{ type: HostListener, args: ['click', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileListItemDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoUploadFileListItem]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: NavigationService }, { type: UploadService }]; }, { fileClass: [{
            type: HostBinding,
            args: ['class.k-file']
        }], uidAttribute: [{
            type: HostBinding,
            args: ['attr.data-uid']
        }], tabIndex: [{
            type: HostBinding,
            args: ['attr.tabIndex']
        }], kFileError: [{
            type: HostBinding,
            args: ['class.k-file-error']
        }], kFileInvalid: [{
            type: HostBinding,
            args: ['class.k-file-invalid']
        }], kFileProgress: [{
            type: HostBinding,
            args: ['class.k-file-progress']
        }], kFileSuccess: [{
            type: HostBinding,
            args: ['class.k-file-success']
        }], kStateFocused: [{
            type: HostBinding,
            args: ['class.k-state-focused']
        }], onFocus: [{
            type: HostListener,
            args: ["focus"]
        }], onBlur: [{
            type: HostListener,
            args: ["blur"]
        }], onClick: [{
            type: HostListener,
            args: ['click', ['$event']]
        }], files: [{
            type: Input
        }], index: [{
            type: Input
        }] }); })();

/* tslint:disable:component-selector */
/**
 * @hidden
 */
class FileListComponent {
    constructor(uploadService, navigation) {
        this.uploadService = uploadService;
        this.navigation = navigation;
        this.onItemFocus();
        this.onItemAction();
    }
    onItemFocus() {
        this.focusSubscription = this.navigation.onFileFocus.subscribe((index) => {
            this.fileListItems.toArray()[index].focus();
        });
    }
    onItemAction() {
        this.actionSubscription = this.navigation.onFileAction.subscribe((key) => {
            this.itemActionHandler(key);
        });
    }
    itemActionHandler(key) {
        let index = this.navigation.focusedIndex;
        let item = this.fileListItems.toArray()[index];
        let uid = item.uidAttribute;
        let files = this.uploadService.files.get(uid);
        if (key === Keys.Escape && files[0].state === FileState.Uploading) {
            this.uploadService.cancelFiles(uid);
            this.navigation.focusSelectButton();
            return;
        }
        if (key === Keys.Enter && files[0].state === FileState.Failed) {
            this.uploadService.retryFiles(uid);
            return;
        }
        if (key === Keys.Delete) {
            if (files[0].state === FileState.Uploading) {
                this.uploadService.cancelFiles(uid);
            }
            else if (this.hasDelete(item)) {
                this.uploadService.removeFiles(uid);
            }
            this.navigation.focusSelectButton();
        }
    }
    hasDelete(item) {
        return item.element.nativeElement.getElementsByClassName('k-delete').length > 0;
    }
    ngOnDestroy() {
        this.focusSubscription.unsubscribe();
        this.actionSubscription.unsubscribe();
    }
}
FileListComponent.ɵfac = function FileListComponent_Factory(t) { return new (t || FileListComponent)(ɵngcc0.ɵɵdirectiveInject(UploadService), ɵngcc0.ɵɵdirectiveInject(NavigationService)); };
FileListComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FileListComponent, selectors: [["", "kendo-upload-file-list", ""]], viewQuery: function FileListComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(FileListItemDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileListItems = _t);
    } }, inputs: { disabled: "disabled", fileList: "fileList", fileTemplate: "fileTemplate" }, attrs: _c15, decls: 1, vars: 1, consts: [["ngFor", "", 3, "ngForOf"], ["kendoUploadFileListItem", "", 3, "files", "index"], ["class", "k-file-single", 3, "disabled", "file", 4, "ngIf"], ["class", "k-file-multiple", 3, "disabled", "files", 4, "ngIf"], [4, "ngIf"], [1, "k-file-single", 3, "disabled", "file"], [1, "k-file-multiple", 3, "disabled", "files"], [3, "templateContext"]], template: function FileListComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵtemplate(0, FileListComponent_ng_template_0_Template, 4, 5, "ng-template", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngForOf", ctx.fileList);
    } }, directives: function () { return [ɵngcc3.NgForOf, FileListItemDirective, ɵngcc3.NgIf, FileListSingleItemComponent,
        FileListMultipleItemsComponent,
        TemplateContextDirective]; }, encapsulation: 2 });
/** @nocollapse */
FileListComponent.ctorParameters = () => [
    { type: UploadService },
    { type: NavigationService }
];
FileListComponent.propDecorators = {
    disabled: [{ type: Input }],
    fileList: [{ type: Input }],
    fileTemplate: [{ type: Input }],
    fileListItems: [{ type: ViewChildren, args: [FileListItemDirective,] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileListComponent, [{
        type: Component,
        args: [{
                selector: '[kendo-upload-file-list]',
                template: `
    <ng-template ngFor
      [ngForOf]="fileList"
      let-files
      let-index="index">
      <li kendoUploadFileListItem [files]='files' [index]='index'>
          <kendo-upload-file-list-single-item
            class='k-file-single'
            *ngIf='files.length === 1 && !fileTemplate'
            [disabled]='disabled'
            [file]='files[0]'>
          </kendo-upload-file-list-single-item>
          <kendo-upload-file-list-multiple-items
            class='k-file-multiple'
            *ngIf='files.length > 1 && !fileTemplate'
            [disabled]='disabled'
            [files]='files'>
          </kendo-upload-file-list-multiple-items>
          <ng-template *ngIf="fileTemplate"
              [templateContext]="{
                templateRef: fileTemplate.templateRef,
                state: files[0].state,
                $implicit: files
              }"></ng-template>
      </li>
    </ng-template>
    `
            }]
    }], function () { return [{ type: UploadService }, { type: NavigationService }]; }, { disabled: [{
            type: Input
        }], fileList: [{
            type: Input
        }], fileTemplate: [{
            type: Input
        }], fileListItems: [{
            type: ViewChildren,
            args: [FileListItemDirective]
        }] }); })();

/**
 * @hidden
 */
class FileListItemActionButtonComponent {
    constructor(uploadService, localization) {
        this.uploadService = uploadService;
        this.localization = localization;
        this.actionFocused = false;
        this.retryFocused = false;
        this.pauseResumeFocused = false;
    }
    onFocus(type) {
        if (type === 'action') {
            this.actionFocused = true;
        }
        if (type === 'retry') {
            this.retryFocused = true;
        }
        if (type === 'pauseResume') {
            this.pauseResumeFocused = true;
        }
    }
    onBlur(type) {
        if (type === 'retry') {
            this.retryFocused = false;
        }
        if (type === 'action') {
            this.actionFocused = false;
        }
        if (type === 'pauseResume') {
            this.pauseResumeFocused = false;
        }
    }
    onRetryClick() {
        if (this.disabled) {
            return;
        }
        this.uploadService.retryFiles(this.file.uid);
    }
    onRemoveCancelClick() {
        if (this.disabled) {
            return;
        }
        const uid = this.file.uid;
        if (this.file.state === FileState.Uploading) {
            this.uploadService.cancelFiles(uid);
        }
        else {
            this.uploadService.removeFiles(uid);
        }
    }
    onPauseResumeClick() {
        if (this.disabled) {
            return;
        }
        const uid = this.file.uid;
        if (this.file.state === FileState.Paused) {
            this.uploadService.resumeFile(uid);
        }
        else {
            this.uploadService.pauseFile(uid);
        }
    }
    get actionButtonTitle() {
        if (this.file.state === FileState.Uploading) {
            return this.localization.get('cancel');
        }
        return this.localization.get('remove');
    }
    get retryButtonTitle() {
        return this.localization.get('retry');
    }
    get pauseResumeButtonTitle() {
        if (this.file.state === FileState.Uploading) {
            return this.localization.get('pause');
        }
        return this.localization.get('resume');
    }
    get isUploading() {
        return this.file.state === FileState.Uploading;
    }
    get isFailed() {
        return this.file.state === FileState.Failed;
    }
    get isPaused() {
        return this.file.state === FileState.Paused;
    }
    get isResumable() {
        const service = this.uploadService;
        const isResumable = service.async.chunk && service.chunk.resumable;
        const isUploading = (this.file.state === FileState.Paused) || (this.file.state === FileState.Uploading);
        return isResumable && isUploading;
    }
    get isActionButtonVisible() {
        if ((this.file.state === FileState.Uploaded || this.file.state === FileState.Initial) &&
            !this.uploadService.async.removeUrl && this.uploadService.component === 'Upload') {
            return false;
        }
        return true;
    }
}
FileListItemActionButtonComponent.ɵfac = function FileListItemActionButtonComponent_Factory(t) { return new (t || FileListItemActionButtonComponent)(ɵngcc0.ɵɵdirectiveInject(UploadService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
FileListItemActionButtonComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FileListItemActionButtonComponent, selectors: [["kendo-upload-file-list-item-action-button"]], inputs: { file: "file", disabled: "disabled", progress: "progress" }, decls: 5, vars: 4, consts: [[1, "k-upload-status"], ["class", "k-upload-pct", 4, "ngIf"], ["type", "button", "class", "k-button k-button-icon k-flat k-upload-action", 3, "ngClass", "focus", "blur", "click", 4, "ngIf"], [1, "k-upload-pct"], ["type", "button", 1, "k-button", "k-button-icon", "k-flat", "k-upload-action", 3, "ngClass", "focus", "blur", "click"], [1, "k-icon", "k-retry", "k-i-refresh-sm"], [1, "k-icon", 3, "ngClass"]], template: function FileListItemActionButtonComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "strong", 0);
        ɵngcc0.ɵɵtemplate(1, FileListItemActionButtonComponent_span_1_Template, 2, 1, "span", 1);
        ɵngcc0.ɵɵtemplate(2, FileListItemActionButtonComponent_button_2_Template, 2, 6, "button", 2);
        ɵngcc0.ɵɵtemplate(3, FileListItemActionButtonComponent_button_3_Template, 2, 10, "button", 2);
        ɵngcc0.ɵɵtemplate(4, FileListItemActionButtonComponent_button_4_Template, 2, 10, "button", 2);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isUploading || ctx.isPaused);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isFailed);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isResumable);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.isActionButtonVisible);
    } }, directives: [ɵngcc3.NgIf, ɵngcc3.NgClass], encapsulation: 2 });
/** @nocollapse */
FileListItemActionButtonComponent.ctorParameters = () => [
    { type: UploadService },
    { type: LocalizationService }
];
FileListItemActionButtonComponent.propDecorators = {
    file: [{ type: Input }],
    disabled: [{ type: Input }],
    progress: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileListItemActionButtonComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-upload-file-list-item-action-button',
                template: `
      <strong class="k-upload-status">
        <span class="k-upload-pct" *ngIf="isUploading || isPaused">{{progress}}%</span>

        <button type="button" *ngIf="isFailed" class="k-button k-button-icon k-flat k-upload-action"
          [ngClass]="{ 'k-state-focused': this.retryFocused }"
          [attr.tabIndex]="-1"
          (focus)="onFocus('retry')"
          (blur)="onBlur('retry')"
          (click)="onRetryClick()">
          <span class="k-icon k-retry k-i-refresh-sm"
            [attr.aria-label]="retryButtonTitle"
            [attr.title]="retryButtonTitle">
          </span>
        </button>

        <button *ngIf="isResumable" type="button" class="k-button k-button-icon k-flat k-upload-action"
          [ngClass]="{ 'k-state-focused': this.pauseResumeFocused }"
          [attr.tabIndex]="-1"
          (focus)="onFocus('pauseResume')"
          (blur)="onBlur('pauseResume')"
          (click)="onPauseResumeClick()">
          <span class="k-icon"
            [ngClass]="{
              'k-i-play-sm': isPaused,
              'k-i-pause-sm': !isPaused
            }"
            [attr.aria-label]='pauseResumeButtonTitle'
            [attr.title]='pauseResumeButtonTitle'>
          </span>
        </button>

        <button type="button" *ngIf="isActionButtonVisible" class="k-button k-button-icon k-flat k-upload-action"
          [ngClass]="{ 'k-state-focused': this.actionFocused }"
          [attr.tabIndex]="-1"
          (focus)="onFocus('action')"
          (blur)="onBlur('action')"
          (click)="onRemoveCancelClick()">
          <span class="k-icon"
            [ngClass]="{
              'k-i-cancel': isUploading,
              'k-delete k-i-x': !isUploading
            }"
            [attr.aria-label]='actionButtonTitle'
            [attr.title]='actionButtonTitle'>
          </span>
        </button>
      </strong>
    `
            }]
    }], function () { return [{ type: UploadService }, { type: ɵngcc2.LocalizationService }]; }, { file: [{
            type: Input
        }], disabled: [{
            type: Input
        }], progress: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class FileListItemBase {
    constructor(uploadService) {
        this.uploadService = uploadService;
        this.progressComplete = 0;
    }
    subscribeUploadProgress(uploadProgressHandler) {
        this.uploadProgressSubscription = this.uploadService.uploadProgressEvent.subscribe(uploadProgressHandler);
    }
    fileHasValidationErrors(file) {
        return fileHasValidationErrors(file);
    }
    filesHaveValidationErrors(files) {
        return filesHaveValidationErrors(files);
    }
    ngOnDestroy() {
        this.uploadProgressSubscription.unsubscribe();
    }
    getFileValidationMessage(file) {
        let validationMessage;
        if (file.validationErrors && file.validationErrors.length > 0) {
            validationMessage = this.localization.get(file.validationErrors[0]);
        }
        return validationMessage;
    }
    getTotalFilesSizeMessage(files) {
        return getTotalFilesSizeMessage(files);
    }
    textFor(key) {
        return this.localization.get(key);
    }
}
FileListItemBase.ɵfac = function FileListItemBase_Factory(t) { ɵngcc0.ɵɵinvalidFactory(); };
FileListItemBase.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FileListItemBase });


/**
 * @hidden
 */
class FileListMultipleItemsComponent extends FileListItemBase {
    constructor(localization, uploadService) {
        super(uploadService);
        this.localization = localization;
        this.subscribeUploadProgress((args) => {
            if (args.files[0].uid === this.files[0].uid) {
                this.progressComplete = args.percentComplete;
            }
        });
    }
    get showProgress() {
        const showProgress = this.files[0].state === FileState.Uploading || this.files[0].state === FileState.Paused;
        return showProgress ? 'active' : 'inactive';
    }
    ngOnInit() {
        this.filesHaveErrors = super.filesHaveValidationErrors(this.files);
    }
    fileStatusText(file) {
        const errors = file.validationErrors;
        if (!isPresent(errors)) {
            return this.getTotalFilesSizeMessage([file]);
        }
        return this.getFileValidationMessage(file);
    }
    get batchStatusText() {
        const state$$1 = this.files[0].state;
        const fileCount = this.files.length;
        if (state$$1 === FileState.Uploaded) {
            return `${fileCount} ${this.textFor('filesBatchStatusUploaded')}`;
        }
        if (state$$1 === FileState.Failed) {
            return `${fileCount} ${this.textFor('filesBatchStatusFailed')}`;
        }
        return `${fileCount} ${this.textFor('filesBatchStatus')}`;
    }
    get isUploadSuccessful() {
        return this.files[0].state === FileState.Uploaded;
    }
    get isUploadFailed() {
        return this.files[0].state === FileState.Failed;
    }
}
FileListMultipleItemsComponent.ɵfac = function FileListMultipleItemsComponent_Factory(t) { return new (t || FileListMultipleItemsComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(UploadService)); };
FileListMultipleItemsComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FileListMultipleItemsComponent, selectors: [["kendo-upload-file-list-multiple-items"]], inputs: { disabled: "disabled", files: "files" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 9, vars: 12, consts: [[1, "k-progressbar"], [1, "k-progress"], [1, "k-multiple-files-group-wrapper"], [1, "k-file-group", "k-icon", "k-i-copy"], [1, "k-multiple-files-wrapper"], ["class", "k-file-name-size-wrapper", 4, "ngFor", "ngForOf"], [1, "k-file-information", 3, "ngClass"], [3, "file", "disabled", "progress"], [1, "k-file-name-size-wrapper"], [1, "k-file-name", 3, "title"], [3, "ngClass"]], template: function FileListMultipleItemsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelement(1, "span", 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(2, "span", 2);
        ɵngcc0.ɵɵelement(3, "span", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "span", 4);
        ɵngcc0.ɵɵtemplate(5, FileListMultipleItemsComponent_span_5_Template, 5, 8, "span", 5);
        ɵngcc0.ɵɵelementStart(6, "span", 6);
        ɵngcc0.ɵɵtext(7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(8, "kendo-upload-file-list-item-action-button", 7);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("@progressState", ctx.showProgress);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵstyleProp("width", ctx.progressComplete + "%");
        ɵngcc0.ɵɵadvance(4);
        ɵngcc0.ɵɵproperty("ngForOf", ctx.files);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction2(9, _c21, ctx.isUploadSuccessful, ctx.isUploadFailed));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ctx.batchStatusText);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("file", ctx.files[0])("disabled", ctx.disabled)("progress", ctx.progressComplete);
    } }, directives: [ɵngcc3.NgForOf, ɵngcc3.NgClass, FileListItemActionButtonComponent], encapsulation: 2, data: { animation: [
            trigger('progressState', [
                state('active', style({ opacity: 1 })),
                state('inactive', style({ opacity: 0 })),
                transition('void => active', style({ opacity: 0 })),
                transition('inactive => active', style({ opacity: 1 })),
                transition('active => inactive', animate('1s 2s ease-out'))
            ])
        ] } });
/** @nocollapse */
FileListMultipleItemsComponent.ctorParameters = () => [
    { type: LocalizationService },
    { type: UploadService }
];
FileListMultipleItemsComponent.propDecorators = {
    disabled: [{ type: Input }],
    files: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileListMultipleItemsComponent, [{
        type: Component,
        args: [{
                animations: [
                    trigger('progressState', [
                        state('active', style({ opacity: 1 })),
                        state('inactive', style({ opacity: 0 })),
                        transition('void => active', style({ opacity: 0 })),
                        transition('inactive => active', style({ opacity: 1 })),
                        transition('active => inactive', animate('1s 2s ease-out'))
                    ])
                ],
                selector: 'kendo-upload-file-list-multiple-items',
                template: `
      <div class="k-progressbar" [@progressState]="showProgress">
        <span class="k-progress" [style.width]="progressComplete + '%'"></span>
      </div>
      <span class="k-multiple-files-group-wrapper">
        <span class="k-file-group k-icon k-i-copy"></span>
      </span>
      <span class="k-multiple-files-wrapper">
        <span *ngFor="let file of files" class="k-file-name-size-wrapper">
            <span [title]="file.name" class="k-file-name">
                {{file.name}}
            </span>
            <span [ngClass]="{
                    'k-text-error': file.validationErrors,
                    'k-file-validation-message': file.validationErrors,
                    'k-file-size': !file.validationErrors
                  }"
            >{{fileStatusText(file)}}</span>
        </span>
        <span class="k-file-information"
          [ngClass]="{
            'k-text-success': isUploadSuccessful,
            'k-text-error': isUploadFailed
          }"
        >{{batchStatusText}}</span>
      </span>
      <kendo-upload-file-list-item-action-button
        [file]='files[0]'
        [disabled]='disabled'
        [progress]='progressComplete'>
      </kendo-upload-file-list-item-action-button>
    `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }, { type: UploadService }]; }, { disabled: [{
            type: Input
        }], files: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class FileListSingleItemComponent extends FileListItemBase {
    constructor(localization, uploadService) {
        super(uploadService);
        this.localization = localization;
        this.subscribeUploadProgress((args) => {
            if (args.files[0].uid === this.file.uid) {
                this.progressComplete = args.percentComplete;
            }
        });
    }
    get fileStatusText() {
        const errors = this.file.validationErrors;
        if (this.file.state === FileState.Uploaded) {
            return `${this.textFor('fileStatusUploaded')}`;
        }
        if (this.file.state === FileState.Failed) {
            return `${this.textFor('fileStatusFailed')}`;
        }
        if (!isPresent(errors)) {
            return this.getTotalFilesSizeMessage([this.file]);
        }
        return this.getFileValidationMessage(this.file);
    }
    get showProgress() {
        const showProgress = this.file.state === FileState.Uploading || this.file.state === FileState.Paused;
        return showProgress ? 'active' : 'inactive';
    }
    get fileGroupClass() {
        return getFileGroupCssClass(this.file.extension ? this.file.extension : '');
    }
    get isUploadSuccessful() {
        return this.file.state === FileState.Uploaded;
    }
    get isUploadFailed() {
        return this.file.state === FileState.Failed;
    }
    get isNotYetUploaded() {
        return !this.isUploadFailed && !this.isUploadSuccessful;
    }
}
FileListSingleItemComponent.ɵfac = function FileListSingleItemComponent_Factory(t) { return new (t || FileListSingleItemComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(UploadService)); };
FileListSingleItemComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: FileListSingleItemComponent, selectors: [["kendo-upload-file-list-single-item"]], inputs: { disabled: "disabled", file: "file" }, features: [ɵngcc0.ɵɵInheritDefinitionFeature], decls: 10, vars: 17, consts: [[1, "k-progressbar"], [1, "k-progress"], [1, "k-file-group-wrapper"], [1, "k-file-group", "k-icon", 3, "ngClass"], [1, "k-file-name-size-wrapper"], [1, "k-file-name", 3, "title"], [3, "ngClass"], [3, "file", "disabled", "progress"]], template: function FileListSingleItemComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "div", 0);
        ɵngcc0.ɵɵelement(1, "span", 1);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(2, "span", 2);
        ɵngcc0.ɵɵelement(3, "span", 3);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(4, "span", 4);
        ɵngcc0.ɵɵelementStart(5, "span", 5);
        ɵngcc0.ɵɵtext(6);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(7, "span", 6);
        ɵngcc0.ɵɵtext(8);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelement(9, "kendo-upload-file-list-item-action-button", 7);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("@progressState", ctx.showProgress);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵstyleProp("width", ctx.progressComplete + "%");
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("ngClass", ctx.fileGroupClass);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("title", ctx.file.name);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ctx.file.name);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction5(11, _c22, ctx.file.validationErrors, !ctx.file.validationErrors && ctx.isNotYetUploaded, ctx.isUploadSuccessful, ctx.file.validationErrors || ctx.isUploadFailed, ctx.isUploadSuccessful || ctx.isUploadFailed));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate(ctx.fileStatusText);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("file", ctx.file)("disabled", ctx.disabled)("progress", ctx.progressComplete);
    } }, directives: [ɵngcc3.NgClass, FileListItemActionButtonComponent], encapsulation: 2, data: { animation: [
            trigger('progressState', [
                state('active', style({ opacity: 1 })),
                state('inactive', style({ opacity: 0 })),
                transition('void => active', style({ opacity: 0 })),
                transition('inactive => active', style({ opacity: 1 })),
                transition('active => inactive', animate('1s 2s ease-out'))
            ])
        ] } });
/** @nocollapse */
FileListSingleItemComponent.ctorParameters = () => [
    { type: LocalizationService },
    { type: UploadService }
];
FileListSingleItemComponent.propDecorators = {
    disabled: [{ type: Input }],
    file: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileListSingleItemComponent, [{
        type: Component,
        args: [{
                animations: [
                    trigger('progressState', [
                        state('active', style({ opacity: 1 })),
                        state('inactive', style({ opacity: 0 })),
                        transition('void => active', style({ opacity: 0 })),
                        transition('inactive => active', style({ opacity: 1 })),
                        transition('active => inactive', animate('1s 2s ease-out'))
                    ])
                ],
                selector: 'kendo-upload-file-list-single-item',
                template: `
      <div class="k-progressbar" [@progressState]="showProgress">
        <span class="k-progress" [style.width]="progressComplete + '%'"></span>
      </div>
      <span class="k-file-group-wrapper">
        <span class="k-file-group k-icon" [ngClass]="fileGroupClass"></span>
      </span>
      <span class="k-file-name-size-wrapper">
        <span class="k-file-name" [title]="file.name">{{ file.name }}</span>
        <span [ngClass]="{
                'k-file-validation-message': file.validationErrors,
                'k-file-size': !file.validationErrors && isNotYetUploaded,
                'k-text-success': isUploadSuccessful,
                'k-text-error': file.validationErrors || isUploadFailed,
                'k-file-information': isUploadSuccessful || isUploadFailed
              }"
        >{{fileStatusText}}</span>
      </span>
      <kendo-upload-file-list-item-action-button
        [file]='file'
        [disabled]='disabled'
        [progress]='progressComplete'>
      </kendo-upload-file-list-item-action-button>
    `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }, { type: UploadService }]; }, { disabled: [{
            type: Input
        }], file: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class FileSelectDirective {
    constructor(uploadService, navigation, el) {
        this.uploadService = uploadService;
        this.navigation = navigation;
        this.type = "file";
        this.autocomplete = "off";
        this.tabIndex = -1;
        this.element = el;
    }
    get nameAttribute() {
        return this.uploadService.async.saveField;
    }
    get multipleAttribute() {
        return this.multiple ? "multiple" : null;
    }
    get dirAttribute() {
        return this.dir;
    }
    get disabledAttribute() {
        return this.disabled ? "true" : null;
    }
    onInputChange(event) {
        const ua = navigator.userAgent;
        const chrome = /(chrome)[ \/]([\w.]+)/i;
        const safari = /(webkit)[ \/]([\w.]+)/i;
        let selectedFiles = inputFiles(event.target);
        selectedFiles = assignGuidToFiles(selectedFiles, !this.uploadService.async.batch);
        validateFiles(selectedFiles, this.restrictions);
        if (!this.multiple) {
            this.uploadService.clearFiles();
        }
        this.uploadService.addFiles(selectedFiles);
        /*
        Chrome and Internet Explorer do not trigger a `change` event
        when a file with the same name is selected a number of consecutive times.
        As a workaround, clear the input value after handling the file.
        */
        const native = this.element.nativeElement;
        if (!(!ua.match(chrome) && ua.match(safari))) {
            native.type = "";
            native.type = "file";
        }
        setTimeout(() => {
            this.navigation.focusedIndex = -1;
        });
    }
}
FileSelectDirective.ɵfac = function FileSelectDirective_Factory(t) { return new (t || FileSelectDirective)(ɵngcc0.ɵɵdirectiveInject(UploadService), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
FileSelectDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: FileSelectDirective, selectors: [["", "kendoFileSelect", ""]], hostVars: 7, hostBindings: function FileSelectDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("change", function FileSelectDirective_change_HostBindingHandler($event) { return ctx.onInputChange($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("type", ctx.type)("autocomplete", ctx.autocomplete)("tabindex", ctx.tabIndex)("name", ctx.nameAttribute)("multiple", ctx.multipleAttribute)("dir", ctx.dirAttribute)("disabled", ctx.disabledAttribute);
    } }, inputs: { dir: "dir", disabled: "disabled", multiple: "multiple", restrictions: "restrictions" } });
/** @nocollapse */
FileSelectDirective.ctorParameters = () => [
    { type: UploadService },
    { type: NavigationService },
    { type: ElementRef }
];
FileSelectDirective.propDecorators = {
    dir: [{ type: Input }],
    disabled: [{ type: Input }],
    multiple: [{ type: Input }],
    restrictions: [{ type: Input }],
    type: [{ type: HostBinding, args: ["attr.type",] }],
    autocomplete: [{ type: HostBinding, args: ["attr.autocomplete",] }],
    tabIndex: [{ type: HostBinding, args: ["attr.tabindex",] }],
    nameAttribute: [{ type: HostBinding, args: ["attr.name",] }],
    multipleAttribute: [{ type: HostBinding, args: ["attr.multiple",] }],
    dirAttribute: [{ type: HostBinding, args: ["attr.dir",] }],
    disabledAttribute: [{ type: HostBinding, args: ["attr.disabled",] }],
    onInputChange: [{ type: HostListener, args: ["change", ["$event"],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileSelectDirective, [{
        type: Directive,
        args: [{
                selector: '[kendoFileSelect]'
            }]
    }], function () { return [{ type: UploadService }, { type: NavigationService }, { type: ɵngcc0.ElementRef }]; }, { type: [{
            type: HostBinding,
            args: ["attr.type"]
        }], autocomplete: [{
            type: HostBinding,
            args: ["attr.autocomplete"]
        }], tabIndex: [{
            type: HostBinding,
            args: ["attr.tabindex"]
        }], nameAttribute: [{
            type: HostBinding,
            args: ["attr.name"]
        }], multipleAttribute: [{
            type: HostBinding,
            args: ["attr.multiple"]
        }], dirAttribute: [{
            type: HostBinding,
            args: ["attr.dir"]
        }], disabledAttribute: [{
            type: HostBinding,
            args: ["attr.disabled"]
        }], onInputChange: [{
            type: HostListener,
            args: ["change", ["$event"]]
        }], dir: [{
            type: Input
        }], disabled: [{
            type: Input
        }], multiple: [{
            type: Input
        }], restrictions: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
class LocalizedMessagesDirective extends Messages {
    constructor(service) {
        super();
        this.service = service;
    }
}
LocalizedMessagesDirective.ɵfac = function LocalizedMessagesDirective_Factory(t) { return new (t || LocalizedMessagesDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
LocalizedMessagesDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LocalizedMessagesDirective, selectors: [["", "kendoUploadLocalizedMessages", ""], ["", "kendoFileSelectLocalizedMessages", ""], ["", "kendoUploadDropZoneLocalizedMessages", ""]], features: [ɵngcc0.ɵɵProvidersFeature([
            {
                provide: Messages,
                useExisting: forwardRef(() => LocalizedMessagesDirective) // tslint:disable-line:no-forward-ref
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature] });
/** @nocollapse */
LocalizedMessagesDirective.ctorParameters = () => [
    { type: LocalizationService }
];
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LocalizedMessagesDirective, [{
        type: Directive,
        args: [{
                providers: [
                    {
                        provide: Messages,
                        useExisting: forwardRef(() => LocalizedMessagesDirective) // tslint:disable-line:no-forward-ref
                    }
                ],
                selector: `
    [kendoUploadLocalizedMessages],
    [kendoFileSelectLocalizedMessages],
    [kendoUploadDropZoneLocalizedMessages]
  `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, null); })();

/**
 * @hidden
 */
class TemplateContextDirective {
    constructor(viewContainerRef) {
        this.viewContainerRef = viewContainerRef;
    }
    set templateContext(context) {
        if (this.insertedViewRef) {
            this.viewContainerRef.remove(this.viewContainerRef.indexOf(this.insertedViewRef));
            this.insertedViewRef = undefined;
        }
        if (context.templateRef) {
            this.insertedViewRef = this.viewContainerRef.createEmbeddedView(context.templateRef, context);
        }
    }
}
TemplateContextDirective.ɵfac = function TemplateContextDirective_Factory(t) { return new (t || TemplateContextDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ViewContainerRef)); };
TemplateContextDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: TemplateContextDirective, selectors: [["", "templateContext", ""]], inputs: { templateContext: "templateContext" } });
/** @nocollapse */
TemplateContextDirective.ctorParameters = () => [
    { type: ViewContainerRef }
];
TemplateContextDirective.propDecorators = {
    templateContext: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(TemplateContextDirective, [{
        type: Directive,
        args: [{
                selector: '[templateContext]' // tslint:disable-line:directive-selector
            }]
    }], function () { return [{ type: ɵngcc0.ViewContainerRef }]; }, { templateContext: [{
            type: Input
        }] }); })();

/* tslint:disable: no-use-before-declare */
/**
 * @hidden
 */
const UPLOAD_VALUE_ACCESSOR = {
    multi: true,
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => UploadComponent) // tslint:disable-line:no-forward-ref
};
/**
 * Represents the [Kendo UI Upload component for Angular]({% slug overview_upload %}).
 */
class UploadComponent {
    constructor(uploadService, localization, navigation, dropZoneService, _ngZone, renderer, cdr, wrapper) {
        this.uploadService = uploadService;
        this.localization = localization;
        this.navigation = navigation;
        this.dropZoneService = dropZoneService;
        this._ngZone = _ngZone;
        this.renderer = renderer;
        this.cdr = cdr;
        /**
         * Enables the chunk functionality of the Upload.
         *
         * The default value is `false`.
         */
        this.chunkable = false;
        /**
         * Enables the selection of multiple files
         * ([see example]({% slug fileprocessing_upload %}#toc-upload-of-sinlge-or-multiple-files)).
         * If set to `false`, only one file can be selected at a time.
         */
        this.multiple = true;
        /**
         * Disables the Upload ([see example]({% slug disabledstate_upload %})).
         * The default value is `false`.
         */
        this.disabled = false;
        /**
         * Toggles the visibility of the file list.
         */
        this.showFileList = true;
        /**
         * Specifies the [`tabindex`](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/tabindex) of the component.
         */
        this.tabindex = 0;
        /**
         * @hidden
         */
        this.focusableId = `k-${guid()}`;
        /**
         * Specifies the possible layout of the action buttons.
         */
        this.actionsLayout = 'end';
        /**
         * Fires when the user navigates outside the component.
         */
        this.onBlur = new EventEmitter();
        /**
         * Fires when the upload is canceled while in progress.
         */
        this.cancel = new EventEmitter();
        /**
         * Fires when the file list is about to be cleared. If prevented, the files will not be cleared.
         */
        this.clear = new EventEmitter();
        /**
         * Fires when all active uploads are completed either successfully or with errors.
         */
        this.complete = new EventEmitter();
        /**
         * Fires when an `upload` or `remove` operation has failed.
         */
        this.error = new EventEmitter();
        /**
         * Fires when the component is focused.
         */
        this.onFocus = new EventEmitter();
        /**
         * Fires when the upload of a file has been paused.
         */
        this.pause = new EventEmitter();
        /**
         * Fires when an uploaded file is about to be removed. If prevented, the files will remain in the list.
         */
        this.remove = new EventEmitter();
        /**
         * Fires when the upload of a file has been resumed.
         */
        this.resume = new EventEmitter();
        /**
         * Fires when files are selected. If prevented, the selected files will not be added to the list.
         */
        this.select = new EventEmitter();
        /**
         * Fires when an `upload` or `remove` operation is successfully completed.
         */
        this.success = new EventEmitter();
        /**
         * Fires when one or more files are about to be uploaded. If prevented, the files will neither be uploaded, nor added to the file list.
         */
        this.upload = new EventEmitter();
        /**
         * Fires when one or more files are being uploaded.
         */
        this.uploadProgress = new EventEmitter();
        /**
         * Fires when the value of the component has changed as a result of a successful `upload`, `remove` or `clear` operation.
         */
        this.valueChange = new EventEmitter();
        this.hostDefaultClasses = true;
        /**
         * @hidden
         */
        this._restrictions = {
            allowedExtensions: [],
            maxFileSize: 0,
            minFileSize: 0
        };
        this.onTouchedCallback = (_) => { };
        this.onChangeCallback = (_) => { };
        this.fileList = this.uploadService.files;
        this.localizationChangeSubscription = localization.changes.subscribe(({ rtl }) => {
            this.direction = rtl ? 'rtl' : 'ltr';
            this.navigation.computeKeys(this.direction);
        });
        this.direction = localization.rtl ? 'rtl' : 'ltr';
        this.navigation.computeKeys(this.direction);
        this.wrapper = wrapper.nativeElement;
        this.subscribeBlur();
        this.subscribeFocus();
        this.attachEventHandlers();
    }
    /**
     * By default, the selected files are immediately uploaded
     * ([see example]({% slug fileprocessing_upload %}#toc-automatic-upload-of-files)).
     * To change this behavior, set `autoUpload` to `false`.
     */
    set autoUpload(autoUpload) {
        this.uploadService.async.autoUpload = autoUpload;
    }
    get autoUpload() {
        return this.uploadService.async.autoUpload;
    }
    /**
     * When enabled, all files in the selection are uploaded in one request
     * ([see example]({% slug fileprocessing_upload %}#toc-upload-of-batches-of-files)).
     * Any files that are selected one after the other are uploaded in separate requests.
     */
    set batch(batch) {
        this.uploadService.async.batch = batch;
    }
    get batch() {
        return this.uploadService.async.batch;
    }
    /**
     * Configures whether credentials (cookies, headers) will be sent for cross-site requests
     * ([see example]({% slug credentials_upload %}#toc-attaching-credentials-to-requests)).
     * The default values is `true`. Setting `withCredentials` has no effect on same-site requests.
     * To add credentials to the request, use the `saveHeaders` or `removeHeaders` property,
     * or the [`upload`]({% slug api_upload_uploadevent %}) event.
     */
    set withCredentials(withCredentials) {
        this.uploadService.async.withCredentials = withCredentials;
    }
    get withCredentials() {
        return this.uploadService.async.withCredentials;
    }
    /**
     * Sets the [`FormData`](https://developer.mozilla.org/en-US/docs/Web/API/FormData) key which contains the files submitted to `saveUrl`.
     * The default value is `files`.
     */
    set saveField(saveField) {
        this.uploadService.async.saveField = saveField;
    }
    get saveField() {
        return this.uploadService.async.saveField;
    }
    /**
     * Configures the [`HttpHeaders`](https://angular.io/api/common/http/HttpHeaders)
     * that are attached to each upload request.
     */
    set saveHeaders(saveHeaders) {
        this.uploadService.async.saveHeaders = saveHeaders;
    }
    get saveHeaders() {
        return this.uploadService.async.saveHeaders;
    }
    /**
     * Sets the [`RequestMethod`](https://angular.io/api/http/RequestMethod) of the upload request.
     * The default value is `POST`.
     */
    set saveMethod(saveMethod) {
        this.uploadService.async.saveMethod = saveMethod;
    }
    get saveMethod() {
        return this.uploadService.async.saveMethod;
    }
    /**
     * Sets the URL of the endpoint for the upload request.
     * The request [`FormData`](https://developer.mozilla.org/en-US/docs/Web/API/FormData) key is named after the `saveField` property.
     * It contains the list of files to be uploaded.
     */
    set saveUrl(saveUrl) {
        this.uploadService.async.saveUrl = saveUrl;
    }
    get saveUrl() {
        return this.uploadService.async.saveUrl;
    }
    /**
     * Sets the expected [`response type`](https://angular.io/api/common/http/HttpRequest#responseType) of the server.
     * It is used to parse the response appropriately.
     * The default value is `json`.
     */
    set responseType(responseType) {
        this.uploadService.async.responseType = responseType;
    }
    get responseType() {
        return this.uploadService.async.responseType;
    }
    /**
     * Sets the [`FormData`](https://developer.mozilla.org/en-US/docs/Web/API/FormData) key
     * which contains the list of file names that are submitted to `removeUrl`.
     * The default value is `fileNames`.
     */
    set removeField(removeField) { this.uploadService.async.removeField = removeField; }
    get removeField() { return this.uploadService.async.removeField; }
    /**
     * Configures the [`HttpHeaders`](https://angular.io/api/common/http/HttpHeaders)
     * that are attached to each `remove` request.
     */
    set removeHeaders(removeHeaders) {
        this.uploadService.async.removeHeaders = removeHeaders;
    }
    get removeHeaders() {
        return this.uploadService.async.removeHeaders;
    }
    /**
     * Sets the [`RequestMethod`](https://angular.io/api/http/RequestMethod) of the `remove` request.
     * The default value is `POST`.
     */
    set removeMethod(removeMethod) {
        this.uploadService.async.removeMethod = removeMethod;
    }
    get removeMethod() {
        return this.uploadService.async.removeMethod;
    }
    /**
     * Sets the URL of the endpoint for the `remove` request.
     * The [`FormData`](https://developer.mozilla.org/en-US/docs/Web/API/FormData) request key is named after the `removeField` property.
     * It contains the list of file names which will be removed.
     */
    set removeUrl(removeUrl) {
        this.uploadService.async.removeUrl = removeUrl;
    }
    get removeUrl() {
        return this.uploadService.async.removeUrl;
    }
    /**
     * Specifies if the selected files are uploaded simultaneously or one by one.
     *
     * The default value is `true`.
     */
    set concurrent(concurrent) {
        this.uploadService.async.concurrent = concurrent;
    }
    get concurrent() {
        return this.uploadService.async.concurrent;
    }
    /**
     * @hidden
     */
    set tabIndex(tabIndex) {
        this.tabindex = tabIndex;
    }
    get tabIndex() {
        return this.tabindex;
    }
    /**
     * Sets the restrictions for selected files ([see example]({% slug api_upload_filerestrictions %})).
     */
    set restrictions(restrictions) {
        let parsedRestrictions = Object.assign({}, this._restrictions, restrictions);
        this._restrictions = parsedRestrictions;
    }
    get restrictions() {
        return this._restrictions;
    }
    get hostDisabledClass() {
        return this.disabled;
    }
    get dir() {
        return this.direction;
    }
    ngOnInit() {
        this.verifySettings();
        this.renderer.removeAttribute(this.wrapper, "tabindex");
        this.uploadService.setChunkSettings(this.chunkable);
        if (this.zoneId) {
            this.dropZoneService.addComponent(this, this.zoneId);
        }
    }
    ngOnChanges(changes) {
        if (isChanged("chunkable", changes)) {
            const newChunkable = changes.chunkable.currentValue;
            if (typeof newChunkable === 'boolean') {
                this.uploadService.async.chunk = newChunkable;
            }
            if (typeof newChunkable === "object" && newChunkable !== null) {
                this.uploadService.async.chunk = true;
                this.uploadService.chunk = Object.assign({}, this.uploadService.chunk, newChunkable);
            }
        }
    }
    ngOnDestroy() {
        this.fileList.clear();
        if (this.blurSubscription) {
            this.blurSubscription.unsubscribe();
        }
        if (this.wrapperFocusSubscription) {
            this.wrapperFocusSubscription.unsubscribe();
        }
        if (this.selectButtonFocusSubscription) {
            this.selectButtonFocusSubscription.unsubscribe();
        }
        if (this.localizationChangeSubscription) {
            this.localizationChangeSubscription.unsubscribe();
        }
        if (this.subs) {
            this.subs.unsubscribe();
        }
    }
    /**
     * @hidden
     */
    handleKeydown(event) {
        if (this.disabled) {
            return;
        }
        if ((event.keyCode === Keys.Enter || event.keyCode === Keys.Space) &&
            event.target === this.fileSelectButton.nativeElement) {
            event.preventDefault();
            this.fileSelect.nativeElement.click();
            return;
        }
        if (hasClasses(event.target, UPLOAD_CLASSES) ||
            (!isFocusable(event.target) && !hasClasses(event.target, IGNORE_TARGET_CLASSES))) {
            this.navigation.process(event);
        }
    }
    /**
     * @hidden
     */
    writeValue(newValue) {
        let isValid = true;
        if (newValue instanceof Array) {
            newValue.forEach((file) => {
                if (!validateInitialFileInfo(file)) {
                    isValid = false;
                }
            });
            if (isValid) {
                this.uploadService.addInitialFiles(newValue);
            }
        }
        if (newValue === null) {
            this.fileList.clear();
        }
        this.cdr.markForCheck();
    }
    /**
     * @hidden
     */
    registerOnChange(fn) {
        this.onChangeCallback = fn;
    }
    /**
     * @hidden
     */
    registerOnTouched(fn) {
        this.onTouchedCallback = fn;
    }
    /**
     * @hidden
     */
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    /**
     * @hidden
     */
    get selectButtonTabIndex() {
        return this.disabled ? undefined : this.tabIndex;
    }
    /**
     * @hidden
     */
    onFileSelectButtonFocus(_event) {
        this.renderer.addClass(this.fileSelectButton.nativeElement, 'k-state-focused');
        if (!this.navigation.focused) {
            this.navigation.focusedIndex = -1;
        }
    }
    /**
     * @hidden
     */
    onFileSelectButtonBlur(_event) {
        this.renderer.removeClass(this.fileSelectButton.nativeElement, 'k-state-focused');
    }
    /**
     * @hidden
     */
    get showActionButtons() {
        let areVisible = false;
        if (!this.autoUpload) {
            const hasFilesToUpload = this.fileList.filesToUpload.length > 0;
            const uploadingFiles = this.fileList.hasFileWithState([FileState.Uploading]);
            if (this.concurrent && hasFilesToUpload) {
                areVisible = true;
            }
            if (!this.concurrent && hasFilesToUpload && !uploadingFiles) {
                areVisible = true;
            }
        }
        this.navigation.actionButtonsVisible = areVisible;
        return areVisible;
    }
    /**
     * @hidden
     */
    get showTotalStatus() {
        const states = [
            FileState.Uploaded,
            FileState.Uploading,
            FileState.Failed,
            FileState.Paused
        ];
        if (this.fileList.hasFileWithState(states)) {
            return true;
        }
        return false;
    }
    /**
     * @hidden
     */
    textFor(key) {
        return this.localization.get(key);
    }
    /**
     * Focuses the underlying input element.
     */
    focus() {
        setTimeout(() => {
            this.fileSelectButton.nativeElement.focus();
        });
    }
    /**
     * @hidden
     * @deprecated
     */
    focusComponent() {
        this.focus();
    }
    /**
     * Blurs the Upload if it was previously focused.
     */
    blur() {
        if (this.navigation.focused) {
            this.navigation.focused = false;
            document.activeElement.blur();
            this.onBlur.emit();
        }
    }
    /**
     * @hidden
     * @deprecated
     */
    blurComponent() {
        this.blur();
    }
    /**
     * Pauses the upload process of a file that is currently uploading.
     * The `pauseFileByUid` method requires the `chunkable` option of the Upload to be enabled.
     *
     * @param uid - The `uid` of the file that will be paused.
     */
    pauseFileByUid(uid) {
        this.uploadService.pauseFile(uid);
    }
    /**
     * Resumes the upload process for a file that has been previously paused.
     * The `resumeFileByUid` method requires the `chunkable` option of the Upload to be enabled.
     *
     * @param uid - The `uid` of the file that will be resumed.
     */
    resumeFileByUid(uid) {
        this.uploadService.resumeFile(uid);
    }
    /**
     * Triggers the removal of a file or a batch of files.
     * @param uid - The `uid` of the file or a batch of files that will be removed.
     */
    removeFilesByUid(uid) {
        this.uploadService.removeFiles(uid);
    }
    /**
     * Triggers another upload attempt of an unsuccessfully uploaded file or a batch of files.
     * @param uid - The `uid` of the file or a batch of files to be retried.
     */
    retryUploadByUid(uid) {
        this.uploadService.retryFiles(uid);
    }
    /**
     * Cancels the upload of a file or a batch of files.
     * @param uid - The `uid` of the file or a batch of files that will be canceled.
     */
    cancelUploadByUid(uid) {
        this.uploadService.cancelFiles(uid);
    }
    /**
     * Uploads the currently selected files which pass the set restrictions.
     */
    uploadFiles() {
        if (this.fileList.filesToUpload.length) {
            this.uploadService.uploadFiles();
        }
    }
    /**
     * Visually clears all files from the UI without issuing requests to the remove handler.
     */
    clearFiles() {
        this.uploadService.clearFiles();
    }
    /**
     * @hidden
     * Used by the external dropzone to add files to the Upload
     */
    addFiles(files) {
        this.uploadService.addFiles(files);
    }
    /**
     * @hidden
     * Used to determine if the component is empty.
     */
    isEmpty() {
        return false;
    }
    verifySettings() {
        if (isDevMode()) {
            if (this.batch && this.chunkable !== false) {
                throw new Error('The file chunking functionality requires the batch setting to be disabled.');
            }
        }
    }
    subscribeBlur() {
        if (!isDocumentAvailable()) {
            return;
        }
        this._ngZone.runOutsideAngular(() => {
            this.documentClick = fromEvent(document, 'click').pipe(filter((event) => {
                return !(this.wrapper !== event.target && this.wrapper.contains(event.target));
            }));
            this.blurSubscription = merge(this.documentClick, this.navigation.onTab).subscribe(() => {
                if (this.navigation.focused) {
                    this._ngZone.run(() => {
                        this.navigation.focused = false;
                        this.onTouchedCallback();
                        this.onBlur.emit();
                    });
                }
            });
        });
    }
    subscribeFocus() {
        this.wrapperFocusSubscription = this.navigation.onWrapperFocus.subscribe(() => {
            this.onFocus.emit();
        });
        this.selectButtonFocusSubscription = this.navigation.onSelectButtonFocus.subscribe(() => {
            this.fileSelectButton.nativeElement.focus();
        });
    }
    attachEventHandlers() {
        this.subs = this.uploadService.cancelEvent.subscribe((args) => {
            this.cancel.emit(args);
        });
        this.subs.add(this.uploadService.changeEvent.subscribe((files) => {
            this.onChangeCallback(files);
            this.valueChange.emit(files);
        }));
        this.subs.add(this.uploadService.clearEvent.subscribe((args) => {
            this.clear.emit(args);
        }));
        this.subs.add(this.uploadService.completeEvent.subscribe(() => {
            this.complete.emit();
        }));
        this.subs.add(this.uploadService.errorEvent.subscribe((args) => {
            this.error.emit(args);
        }));
        this.subs.add(this.uploadService.pauseEvent.subscribe((args) => {
            this.pause.emit(args);
        }));
        this.subs.add(this.uploadService.removeEvent.subscribe((args) => {
            this.remove.emit(args);
        }));
        this.subs.add(this.uploadService.resumeEvent.subscribe((args) => {
            this.resume.emit(args);
        }));
        this.subs.add(this.uploadService.selectEvent.subscribe((args) => {
            this.select.emit(args);
        }));
        this.subs.add(this.uploadService.successEvent.subscribe((args) => {
            this.success.emit(args);
        }));
        this.subs.add(this.uploadService.uploadEvent.subscribe((args) => {
            this.upload.emit(args);
        }));
        this.subs.add(this.uploadService.uploadProgressEvent.subscribe((args) => {
            this.uploadProgress.emit(args);
        }));
    }
}
UploadComponent.ɵfac = function UploadComponent_Factory(t) { return new (t || UploadComponent)(ɵngcc0.ɵɵdirectiveInject(UploadService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(NavigationService), ɵngcc0.ɵɵdirectiveInject(DropZoneService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.NgZone), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef)); };
UploadComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: UploadComponent, selectors: [["kendo-upload"]], contentQueries: function UploadComponent_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, FileTemplateDirective, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileTemplate = _t.first);
    } }, viewQuery: function UploadComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
        ɵngcc0.ɵɵviewQuery(_c1, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileSelect = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.fileSelectButton = _t.first);
    } }, hostVars: 7, hostBindings: function UploadComponent_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("keydown", function UploadComponent_keydown_HostBindingHandler($event) { return ctx.handleKeydown($event); });
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("dir", ctx.dir);
        ɵngcc0.ɵɵclassProp("k-widget", ctx.hostDefaultClasses)("k-upload", ctx.hostDefaultClasses)("k-state-disabled", ctx.hostDisabledClass);
    } }, inputs: { chunkable: "chunkable", multiple: "multiple", disabled: "disabled", showFileList: "showFileList", tabindex: "tabindex", focusableId: "focusableId", actionsLayout: "actionsLayout", autoUpload: "autoUpload", batch: "batch", withCredentials: "withCredentials", saveField: "saveField", saveHeaders: "saveHeaders", saveMethod: "saveMethod", saveUrl: "saveUrl", responseType: "responseType", removeField: "removeField", removeHeaders: "removeHeaders", removeMethod: "removeMethod", removeUrl: "removeUrl", concurrent: "concurrent", tabIndex: "tabIndex", restrictions: "restrictions", zoneId: "zoneId", accept: "accept" }, outputs: { onBlur: "blur", cancel: "cancel", clear: "clear", complete: "complete", error: "error", onFocus: "focus", pause: "pause", remove: "remove", resume: "resume", select: "select", success: "success", upload: "upload", uploadProgress: "uploadProgress", valueChange: "valueChange" }, exportAs: ["kendoUpload"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            NavigationService,
            UploadService,
            DropZoneService,
            UPLOAD_VALUE_ACCESSOR,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.upload'
            },
            {
                provide: KendoInput,
                useExisting: forwardRef(() => UploadComponent)
            }
        ]), ɵngcc0.ɵɵNgOnChangesFeature], decls: 14, vars: 16, consts: [["kendoUploadLocalizedMessages", "", 6, "cancel", "clearSelectedFiles", "dropFilesHere", "filesBatchStatus", "filesBatchStatusFailed", "filesBatchStatusUploaded", "fileStatusFailed", "fileStatusUploaded", "headerStatusPaused", "headerStatusUploaded", "headerStatusUploading", "invalidFileExtension", "invalidMaxFileSize", "invalidMinFileSize", "pause", "remove", "resume", "retry", "select", "uploadSelectedFiles"], ["kendoUploadInternalDropZone", "", 3, "restrictions", "multiple", "disabled"], ["role", "button", 1, "k-button", "k-upload-button", 3, "id", "focus", "blur"], ["fileSelectButton", ""], ["kendoFileSelect", "", 3, "dir", "restrictions", "multiple", "disabled"], ["fileSelect", ""], ["class", "k-upload-status k-upload-status-total", 3, "fileList", 4, "ngIf"], [1, "k-dropzone-hint"], ["kendo-upload-file-list", "", "class", "k-upload-files k-reset", 3, "disabled", "fileList", "fileTemplate", 4, "ngIf"], [3, "disabled", "actionsLayout", 4, "ngIf"], [1, "k-upload-status", "k-upload-status-total", 3, "fileList"], ["kendo-upload-file-list", "", 1, "k-upload-files", "k-reset", 3, "disabled", "fileList", "fileTemplate"], [3, "disabled", "actionsLayout"]], template: function UploadComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵi18nAttributes(1, _c63);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵelementStart(3, "div", 2, 3);
        ɵngcc0.ɵɵlistener("focus", function UploadComponent_Template_div_focus_3_listener($event) { return ctx.onFileSelectButtonFocus($event); })("blur", function UploadComponent_Template_div_blur_3_listener($event) { return ctx.onFileSelectButtonBlur($event); });
        ɵngcc0.ɵɵelement(5, "input", 4, 5);
        ɵngcc0.ɵɵelementStart(7, "span");
        ɵngcc0.ɵɵtext(8);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(9, UploadComponent_kendo_upload_status_total_9_Template, 1, 1, "kendo-upload-status-total", 6);
        ɵngcc0.ɵɵelementStart(10, "div", 7);
        ɵngcc0.ɵɵtext(11);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵtemplate(12, UploadComponent_ul_12_Template, 1, 3, "ul", 8);
        ɵngcc0.ɵɵtemplate(13, UploadComponent_kendo_upload_action_buttons_13_Template, 1, 2, "kendo-upload-action-buttons", 9);
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("restrictions", ctx.restrictions)("multiple", ctx.multiple)("disabled", ctx.disabled);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("id", ctx.focusableId);
        ɵngcc0.ɵɵattribute("aria-label", ctx.textFor("select"))("tabindex", ctx.selectButtonTabIndex);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("dir", ctx.direction)("restrictions", ctx.restrictions)("multiple", ctx.multiple)("disabled", ctx.disabled);
        ɵngcc0.ɵɵattribute("accept", ctx.accept ? ctx.accept : null);
        ɵngcc0.ɵɵadvance(3);
        ɵngcc0.ɵɵtextInterpolate(ctx.textFor("select"));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showTotalStatus);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ctx.textFor("dropFilesHere"));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showFileList && ctx.fileList.count > 0);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngIf", ctx.showActionButtons);
    } }, directives: function () { return [LocalizedMessagesDirective,
        DropZoneInternalDirective,
        FileSelectDirective, ɵngcc3.NgIf, UploadStatusTotalComponent,
        FileListComponent,
        UploadActionButtonsComponent]; }, encapsulation: 2 });
/** @nocollapse */
UploadComponent.ctorParameters = () => [
    { type: UploadService },
    { type: LocalizationService },
    { type: NavigationService },
    { type: DropZoneService },
    { type: NgZone },
    { type: Renderer2 },
    { type: ChangeDetectorRef },
    { type: ElementRef }
];
UploadComponent.propDecorators = {
    autoUpload: [{ type: Input }],
    batch: [{ type: Input }],
    withCredentials: [{ type: Input }],
    saveField: [{ type: Input }],
    saveHeaders: [{ type: Input }],
    saveMethod: [{ type: Input }],
    saveUrl: [{ type: Input }],
    responseType: [{ type: Input }],
    removeField: [{ type: Input }],
    removeHeaders: [{ type: Input }],
    removeMethod: [{ type: Input }],
    removeUrl: [{ type: Input }],
    chunkable: [{ type: Input }],
    concurrent: [{ type: Input }],
    multiple: [{ type: Input }],
    disabled: [{ type: Input }],
    showFileList: [{ type: Input }],
    tabindex: [{ type: Input }],
    zoneId: [{ type: Input }],
    tabIndex: [{ type: Input, args: ['tabIndex',] }],
    accept: [{ type: Input }],
    restrictions: [{ type: Input }],
    focusableId: [{ type: Input }],
    actionsLayout: [{ type: Input }],
    fileTemplate: [{ type: ContentChild, args: [FileTemplateDirective,] }],
    fileSelect: [{ type: ViewChild, args: ['fileSelect',] }],
    fileSelectButton: [{ type: ViewChild, args: ['fileSelectButton',] }],
    onBlur: [{ type: Output, args: ['blur',] }],
    cancel: [{ type: Output }],
    clear: [{ type: Output }],
    complete: [{ type: Output }],
    error: [{ type: Output }],
    onFocus: [{ type: Output, args: ['focus',] }],
    pause: [{ type: Output }],
    remove: [{ type: Output }],
    resume: [{ type: Output }],
    select: [{ type: Output }],
    success: [{ type: Output }],
    upload: [{ type: Output }],
    uploadProgress: [{ type: Output }],
    valueChange: [{ type: Output }],
    hostDefaultClasses: [{ type: HostBinding, args: ['class.k-widget',] }, { type: HostBinding, args: ['class.k-upload',] }],
    hostDisabledClass: [{ type: HostBinding, args: ['class.k-state-disabled',] }],
    dir: [{ type: HostBinding, args: ['attr.dir',] }],
    handleKeydown: [{ type: HostListener, args: ['keydown', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadComponent, [{
        type: Component,
        args: [{
                exportAs: 'kendoUpload',
                providers: [
                    LocalizationService,
                    NavigationService,
                    UploadService,
                    DropZoneService,
                    UPLOAD_VALUE_ACCESSOR,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.upload'
                    },
                    {
                        provide: KendoInput,
                        useExisting: forwardRef(() => UploadComponent)
                    }
                ],
                selector: 'kendo-upload',
                template: `
    <ng-container kendoUploadLocalizedMessages
      i18n-cancel="kendo.upload.cancel|The text for the Cancel button"
      cancel="Cancel"

      i18n-clearSelectedFiles="kendo.upload.clearSelectedFiles|The text for the Clear button"
      clearSelectedFiles="Clear"

      i18n-dropFilesHere="kendo.upload.dropFilesHere|The drop zone hint"
      dropFilesHere="Drop files here to upload"

      i18n-filesBatchStatus="kendo.upload.filesBatchStatus|The status message for a batch of files"
      filesBatchStatus="files"

      i18n-filesBatchStatusFailed="kendo.upload.filesBatchStatusFailed|The status message for a batch of files after failed upload"
      filesBatchStatusFailed="files failed to upload."

      i18n-filesBatchStatusUploaded="kendo.upload.filesBatchStatusUploaded|The status message for a batch of files after successful upload"
      filesBatchStatusUploaded="files successfully uploaded."

      i18n-fileStatusFailed="kendo.upload.fileStatusFailed|The file status message after failed upload"
      fileStatusFailed="File failed to upload."

      i18n-fileStatusUploaded="kendo.upload.fileStatusUploaded|The file status message after successful upload"
      fileStatusUploaded="File successfully uploaded."

      i18n-headerStatusPaused="kendo.upload.headerStatusPaused|The header status message when the file upload is paused"
      headerStatusPaused="Paused"

      i18n-headerStatusUploaded="kendo.upload.headerStatusUploaded|The header status message after file upload completion"
      headerStatusUploaded="Done"

      i18n-headerStatusUploading="kendo.upload.headerStatusUploading|The header status message during file upload"
      headerStatusUploading="Uploading..."

      i18n-invalidFileExtension="kendo.upload.invalidFileExtension|The text for the invalid allowed extensions restriction message"
      invalidFileExtension="File type not allowed."

      i18n-invalidMaxFileSize="kendo.upload.invalidMaxFileSize|The text for the invalid max file size restriction message"
      invalidMaxFileSize="File size too large."

      i18n-invalidMinFileSize="kendo.upload.invalidMinFileSize|The text for the invalid min file size restriction message"
      invalidMinFileSize="File size too small."

      i18n-pause="kendo.upload.pause|The text for the Pause button"
      pause="Pause"

      i18n-remove="kendo.upload.remove|The text for the Remove button"
      remove="Remove"

      i18n-resume="kendo.upload.resume|The text for the Resume button"
      resume="Resume"

      i18n-retry="kendo.upload.retry|The text for the Retry button"
      retry="Retry"

      i18n-select="kendo.upload.select|The text for the Select button"
      select="Select files..."

      i18n-uploadSelectedFiles="kendo.upload.uploadSelectedFiles|The text for the Upload files button"
      uploadSelectedFiles="Upload"
    >
    </ng-container>
    <div kendoUploadInternalDropZone
      [restrictions]="restrictions"
      [multiple]="multiple"
      [disabled]="disabled">
        <div role="button" #fileSelectButton
             [id]="focusableId"
             [attr.aria-label]="textFor('select')"
             [attr.tabindex]="selectButtonTabIndex"
             (focus)="onFileSelectButtonFocus($event)"
             (blur)="onFileSelectButtonBlur($event)"
             class="k-button k-upload-button">
          <input #fileSelect kendoFileSelect
            [attr.accept]="accept ? accept : null"
            [dir]="direction"
            [restrictions]="restrictions"
            [multiple]="multiple"
            [disabled]="disabled" />
          <span>{{textFor('select')}}</span>
        </div>
        <kendo-upload-status-total *ngIf="showTotalStatus"
          class="k-upload-status k-upload-status-total"
          [fileList]="fileList">
        </kendo-upload-status-total>
        <div class="k-dropzone-hint">{{textFor('dropFilesHere')}}</div>
    </div>
    <ul kendo-upload-file-list *ngIf="showFileList && fileList.count > 0"
        class="k-upload-files k-reset"
        [disabled]="disabled"
        [fileList]="fileList.files"
        [fileTemplate]="fileTemplate">
    </ul>
    <kendo-upload-action-buttons
      *ngIf="showActionButtons"
      [disabled]="disabled"
      [actionsLayout]="actionsLayout">
    </kendo-upload-action-buttons>
  `
            }]
    }], function () { return [{ type: UploadService }, { type: ɵngcc2.LocalizationService }, { type: NavigationService }, { type: DropZoneService }, { type: ɵngcc0.NgZone }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc0.ChangeDetectorRef }, { type: ɵngcc0.ElementRef }]; }, { chunkable: [{
            type: Input
        }], multiple: [{
            type: Input
        }], disabled: [{
            type: Input
        }], showFileList: [{
            type: Input
        }], tabindex: [{
            type: Input
        }], focusableId: [{
            type: Input
        }], actionsLayout: [{
            type: Input
        }], onBlur: [{
            type: Output,
            args: ['blur']
        }], cancel: [{
            type: Output
        }], clear: [{
            type: Output
        }], complete: [{
            type: Output
        }], error: [{
            type: Output
        }], onFocus: [{
            type: Output,
            args: ['focus']
        }], pause: [{
            type: Output
        }], remove: [{
            type: Output
        }], resume: [{
            type: Output
        }], select: [{
            type: Output
        }], success: [{
            type: Output
        }], upload: [{
            type: Output
        }], uploadProgress: [{
            type: Output
        }], valueChange: [{
            type: Output
        }], hostDefaultClasses: [{
            type: HostBinding,
            args: ['class.k-widget']
        }, {
            type: HostBinding,
            args: ['class.k-upload']
        }], autoUpload: [{
            type: Input
        }], batch: [{
            type: Input
        }], withCredentials: [{
            type: Input
        }], saveField: [{
            type: Input
        }], saveHeaders: [{
            type: Input
        }], saveMethod: [{
            type: Input
        }], saveUrl: [{
            type: Input
        }], responseType: [{
            type: Input
        }], removeField: [{
            type: Input
        }], removeHeaders: [{
            type: Input
        }], removeMethod: [{
            type: Input
        }], removeUrl: [{
            type: Input
        }], concurrent: [{
            type: Input
        }], tabIndex: [{
            type: Input,
            args: ['tabIndex']
        }], restrictions: [{
            type: Input
        }], hostDisabledClass: [{
            type: HostBinding,
            args: ['class.k-state-disabled']
        }], dir: [{
            type: HostBinding,
            args: ['attr.dir']
        }], handleKeydown: [{
            type: HostListener,
            args: ['keydown', ['$event']]
        }], zoneId: [{
            type: Input
        }], accept: [{
            type: Input
        }], fileTemplate: [{
            type: ContentChild,
            args: [FileTemplateDirective]
        }], fileSelect: [{
            type: ViewChild,
            args: ['fileSelect']
        }], fileSelectButton: [{
            type: ViewChild,
            args: ['fileSelectButton']
        }] }); })();

class UploadDropZoneDirective {
    constructor(dropZoneService) {
        this.dropZoneService = dropZoneService;
    }
    /**
     * @hidden
     */
    onElementDragEnter() {
        return false;
    }
    /**
     * @hidden
     */
    onElementDragOver() {
        return false;
    }
    /**
     * @hidden
     */
    onDropListener(event) {
        const components = this.componentInstance;
        if (!isPresent(components)) {
            return;
        }
        components.forEach((component) => {
            let droppedFiles = event.dataTransfer.files;
            if (droppedFiles.length > 0 && !component.disabled) {
                let files = getAllFileInfo(droppedFiles);
                if (component instanceof UploadComponent) {
                    files = assignGuidToFiles(files, !component.batch);
                }
                else {
                    files = assignGuidToFiles(files, true);
                }
                if (!component.multiple) {
                    files.splice(1, files.length - 1);
                    component.clearFiles();
                }
                validateFiles(files, component.restrictions);
                component.addFiles(files);
            }
        });
        return false;
    }
    /**
     * @hidden
     */
    get componentInstance() {
        return this.dropZoneService.getComponents(this.zoneId);
    }
}
UploadDropZoneDirective.ɵfac = function UploadDropZoneDirective_Factory(t) { return new (t || UploadDropZoneDirective)(ɵngcc0.ɵɵdirectiveInject(DropZoneService)); };
UploadDropZoneDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: UploadDropZoneDirective, selectors: [["", "kendoUploadDropZone", ""], ["", "kendoFileSelectDropZone", ""]], hostBindings: function UploadDropZoneDirective_HostBindings(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵlistener("dragenter", function UploadDropZoneDirective_dragenter_HostBindingHandler() { return ctx.onElementDragEnter(); })("dragover", function UploadDropZoneDirective_dragover_HostBindingHandler() { return ctx.onElementDragOver(); })("drop", function UploadDropZoneDirective_drop_HostBindingHandler($event) { return ctx.onDropListener($event); });
    } }, inputs: { zoneId: ["kendoUploadDropZone", "zoneId"] }, features: [ɵngcc0.ɵɵProvidersFeature([
            DropZoneService
        ])] });
/** @nocollapse */
UploadDropZoneDirective.ctorParameters = () => [
    { type: DropZoneService }
];
UploadDropZoneDirective.propDecorators = {
    zoneId: [{ type: Input, args: ['kendoUploadDropZone',] }],
    onElementDragEnter: [{ type: HostListener, args: ['dragenter',] }],
    onElementDragOver: [{ type: HostListener, args: ['dragover',] }],
    onDropListener: [{ type: HostListener, args: ['drop', ['$event'],] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadDropZoneDirective, [{
        type: Directive,
        args: [{
                providers: [
                    DropZoneService
                ],
                selector: '[kendoUploadDropZone], [kendoFileSelectDropZone]'
            }]
    }], function () { return [{ type: DropZoneService }]; }, { onElementDragEnter: [{
            type: HostListener,
            args: ['dragenter']
        }], onElementDragOver: [{
            type: HostListener,
            args: ['dragover']
        }], onDropListener: [{
            type: HostListener,
            args: ['drop', ['$event']]
        }], zoneId: [{
            type: Input,
            args: ['kendoUploadDropZone']
        }] }); })();

/* tslint:disable: no-use-before-declare */
/**
 * Represents the [Kendo UI UploadDropZone component for Angular]({% slug overview_upload %}).
 */
class UploadDropZoneComponent extends DropZoneBase {
    constructor(element, renderer, localization) {
        super(element, renderer, 'k-external-dropzone-hover');
        this.localization = localization;
        this.hostClass = true;
        this.localizationChangeSubscription = this.localization.changes.subscribe(({ rtl }) => {
            this.direction = rtl ? 'rtl' : 'ltr';
        });
    }
    get dirAttribute() {
        return this.direction;
    }
    /**
     * @hidden
     */
    textFor(key) {
        return this.localization.get(key);
    }
    /**
     * @hidden
     */
    get iconClasses() {
        if (this.icon) {
            return `k-icon k-i-${this.icon}`;
        }
        if (this.iconClass) {
            return `${this.iconClass}`;
        }
        return 'k-icon k-i-upload';
    }
    ngOnDestroy() {
        if (this.localizationChangeSubscription) {
            this.localizationChangeSubscription.unsubscribe();
        }
    }
}
UploadDropZoneComponent.ɵfac = function UploadDropZoneComponent_Factory(t) { return new (t || UploadDropZoneComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
UploadDropZoneComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: UploadDropZoneComponent, selectors: [["kendo-uploaddropzone"]], hostVars: 3, hostBindings: function UploadDropZoneComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵattribute("dir", ctx.dirAttribute);
        ɵngcc0.ɵɵclassProp("k-external-dropzone", ctx.hostClass);
    } }, inputs: { zoneId: "zoneId", icon: "icon", iconClass: "iconClass" }, exportAs: ["kendoUploadDropZone"], features: [ɵngcc0.ɵɵProvidersFeature([
            LocalizationService,
            {
                provide: L10N_PREFIX,
                useValue: 'kendo.uploaddropzone'
            }
        ]), ɵngcc0.ɵɵInheritDefinitionFeature], ngContentSelectors: _c67, decls: 8, vars: 3, consts: [["kendoUploadDropZoneLocalizedMessages", "", 6, "externalDropFilesHere"], [1, "k-dropzone-inner", 3, "kendoUploadDropZone"], [3, "ngClass"], [1, "k-dropzone-hint"], [1, "k-dropzone-note"]], template: function UploadDropZoneComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵelementContainerStart(0, 0);
        ɵngcc0.ɵɵi18nAttributes(1, _c66);
        ɵngcc0.ɵɵelementContainerEnd();
        ɵngcc0.ɵɵelementStart(2, "div", 1);
        ɵngcc0.ɵɵelement(3, "span", 2);
        ɵngcc0.ɵɵelementStart(4, "span", 3);
        ɵngcc0.ɵɵtext(5);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(6, "span", 4);
        ɵngcc0.ɵɵprojection(7);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵproperty("kendoUploadDropZone", ctx.zoneId);
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵproperty("ngClass", ctx.iconClasses);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate(ctx.textFor("externalDropFilesHere"));
    } }, directives: [LocalizedMessagesDirective,
        UploadDropZoneDirective, ɵngcc3.NgClass], encapsulation: 2 });
/** @nocollapse */
UploadDropZoneComponent.ctorParameters = () => [
    { type: ElementRef },
    { type: Renderer2 },
    { type: LocalizationService }
];
UploadDropZoneComponent.propDecorators = {
    hostClass: [{ type: HostBinding, args: ['class.k-external-dropzone',] }],
    dirAttribute: [{ type: HostBinding, args: ['attr.dir',] }],
    zoneId: [{ type: Input }],
    icon: [{ type: Input }],
    iconClass: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadDropZoneComponent, [{
        type: Component,
        args: [{
                exportAs: 'kendoUploadDropZone',
                providers: [
                    LocalizationService,
                    {
                        provide: L10N_PREFIX,
                        useValue: 'kendo.uploaddropzone'
                    }
                ],
                selector: 'kendo-uploaddropzone',
                template: `
    <ng-container kendoUploadDropZoneLocalizedMessages
      i18n-externalDropFilesHere='kendo.uploaddropzone.externalDropFilesHere|Sets the external drop-zone hint'
      externalDropFilesHere='Drag and drop files here to upload'
    >
    </ng-container>
    <div class='k-dropzone-inner' [kendoUploadDropZone]="zoneId">
      <span [ngClass]="iconClasses"></span>
      <span class="k-dropzone-hint">{{ textFor('externalDropFilesHere') }}</span>
      <span class="k-dropzone-note">
        <ng-content></ng-content>
      </span>
    </div>
  `
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc0.Renderer2 }, { type: ɵngcc2.LocalizationService }]; }, { hostClass: [{
            type: HostBinding,
            args: ['class.k-external-dropzone']
        }], dirAttribute: [{
            type: HostBinding,
            args: ['attr.dir']
        }], zoneId: [{
            type: Input
        }], icon: [{
            type: Input
        }], iconClass: [{
            type: Input
        }] }); })();

/**
 * @hidden
 */
const SHARED_DECLARATIONS = [
    DropZoneInternalDirective,
    FileListComponent,
    FileListItemDirective,
    FileListItemActionButtonComponent,
    FileListMultipleItemsComponent,
    FileListSingleItemComponent,
    FileSelectDirective,
    LocalizedMessagesDirective,
    TemplateContextDirective
];
/**
 * @hidden
 */
const PUBLIC_DIRECTIVES = [
    FileTemplateDirective,
    CustomMessagesComponent,
    UploadDropZoneDirective,
    UploadDropZoneComponent
];
/**
 * @hidden
 */
class SharedModule {
}
SharedModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: SharedModule });
SharedModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function SharedModule_Factory(t) { return new (t || SharedModule)(); }, imports: [[CommonModule],
        CommonModule] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(SharedModule, { declarations: function () { return [FileTemplateDirective,
        CustomMessagesComponent,
        UploadDropZoneDirective,
        UploadDropZoneComponent,
        DropZoneInternalDirective,
        FileListComponent,
        FileListItemDirective,
        FileListItemActionButtonComponent,
        FileListMultipleItemsComponent,
        FileListSingleItemComponent,
        FileSelectDirective,
        LocalizedMessagesDirective,
        TemplateContextDirective]; }, imports: function () { return [CommonModule]; }, exports: function () { return [FileTemplateDirective,
        CustomMessagesComponent,
        UploadDropZoneDirective,
        UploadDropZoneComponent,
        DropZoneInternalDirective,
        FileListComponent,
        FileListItemDirective,
        FileListItemActionButtonComponent,
        FileListMultipleItemsComponent,
        FileListSingleItemComponent,
        FileSelectDirective,
        LocalizedMessagesDirective,
        TemplateContextDirective,
        CommonModule]; } }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(SharedModule, [{
        type: NgModule,
        args: [{
                declarations: [
                    PUBLIC_DIRECTIVES,
                    SHARED_DECLARATIONS
                ],
                exports: [
                    PUBLIC_DIRECTIVES,
                    SHARED_DECLARATIONS,
                    CommonModule
                ],
                imports: [CommonModule]
            }]
    }], null, null); })();

const FILESELECT_DECLARATIONS = [
    FileSelectComponent
];
/**
 * Represents the [NgModule](https://angular.io/api/core/NgModule) definition for the FileSelect component.
 */
class FileSelectModule {
}
FileSelectModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: FileSelectModule });
FileSelectModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function FileSelectModule_Factory(t) { return new (t || FileSelectModule)(); }, imports: [[SharedModule]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(FileSelectModule, { declarations: [FileSelectComponent], imports: [SharedModule], exports: [FileTemplateDirective,
        CustomMessagesComponent,
        UploadDropZoneDirective,
        UploadDropZoneComponent,
        FileSelectComponent] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(FileSelectModule, [{
        type: NgModule,
        args: [{
                declarations: [FILESELECT_DECLARATIONS],
                exports: [
                    PUBLIC_DIRECTIVES,
                    FILESELECT_DECLARATIONS
                ],
                imports: [SharedModule]
            }]
    }], null, null); })();

/**
 * @hidden
 */
class UploadActionButtonsComponent {
    constructor(uploadService, localization, navigation) {
        this.uploadService = uploadService;
        this.localization = localization;
        this.navigation = navigation;
        this.hostDefaultClass = true;
        this.onAction();
        this.onFocus();
    }
    get actionButtonsEndClassName() {
        return this.actionsLayout === 'end';
    }
    get actionButtonsStretchedClassName() {
        return this.actionsLayout === 'stretched';
    }
    get actionButtonsStartClassName() {
        return this.actionsLayout === 'start';
    }
    get actionButtonsCenterClassName() {
        return this.actionsLayout === 'center';
    }
    onAction() {
        this.actionSubscription = this.navigation.onActionButtonAction.subscribe((button) => {
            if (button === "clear") {
                this.clearFiles();
            }
            else {
                this.performUpload();
            }
            this.navigation.focusSelectButton();
        });
    }
    onFocus() {
        this.focusSubscription = this.navigation.onActionButtonFocus.subscribe((button) => {
            this.focusButton(button);
        });
    }
    focusButton(button) {
        const el = (button === "clear") ? this.clearButton : this.uploadButton;
        el.nativeElement.focus();
    }
    ngOnDestroy() {
        this.actionSubscription.unsubscribe();
        this.focusSubscription.unsubscribe();
    }
    performUpload(_event) {
        if (!this.disabled) {
            this.uploadService.uploadFiles();
        }
    }
    clearFiles(_event) {
        if (!this.disabled) {
            this.uploadService.clearFiles();
        }
    }
    textFor(key) {
        return this.localization.get(key);
    }
}
UploadActionButtonsComponent.ɵfac = function UploadActionButtonsComponent_Factory(t) { return new (t || UploadActionButtonsComponent)(ɵngcc0.ɵɵdirectiveInject(UploadService), ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService), ɵngcc0.ɵɵdirectiveInject(NavigationService)); };
UploadActionButtonsComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: UploadActionButtonsComponent, selectors: [["kendo-upload-action-buttons"]], viewQuery: function UploadActionButtonsComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c68, true);
        ɵngcc0.ɵɵviewQuery(_c69, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.clearButton = _t.first);
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.uploadButton = _t.first);
    } }, hostVars: 10, hostBindings: function UploadActionButtonsComponent_HostBindings(rf, ctx) { if (rf & 2) {
        ɵngcc0.ɵɵclassProp("k-actions", ctx.hostDefaultClass)("k-actions-end", ctx.actionButtonsEndClassName)("k-actions-stretched", ctx.actionButtonsStretchedClassName)("k-actions-start", ctx.actionButtonsStartClassName)("k-actions-center", ctx.actionButtonsCenterClassName);
    } }, inputs: { disabled: "disabled", actionsLayout: "actionsLayout" }, decls: 6, vars: 4, consts: [["type", "button", 1, "k-button", "k-clear-selected", 3, "click"], ["clearButton", ""], ["type", "button", 1, "k-button", "k-primary", "k-upload-selected", 3, "click"], ["uploadButton", ""]], template: function UploadActionButtonsComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelementStart(0, "button", 0, 1);
        ɵngcc0.ɵɵlistener("click", function UploadActionButtonsComponent_Template_button_click_0_listener($event) { return ctx.clearFiles($event); });
        ɵngcc0.ɵɵtext(2);
        ɵngcc0.ɵɵelementEnd();
        ɵngcc0.ɵɵelementStart(3, "button", 2, 3);
        ɵngcc0.ɵɵlistener("click", function UploadActionButtonsComponent_Template_button_click_3_listener($event) { return ctx.performUpload($event); });
        ɵngcc0.ɵɵtext(5);
        ɵngcc0.ɵɵelementEnd();
    } if (rf & 2) {
        ɵngcc0.ɵɵattribute("tabIndex", 0 - 1);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.textFor("clearSelectedFiles"), " ");
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵattribute("tabIndex", 0 - 1);
        ɵngcc0.ɵɵadvance(2);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.textFor("uploadSelectedFiles"), " ");
    } }, encapsulation: 2 });
/** @nocollapse */
UploadActionButtonsComponent.ctorParameters = () => [
    { type: UploadService },
    { type: LocalizationService },
    { type: NavigationService }
];
UploadActionButtonsComponent.propDecorators = {
    disabled: [{ type: Input }],
    actionsLayout: [{ type: Input }],
    clearButton: [{ type: ViewChild, args: ['clearButton',] }],
    uploadButton: [{ type: ViewChild, args: ['uploadButton',] }],
    hostDefaultClass: [{ type: HostBinding, args: ['class.k-actions',] }],
    actionButtonsEndClassName: [{ type: HostBinding, args: ['class.k-actions-end',] }],
    actionButtonsStretchedClassName: [{ type: HostBinding, args: ['class.k-actions-stretched',] }],
    actionButtonsStartClassName: [{ type: HostBinding, args: ['class.k-actions-start',] }],
    actionButtonsCenterClassName: [{ type: HostBinding, args: ['class.k-actions-center',] }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadActionButtonsComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-upload-action-buttons',
                template: `
        <button #clearButton type="button" class="k-button k-clear-selected"
            [attr.tabIndex]="-1"
            (click)="clearFiles($event)">
                {{textFor('clearSelectedFiles')}}
        </button>
        <button #uploadButton type="button" class="k-button k-primary k-upload-selected"
            [attr.tabIndex]="-1"
            (click)="performUpload($event)">
                {{textFor('uploadSelectedFiles')}}
        </button>
    `
            }]
    }], function () { return [{ type: UploadService }, { type: ɵngcc2.LocalizationService }, { type: NavigationService }]; }, { hostDefaultClass: [{
            type: HostBinding,
            args: ['class.k-actions']
        }], actionButtonsEndClassName: [{
            type: HostBinding,
            args: ['class.k-actions-end']
        }], actionButtonsStretchedClassName: [{
            type: HostBinding,
            args: ['class.k-actions-stretched']
        }], actionButtonsStartClassName: [{
            type: HostBinding,
            args: ['class.k-actions-start']
        }], actionButtonsCenterClassName: [{
            type: HostBinding,
            args: ['class.k-actions-center']
        }], disabled: [{
            type: Input
        }], actionsLayout: [{
            type: Input
        }], clearButton: [{
            type: ViewChild,
            args: ['clearButton']
        }], uploadButton: [{
            type: ViewChild,
            args: ['uploadButton']
        }] }); })();

/**
 * @hidden
 */
class UploadStatusTotalComponent {
    constructor(localization) {
        this.localization = localization;
    }
    ngDoCheck() {
        this.isPaused = this.fileList.hasFileWithState([FileState.Paused]);
        this.isFailed = this.fileList.hasFileWithState([FileState.Failed]);
        this.isUploading = this.fileList.hasFileWithState([FileState.Uploading]);
        if (this.isPaused && !this.isUploading) {
            this.statusText = this.localization.get('headerStatusPaused');
        }
        else {
            this.statusText = this.isUploading ? this.localization.get('headerStatusUploading')
                : this.localization.get('headerStatusUploaded');
        }
    }
}
UploadStatusTotalComponent.ɵfac = function UploadStatusTotalComponent_Factory(t) { return new (t || UploadStatusTotalComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc2.LocalizationService)); };
UploadStatusTotalComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: UploadStatusTotalComponent, selectors: [["kendo-upload-status-total"]], inputs: { fileList: "fileList" }, decls: 2, vars: 7, consts: [[1, "k-icon", 3, "ngClass"]], template: function UploadStatusTotalComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "span", 0);
        ɵngcc0.ɵɵtext(1);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngClass", ɵngcc0.ɵɵpureFunction4(2, _c70, !ctx.isUploading && !ctx.isFailed, !ctx.isUploading && ctx.isFailed, ctx.isUploading, ctx.isPaused));
        ɵngcc0.ɵɵadvance(1);
        ɵngcc0.ɵɵtextInterpolate1(" ", ctx.statusText, " ");
    } }, directives: [ɵngcc3.NgClass], encapsulation: 2 });
/** @nocollapse */
UploadStatusTotalComponent.ctorParameters = () => [
    { type: LocalizationService }
];
UploadStatusTotalComponent.propDecorators = {
    fileList: [{ type: Input }]
};
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadStatusTotalComponent, [{
        type: Component,
        args: [{
                selector: 'kendo-upload-status-total',
                template: `
        <span class="k-icon"
            [ngClass]="{
                'k-i-checkmark': !this.isUploading && !this.isFailed,
                'k-i-exception': !this.isUploading && this.isFailed,
                'k-i-upload': this.isUploading,
                'k-i-pause-sm': this.isPaused
            }">
        </span>
        {{statusText}}
    `
            }]
    }], function () { return [{ type: ɵngcc2.LocalizationService }]; }, { fileList: [{
            type: Input
        }] }); })();

const UPLOAD_DECLARATIONS = [
    UploadComponent,
    UploadActionButtonsComponent,
    UploadStatusTotalComponent
];
/**
 * Represents the [NgModule](https://angular.io/api/core/NgModule) definition for the Upload component.
 */
class UploadModule {
}
UploadModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: UploadModule });
UploadModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function UploadModule_Factory(t) { return new (t || UploadModule)(); }, imports: [[SharedModule]] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(UploadModule, { declarations: [UploadComponent,
        UploadActionButtonsComponent,
        UploadStatusTotalComponent], imports: [SharedModule], exports: [FileTemplateDirective,
        CustomMessagesComponent,
        UploadDropZoneDirective,
        UploadDropZoneComponent,
        UploadComponent,
        UploadActionButtonsComponent,
        UploadStatusTotalComponent] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadModule, [{
        type: NgModule,
        args: [{
                declarations: [UPLOAD_DECLARATIONS],
                exports: [
                    PUBLIC_DIRECTIVES,
                    UPLOAD_DECLARATIONS
                ],
                imports: [SharedModule]
            }]
    }], null, null); })();

/**
 * Represents the [NgModule]({{ site.data.urls.angular['ngmoduleapi'] }})
 * definition for the Uploads components.
 *
 * @example
 *
 * ```ts-no-run
 * import { UploadsModule } from '@progress/kendo-angular-upload';
 *
 * import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 * import { NgModule } from '@angular/core';
 *
 * import { AppComponent } from './app.component';
 *
 * _@NgModule({
 *     declarations: [AppComponent],
 *     imports:      [BrowserModule, UploadsModule],
 *     bootstrap:    [AppComponent]
 * })
 * export class AppModule {}
 *
 * platformBrowserDynamic().bootstrapModule(AppModule);
 *
 * ```
 */
class UploadsModule {
}
UploadsModule.ɵmod = ɵngcc0.ɵɵdefineNgModule({ type: UploadsModule });
UploadsModule.ɵinj = ɵngcc0.ɵɵdefineInjector({ factory: function UploadsModule_Factory(t) { return new (t || UploadsModule)(); }, imports: [FileSelectModule,
        UploadModule] });
(function () { (typeof ngJitMode === "undefined" || ngJitMode) && ɵngcc0.ɵɵsetNgModuleScope(UploadsModule, { exports: [FileSelectModule,
        UploadModule] }); })();
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(UploadsModule, [{
        type: NgModule,
        args: [{
                exports: [
                    FileSelectModule,
                    UploadModule
                ]
            }]
    }], null, null); })();

/**
 * Generated bundle index. Do not edit.
 */

export { DropZoneBase, DropZoneInternalDirective, DropZoneService, PreventableEvent, FILESELECT_VALUE_ACCESSOR, LocalizedMessagesDirective, Messages, NavigationService, FileListItemDirective, FileListItemBase, PUBLIC_DIRECTIVES, SHARED_DECLARATIONS, SharedModule, UPLOAD_VALUE_ACCESSOR, UploadService, FileSelectModule, UploadModule, UploadsModule, UploadComponent, FileSelectComponent, UploadDropZoneComponent, FileSelectDirective, FileListComponent, FileListSingleItemComponent, FileListItemActionButtonComponent, FileListMultipleItemsComponent, FileTemplateDirective, TemplateContextDirective, UploadStatusTotalComponent, UploadActionButtonsComponent, UploadDropZoneDirective, CustomMessagesComponent, CancelEvent, ClearEvent, ErrorEvent, PauseEvent, RemoveEvent, ResumeEvent, SelectEvent, SuccessEvent, UploadEvent, UploadProgressEvent, FileState };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O3VHQUdFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7OzsyRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzttSEFHRTtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7dUVBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O2tMQUtFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs0RUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7MEJBR0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7cUZBdUVFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7ODJCQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtxRUFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7eUpBWUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7OztvRkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7O1dBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQTtBQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7OztnSkFRRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7dURBS0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7MERBZ0NFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7d0VBc0RFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7QUFBQztBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7ZUE4Q0U7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztlQXNDRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OzZHQUtFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7OztrREFlRTtBQUNGO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7O29GQUFFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzt1TEFLRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OERBeUhFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7ZUFRRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7c0VBMkJFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzswQkFjRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OzBCQVVFO0FBQ0Y7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzZCQWlCRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7b0JBQUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7OzsyREFnQkU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFBRTtBQUNGO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7MEJBVUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7Ozs7Ozs7Ozs7Ozs7MEJBUUU7QUFDRjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJzb3VyY2VzQ29udGVudCI6WyIvKiotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuKiBDb3B5cmlnaHQgwqkgMjAyMCBQcm9ncmVzcyBTb2Z0d2FyZSBDb3Jwb3JhdGlvbi4gQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiogTGljZW5zZWQgdW5kZXIgY29tbWVyY2lhbCBsaWNlbnNlLiBTZWUgTElDRU5TRS5tZCBpbiB0aGUgcHJvamVjdCByb290IGZvciBtb3JlIGluZm9ybWF0aW9uXG4qLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5pbXBvcnQgeyBFdmVudEVtaXR0ZXIsIEluamVjdGFibGUsIERpcmVjdGl2ZSwgVGVtcGxhdGVSZWYsIGZvcndhcmRSZWYsIENvbXBvbmVudCwgTmdab25lLCBSZW5kZXJlcjIsIENoYW5nZURldGVjdG9yUmVmLCBFbGVtZW50UmVmLCBJbnB1dCwgQ29udGVudENoaWxkLCBWaWV3Q2hpbGQsIE91dHB1dCwgSG9zdEJpbmRpbmcsIEhvc3RMaXN0ZW5lciwgVmlld0NoaWxkcmVuLCBWaWV3Q29udGFpbmVyUmVmLCBpc0Rldk1vZGUsIE5nTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBOR19WQUxVRV9BQ0NFU1NPUiB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7IExvY2FsaXphdGlvblNlcnZpY2UsIEwxME5fUFJFRklYLCBDb21wb25lbnRNZXNzYWdlcyB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLWwxMG4nO1xuaW1wb3J0IHsgZ3VpZCwgS2V5cywgaXNEb2N1bWVudEF2YWlsYWJsZSwgS2VuZG9JbnB1dCwgaXNDaGFuZ2VkIH0gZnJvbSAnQHByb2dyZXNzL2tlbmRvLWFuZ3VsYXItY29tbW9uJztcbmltcG9ydCB7IGZyb21FdmVudCwgbWVyZ2UgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IGZpbHRlciB9IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcbmltcG9ydCB7IEh0dHBIZWFkZXJzLCBIdHRwUmVxdWVzdCwgSHR0cEV2ZW50VHlwZSwgSHR0cFJlc3BvbnNlLCBIdHRwQ2xpZW50IH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uL2h0dHAnO1xuaW1wb3J0IHsgQ29tbW9uTW9kdWxlIH0gZnJvbSAnQGFuZ3VsYXIvY29tbW9uJztcbmltcG9ydCB7IHRyaWdnZXIsIHN0YXRlLCBzdHlsZSwgdHJhbnNpdGlvbiwgYW5pbWF0ZSB9IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuXG4vKipcbiAqIExpc3RzIHRoZSBwb3NzaWJsZSBzdGF0ZXMgb2YgYSBmaWxlLlxuICovXG52YXIgRmlsZVN0YXRlO1xuKGZ1bmN0aW9uIChGaWxlU3RhdGUpIHtcbiAgICAvKipcbiAgICAgKiBUaGUgZmlsZSB1cGxvYWQgcHJvY2VzcyBoYXMgZmFpbGVkLlxuICAgICAqL1xuICAgIEZpbGVTdGF0ZVtGaWxlU3RhdGVbXCJGYWlsZWRcIl0gPSAwXSA9IFwiRmFpbGVkXCI7XG4gICAgLyoqXG4gICAgICogQW4gaW5pdGlhbGx5IHNlbGVjdGVkIGZha2UgZmlsZSB3aXRob3V0IGEgc2V0IHN0YXRlLlxuICAgICAqL1xuICAgIEZpbGVTdGF0ZVtGaWxlU3RhdGVbXCJJbml0aWFsXCJdID0gMV0gPSBcIkluaXRpYWxcIjtcbiAgICAvKipcbiAgICAgKiBUaGUgZmlsZSBpcyBzZWxlY3RlZC5cbiAgICAgKi9cbiAgICBGaWxlU3RhdGVbRmlsZVN0YXRlW1wiU2VsZWN0ZWRcIl0gPSAyXSA9IFwiU2VsZWN0ZWRcIjtcbiAgICAvKipcbiAgICAgKiBUaGUgZmlsZSBpcyBzdWNjZXNzZnVsbHkgdXBsb2FkZWQuXG4gICAgICovXG4gICAgRmlsZVN0YXRlW0ZpbGVTdGF0ZVtcIlVwbG9hZGVkXCJdID0gM10gPSBcIlVwbG9hZGVkXCI7XG4gICAgLyoqXG4gICAgICogVGhlIGZpbGUgaXMgaW4gdGhlIHByb2Nlc3Mgb2YgdXBsb2FkaW5nLlxuICAgICAqL1xuICAgIEZpbGVTdGF0ZVtGaWxlU3RhdGVbXCJVcGxvYWRpbmdcIl0gPSA0XSA9IFwiVXBsb2FkaW5nXCI7XG4gICAgLyoqXG4gICAgICogVGhlIGZpbGUgdXBsb2FkIHByb2Nlc3MgaGFzIGJlZW4gcGF1c2VkLlxuICAgICAqL1xuICAgIEZpbGVTdGF0ZVtGaWxlU3RhdGVbXCJQYXVzZWRcIl0gPSA1XSA9IFwiUGF1c2VkXCI7XG59KShGaWxlU3RhdGUgfHwgKEZpbGVTdGF0ZSA9IHt9KSk7XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jbGFzcyBGaWxlTWFwIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fZmlsZXMgPSB7fTtcbiAgICB9XG4gICAgYWRkKGZpbGUpIHtcbiAgICAgICAgbGV0IHVpZCA9IGZpbGUudWlkO1xuICAgICAgICBpZiAodGhpcy5oYXModWlkKSkge1xuICAgICAgICAgICAgaWYgKGZpbGUudmFsaWRhdGlvbkVycm9ycyAmJiBmaWxlLnZhbGlkYXRpb25FcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVzW3VpZF0udW5zaGlmdChmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMuX2ZpbGVzW3VpZF0ucHVzaChmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuX2ZpbGVzW3VpZF0gPSBbZmlsZV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmVtb3ZlKHVpZCkge1xuICAgICAgICBpZiAodGhpcy5oYXModWlkKSkge1xuICAgICAgICAgICAgdGhpcy5fZmlsZXNbdWlkXSA9IG51bGw7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fZmlsZXNbdWlkXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhcigpIHtcbiAgICAgICAgbGV0IGFsbEZpbGVzID0gdGhpcy5fZmlsZXM7XG4gICAgICAgIGZvciAobGV0IHVpZCBpbiBhbGxGaWxlcykge1xuICAgICAgICAgICAgaWYgKGFsbEZpbGVzLmhhc093blByb3BlcnR5KHVpZCkpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBmaWxlIG9mIGFsbEZpbGVzW3VpZF0pIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuaHR0cFN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZS5odHRwU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWxsRmlsZXNbdWlkXSA9IG51bGw7XG4gICAgICAgICAgICAgICAgZGVsZXRlIGFsbEZpbGVzW3VpZF07XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFzKHVpZCkge1xuICAgICAgICByZXR1cm4gdWlkIGluIHRoaXMuX2ZpbGVzO1xuICAgIH1cbiAgICBnZXQodWlkKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9maWxlc1t1aWRdO1xuICAgIH1cbiAgICBzZXRGaWxlc1N0YXRlKGZpbGVzLCBzdGF0ZSQkMSkge1xuICAgICAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgICAgICB0aGlzLnNldEZpbGVzU3RhdGVCeVVpZChmaWxlLnVpZCwgc3RhdGUkJDEpO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNldEZpbGVzU3RhdGVCeVVpZCh1aWQsIHN0YXRlJCQxKSB7XG4gICAgICAgIHRoaXMuZ2V0KHVpZCkuZm9yRWFjaCgoZikgPT4ge1xuICAgICAgICAgICAgZi5zdGF0ZSA9IHN0YXRlJCQxO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0IGNvdW50KCkge1xuICAgICAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXModGhpcy5fZmlsZXMpLmxlbmd0aDtcbiAgICB9XG4gICAgZ2V0IGZpbGVzKCkge1xuICAgICAgICBsZXQgaW5pdGlhbCA9IHRoaXMuX2ZpbGVzO1xuICAgICAgICBsZXQgdHJhbnNmb3JtZWQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgdWlkIGluIGluaXRpYWwpIHtcbiAgICAgICAgICAgIGlmIChpbml0aWFsLmhhc093blByb3BlcnR5KHVpZCkpIHtcbiAgICAgICAgICAgICAgICB0cmFuc2Zvcm1lZC5wdXNoKGluaXRpYWxbdWlkXSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRyYW5zZm9ybWVkO1xuICAgIH1cbiAgICBnZXQgZmlsZXNGbGF0KCkge1xuICAgICAgICBsZXQgaW5pdGlhbCA9IHRoaXMuX2ZpbGVzO1xuICAgICAgICBsZXQgdHJhbnNmb3JtZWQgPSBbXTtcbiAgICAgICAgZm9yIChsZXQgdWlkIGluIGluaXRpYWwpIHtcbiAgICAgICAgICAgIGlmIChpbml0aWFsLmhhc093blByb3BlcnR5KHVpZCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudCA9IGluaXRpYWxbdWlkXTtcbiAgICAgICAgICAgICAgICBjdXJyZW50LmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtZWQucHVzaChmaWxlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJhbnNmb3JtZWQ7XG4gICAgfVxuICAgIGdldCBmaWxlc1RvVXBsb2FkKCkge1xuICAgICAgICBsZXQgZmlsZXMgPSB0aGlzLl9maWxlcztcbiAgICAgICAgbGV0IG5vdFVwbG9hZGVkID0gW107XG4gICAgICAgIGZvciAobGV0IHVpZCBpbiBmaWxlcykge1xuICAgICAgICAgICAgaWYgKGZpbGVzLmhhc093blByb3BlcnR5KHVpZCkpIHtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudEZpbGVzID0gZmlsZXNbdWlkXTtcbiAgICAgICAgICAgICAgICBsZXQgY3VycmVudEZpbGVzVmFsaWQgPSB0cnVlO1xuICAgICAgICAgICAgICAgIGZvciAobGV0IGZpbGUgb2YgY3VycmVudEZpbGVzKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXRlICE9PSBGaWxlU3RhdGUuU2VsZWN0ZWQgfHwgKGZpbGUudmFsaWRhdGlvbkVycm9ycyAmJiBmaWxlLnZhbGlkYXRpb25FcnJvcnMubGVuZ3RoID4gMCkpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbnRGaWxlc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRGaWxlc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIG5vdFVwbG9hZGVkLnB1c2goY3VycmVudEZpbGVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIG5vdFVwbG9hZGVkO1xuICAgIH1cbiAgICBnZXQgZmlyc3RGaWxlVG9VcGxvYWQoKSB7XG4gICAgICAgIGxldCBmaWxlcyA9IHRoaXMuX2ZpbGVzO1xuICAgICAgICBmb3IgKGxldCB1aWQgaW4gZmlsZXMpIHtcbiAgICAgICAgICAgIGlmIChmaWxlcy5oYXNPd25Qcm9wZXJ0eSh1aWQpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRGaWxlcyA9IGZpbGVzW3VpZF07XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRGaWxlc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBmaWxlIG9mIGN1cnJlbnRGaWxlcykge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsZS5zdGF0ZSAhPT0gRmlsZVN0YXRlLlNlbGVjdGVkIHx8IChmaWxlLnZhbGlkYXRpb25FcnJvcnMgJiYgZmlsZS52YWxpZGF0aW9uRXJyb3JzLmxlbmd0aCA+IDApKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50RmlsZXNWYWxpZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50RmlsZXNWYWxpZCkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gY3VycmVudEZpbGVzO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgaGFzRmlsZVdpdGhTdGF0ZShmaWxlU3RhdGVzKSB7XG4gICAgICAgIGxldCBmaWxlcyA9IHRoaXMuX2ZpbGVzO1xuICAgICAgICBmb3IgKGxldCB1aWQgaW4gZmlsZXMpIHtcbiAgICAgICAgICAgIGlmIChmaWxlcy5oYXNPd25Qcm9wZXJ0eSh1aWQpKSB7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRGaWxlcyA9IGZpbGVzW3VpZF07XG4gICAgICAgICAgICAgICAgZm9yIChsZXQgZmlsZSBvZiBjdXJyZW50RmlsZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGVTdGF0ZXMuaW5kZXhPZihmaWxlLnN0YXRlKSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuXG4vKipcbiAqIEFyZ3VtZW50cyBmb3IgdGhlIGBjYW5jZWxgIGV2ZW50LiBUaGUgYGNhbmNlbGAgZXZlbnQgZmlyZXMgd2hlblxuICogdGhlIHVzZXIgY2FuY2VscyB0aGUgcHJvY2VzcyBvZiB1cGxvYWRpbmcgYSBmaWxlIG9yIGEgYmF0Y2ggb2YgZmlsZXMuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPHA+Q2xpY2sgdGhlIDxzcGFuIGNsYXNzPSdrLWljb24gay1pLWNhbmNlbCc+PC9zcGFuPiBpY29uIGR1cmluZyB1cGxvYWQgdG8gdHJpZ2dlciB0aGUgZXZlbnQ8L3A+XG4gKiAgICA8a2VuZG8tdXBsb2FkXG4gKiAgICAgIFtzYXZlVXJsXT1cInVwbG9hZFNhdmVVcmxcIlxuICogICAgICBbcmVtb3ZlVXJsXT1cInVwbG9hZFJlbW92ZVVybFwiXG4gKiAgICAgIChjYW5jZWwpPVwiY2FuY2VsRXZlbnRIYW5kbGVyKCRldmVudClcIj5cbiAqICAgIDwva2VuZG8tdXBsb2FkPlxuICogICAgYFxuICogIH0pXG4gKiAgZXhwb3J0IGNsYXNzIFVwbG9hZENvbXBvbmVudCB7XG4gKiAgICB1cGxvYWRTYXZlVXJsID0gJ3NhdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqICAgIHVwbG9hZFJlbW92ZVVybCA9ICdyZW1vdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqXG4gKiAgICBjYW5jZWxFdmVudEhhbmRsZXIoZTogQ2FuY2VsRXZlbnQpIHtcbiAqICAgICAgY29uc29sZS5sb2coJ0NhbmNlbGluZyBmaWxlIHVwbG9hZCcsIGUuZmlsZXMpO1xuICogICAgfVxuICogIH1cbiAqIGBgYFxuICovXG5jbGFzcyBDYW5jZWxFdmVudCB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyB0aGUgZXZlbnQgYXJndW1lbnRzIGZvciB0aGUgYGNhbmNlbGAgZXZlbnQuXG4gICAgICogQHBhcmFtIGZpbGVzIC0gVGhlIGxpc3Qgb2YgdGhlIGZpbGVzIHRoYXQgd2VyZSBnb2luZyB0byBiZSB1cGxvYWRlZC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihmaWxlcykge1xuICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgfVxufVxuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgUHJldmVudGFibGVFdmVudCB7XG4gICAgY29uc3RydWN0b3IoKSB7XG4gICAgICAgIHRoaXMucHJldmVudGVkID0gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFByZXZlbnRzIHRoZSBkZWZhdWx0IGFjdGlvbiBmb3IgYSBzcGVjaWZpZWQgZXZlbnQuXG4gICAgICogSW4gdGhpcyB3YXksIHRoZSBzb3VyY2UgY29tcG9uZW50IHN1cHByZXNzZXMgdGhlIGJ1aWx0LWluIGJlaGF2aW9yIHRoYXQgZm9sbG93cyB0aGUgZXZlbnQuXG4gICAgICovXG4gICAgcHJldmVudERlZmF1bHQoKSB7XG4gICAgICAgIHRoaXMucHJldmVudGVkID0gdHJ1ZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogSWYgdGhlIGV2ZW50IGlzIHByZXZlbnRlZCBieSBhbnkgb2YgaXRzIHN1YnNjcmliZXJzLCByZXR1cm5zIGB0cnVlYC5cbiAgICAgKlxuICAgICAqIEByZXR1cm5zIGB0cnVlYCBpZiB0aGUgZGVmYXVsdCBhY3Rpb24gd2FzIHByZXZlbnRlZC4gT3RoZXJ3aXNlLCByZXR1cm5zIGBmYWxzZWAuXG4gICAgICovXG4gICAgaXNEZWZhdWx0UHJldmVudGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5wcmV2ZW50ZWQ7XG4gICAgfVxufVxuXG4vKipcbiAqIEFyZ3VtZW50cyBmb3IgdGhlIGBjbGVhcmAgZXZlbnQuIFRoZSBgY2xlYXJgIGV2ZW50IGZpcmVzIHdoZW5cbiAqIHRoZSAqKkNsZWFyKiogYnV0dG9uIGlzIGNsaWNrZWQuIEF0IHRoaXMgcG9pbnQsIHRoZSBzZWxlY3RlZCBmaWxlcyBhcmUgYWJvdXQgdG8gYmUgY2xlYXJlZC5cbiAqXG4gKiBgYGB0cy1uby1ydW5cbiAqICBAQ29tcG9uZW50KHtcbiAqICAgIHNlbGVjdG9yOiAnbXktdXBsb2FkJyxcbiAqICAgIHRlbXBsYXRlOiBgXG4gKiAgICA8a2VuZG8tdXBsb2FkXG4gKiAgICAgIFthdXRvVXBsb2FkXT1cImZhbHNlXCJcbiAqICAgICAgW3NhdmVVcmxdPVwidXBsb2FkU2F2ZVVybFwiXG4gKiAgICAgIFtyZW1vdmVVcmxdPVwidXBsb2FkUmVtb3ZlVXJsXCJcbiAqICAgICAgKGNsZWFyKT1cImNsZWFyRXZlbnRIYW5kbGVyKCRldmVudClcIj5cbiAqICAgIDwva2VuZG8tdXBsb2FkPlxuICogICAgYFxuICogIH0pXG4gKiAgZXhwb3J0IGNsYXNzIFVwbG9hZENvbXBvbmVudCB7XG4gKiAgICB1cGxvYWRTYXZlVXJsID0gJ3NhdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqICAgIHVwbG9hZFJlbW92ZVVybCA9ICdyZW1vdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqXG4gKiAgICBjbGVhckV2ZW50SGFuZGxlcihlOiBDbGVhckV2ZW50KSB7XG4gKiAgICAgIGNvbnNvbGUubG9nKCdDbGVhcmluZyB0aGUgZmlsZSB1cGxvYWQnKTtcbiAqICAgIH1cbiAqICB9XG4gKiBgYGBcbiAqL1xuY2xhc3MgQ2xlYXJFdmVudCBleHRlbmRzIFByZXZlbnRhYmxlRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgdGhlIGV2ZW50IGFyZ3VtZW50cyBmb3IgdGhlIGBjbGVhcmAgZXZlbnQuXG4gICAgICovXG4gICAgY29uc3RydWN0b3IoKSB7IHN1cGVyKCk7IH1cbn1cblxuLyoqXG4gKiBBcmd1bWVudHMgZm9yIHRoZSBgZXJyb3JgIGV2ZW50LiBUaGUgYGVycm9yYCBldmVudCBmaXJlcyB3aGVuXG4gKiBhbiBgdXBsb2FkYCBvciBgcmVtb3ZlYCBvcGVyYXRpb24gZmFpbHMuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPGtlbmRvLXVwbG9hZFxuICogICAgICBbc2F2ZVVybF09XCJ1cGxvYWRTYXZlVXJsXCJcbiAqICAgICAgW3JlbW92ZVVybF09XCJ1cGxvYWRSZW1vdmVVcmxcIlxuICogICAgICAoZXJyb3IpPVwiZXJyb3JFdmVudEhhbmRsZXIoJGV2ZW50KVwiPlxuICogICAgPC9rZW5kby11cGxvYWQ+XG4gKiAgICBgXG4gKiAgfSlcbiAqICBleHBvcnQgY2xhc3MgVXBsb2FkQ29tcG9uZW50IHtcbiAqICAgIHVwbG9hZFNhdmVVcmwgPSAnc2F2ZVVybCc7IC8vIHNob3VsZCByZXByZXNlbnQgYW4gYWN0dWFsIEFQSSBlbmRwb2ludFxuICogICAgdXBsb2FkUmVtb3ZlVXJsID0gJ3JlbW92ZVVybCc7IC8vIHNob3VsZCByZXByZXNlbnQgYW4gYWN0dWFsIEFQSSBlbmRwb2ludFxuICpcbiAqICAgIGVycm9yRXZlbnRIYW5kbGVyKGU6IEVycm9yRXZlbnQpIHtcbiAqICAgICAgY29uc29sZS5sb2coJ0FuIGVycm9yIG9jY3VycmVkJyk7XG4gKiAgICB9XG4gKiAgfVxuICogYGBgXG4gKi9cbmNsYXNzIEVycm9yRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgdGhlIGV2ZW50IGFyZ3VtZW50cyBmb3IgdGhlIGBlcnJvcmAgZXZlbnQuXG4gICAgICpcbiAgICAgKiBAcGFyYW0gZmlsZXMgLSBUaGUgbGlzdCBvZiB0aGUgZmlsZXMgdGhhdCBmYWlsZWQgdG8gYmUgdXBsb2FkZWQgb3IgcmVtb3ZlZC5cbiAgICAgKiBAcGFyYW0gb3BlcmF0aW9uIC0gVGhlIG9wZXJhdGlvbiB0eXBlIChgdXBsb2FkYCBvciBgcmVtb3ZlYCkuXG4gICAgICogQHBhcmFtIHJlc3BvbnNlIC0gVGhlIHJlc3BvbnNlIG9iamVjdCByZXR1cm5lZCBieSB0aGUgc2VydmVyLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGZpbGVzLCBvcGVyYXRpb24sIHJlc3BvbnNlKSB7XG4gICAgICAgIHRoaXMuZmlsZXMgPSBmaWxlcztcbiAgICAgICAgdGhpcy5vcGVyYXRpb24gPSBvcGVyYXRpb247XG4gICAgICAgIHRoaXMucmVzcG9uc2UgPSByZXNwb25zZTtcbiAgICB9XG59XG5cbi8qKlxuICogQXJndW1lbnRzIGZvciB0aGUgYHBhdXNlYCBldmVudC4gVGhlIGBwYXVzZWAgZXZlbnQgZmlyZXMgd2hlbiB0aGUgdXNlclxuICogcGF1c2VzIGEgZmlsZSB0aGF0IGlzIGN1cnJlbnRseSB1cGxvYWRpbmcuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPGtlbmRvLXVwbG9hZFxuICogICAgICBbY2h1bmthYmxlXT1cInRydWVcIlxuICogICAgICBbc2F2ZVVybF09XCJ1cGxvYWRTYXZlVXJsXCJcbiAqICAgICAgW3JlbW92ZVVybF09XCJ1cGxvYWRSZW1vdmVVcmxcIlxuICogICAgICAocGF1c2UpPVwicGF1c2VFdmVudEhhbmRsZXIoJGV2ZW50KVwiPlxuICogICAgPC9rZW5kby11cGxvYWQ+XG4gKiAgICBgXG4gKiAgfSlcbiAqICBleHBvcnQgY2xhc3MgVXBsb2FkQ29tcG9uZW50IHtcbiAqICAgIHVwbG9hZFNhdmVVcmwgPSAnc2F2ZVVybCc7IC8vIHNob3VsZCByZXByZXNlbnQgYW4gYWN0dWFsIEFQSSBlbmRwb2ludFxuICogICAgdXBsb2FkUmVtb3ZlVXJsID0gJ3JlbW92ZVVybCc7IC8vIHNob3VsZCByZXByZXNlbnQgYW4gYWN0dWFsIEFQSSBlbmRwb2ludFxuICpcbiAqICAgIHBhdXNlRXZlbnRIYW5kbGVyKGV2OiBQYXVzZUV2ZW50KSB7XG4gKiAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHBhdXNlZCcpO1xuICogICAgfVxuICogIH1cbiAqIGBgYFxuICpcbiAqL1xuY2xhc3MgUGF1c2VFdmVudCB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyB0aGUgZXZlbnQgYXJndW1lbnRzIGZvciB0aGUgYHBhdXNlYCBldmVudC5cbiAgICAgKiBAcGFyYW0gZmlsZSAtIFRoZSBmaWxlIHRoYXQgaXMgZ29pbmcgdG8gYmUgcGF1c2VkLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGZpbGUpIHtcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcbiAgICB9XG59XG5cbi8qKlxuICogQXJndW1lbnRzIGZvciB0aGUgYHJlbW92ZWAgZXZlbnQuIFRoZSBgcmVtb3ZlYCBldmVudCBmaXJlcyB3aGVuIGFuIHVwbG9hZGVkXG4gKiBvciBzZWxlY3RlZCBmaWxlIGlzIGFib3V0IHRvIGJlIHJlbW92ZWQuIElmIHlvdSBjYW5jZWwgdGhlIGV2ZW50LCB0aGUgcmVtb3ZhbCBpcyBwcmV2ZW50ZWQuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPGtlbmRvLXVwbG9hZFxuICogICAgICBbc2F2ZVVybF09XCJ1cGxvYWRTYXZlVXJsXCJcbiAqICAgICAgW3JlbW92ZVVybF09XCJ1cGxvYWRSZW1vdmVVcmxcIlxuICogICAgICAocmVtb3ZlKT1cInJlbW92ZUV2ZW50SGFuZGxlcigkZXZlbnQpXCI+XG4gKiAgICA8L2tlbmRvLXVwbG9hZD5cbiAqICAgIGBcbiAqICB9KVxuICogIGV4cG9ydCBjbGFzcyBVcGxvYWRDb21wb25lbnQge1xuICogICAgdXBsb2FkU2F2ZVVybCA9ICdzYXZlVXJsJzsgLy8gc2hvdWxkIHJlcHJlc2VudCBhbiBhY3R1YWwgQVBJIGVuZHBvaW50XG4gKiAgICB1cGxvYWRSZW1vdmVVcmwgPSAncmVtb3ZlVXJsJzsgLy8gc2hvdWxkIHJlcHJlc2VudCBhbiBhY3R1YWwgQVBJIGVuZHBvaW50XG4gKlxuICogICAgcmVtb3ZlRXZlbnRIYW5kbGVyKGU6IFJlbW92ZUV2ZW50KSB7XG4gKiAgICAgIGNvbnNvbGUubG9nKCdSZW1vdmluZyBhIGZpbGUnKTtcbiAqICAgIH1cbiAqICB9XG4gKiBgYGBcbiAqL1xuY2xhc3MgUmVtb3ZlRXZlbnQgZXh0ZW5kcyBQcmV2ZW50YWJsZUV2ZW50IHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIHRoZSBldmVudCBhcmd1bWVudHMgZm9yIHRoZSBgcmVtb3ZlYCBldmVudC5cbiAgICAgKiBAcGFyYW0gZmlsZXMgLSBUaGUgbGlzdCBvZiB0aGUgZmlsZXMgdGhhdCB3aWxsIGJlIHJlbW92ZWQuXG4gICAgICogQHBhcmFtIGhlYWRlcnMgLSBUaGUgaGVhZGVycyBvZiB0aGUgcmVxdWVzdC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihmaWxlcywgaGVhZGVycykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7XG4gICAgfVxufVxuXG4vKipcbiAqIEFyZ3VtZW50cyBmb3IgdGhlIGByZXN1bWVgIGV2ZW50LiBUaGUgYHJlc3VtZWAgZXZlbnQgZmlyZXMgd2hlbiB0aGUgdXNlclxuICogcmVzdW1lcyB0aGUgdXBsb2FkIG9mIGEgZmlsZSB0aGF0IGhhcyBiZWVuIHByZXZpb3VzbHkgcGF1c2VkLlxuICpcbiAqIGBgYHRzLW5vLXJ1blxuICogIEBDb21wb25lbnQoe1xuICogICAgc2VsZWN0b3I6ICdteS11cGxvYWQnLFxuICogICAgdGVtcGxhdGU6IGBcbiAqICAgIDxrZW5kby11cGxvYWRcbiAqICAgICAgW2NodW5rYWJsZV09XCJ0cnVlXCJcbiAqICAgICAgW3NhdmVVcmxdPVwidXBsb2FkU2F2ZVVybFwiXG4gKiAgICAgIFtyZW1vdmVVcmxdPVwidXBsb2FkUmVtb3ZlVXJsXCJcbiAqICAgICAgKHJlc3VtZSk9XCJyZXN1bWVFdmVudEhhbmRsZXIoJGV2ZW50KVwiPlxuICogICAgPC9rZW5kby11cGxvYWQ+XG4gKiAgICBgXG4gKiAgfSlcbiAqICBleHBvcnQgY2xhc3MgVXBsb2FkQ29tcG9uZW50IHtcbiAqICAgIHVwbG9hZFNhdmVVcmwgPSAnc2F2ZVVybCc7IC8vIHNob3VsZCByZXByZXNlbnQgYW4gYWN0dWFsIEFQSSBlbmRwb2ludFxuICogICAgdXBsb2FkUmVtb3ZlVXJsID0gJ3JlbW92ZVVybCc7IC8vIHNob3VsZCByZXByZXNlbnQgYW4gYWN0dWFsIEFQSSBlbmRwb2ludFxuICpcbiAqICAgIHJlc3VtZUV2ZW50SGFuZGxlcihldjogUmVzdW1lRXZlbnQpIHtcbiAqICAgICAgY29uc29sZS5sb2coJ0ZpbGUgcmVzdW1lZCcpO1xuICogICAgfVxuICogIH1cbiAqIGBgYFxuICpcbiAqL1xuY2xhc3MgUmVzdW1lRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgdGhlIGV2ZW50IGFyZ3VtZW50cyBmb3IgdGhlIGByZXN1bWVgIGV2ZW50LlxuICAgICAqIEBwYXJhbSBmaWxlIC0gVGhlIGZpbGUgdGhhdCBpcyBnb2luZyB0byBiZSByZXN1bWVkLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGZpbGUpIHtcbiAgICAgICAgdGhpcy5maWxlID0gZmlsZTtcbiAgICB9XG59XG5cbi8qKlxuICogQXJndW1lbnRzIGZvciB0aGUgYHNlbGVjdGAgZXZlbnQuIFRoZSBgc2VsZWN0YCBldmVudCBmaXJlcyB3aGVuIHRoZSB1c2VyXG4gKiBzZWxlY3RzIGEgZmlsZSBvciBtdWx0aXBsZSBmaWxlcyBmb3IgdXBsb2FkLiBJZiB5b3UgY2FuY2VsIHRoZSBldmVudCwgdGhlIHNlbGVjdGlvbiBpcyBwcmV2ZW50ZWQuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPGtlbmRvLXVwbG9hZFxuICogICAgICBbc2F2ZVVybF09XCJ1cGxvYWRTYXZlVXJsXCJcbiAqICAgICAgW3JlbW92ZVVybF09XCJ1cGxvYWRSZW1vdmVVcmxcIlxuICogICAgICAoc2VsZWN0KT1cInNlbGVjdEV2ZW50SGFuZGxlcigkZXZlbnQpXCI+XG4gKiAgICA8L2tlbmRvLXVwbG9hZD5cbiAqICAgIGBcbiAqICB9KVxuICogIGV4cG9ydCBjbGFzcyBVcGxvYWRDb21wb25lbnQge1xuICogICAgdXBsb2FkU2F2ZVVybCA9ICdzYXZlVXJsJzsgLy8gc2hvdWxkIHJlcHJlc2VudCBhbiBhY3R1YWwgQVBJIGVuZHBvaW50XG4gKiAgICB1cGxvYWRSZW1vdmVVcmwgPSAncmVtb3ZlVXJsJzsgLy8gc2hvdWxkIHJlcHJlc2VudCBhbiBhY3R1YWwgQVBJIGVuZHBvaW50XG4gKlxuICogICAgc2VsZWN0RXZlbnRIYW5kbGVyKGU6IFNlbGVjdEV2ZW50KSB7XG4gKiAgICAgIGNvbnNvbGUubG9nKCdGaWxlIHNlbGVjdGVkJyk7XG4gKiAgICB9XG4gKiAgfVxuICogYGBgXG4gKi9cbmNsYXNzIFNlbGVjdEV2ZW50IGV4dGVuZHMgUHJldmVudGFibGVFdmVudCB7XG4gICAgLyoqXG4gICAgICogQ29uc3RydWN0cyB0aGUgZXZlbnQgYXJndW1lbnRzIGZvciB0aGUgYHNlbGVjdGAgZXZlbnQuXG4gICAgICogQHBhcmFtIGZpbGVzIC0gVGhlIGxpc3Qgb2YgdGhlIHNlbGVjdGVkIGZpbGVzLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGZpbGVzKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuZmlsZXMgPSBmaWxlcztcbiAgICB9XG59XG5cbi8qKlxuICogQXJndW1lbnRzIGZvciB0aGUgYHN1Y2Nlc3NgIGV2ZW50LiBUaGUgYHN1Y2Nlc3NgIGV2ZW50IGZpcmVzIHdoZW5cbiAqIHRoZSBzZWxlY3RlZCBmaWxlcyBhcmUgc3VjY2Vzc2Z1bGx5IHVwbG9hZGVkIG9yIHJlbW92ZWQuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPGtlbmRvLXVwbG9hZFxuICogICAgICBbc2F2ZVVybF09XCJ1cGxvYWRTYXZlVXJsXCJcbiAqICAgICAgW3JlbW92ZVVybF09XCJ1cGxvYWRSZW1vdmVVcmxcIlxuICogICAgICAoc3VjY2Vzcyk9XCJzdWNjZXNzRXZlbnRIYW5kbGVyKCRldmVudClcIj5cbiAqICAgIDwva2VuZG8tdXBsb2FkPlxuICogICAgYFxuICogIH0pXG4gKiAgZXhwb3J0IGNsYXNzIFVwbG9hZENvbXBvbmVudCB7XG4gKiAgICB1cGxvYWRTYXZlVXJsID0gJ3NhdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqICAgIHVwbG9hZFJlbW92ZVVybCA9ICdyZW1vdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqXG4gKiAgICBzdWNjZXNzRXZlbnRIYW5kbGVyKGU6IFN1Y2Nlc3NFdmVudCkge1xuICogICAgICBjb25zb2xlLmxvZygnVGhlICcgKyBlLm9wZXJhdGlvbiArICcgd2FzIHN1Y2Nlc3NmdWwhJyk7XG4gKiAgICB9XG4gKiAgfVxuICogYGBgXG4gKi9cbmNsYXNzIFN1Y2Nlc3NFdmVudCBleHRlbmRzIFByZXZlbnRhYmxlRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgdGhlIGV2ZW50IGFyZ3VtZW50cyBmb3IgdGhlIGBzdWNjZXNzYCBldmVudC5cbiAgICAgKiBAcGFyYW0gZmlsZXMgLSBUaGUgbGlzdCBvZiB0aGUgZmlsZXMgdGhhdCB3ZXJlIHVwbG9hZGVkIG9yIHJlbW92ZWQuXG4gICAgICogQHBhcmFtIG9wZXJhdGlvbiAtIFRoZSBvcGVyYXRpb24gdHlwZSAoYHVwbG9hZGAgb3IgYHJlbW92ZWApLlxuICAgICAqIEBwYXJhbSByZXNwb25zZSAtIFRoZSByZXNwb25zZSBvYmplY3QgcmV0dXJuZWQgYnkgdGhlIHNlcnZlci5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihmaWxlcywgb3BlcmF0aW9uLCByZXNwb25zZSkge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgICAgIHRoaXMub3BlcmF0aW9uID0gb3BlcmF0aW9uO1xuICAgICAgICB0aGlzLnJlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgfVxufVxuXG4vKipcbiAqIEFyZ3VtZW50cyBmb3IgdGhlIGB1cGxvYWRgIGV2ZW50LiBUaGUgYHVwbG9hZGAgZXZlbnQgZmlyZXMgd2hlbiBvbmUgb3IgbW9yZSBmaWxlcyBhcmUgYWJvdXRcbiAqIHRvIGJlIHVwbG9hZGVkLiBJZiB5b3UgY2FuY2VsIHRoZSBldmVudCwgdGhlIHVwbG9hZCBpcyBwcmV2ZW50ZWQuIFlvdSBjYW4gYWRkIGhlYWRlcnMgdG8gdGhlIHJlcXVlc3QuXG4gKlxuICogYGBgdHMtbm8tcnVuXG4gKiAgQENvbXBvbmVudCh7XG4gKiAgICBzZWxlY3RvcjogJ215LXVwbG9hZCcsXG4gKiAgICB0ZW1wbGF0ZTogYFxuICogICAgPGtlbmRvLXVwbG9hZFxuICogICAgICBbc2F2ZVVybF09XCJ1cGxvYWRTYXZlVXJsXCJcbiAqICAgICAgW3JlbW92ZVVybF09XCJ1cGxvYWRSZW1vdmVVcmxcIlxuICogICAgICAodXBsb2FkKT1cInVwbG9hZEV2ZW50SGFuZGxlcigkZXZlbnQpXCI+XG4gKiAgICA8L2tlbmRvLXVwbG9hZD5cbiAqICAgIGBcbiAqICB9KVxuICogIGV4cG9ydCBjbGFzcyBVcGxvYWRDb21wb25lbnQge1xuICogICAgdXBsb2FkU2F2ZVVybCA9ICdzYXZlVXJsJzsgLy8gc2hvdWxkIHJlcHJlc2VudCBhbiBhY3R1YWwgQVBJIGVuZHBvaW50XG4gKiAgICB1cGxvYWRSZW1vdmVVcmwgPSAncmVtb3ZlVXJsJzsgLy8gc2hvdWxkIHJlcHJlc2VudCBhbiBhY3R1YWwgQVBJIGVuZHBvaW50XG4gKlxuICogICAgdXBsb2FkRXZlbnRIYW5kbGVyKGU6IFVwbG9hZEV2ZW50KSB7XG4gKiAgICAgIGUuaGVhZGVycyA9IGUuaGVhZGVycy5hcHBlbmQoJ1gtRm9vJywgJ0JhcicpO1xuICogICAgfVxuICogIH1cbiAqIGBgYFxuICovXG5jbGFzcyBVcGxvYWRFdmVudCBleHRlbmRzIFByZXZlbnRhYmxlRXZlbnQge1xuICAgIC8qKlxuICAgICAqIENvbnN0cnVjdHMgdGhlIGV2ZW50IGFyZ3VtZW50cyBmb3IgdGhlIGB1cGxvYWRgIGV2ZW50LlxuICAgICAqIEBwYXJhbSBmaWxlcyAtIFRoZSBsaXN0IG9mIHRoZSBmaWxlcyB0aGF0IHdpbGwgYmUgdXBsb2FkZWQuXG4gICAgICogQHBhcmFtIGhlYWRlcnMgLSBUaGUgaGVhZGVycyBvZiB0aGUgcmVxdWVzdC5cbiAgICAgKi9cbiAgICBjb25zdHJ1Y3RvcihmaWxlcywgaGVhZGVycykge1xuICAgICAgICBzdXBlcigpO1xuICAgICAgICB0aGlzLmZpbGVzID0gZmlsZXM7XG4gICAgICAgIHRoaXMuaGVhZGVycyA9IGhlYWRlcnM7XG4gICAgfVxufVxuXG4vKipcbiAqIEFyZ3VtZW50cyBmb3IgdGhlIGB1cGxvYWRwcm9ncmVzc2AgZXZlbnQuIFRoZSBgdXBsb2FkcHJvZ3Jlc3NgIGV2ZW50XG4gKiBmaXJlcyB3aGVuIHRoZSBmaWxlcyBhcmUgaW4gdGhlIHByb2Nlc3Mgb2YgdXBsb2FkaW5nLlxuICpcbiAqIGBgYHRzLW5vLXJ1blxuICogIEBDb21wb25lbnQoe1xuICogICAgc2VsZWN0b3I6ICdteS11cGxvYWQnLFxuICogICAgdGVtcGxhdGU6IGBcbiAqICAgIDxrZW5kby11cGxvYWRcbiAqICAgICAgW3NhdmVVcmxdPVwidXBsb2FkU2F2ZVVybFwiXG4gKiAgICAgIFtyZW1vdmVVcmxdPVwidXBsb2FkUmVtb3ZlVXJsXCJcbiAqICAgICAgKHVwbG9hZFByb2dyZXNzKT1cInVwbG9hZFByb2dyZXNzRXZlbnRIYW5kbGVyKCRldmVudClcIj5cbiAqICAgIDwva2VuZG8tdXBsb2FkPlxuICogICAgYFxuICogIH0pXG4gKiAgZXhwb3J0IGNsYXNzIFVwbG9hZENvbXBvbmVudCB7XG4gKiAgICB1cGxvYWRTYXZlVXJsID0gJ3NhdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqICAgIHVwbG9hZFJlbW92ZVVybCA9ICdyZW1vdmVVcmwnOyAvLyBzaG91bGQgcmVwcmVzZW50IGFuIGFjdHVhbCBBUEkgZW5kcG9pbnRcbiAqXG4gKiAgICB1cGxvYWRQcm9ncmVzc0V2ZW50SGFuZGxlcihlOiBVcGxvYWRQcm9ncmVzc0V2ZW50KSB7XG4gKiAgICAgIGNvbnNvbGUubG9nKGUuZmlsZXNbMF0ubmFtZSArICcgaXMgJyArIGUucGVyY2VudENvbXBsZXRlICsgJyB1cGxvYWRlZCcpO1xuICogICAgfVxuICogIH1cbiAqIGBgYFxuICovXG5jbGFzcyBVcGxvYWRQcm9ncmVzc0V2ZW50IHtcbiAgICAvKipcbiAgICAgKiBDb25zdHJ1Y3RzIHRoZSBldmVudCBhcmd1bWVudHMgZm9yIHRoZSBgdXBsb2FkcHJvZ3Jlc3NgIGV2ZW50LlxuICAgICAqIEBwYXJhbSBmaWxlcyAtIFRoZSBsaXN0IG9mIGZpbGVzIHRoYXQgYXJlIGJlaW5nIHVwbG9hZGVkLlxuICAgICAqIEBwYXJhbSBwZXJjZW50Q29tcGxldGUgLSBUaGUgcG9ydGlvbiB0aGF0IGhhcyBiZWVuIHVwbG9hZGVkLlxuICAgICAqL1xuICAgIGNvbnN0cnVjdG9yKGZpbGVzLCBwZXJjZW50Q29tcGxldGUpIHtcbiAgICAgICAgdGhpcy5maWxlcyA9IGZpbGVzO1xuICAgICAgICB0aGlzLnBlcmNlbnRDb21wbGV0ZSA9IHBlcmNlbnRDb21wbGV0ZTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBmaWxlR3JvdXBNYXAgPSB7XG4gICAgYXVkaW86IFtcbiAgICAgICAgXCIuYWlmXCIsIFwiLmlmZlwiLCBcIi5tM3VcIiwgXCIubTRhXCIsIFwiLm1pZFwiLCBcIi5tcDNcIiwgXCIubXBhXCIsIFwiLndhdlwiLCBcIi53bWFcIiwgXCIub2dnXCIsIFwiLndhdlwiLCBcIi53bWFcIiwgXCIud3BsXCJcbiAgICBdLFxuICAgIHZpZGVvOiBbXG4gICAgICAgIFwiLjNnMlwiLCBcIi4zZ3BcIiwgXCIuYXZpXCIsIFwiLmFzZlwiLCBcIi5mbHZcIiwgXCIubTR1XCIsIFwiLnJtXCIsIFwiLmgyNjRcIiwgXCIubTR2XCIsIFwiLm1rdlwiLCBcIi5tb3ZcIiwgXCIubXA0XCIsIFwiLm1wZ1wiLCBcIi5ybVwiLCBcIi5zd2ZcIiwgXCIudm9iXCIsIFwiLndtdlwiXG4gICAgXSxcbiAgICBpbWFnZTogW1xuICAgICAgICBcIi5haVwiLCBcIi5kZHNcIiwgXCIuaGVpY1wiLCBcIi5qcGVcIiwgXCJqZmlmXCIsIFwiLmppZlwiLCBcIi5qcDJcIiwgXCIuanBzXCIsIFwiLmVwc1wiLCBcIi5ibXBcIiwgXCIuZ2lmXCIsIFwiLmpwZWdcIiwgXCIuanBnXCIsIFwiLnBuZ1wiLCBcIi5wc1wiLCBcIi5wc2RcIiwgXCIuc3ZnXCIsIFwiLnN2Z3pcIiwgXCIudGlmXCIsIFwiLnRpZmZcIlxuICAgIF0sXG4gICAgdHh0OiBbXG4gICAgICAgIFwiLmRvY1wiLCBcIi5kb2N4XCIsIFwiLmxvZ1wiLCBcIi5wYWdlc1wiLCBcIi50ZXhcIiwgXCIud3BkXCIsIFwiLndwc1wiLCBcIi5vZHRcIiwgXCIucnRmXCIsIFwiLnRleHRcIiwgXCIudHh0XCIsIFwiLndrc1wiXG4gICAgXSxcbiAgICBwcmVzZW50YXRpb246IFtcbiAgICAgICAgXCIua2V5XCIsIFwiLm9kcFwiLCBcIi5wcHNcIiwgXCIucHB0XCIsIFwiLnBwdHhcIlxuICAgIF0sXG4gICAgZGF0YTogW1xuICAgICAgICBcIi54bHJcIiwgXCIueGxzXCIsIFwiLnhsc3hcIlxuICAgIF0sXG4gICAgcHJvZ3JhbW1pbmc6IFtcbiAgICAgICAgXCIudG1wXCIsIFwiLmJha1wiLCBcIi5tc2lcIiwgXCIuY2FiXCIsIFwiLmNwbFwiLCBcIi5jdXJcIiwgXCIuZGxsXCIsIFwiLmRtcFwiLCBcIi5kcnZcIiwgXCIuaWNuc1wiLCBcIi5pY29cIiwgXCIubGlua1wiLCBcIi5zeXNcIiwgXCIuY2ZnXCIsXG4gICAgICAgIFwiLmluaVwiLCBcIi5hc3BcIiwgXCIuYXNweFwiLCBcIi5jZXJcIiwgXCIuY3NyXCIsIFwiLmNzc1wiLCBcIi5kY3JcIiwgXCIuaHRtXCIsIFwiLmh0bWxcIiwgXCIuanNcIiwgXCIucGhwXCIsIFwiLnJzc1wiLCBcIi54aHRtbFwiXG4gICAgXSxcbiAgICBwZGY6IFtcbiAgICAgICAgXCIucGRmXCJcbiAgICBdLFxuICAgIGNvbmZpZzogW1xuICAgICAgICBcIi5hcGtcIiwgXCIuYXBwXCIsIFwiLmJhdFwiLCBcIi5jZ2lcIiwgXCIuY29tXCIsIFwiLmV4ZVwiLCBcIi5nYWRnZXRcIiwgXCIuamFyXCIsIFwiLndzZlwiXG4gICAgXSxcbiAgICB6aXA6IFtcbiAgICAgICAgXCIuN3pcIiwgXCIuY2JyXCIsIFwiLmd6XCIsIFwiLnNpdHhcIiwgXCIuYXJqXCIsIFwiLmRlYlwiLCBcIi5wa2dcIiwgXCIucmFyXCIsIFwiLnJwbVwiLCBcIi50YXIuZ3pcIiwgXCIuelwiLCBcIi56aXBcIiwgXCIuemlweFwiXG4gICAgXSxcbiAgICBkaXNjSW1hZ2U6IFtcbiAgICAgICAgXCIuZG1nXCIsIFwiLmlzb1wiLCBcIi50b2FzdFwiLCBcIi52Y2RcIiwgXCIuYmluXCIsIFwiLmN1ZVwiLCBcIi5tZGZcIlxuICAgIF1cbn07XG5cbi8qIHRzbGludDpkaXNhYmxlOiBuby1iaXR3aXNlICovXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgZ2V0VG90YWxGaWxlc1NpemVNZXNzYWdlID0gKGZpbGVzKSA9PiB7XG4gICAgbGV0IHRvdGFsU2l6ZSA9IDA7XG4gICAgbGV0IGk7XG4gICAgaWYgKHR5cGVvZiBmaWxlc1swXS5zaXplID09PSBcIm51bWJlclwiKSB7XG4gICAgICAgIGZvciAoaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgaWYgKGZpbGVzW2ldLnNpemUpIHtcbiAgICAgICAgICAgICAgICB0b3RhbFNpemUgKz0gZmlsZXNbaV0uc2l6ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgcmV0dXJuIFwiXCI7XG4gICAgfVxuICAgIHRvdGFsU2l6ZSAvPSAxMDI0O1xuICAgIGlmICh0b3RhbFNpemUgPCAxMDI0KSB7XG4gICAgICAgIHJldHVybiB0b3RhbFNpemUudG9GaXhlZCgyKSArIFwiIEtCXCI7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICByZXR1cm4gKHRvdGFsU2l6ZSAvIDEwMjQpLnRvRml4ZWQoMikgKyBcIiBNQlwiO1xuICAgIH1cbn07XG5jb25zdCBzdHJpcFBhdGggPSAobmFtZSkgPT4ge1xuICAgIGxldCBzbGFzaEluZGV4ID0gbmFtZS5sYXN0SW5kZXhPZihcIlxcXFxcIik7XG4gICAgcmV0dXJuIChzbGFzaEluZGV4ICE9PSAtMSkgPyBuYW1lLnN1YnN0cihzbGFzaEluZGV4ICsgMSkgOiBuYW1lO1xufTtcbmNvbnN0IGdldEZpbGVFeHRlbnNpb24gPSAoZmlsZU5hbWUpID0+IHtcbiAgICBjb25zdCByRmlsZUV4dGVuc2lvbiA9IC9cXC4oW15cXC5dKykkLztcbiAgICBjb25zdCBtYXRjaGVzID0gZmlsZU5hbWUubWF0Y2gockZpbGVFeHRlbnNpb24pO1xuICAgIHJldHVybiBtYXRjaGVzID8gbWF0Y2hlc1swXSA6IFwiXCI7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IHZhbGlkYXRlSW5pdGlhbEZpbGVJbmZvID0gKGZpbGUpID0+IHtcbiAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIE9iamVjdCAmJiBmaWxlLmhhc093blByb3BlcnR5KFwibmFtZVwiKSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCB2YWxpZGF0ZUluaXRpYWxGaWxlU2VsZWN0RmlsZSA9IChmaWxlKSA9PiB7XG4gICAgaWYgKGZpbGUgaW5zdGFuY2VvZiBGaWxlIHx8IHZhbGlkYXRlSW5pdGlhbEZpbGVJbmZvKGZpbGUpKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGdldEluaXRpYWxGaWxlSW5mbyA9IChmYWtlRmlsZSkgPT4ge1xuICAgIGZha2VGaWxlLmV4dGVuc2lvbiA9IGZha2VGaWxlLmV4dGVuc2lvbiB8fCBnZXRGaWxlRXh0ZW5zaW9uKGZha2VGaWxlLm5hbWUpO1xuICAgIGZha2VGaWxlLm5hbWUgPSBmYWtlRmlsZS5uYW1lO1xuICAgIGZha2VGaWxlLnNpemUgPSBmYWtlRmlsZS5zaXplIHx8IDA7XG4gICAgaWYgKCFmYWtlRmlsZS5oYXNPd25Qcm9wZXJ0eShcInN0YXRlXCIpKSB7XG4gICAgICAgIGZha2VGaWxlLnN0YXRlID0gRmlsZVN0YXRlLkluaXRpYWw7XG4gICAgfVxuICAgIGlmICghZmFrZUZpbGUuaGFzT3duUHJvcGVydHkoXCJ1aWRcIikpIHtcbiAgICAgICAgZmFrZUZpbGUudWlkID0gZ3VpZCgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFrZUZpbGU7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGNvbnZlcnRGaWxlVG9GaWxlSW5mbyA9IChmaWxlKSA9PiB7XG4gICAgbGV0IGZpbGVJbmZvID0gZ2V0RmlsZUluZm8oZmlsZSk7XG4gICAgZmlsZUluZm8udWlkID0gZ3VpZCgpO1xuICAgIC8vIFVzZWQgdG8gZGlmZmVyZW50aWF0ZSBpbml0aWFsIEZpbGVJbmZvIG9iamVjdHMgYW5kIGFjdHVhbCBGaWxlc1xuICAgIGZpbGVJbmZvLnN0YXRlID0gRmlsZVN0YXRlLlNlbGVjdGVkO1xuICAgIHJldHVybiBmaWxlSW5mbztcbn07XG5jb25zdCBnZXRGaWxlSW5mbyA9IChyYXdGaWxlKSA9PiB7XG4gICAgY29uc3QgZmlsZU5hbWUgPSByYXdGaWxlLm5hbWU7XG4gICAgY29uc3QgZmlsZVNpemUgPSByYXdGaWxlLnNpemU7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgZXh0ZW5zaW9uOiBnZXRGaWxlRXh0ZW5zaW9uKGZpbGVOYW1lKSxcbiAgICAgICAgbmFtZTogZmlsZU5hbWUsXG4gICAgICAgIHJhd0ZpbGU6IHJhd0ZpbGUsXG4gICAgICAgIHNpemU6IGZpbGVTaXplLFxuICAgICAgICBzdGF0ZTogRmlsZVN0YXRlLlNlbGVjdGVkXG4gICAgfTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgZ2V0QWxsRmlsZUluZm8gPSAocmF3RmlsZXMpID0+IHtcbiAgICBsZXQgYWxsRmlsZUluZm8gPSBuZXcgQXJyYXkoKTtcbiAgICBsZXQgaTtcbiAgICBmb3IgKGkgPSAwOyBpIDwgcmF3RmlsZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgYWxsRmlsZUluZm8ucHVzaChnZXRGaWxlSW5mbyhyYXdGaWxlc1tpXSkpO1xuICAgIH1cbiAgICByZXR1cm4gYWxsRmlsZUluZm87XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGZpbGVIYXNWYWxpZGF0aW9uRXJyb3JzID0gKGZpbGUpID0+IHtcbiAgICBpZiAoZmlsZS52YWxpZGF0aW9uRXJyb3JzICYmIGZpbGUudmFsaWRhdGlvbkVycm9ycy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGZpbGVzSGF2ZVZhbGlkYXRpb25FcnJvcnMgPSAoZmlsZXMpID0+IHtcbiAgICBmb3IgKGxldCBmaWxlIG9mIGZpbGVzKSB7XG4gICAgICAgIGlmIChmaWxlSGFzVmFsaWRhdGlvbkVycm9ycyhmaWxlKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xufTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpbnB1dEZpbGVzID0gKGlucHV0KSA9PiB7XG4gICAgaWYgKGlucHV0LmZpbGVzKSB7XG4gICAgICAgIHJldHVybiBnZXRBbGxGaWxlSW5mbyhpbnB1dC5maWxlcyk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICAvL1JlcXVpcmVkIGZvciB0ZXN0aW5nXG4gICAgICAgIGxldCBmaWxlTmFtZXMgPSBpbnB1dC52YWx1ZS5zcGxpdChcInxcIikubWFwKChmaWxlLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgbGV0IGZpbGVOYW1lID0gZmlsZS50cmltKCk7XG4gICAgICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgICAgIGV4dGVuc2lvbjogZ2V0RmlsZUV4dGVuc2lvbihmaWxlTmFtZSksXG4gICAgICAgICAgICAgICAgbmFtZTogc3RyaXBQYXRoKGZpbGVOYW1lKSxcbiAgICAgICAgICAgICAgICByYXdGaWxlOiBudWxsLFxuICAgICAgICAgICAgICAgIHNpemU6IChpbmRleCArIDEpICogMTAwMCxcbiAgICAgICAgICAgICAgICBzdGF0ZTogRmlsZVN0YXRlLlNlbGVjdGVkXG4gICAgICAgICAgICB9O1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIGZpbGVOYW1lcztcbiAgICB9XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGFzc2lnbkd1aWRUb0ZpbGVzID0gKGZpbGVzLCBpc1VuaXF1ZSkgPT4ge1xuICAgIGNvbnN0IHVpZCA9IGd1aWQoKTtcbiAgICByZXR1cm4gZmlsZXMubWFwKChmaWxlKSA9PiB7XG4gICAgICAgIGZpbGUudWlkID0gaXNVbmlxdWUgPyBndWlkKCkgOiB1aWQ7XG4gICAgICAgIHJldHVybiBmaWxlO1xuICAgIH0pO1xufTtcbmNvbnN0IGZvY3VzYWJsZVJlZ2V4ID0gL14oPzphfGlucHV0fHNlbGVjdHx0ZXh0YXJlYXxidXR0b258b2JqZWN0KSQvaTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBJR05PUkVfVEFSR0VUX0NMQVNTRVMgPSAnay1pY29uIGstc2VsZWN0IGstaW5wdXQgay1tdWx0aXNlbGVjdC13cmFwJztcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBVUExPQURfQ0xBU1NFUyA9ICdrLXVwbG9hZC1idXR0b24gay1jbGVhci1zZWxlY3RlZCBrLXVwbG9hZC1zZWxlY3RlZCBrLXVwbG9hZC1hY3Rpb24nO1xuY29uc3QgaXNWaXNpYmxlID0gKGVsZW1lbnQpID0+IHtcbiAgICBjb25zdCByZWN0ID0gZWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4gISEocmVjdC53aWR0aCAmJiByZWN0LmhlaWdodCkgJiYgd2luZG93LmdldENvbXB1dGVkU3R5bGUoZWxlbWVudCkudmlzaWJpbGl0eSAhPT0gJ2hpZGRlbic7XG59O1xuY29uc3QgdG9DbGFzc0xpc3QgPSAoY2xhc3NOYW1lcykgPT4gU3RyaW5nKGNsYXNzTmFtZXMpLnRyaW0oKS5zcGxpdCgnICcpO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGhhc0NsYXNzZXMgPSAoZWxlbWVudCwgY2xhc3NOYW1lcykgPT4ge1xuICAgIGNvbnN0IG5hbWVzTGlzdCA9IHRvQ2xhc3NMaXN0KGNsYXNzTmFtZXMpO1xuICAgIHJldHVybiBCb29sZWFuKHRvQ2xhc3NMaXN0KGVsZW1lbnQuY2xhc3NOYW1lKS5maW5kKChjbGFzc05hbWUpID0+IG5hbWVzTGlzdC5pbmRleE9mKGNsYXNzTmFtZSkgPj0gMCkpO1xufTtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBpc0ZvY3VzYWJsZSA9IChlbGVtZW50LCBjaGVja1Zpc2liaWxpdHkgPSB0cnVlKSA9PiB7XG4gICAgaWYgKGVsZW1lbnQudGFnTmFtZSkge1xuICAgICAgICBjb25zdCB0YWdOYW1lID0gZWxlbWVudC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XG4gICAgICAgIGNvbnN0IHRhYkluZGV4ID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoJ3RhYkluZGV4Jyk7XG4gICAgICAgIGNvbnN0IHZhbGlkVGFiSW5kZXggPSB0YWJJbmRleCAhPT0gbnVsbCAmJiAhaXNOYU4odGFiSW5kZXgpICYmIHRhYkluZGV4ID4gLTE7XG4gICAgICAgIGxldCBmb2N1c2FibGUgPSBmYWxzZTtcbiAgICAgICAgaWYgKGZvY3VzYWJsZVJlZ2V4LnRlc3QodGFnTmFtZSkpIHtcbiAgICAgICAgICAgIGZvY3VzYWJsZSA9ICFlbGVtZW50LmRpc2FibGVkO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZm9jdXNhYmxlID0gdmFsaWRUYWJJbmRleDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZm9jdXNhYmxlICYmICghY2hlY2tWaXNpYmlsaXR5IHx8IGlzVmlzaWJsZShlbGVtZW50KSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbn07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgZ2V0RmlsZUdyb3VwQ3NzQ2xhc3MgPSAoZmlsZUV4dGVuc2lvbikgPT4ge1xuICAgIGNvbnN0IGluaXRpYWwgPSAnay1pLWZpbGUnO1xuICAgIGZvciAobGV0IGdyb3VwIGluIGZpbGVHcm91cE1hcCkge1xuICAgICAgICBpZiAoZmlsZUdyb3VwTWFwW2dyb3VwXS5pbmRleE9mKGZpbGVFeHRlbnNpb24pID49IDApIHtcbiAgICAgICAgICAgIHJldHVybiBgJHtpbml0aWFsfS0ke2dyb3VwfWA7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGluaXRpYWw7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IGlzUHJlc2VudCA9ICh2YWx1ZSkgPT4gdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZDtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIENodW5rTWFwIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5fZmlsZXMgPSB7fTtcbiAgICB9XG4gICAgYWRkKHVpZCwgdG90YWxDaHVua3MpIHtcbiAgICAgICAgY29uc3QgaW5pdGlhbENodW5rSW5mbyA9IHtcbiAgICAgICAgICAgIGluZGV4OiAwLFxuICAgICAgICAgICAgcG9zaXRpb246IDAsXG4gICAgICAgICAgICByZXRyaWVzOiAwLFxuICAgICAgICAgICAgdG90YWxDaHVua3M6IHRvdGFsQ2h1bmtzXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuX2ZpbGVzW3VpZF0gPSBpbml0aWFsQ2h1bmtJbmZvO1xuICAgICAgICByZXR1cm4gaW5pdGlhbENodW5rSW5mbztcbiAgICB9XG4gICAgcmVtb3ZlKHVpZCkge1xuICAgICAgICBpZiAodGhpcy5oYXModWlkKSkge1xuICAgICAgICAgICAgdGhpcy5fZmlsZXNbdWlkXSA9IG51bGw7XG4gICAgICAgICAgICBkZWxldGUgdGhpcy5fZmlsZXNbdWlkXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYXModWlkKSB7XG4gICAgICAgIHJldHVybiB1aWQgaW4gdGhpcy5fZmlsZXM7XG4gICAgfVxuICAgIGdldCh1aWQpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX2ZpbGVzW3VpZF07XG4gICAgfVxufVxuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgVXBsb2FkU2VydmljZSB7XG4gICAgY29uc3RydWN0b3IoaHR0cCkge1xuICAgICAgICB0aGlzLmh0dHAgPSBodHRwO1xuICAgICAgICB0aGlzLmNhbmNlbEV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmNsZWFyRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuY29tcGxldGVFdmVudCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5lcnJvckV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnBhdXNlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMucmVzdW1lRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuc2VsZWN0RXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIHRoaXMuc3VjY2Vzc0V2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnVwbG9hZEV2ZW50ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLnVwbG9hZFByb2dyZXNzRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBSZXF1aXJlZCBmb3IgdGhlIGBDb250cm9sVmFsdWVBY2Nlc3NvcmAgaW50ZWdyYXRpb25cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2hhbmdlRXZlbnQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEZWZhdWx0IGFzeW5jIHNldHRpbmdzXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmFzeW5jID0ge1xuICAgICAgICAgICAgYXV0b1VwbG9hZDogdHJ1ZSxcbiAgICAgICAgICAgIGJhdGNoOiBmYWxzZSxcbiAgICAgICAgICAgIGNodW5rOiBmYWxzZSxcbiAgICAgICAgICAgIGNvbmN1cnJlbnQ6IHRydWUsXG4gICAgICAgICAgICByZW1vdmVGaWVsZDogXCJmaWxlTmFtZXNcIixcbiAgICAgICAgICAgIHJlbW92ZUhlYWRlcnM6IG5ldyBIdHRwSGVhZGVycygpLFxuICAgICAgICAgICAgcmVtb3ZlTWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICAgIHJlbW92ZVVybDogXCJcIixcbiAgICAgICAgICAgIHJlc3BvbnNlVHlwZTogXCJqc29uXCIsXG4gICAgICAgICAgICBzYXZlRmllbGQ6IFwiZmlsZXNcIixcbiAgICAgICAgICAgIHNhdmVIZWFkZXJzOiBuZXcgSHR0cEhlYWRlcnMoKSxcbiAgICAgICAgICAgIHNhdmVNZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgICAgc2F2ZVVybDogXCJcIixcbiAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdHJ1ZVxuICAgICAgICB9O1xuICAgICAgICAvKipcbiAgICAgICAgICogRGVmYXVsdCBjaHVuayBzZXR0aW5nc1xuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jaHVuayA9IHtcbiAgICAgICAgICAgIGF1dG9SZXRyeUFmdGVyOiAxMDAsXG4gICAgICAgICAgICBzaXplOiAxMDI0ICogMTAyNCxcbiAgICAgICAgICAgIG1heEF1dG9SZXRyaWVzOiAxLFxuICAgICAgICAgICAgcmVzdW1hYmxlOiB0cnVlXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMuY29tcG9uZW50ID0gJ1VwbG9hZCc7XG4gICAgICAgIHRoaXMuY2h1bmtNYXAgPSBuZXcgQ2h1bmtNYXAoKTtcbiAgICAgICAgdGhpcy5maWxlTGlzdCA9IG5ldyBGaWxlTWFwKCk7XG4gICAgfVxuICAgIGdldCBmaWxlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsZUxpc3Q7XG4gICAgfVxuICAgIHNldENodW5rU2V0dGluZ3Moc2V0dGluZ3MpIHtcbiAgICAgICAgaWYgKHNldHRpbmdzICE9PSBmYWxzZSkge1xuICAgICAgICAgICAgdGhpcy5hc3luYy5jaHVuayA9IHRydWU7XG4gICAgICAgICAgICBpZiAodHlwZW9mIHNldHRpbmdzID09PSBcIm9iamVjdFwiKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5jaHVuayA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuY2h1bmssIHNldHRpbmdzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkNoYW5nZSgpIHtcbiAgICAgICAgbGV0IGZpbGVzID0gdGhpcy5maWxlTGlzdC5maWxlc0ZsYXQuZmlsdGVyKChmaWxlKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLkluaXRpYWwgfHxcbiAgICAgICAgICAgICAgICBmaWxlLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkZWQ7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLmNoYW5nZUV2ZW50LmVtaXQoZmlsZXMubGVuZ3RoID4gMCA/IGZpbGVzIDogbnVsbCk7XG4gICAgfVxuICAgIGFkZEZpbGVzKGZpbGVzKSB7XG4gICAgICAgIGxldCBzZWxlY3RFdmVudEFyZ3MgPSBuZXcgU2VsZWN0RXZlbnQoZmlsZXMpO1xuICAgICAgICB0aGlzLnNlbGVjdEV2ZW50LmVtaXQoc2VsZWN0RXZlbnRBcmdzKTtcbiAgICAgICAgaWYgKCFzZWxlY3RFdmVudEFyZ3MuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0LmFkZChmaWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh0aGlzLmFzeW5jLmF1dG9VcGxvYWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGVzKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50ID09PSAnRmlsZVNlbGVjdCcpIHtcbiAgICAgICAgICAgIGNvbnN0IGZsYXRGaWxlcyA9IHRoaXMuZmlsZUxpc3QuZmlsZXNGbGF0O1xuICAgICAgICAgICAgdGhpcy5jaGFuZ2VFdmVudC5lbWl0KGZsYXRGaWxlcy5sZW5ndGggPiAwID8gZmxhdEZpbGVzIDogbnVsbCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgYWRkSW5pdGlhbEZpbGVzKGluaXRpYWxGaWxlcykge1xuICAgICAgICB0aGlzLmZpbGVMaXN0LmNsZWFyKCk7XG4gICAgICAgIGluaXRpYWxGaWxlcy5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgICAgICBsZXQgZmFrZUZpbGUgPSBnZXRJbml0aWFsRmlsZUluZm8oZmlsZSk7XG4gICAgICAgICAgICB0aGlzLmZpbGVMaXN0LmFkZChmYWtlRmlsZSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBhZGRJbml0aWFsRmlsZVNlbGVjdEZpbGVzKGluaXRpYWxGaWxlcykge1xuICAgICAgICB0aGlzLmZpbGVMaXN0LmNsZWFyKCk7XG4gICAgICAgIGluaXRpYWxGaWxlcy5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgICAgICBpZiAoZmlsZSBpbnN0YW5jZW9mIEZpbGUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0LmFkZChjb252ZXJ0RmlsZVRvRmlsZUluZm8oZmlsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5hZGQoZ2V0SW5pdGlhbEZpbGVJbmZvKGZpbGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJlc3VtZUZpbGUodWlkKSB7XG4gICAgICAgIGNvbnN0IGZpbGVUb1Jlc3VtZSA9IHRoaXMuZmlsZUxpc3QuZ2V0KHVpZCk7XG4gICAgICAgIHRoaXMucmVzdW1lRXZlbnQuZW1pdChuZXcgUmVzdW1lRXZlbnQoZmlsZVRvUmVzdW1lWzBdKSk7XG4gICAgICAgIHRoaXMuZmlsZUxpc3Quc2V0RmlsZXNTdGF0ZUJ5VWlkKHVpZCwgRmlsZVN0YXRlLlVwbG9hZGluZyk7XG4gICAgICAgIHRoaXMuX3VwbG9hZEZpbGVzKFtmaWxlVG9SZXN1bWVdKTtcbiAgICB9XG4gICAgcGF1c2VGaWxlKHVpZCkge1xuICAgICAgICBsZXQgcGF1c2VkRmlsZSA9IHRoaXMuZmlsZUxpc3QuZ2V0KHVpZClbMF07XG4gICAgICAgIHRoaXMucGF1c2VFdmVudC5lbWl0KG5ldyBQYXVzZUV2ZW50KHBhdXNlZEZpbGUpKTtcbiAgICAgICAgdGhpcy5maWxlTGlzdC5zZXRGaWxlc1N0YXRlQnlVaWQodWlkLCBGaWxlU3RhdGUuUGF1c2VkKTtcbiAgICB9XG4gICAgcmVtb3ZlRmlsZXModWlkKSB7XG4gICAgICAgIGxldCByZW1vdmVkRmlsZXMgPSB0aGlzLmZpbGVMaXN0LmdldCh1aWQpO1xuICAgICAgICAvLyBDbG9uZSB0aGUgSGVhZGVycyBzbyB0aGF0IHRoZSBkZWZhdWx0IG9uZXMgYXJlIG5vdCBvdmVycmlkZGVuXG4gICAgICAgIGxldCByZW1vdmVFdmVudEFyZ3MgPSBuZXcgUmVtb3ZlRXZlbnQocmVtb3ZlZEZpbGVzLCB0aGlzLmNsb25lUmVxdWVzdEhlYWRlcnModGhpcy5hc3luYy5yZW1vdmVIZWFkZXJzKSk7XG4gICAgICAgIHRoaXMucmVtb3ZlRXZlbnQuZW1pdChyZW1vdmVFdmVudEFyZ3MpO1xuICAgICAgICBpZiAoIXJlbW92ZUV2ZW50QXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgICAgaWYgKHRoaXMuY29tcG9uZW50ID09PSAnVXBsb2FkJyAmJlxuICAgICAgICAgICAgICAgIChyZW1vdmVkRmlsZXNbMF0uc3RhdGUgPT09IEZpbGVTdGF0ZS5VcGxvYWRlZCB8fFxuICAgICAgICAgICAgICAgICAgICByZW1vdmVkRmlsZXNbMF0uc3RhdGUgPT09IEZpbGVTdGF0ZS5Jbml0aWFsKSkge1xuICAgICAgICAgICAgICAgIHRoaXMucGVyZm9ybVJlbW92ZShyZW1vdmVkRmlsZXMsIHJlbW92ZUV2ZW50QXJncyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZpbGVMaXN0LnJlbW92ZSh1aWQpO1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLmNvbXBvbmVudCA9PT0gJ0ZpbGVTZWxlY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZsYXRGaWxlcyA9IHRoaXMuZmlsZUxpc3QuZmlsZXNGbGF0O1xuICAgICAgICAgICAgICAgICAgICB0aGlzLmNoYW5nZUV2ZW50LmVtaXQoZmxhdEZpbGVzLmxlbmd0aCA+IDAgPyBmbGF0RmlsZXMgOiBudWxsKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgY2FuY2VsRmlsZXModWlkKSB7XG4gICAgICAgIGxldCBjYW5jZWxlZEZpbGVzID0gdGhpcy5maWxlTGlzdC5nZXQodWlkKTtcbiAgICAgICAgbGV0IGNhbmNlbEV2ZW50QXJncyA9IG5ldyBDYW5jZWxFdmVudChjYW5jZWxlZEZpbGVzKTtcbiAgICAgICAgdGhpcy5jYW5jZWxFdmVudC5lbWl0KGNhbmNlbEV2ZW50QXJncyk7XG4gICAgICAgIGZvciAobGV0IGZpbGUgb2YgY2FuY2VsZWRGaWxlcykge1xuICAgICAgICAgICAgaWYgKGZpbGUuaHR0cFN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgICAgIGZpbGUuaHR0cFN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZmlsZUxpc3QucmVtb3ZlKHVpZCk7XG4gICAgICAgIHRoaXMuY2hlY2tBbGxDb21wbGV0ZSgpO1xuICAgIH1cbiAgICBjbGVhckZpbGVzKCkge1xuICAgICAgICBsZXQgY2xlYXJFdmVudEFyZ3MgPSBuZXcgQ2xlYXJFdmVudCgpO1xuICAgICAgICB0aGlzLmNsZWFyRXZlbnQuZW1pdChjbGVhckV2ZW50QXJncyk7XG4gICAgICAgIGlmICghY2xlYXJFdmVudEFyZ3MuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICAgIGxldCB0cmlnZ2VyQ2hhbmdlID0gdGhpcy5maWxlTGlzdC5oYXNGaWxlV2l0aFN0YXRlKFtcbiAgICAgICAgICAgICAgICBGaWxlU3RhdGUuSW5pdGlhbCxcbiAgICAgICAgICAgICAgICBGaWxlU3RhdGUuVXBsb2FkZWRcbiAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5jbGVhcigpO1xuICAgICAgICAgICAgaWYgKHRyaWdnZXJDaGFuZ2UpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ2hhbmdlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBsb2FkRmlsZXMoKSB7XG4gICAgICAgIGxldCBmaWxlc1RvVXBsb2FkID0gW107XG4gICAgICAgIGlmICh0aGlzLmFzeW5jLmNvbmN1cnJlbnQpIHtcbiAgICAgICAgICAgIGZpbGVzVG9VcGxvYWQgPSB0aGlzLmZpbGVMaXN0LmZpbGVzVG9VcGxvYWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCF0aGlzLmFzeW5jLmNvbmN1cnJlbnQgJiYgIXRoaXMuZmlsZUxpc3QuaGFzRmlsZVdpdGhTdGF0ZShbRmlsZVN0YXRlLlVwbG9hZGluZ10pKSB7XG4gICAgICAgICAgICBmaWxlc1RvVXBsb2FkID0gW3RoaXMuZmlsZUxpc3QuZmlyc3RGaWxlVG9VcGxvYWRdO1xuICAgICAgICB9XG4gICAgICAgIGlmIChmaWxlc1RvVXBsb2FkICYmIGZpbGVzVG9VcGxvYWQubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgdGhpcy5fdXBsb2FkRmlsZXMoZmlsZXNUb1VwbG9hZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0cnlGaWxlcyh1aWQpIHtcbiAgICAgICAgbGV0IGZpbGVzVG9SZXRyeSA9IFt0aGlzLmZpbGVMaXN0LmdldCh1aWQpXTtcbiAgICAgICAgaWYgKGZpbGVzVG9SZXRyeSkge1xuICAgICAgICAgICAgdGhpcy5fdXBsb2FkRmlsZXMoZmlsZXNUb1JldHJ5KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBfdXBsb2FkRmlsZXMoYWxsRmlsZXMpIHtcbiAgICAgICAgZm9yIChsZXQgZmlsZXNUb1VwbG9hZCBvZiBhbGxGaWxlcykge1xuICAgICAgICAgICAgaWYgKGZpbGVzVG9VcGxvYWRbMF0uc3RhdGUgPT09IEZpbGVTdGF0ZS5QYXVzZWQpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBDbG9uZSB0aGUgSGVhZGVycyBzbyB0aGF0IHRoZSBkZWZhdWx0IG9uZXMgYXJlIG5vdCBvdmVycmlkZGVuXG4gICAgICAgICAgICBsZXQgdXBsb2FkRXZlbnRBcmdzID0gbmV3IFVwbG9hZEV2ZW50KGZpbGVzVG9VcGxvYWQsIHRoaXMuY2xvbmVSZXF1ZXN0SGVhZGVycyh0aGlzLmFzeW5jLnNhdmVIZWFkZXJzKSk7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZEV2ZW50LmVtaXQodXBsb2FkRXZlbnRBcmdzKTtcbiAgICAgICAgICAgIGlmICghdXBsb2FkRXZlbnRBcmdzLmlzRGVmYXVsdFByZXZlbnRlZCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5zZXRGaWxlc1N0YXRlKGZpbGVzVG9VcGxvYWQsIEZpbGVTdGF0ZS5VcGxvYWRpbmcpO1xuICAgICAgICAgICAgICAgIGxldCBodHRwU3ViY3JpcHRpb24gPSB0aGlzLnBlcmZvcm1VcGxvYWQoZmlsZXNUb1VwbG9hZCwgdXBsb2FkRXZlbnRBcmdzKTtcbiAgICAgICAgICAgICAgICBmaWxlc1RvVXBsb2FkLmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgZmlsZS5odHRwU3Vic2NyaXB0aW9uID0gaHR0cFN1YmNyaXB0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5yZW1vdmUoZmlsZXNUb1VwbG9hZFswXS51aWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIHBlcmZvcm1SZW1vdmUoZmlsZXMsIHJlbW92ZUV2ZW50QXJncykge1xuICAgICAgICBjb25zdCBhc3luYyA9IHRoaXMuYXN5bmM7XG4gICAgICAgIGxldCBmaWxlTmFtZXMgPSBmaWxlcy5tYXAoKGZpbGUpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBmaWxlLm5hbWU7XG4gICAgICAgIH0pO1xuICAgICAgICBsZXQgZm9ybURhdGEgPSB0aGlzLnBvcHVsYXRlUmVtb3ZlRm9ybURhdGEoZmlsZU5hbWVzLCByZW1vdmVFdmVudEFyZ3MuZGF0YSk7XG4gICAgICAgIGxldCBvcHRpb25zID0gdGhpcy5wb3B1bGF0ZVJlcXVlc3RPcHRpb25zKHJlbW92ZUV2ZW50QXJncy5oZWFkZXJzKTtcbiAgICAgICAgbGV0IHJlbW92ZVJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3QoYXN5bmMucmVtb3ZlTWV0aG9kLCBhc3luYy5yZW1vdmVVcmwsIGZvcm1EYXRhLCBvcHRpb25zKTtcbiAgICAgICAgdGhpcy5odHRwLnJlcXVlc3QocmVtb3ZlUmVxdWVzdClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoc3VjY2VzcyA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uU3VjY2VzcyhzdWNjZXNzLCBmaWxlcywgXCJyZW1vdmVcIik7XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMub25FcnJvcihlcnJvciwgZmlsZXMsIFwicmVtb3ZlXCIpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcGVyZm9ybVVwbG9hZChmaWxlcywgdXBsb2FkRXZlbnRBcmdzKSB7XG4gICAgICAgIGNvbnN0IGFzeW5jID0gdGhpcy5hc3luYztcbiAgICAgICAgbGV0IGZvcm1EYXRhID0gdGhpcy5wb3B1bGF0ZVVwbG9hZEZvcm1EYXRhKGZpbGVzLCB1cGxvYWRFdmVudEFyZ3MuZGF0YSk7XG4gICAgICAgIGxldCBvcHRpb25zID0gdGhpcy5wb3B1bGF0ZVJlcXVlc3RPcHRpb25zKHVwbG9hZEV2ZW50QXJncy5oZWFkZXJzKTtcbiAgICAgICAgbGV0IHVwbG9hZFJlcXVlc3QgPSBuZXcgSHR0cFJlcXVlc3QoYXN5bmMuc2F2ZU1ldGhvZCwgYXN5bmMuc2F2ZVVybCwgZm9ybURhdGEsIG9wdGlvbnMpO1xuICAgICAgICBsZXQgaHR0cFN1YnNjcmlwdGlvbiA9IHRoaXMuaHR0cC5yZXF1ZXN0KHVwbG9hZFJlcXVlc3QpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGV2ZW50ID0+IHtcbiAgICAgICAgICAgIGlmIChldmVudC50eXBlID09PSBIdHRwRXZlbnRUeXBlLlVwbG9hZFByb2dyZXNzICYmICF0aGlzLmFzeW5jLmNodW5rKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5vblByb2dyZXNzKGV2ZW50LCBmaWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChldmVudCBpbnN0YW5jZW9mIEh0dHBSZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIHRoaXMub25TdWNjZXNzKGV2ZW50LCBmaWxlcywgXCJ1cGxvYWRcIik7XG4gICAgICAgICAgICAgICAgdGhpcy5jaGVja0FsbENvbXBsZXRlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgICAgIHRoaXMub25FcnJvcihlcnJvciwgZmlsZXMsIFwidXBsb2FkXCIpO1xuICAgICAgICAgICAgdGhpcy5jaGVja0FsbENvbXBsZXRlKCk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gaHR0cFN1YnNjcmlwdGlvbjtcbiAgICB9XG4gICAgb25TdWNjZXNzKHN1Y2Nlc3NSZXNwb25zZSwgZmlsZXMsIG9wZXJhdGlvbikge1xuICAgICAgICBpZiAob3BlcmF0aW9uID09PSBcInVwbG9hZFwiICYmIHRoaXMuYXN5bmMuY2h1bmspIHtcbiAgICAgICAgICAgIHRoaXMub25DaHVua1Byb2dyZXNzKGZpbGVzKTtcbiAgICAgICAgICAgIGlmICh0aGlzLmlzQ2h1bmtVcGxvYWRDb21wbGV0ZShmaWxlc1swXS51aWQpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDaHVua0luZm8oZmlsZXNbMF0udWlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMudXBkYXRlQ2h1bmtJbmZvKGZpbGVzWzBdLnVpZCk7XG4gICAgICAgICAgICAgICAgdGhpcy5fdXBsb2FkRmlsZXMoW2ZpbGVzXSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHN1Y2Nlc3NBcmdzID0gbmV3IFN1Y2Nlc3NFdmVudChmaWxlcywgb3BlcmF0aW9uLCBzdWNjZXNzUmVzcG9uc2UpO1xuICAgICAgICB0aGlzLnN1Y2Nlc3NFdmVudC5lbWl0KHN1Y2Nlc3NBcmdzKTtcbiAgICAgICAgaWYgKG9wZXJhdGlvbiA9PT0gXCJ1cGxvYWRcIikge1xuICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5zZXRGaWxlc1N0YXRlKGZpbGVzLCBzdWNjZXNzQXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSA/IEZpbGVTdGF0ZS5GYWlsZWQgOiBGaWxlU3RhdGUuVXBsb2FkZWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaWYgKCFzdWNjZXNzQXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgICAgICAgIHRoaXMuZmlsZUxpc3QucmVtb3ZlKGZpbGVzWzBdLnVpZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFzdWNjZXNzQXJncy5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkge1xuICAgICAgICAgICAgdGhpcy5vbkNoYW5nZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uRXJyb3IoZXJyb3JSZXNwb25zZSwgZmlsZXMsIG9wZXJhdGlvbikge1xuICAgICAgICBpZiAob3BlcmF0aW9uID09PSBcInVwbG9hZFwiICYmIHRoaXMuYXN5bmMuY2h1bmspIHtcbiAgICAgICAgICAgIGNvbnN0IG1heFJldHJpZXMgPSB0aGlzLmNodW5rLm1heEF1dG9SZXRyaWVzO1xuICAgICAgICAgICAgY29uc3QgY2h1bmtJbmZvID0gdGhpcy5jaHVua01hcC5nZXQoZmlsZXNbMF0udWlkKTtcbiAgICAgICAgICAgIGlmIChjaHVua0luZm8ucmV0cmllcyA8IG1heFJldHJpZXMpIHtcbiAgICAgICAgICAgICAgICBjaHVua0luZm8ucmV0cmllcyArPSAxO1xuICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnJldHJ5RmlsZXMoZmlsZXNbMF0udWlkKTtcbiAgICAgICAgICAgICAgICB9LCB0aGlzLmNodW5rLmF1dG9SZXRyeUFmdGVyKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgZXJyb3JBcmdzID0gbmV3IEVycm9yRXZlbnQoZmlsZXMsIG9wZXJhdGlvbiwgZXJyb3JSZXNwb25zZSk7XG4gICAgICAgIHRoaXMuZXJyb3JFdmVudC5lbWl0KGVycm9yQXJncyk7XG4gICAgICAgIGlmIChvcGVyYXRpb24gPT09IFwidXBsb2FkXCIpIHtcbiAgICAgICAgICAgIHRoaXMuZmlsZUxpc3Quc2V0RmlsZXNTdGF0ZShmaWxlcywgRmlsZVN0YXRlLkZhaWxlZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgb25Qcm9ncmVzcyhldmVudCwgZmlsZXMpIHtcbiAgICAgICAgY29uc3QgcGVyY2VudENvbXBsZXRlID0gTWF0aC5yb3VuZCgxMDAgKiBldmVudC5sb2FkZWQgLyBldmVudC50b3RhbCk7XG4gICAgICAgIGNvbnN0IHByb2dyZXNzQXJncyA9IG5ldyBVcGxvYWRQcm9ncmVzc0V2ZW50KGZpbGVzLCBwZXJjZW50Q29tcGxldGUgPCAxMDAgPyBwZXJjZW50Q29tcGxldGUgOiAxMDApO1xuICAgICAgICB0aGlzLnVwbG9hZFByb2dyZXNzRXZlbnQuZW1pdChwcm9ncmVzc0FyZ3MpO1xuICAgIH1cbiAgICBvbkNodW5rUHJvZ3Jlc3MoZmlsZXMpIHtcbiAgICAgICAgY29uc3QgY2h1bmtJbmZvID0gdGhpcy5jaHVua01hcC5nZXQoZmlsZXNbMF0udWlkKTtcbiAgICAgICAgbGV0IHBlcmNlbnRDb21wbGV0ZSA9IDA7XG4gICAgICAgIGlmIChjaHVua0luZm8pIHtcbiAgICAgICAgICAgIGlmIChjaHVua0luZm8uaW5kZXggPT09IGNodW5rSW5mby50b3RhbENodW5rcyAtIDEpIHtcbiAgICAgICAgICAgICAgICBwZXJjZW50Q29tcGxldGUgPSAxMDA7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBwZXJjZW50Q29tcGxldGUgPSBNYXRoLnJvdW5kKCgoY2h1bmtJbmZvLmluZGV4ICsgMSkgLyBjaHVua0luZm8udG90YWxDaHVua3MpICogMTAwKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBwcm9ncmVzc0FyZ3MgPSBuZXcgVXBsb2FkUHJvZ3Jlc3NFdmVudChmaWxlcywgcGVyY2VudENvbXBsZXRlIDwgMTAwID8gcGVyY2VudENvbXBsZXRlIDogMTAwKTtcbiAgICAgICAgdGhpcy51cGxvYWRQcm9ncmVzc0V2ZW50LmVtaXQocHJvZ3Jlc3NBcmdzKTtcbiAgICB9XG4gICAgY2hlY2tBbGxDb21wbGV0ZSgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZpbGVMaXN0Lmhhc0ZpbGVXaXRoU3RhdGUoW1xuICAgICAgICAgICAgRmlsZVN0YXRlLlNlbGVjdGVkLFxuICAgICAgICAgICAgRmlsZVN0YXRlLlVwbG9hZGluZyxcbiAgICAgICAgICAgIEZpbGVTdGF0ZS5QYXVzZWRcbiAgICAgICAgXSkpIHtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGVFdmVudC5lbWl0KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodGhpcy5zaG91bGRVcGxvYWROZXh0RmlsZSgpKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZEZpbGVzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgc2hvdWxkVXBsb2FkTmV4dEZpbGUoKSB7XG4gICAgICAgIHJldHVybiAhdGhpcy5hc3luYy5jb25jdXJyZW50ICYmXG4gICAgICAgICAgICB0aGlzLmZpbGVMaXN0Lmhhc0ZpbGVXaXRoU3RhdGUoW0ZpbGVTdGF0ZS5TZWxlY3RlZF0pICYmXG4gICAgICAgICAgICAhdGhpcy5maWxlTGlzdC5oYXNGaWxlV2l0aFN0YXRlKFtGaWxlU3RhdGUuVXBsb2FkaW5nXSk7XG4gICAgfVxuICAgIGNsb25lUmVxdWVzdEhlYWRlcnMoaGVhZGVycykge1xuICAgICAgICBsZXQgY2xvbmVkID0ge307XG4gICAgICAgIGlmIChoZWFkZXJzKSB7XG4gICAgICAgICAgICBoZWFkZXJzLmtleXMoKS5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgICAgICAgICAgICBjbG9uZWRba2V5XSA9IGhlYWRlcnMuZ2V0KGtleSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gbmV3IEh0dHBIZWFkZXJzKGNsb25lZCk7XG4gICAgfVxuICAgIHBvcHVsYXRlUmVxdWVzdE9wdGlvbnMoaGVhZGVycykge1xuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgaGVhZGVyczogaGVhZGVycyxcbiAgICAgICAgICAgIHJlcG9ydFByb2dyZXNzOiB0cnVlLFxuICAgICAgICAgICAgcmVzcG9uc2VUeXBlOiB0aGlzLmFzeW5jLnJlc3BvbnNlVHlwZSxcbiAgICAgICAgICAgIHdpdGhDcmVkZW50aWFsczogdGhpcy5hc3luYy53aXRoQ3JlZGVudGlhbHNcbiAgICAgICAgfTtcbiAgICB9XG4gICAgcG9wdWxhdGVVcGxvYWRGb3JtRGF0YShmaWxlcywgY2xpZW50RGF0YSkge1xuICAgICAgICBjb25zdCBzYXZlRmllbGQgPSB0aGlzLmFzeW5jLnNhdmVGaWVsZDtcbiAgICAgICAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcbiAgICAgICAgdGhpcy5wb3B1bGF0ZUNsaWVudEZvcm1EYXRhKGRhdGEsIGNsaWVudERhdGEpO1xuICAgICAgICBpZiAodGhpcy5hc3luYy5jaHVuaykge1xuICAgICAgICAgICAgZGF0YS5hcHBlbmQoc2F2ZUZpZWxkLCB0aGlzLmdldE5leHRDaHVuayhmaWxlc1swXSkpO1xuICAgICAgICAgICAgZGF0YS5hcHBlbmQoXCJtZXRhZGF0YVwiLCB0aGlzLmdldENodW5rTWV0YWRhdGEoZmlsZXNbMF0pKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGZvciAobGV0IGZpbGUgb2YgZmlsZXMpIHtcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZChzYXZlRmllbGQsIGZpbGUucmF3RmlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIHBvcHVsYXRlUmVtb3ZlRm9ybURhdGEoZmlsZU5hbWVzLCBjbGllbnREYXRhKSB7XG4gICAgICAgIGxldCBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XG4gICAgICAgIHRoaXMucG9wdWxhdGVDbGllbnRGb3JtRGF0YShkYXRhLCBjbGllbnREYXRhKTtcbiAgICAgICAgZm9yIChsZXQgZmlsZU5hbWUgb2YgZmlsZU5hbWVzKSB7XG4gICAgICAgICAgICBkYXRhLmFwcGVuZCh0aGlzLmFzeW5jLnJlbW92ZUZpZWxkLCBmaWxlTmFtZSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuICAgIHBvcHVsYXRlQ2xpZW50Rm9ybURhdGEoZGF0YSwgY2xpZW50RGF0YSkge1xuICAgICAgICBmb3IgKHZhciBrZXkgaW4gY2xpZW50RGF0YSkge1xuICAgICAgICAgICAgaWYgKGNsaWVudERhdGEuaGFzT3duUHJvcGVydHkoa2V5KSkge1xuICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKGtleSwgY2xpZW50RGF0YVtrZXldKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbiAgICAvKiBDaHVua2luZyBIZWxwZXIgTWV0aG9kcyBTZWN0aW9uICovXG4gICAgZ2V0TmV4dENodW5rKGZpbGUpIHtcbiAgICAgICAgY29uc3QgaW5mbyA9IHRoaXMuZ2V0Q2h1bmtJbmZvKGZpbGUpO1xuICAgICAgICBjb25zdCBuZXdQb3NpdGlvbiA9IGluZm8ucG9zaXRpb24gKyB0aGlzLmNodW5rLnNpemU7XG4gICAgICAgIHJldHVybiBmaWxlLnJhd0ZpbGUuc2xpY2UoaW5mby5wb3NpdGlvbiwgbmV3UG9zaXRpb24pO1xuICAgIH1cbiAgICBnZXRDaHVua0luZm8oZmlsZSkge1xuICAgICAgICBsZXQgY2h1bmtJbmZvID0gdGhpcy5jaHVua01hcC5nZXQoZmlsZS51aWQpO1xuICAgICAgICBpZiAoIWNodW5rSW5mbykge1xuICAgICAgICAgICAgY29uc3QgdG90YWxDaHVua3MgPSBNYXRoLmNlaWwoZmlsZS5zaXplIC8gdGhpcy5jaHVuay5zaXplKTtcbiAgICAgICAgICAgIGNodW5rSW5mbyA9IHRoaXMuY2h1bmtNYXAuYWRkKGZpbGUudWlkLCB0b3RhbENodW5rcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGNodW5rSW5mbztcbiAgICB9XG4gICAgdXBkYXRlQ2h1bmtJbmZvKHVpZCkge1xuICAgICAgICBjb25zdCBjaHVua0luZm8gPSB0aGlzLmNodW5rTWFwLmdldCh1aWQpO1xuICAgICAgICBpZiAoY2h1bmtJbmZvLmluZGV4IDwgY2h1bmtJbmZvLnRvdGFsQ2h1bmtzIC0gMSkge1xuICAgICAgICAgICAgY2h1bmtJbmZvLmluZGV4ICs9IDE7XG4gICAgICAgICAgICBjaHVua0luZm8ucG9zaXRpb24gKz0gdGhpcy5jaHVuay5zaXplO1xuICAgICAgICAgICAgY2h1bmtJbmZvLnJldHJpZXMgPSAwO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJlbW92ZUNodW5rSW5mbyh1aWQpIHtcbiAgICAgICAgdGhpcy5jaHVua01hcC5yZW1vdmUodWlkKTtcbiAgICB9XG4gICAgZ2V0Q2h1bmtNZXRhZGF0YShmaWxlKSB7XG4gICAgICAgIGNvbnN0IGNodW5rSW5mbyA9IHRoaXMuY2h1bmtNYXAuZ2V0KGZpbGUudWlkKTtcbiAgICAgICAgY29uc3QgY2h1bmtNZXRhZGF0YSA9IHtcbiAgICAgICAgICAgIGNodW5rSW5kZXg6IGNodW5rSW5mby5pbmRleCxcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmaWxlLnJhd0ZpbGUudHlwZSxcbiAgICAgICAgICAgIGZpbGVOYW1lOiBmaWxlLm5hbWUsXG4gICAgICAgICAgICBmaWxlU2l6ZTogZmlsZS5zaXplLFxuICAgICAgICAgICAgZmlsZVVpZDogZmlsZS51aWQsXG4gICAgICAgICAgICB0b3RhbENodW5rczogY2h1bmtJbmZvLnRvdGFsQ2h1bmtzXG4gICAgICAgIH07XG4gICAgICAgIHJldHVybiBKU09OLnN0cmluZ2lmeShjaHVua01ldGFkYXRhKTtcbiAgICB9XG4gICAgaXNDaHVua1VwbG9hZENvbXBsZXRlKHVpZCkge1xuICAgICAgICBjb25zdCBjaHVua0luZm8gPSB0aGlzLmNodW5rTWFwLmdldCh1aWQpO1xuICAgICAgICBpZiAoY2h1bmtJbmZvKSB7XG4gICAgICAgICAgICByZXR1cm4gY2h1bmtJbmZvLmluZGV4ICsgMSA9PT0gY2h1bmtJbmZvLnRvdGFsQ2h1bmtzO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG5VcGxvYWRTZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5VcGxvYWRTZXJ2aWNlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogSHR0cENsaWVudCB9XG5dO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgTmF2aWdhdGlvblNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKHVwbG9hZFNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlID0gdXBsb2FkU2VydmljZTtcbiAgICAgICAgdGhpcy5vbkFjdGlvbkJ1dHRvbkFjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vbkFjdGlvbkJ1dHRvbkZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLm9uRmlsZUFjdGlvbiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vbkZpbGVGb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vblRhYiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vbldyYXBwZXJGb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5vblNlbGVjdEJ1dHRvbkZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmFjdGlvbkJ1dHRvbnNWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLl9mb2N1c2VkSW5kZXggPSAtMTtcbiAgICB9XG4gICAgYWN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGNvbnN0IGtleSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICAgIHJldHVybiB0aGlzLmtleUJpbmRpbmdzW2tleV07XG4gICAgfVxuICAgIHByb2Nlc3MoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgaGFuZGxlciA9IHRoaXMuYWN0aW9uKGV2ZW50KTtcbiAgICAgICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgICAgIGhhbmRsZXIoZXZlbnQuc2hpZnRLZXkpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNvbXB1dGVLZXlzKGRpcmVjdGlvbikge1xuICAgICAgICB0aGlzLmtleUJpbmRpbmdzID0ge1xuICAgICAgICAgICAgW0tleXMuRW50ZXJdOiAoKSA9PiB0aGlzLmhhbmRsZUVudGVyKCksXG4gICAgICAgICAgICBbS2V5cy5Fc2NhcGVdOiAoKSA9PiB0aGlzLmhhbmRsZUVzY2FwZSgpLFxuICAgICAgICAgICAgW0tleXMuRGVsZXRlXTogKCkgPT4gdGhpcy5oYW5kbGVEZWxldGUoKSxcbiAgICAgICAgICAgIFtLZXlzLlRhYl06IChzaGlmdGVkKSA9PiB0aGlzLmhhbmRsZVRhYihzaGlmdGVkKSxcbiAgICAgICAgICAgIFtLZXlzLkFycm93VXBdOiAoKSA9PiB0aGlzLmhhbmRsZVVwKCksXG4gICAgICAgICAgICBbS2V5cy5BcnJvd0Rvd25dOiAoKSA9PiB0aGlzLmhhbmRsZURvd24oKSxcbiAgICAgICAgICAgIFt0aGlzLmludmVydEtleXMoZGlyZWN0aW9uLCBLZXlzLkFycm93TGVmdCwgS2V5cy5BcnJvd1JpZ2h0KV06ICgpID0+IHRoaXMuaGFuZGxlTGVmdCgpLFxuICAgICAgICAgICAgW3RoaXMuaW52ZXJ0S2V5cyhkaXJlY3Rpb24sIEtleXMuQXJyb3dSaWdodCwgS2V5cy5BcnJvd0xlZnQpXTogKCkgPT4gdGhpcy5oYW5kbGVSaWdodCgpXG4gICAgICAgIH07XG4gICAgfVxuICAgIGludmVydEtleXMoZGlyZWN0aW9uLCBvcmlnaW5hbCwgaW52ZXJ0ZWQpIHtcbiAgICAgICAgcmV0dXJuIGRpcmVjdGlvbiA9PT0gJ3J0bCcgPyBpbnZlcnRlZCA6IG9yaWdpbmFsO1xuICAgIH1cbiAgICBmb2N1c1NlbGVjdEJ1dHRvbigpIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5fZm9jdXNlZEluZGV4ID0gLTE7XG4gICAgICAgIHRoaXMub25TZWxlY3RCdXR0b25Gb2N1cy5lbWl0KCk7XG4gICAgfVxuICAgIGhhbmRsZUVudGVyKCkge1xuICAgICAgICBpZiAodGhpcy5sYXN0SW5kZXggPj0gMCkge1xuICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEluZGV4IDw9IHRoaXMubGFzdEZpbGVJbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMub25GaWxlQWN0aW9uLmVtaXQoS2V5cy5FbnRlcik7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uQnV0dG9uc1Zpc2libGUgJiYgdGhpcy5mb2N1c2VkSW5kZXggPD0gdGhpcy5sYXN0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQWN0aW9uQnV0dG9uQWN0aW9uLmVtaXQodGhpcy5mb2N1c2VkSW5kZXggPCB0aGlzLmxhc3RJbmRleCA/IFwiY2xlYXJcIiA6IFwidXBsb2FkXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZURlbGV0ZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEluZGV4ID49IDAgJiYgdGhpcy5mb2N1c2VkSW5kZXggPD0gdGhpcy5sYXN0RmlsZUluZGV4KSB7XG4gICAgICAgICAgICB0aGlzLm9uRmlsZUFjdGlvbi5lbWl0KEtleXMuRGVsZXRlKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVFc2NhcGUoKSB7XG4gICAgICAgIGlmICh0aGlzLmZvY3VzZWRJbmRleCA+PSAwICYmIHRoaXMuZm9jdXNlZEluZGV4IDw9IHRoaXMubGFzdEZpbGVJbmRleCkge1xuICAgICAgICAgICAgdGhpcy5vbkZpbGVBY3Rpb24uZW1pdChLZXlzLkVzY2FwZSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaGFuZGxlTGVmdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uQnV0dG9uc1Zpc2libGUgJiYgdGhpcy5mb2N1c2VkSW5kZXggPT09IHRoaXMubGFzdEluZGV4KSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzZWRJbmRleCAtPSAxO1xuICAgICAgICAgICAgdGhpcy5vbkFjdGlvbkJ1dHRvbkZvY3VzLmVtaXQoXCJjbGVhclwiKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBoYW5kbGVSaWdodCgpIHtcbiAgICAgICAgaWYgKHRoaXMuYWN0aW9uQnV0dG9uc1Zpc2libGUgJiYgdGhpcy5mb2N1c2VkSW5kZXggPT09IHRoaXMubGFzdEluZGV4IC0gMSkge1xuICAgICAgICAgICAgdGhpcy5mb2N1c2VkSW5kZXggKz0gMTtcbiAgICAgICAgICAgIHRoaXMub25BY3Rpb25CdXR0b25Gb2N1cy5lbWl0KFwidXBsb2FkXCIpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVRhYihzaGlmdGVkKSB7XG4gICAgICAgIGlmICh0aGlzLmZvY3VzZWRJbmRleCA+PSAwICYmIHNoaWZ0ZWQpIHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNlZEluZGV4ID0gLTE7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5vblRhYi5lbWl0KCk7XG4gICAgfVxuICAgIGhhbmRsZURvd24oKSB7XG4gICAgICAgIGlmICh0aGlzLmxhc3RJbmRleCA+PSAwICYmIHRoaXMuZm9jdXNlZEluZGV4IDwgdGhpcy5sYXN0SW5kZXgpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLmZvY3VzZWRJbmRleCA8IHRoaXMubGFzdEZpbGVJbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMuZm9jdXNlZEluZGV4ICs9IDE7XG4gICAgICAgICAgICAgICAgdGhpcy5vbkZpbGVGb2N1cy5lbWl0KHRoaXMuZm9jdXNlZEluZGV4KTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodGhpcy5hY3Rpb25CdXR0b25zVmlzaWJsZSAmJiB0aGlzLmZvY3VzZWRJbmRleCA9PT0gdGhpcy5sYXN0RmlsZUluZGV4KSB7XG4gICAgICAgICAgICAgICAgdGhpcy5mb2N1c2VkSW5kZXggKz0gMTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQWN0aW9uQnV0dG9uRm9jdXMuZW1pdChcImNsZWFyXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGhhbmRsZVVwKCkge1xuICAgICAgICBpZiAodGhpcy5sYXN0SW5kZXggPj0gMCAmJiB0aGlzLmZvY3VzZWRJbmRleCA+IC0xKSB7XG4gICAgICAgICAgICB0aGlzLmZvY3VzZWRJbmRleCAtPSAxO1xuICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEluZGV4ID09PSAtMSkge1xuICAgICAgICAgICAgICAgIHRoaXMub25TZWxlY3RCdXR0b25Gb2N1cy5lbWl0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuZm9jdXNlZEluZGV4IDw9IHRoaXMubGFzdEZpbGVJbmRleCkge1xuICAgICAgICAgICAgICAgIHRoaXMub25GaWxlRm9jdXMuZW1pdCh0aGlzLmZvY3VzZWRJbmRleCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aW9uQnV0dG9uc1Zpc2libGUgJiYgdGhpcy5mb2N1c2VkSW5kZXggPD0gdGhpcy5sYXN0SW5kZXgpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmZvY3VzZWRJbmRleCA9IHRoaXMubGFzdEZpbGVJbmRleDtcbiAgICAgICAgICAgICAgICB0aGlzLm9uRmlsZUZvY3VzLmVtaXQodGhpcy5mb2N1c2VkSW5kZXgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBmb2N1c2VkSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9mb2N1c2VkSW5kZXg7XG4gICAgfVxuICAgIHNldCBmb2N1c2VkSW5kZXgoaW5kZXgpIHtcbiAgICAgICAgaWYgKCF0aGlzLmZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMub25XcmFwcGVyRm9jdXMuZW1pdCgpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2ZvY3VzZWRJbmRleCA9IGluZGV4O1xuICAgICAgICB0aGlzLmZvY3VzZWQgPSB0cnVlO1xuICAgICAgICBpZiAodGhpcy5fZm9jdXNlZEluZGV4ID49IDAgJiYgdGhpcy5fZm9jdXNlZEluZGV4IDw9IHRoaXMubGFzdEZpbGVJbmRleCkge1xuICAgICAgICAgICAgdGhpcy5vbkZpbGVGb2N1cy5lbWl0KGluZGV4KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXQgbGFzdEZpbGVJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9uQnV0dG9uc1Zpc2libGUgPyB0aGlzLmxhc3RJbmRleCAtIDIgOiB0aGlzLmxhc3RJbmRleDtcbiAgICB9XG4gICAgZ2V0IGxhc3RJbmRleCgpIHtcbiAgICAgICAgY29uc3QgZmlsZUNvdW50ID0gdGhpcy51cGxvYWRTZXJ2aWNlLmZpbGVzLmNvdW50O1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25CdXR0b25zVmlzaWJsZSA/IGZpbGVDb3VudCArIDEgOiBmaWxlQ291bnQgLSAxO1xuICAgIH1cbn1cbk5hdmlnYXRpb25TZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5OYXZpZ2F0aW9uU2VydmljZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IFVwbG9hZFNlcnZpY2UgfVxuXTtcblxuLyoqXG4gKiBVc2VkIHRvIGN1c3RvbWl6ZSB0aGUgcmVuZGVyaW5nIG9mIHRoZSBmaWxlcyBpbiB0aGUgbGlzdCAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIHRlbXBsYXRlc191cGxvYWQgJX0pKS5cbiAqL1xuY2xhc3MgRmlsZVRlbXBsYXRlRGlyZWN0aXZlIHtcbiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZVJlZikge1xuICAgICAgICB0aGlzLnRlbXBsYXRlUmVmID0gdGVtcGxhdGVSZWY7XG4gICAgfVxufVxuRmlsZVRlbXBsYXRlRGlyZWN0aXZlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBEaXJlY3RpdmUsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdba2VuZG9VcGxvYWRGaWxlVGVtcGxhdGVdLCBba2VuZG9GaWxlU2VsZWN0RmlsZVRlbXBsYXRlXScgLy8gdHNsaW50OmRpc2FibGUtbGluZTpkaXJlY3RpdmUtc2VsZWN0b3ItcHJlZml4XG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkZpbGVUZW1wbGF0ZURpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IFRlbXBsYXRlUmVmIH1cbl07XG5cbmxldCBjb21wb25lbnRzID0ge307XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgRHJvcFpvbmVTZXJ2aWNlIHtcbiAgICBhZGRDb21wb25lbnQoY29tcG9uZW50LCB6b25lSWQpIHtcbiAgICAgICAgaWYgKHRoaXMuaGFzKHpvbmVJZCkpIHtcbiAgICAgICAgICAgIGNvbXBvbmVudHNbem9uZUlkXS5wdXNoKGNvbXBvbmVudCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb21wb25lbnRzW3pvbmVJZF0gPSBbY29tcG9uZW50XTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBnZXRDb21wb25lbnRzKHpvbmVJZCkge1xuICAgICAgICByZXR1cm4gY29tcG9uZW50c1t6b25lSWRdO1xuICAgIH1cbiAgICBoYXMoaWQpIHtcbiAgICAgICAgcmV0dXJuIGlkIGluIGNvbXBvbmVudHM7XG4gICAgfVxufVxuRHJvcFpvbmVTZXJ2aWNlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBJbmplY3RhYmxlIH0sXG5dO1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgRklMRVNFTEVDVF9WQUxVRV9BQ0NFU1NPUiA9IHtcbiAgICBtdWx0aTogdHJ1ZSxcbiAgICBwcm92aWRlOiBOR19WQUxVRV9BQ0NFU1NPUixcbiAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGaWxlU2VsZWN0Q29tcG9uZW50KSAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLWZvcndhcmQtcmVmXG59O1xuY2xhc3MgRmlsZVNlbGVjdENvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IodXBsb2FkU2VydmljZSwgbG9jYWxpemF0aW9uLCBuYXZpZ2F0aW9uLCBkcm9wWm9uZVNlcnZpY2UsIG5nWm9uZSwgcmVuZGVyZXIsIGNkciwgd3JhcHBlcikge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UgPSB1cGxvYWRTZXJ2aWNlO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjtcbiAgICAgICAgdGhpcy5kcm9wWm9uZVNlcnZpY2UgPSBkcm9wWm9uZVNlcnZpY2U7XG4gICAgICAgIHRoaXMubmdab25lID0gbmdab25lO1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuY2RyID0gY2RyO1xuICAgICAgICAvKipcbiAgICAgICAgICogRGlzYWJsZXMgdGhlIEZpbGVTZWxlY3QuXG4gICAgICAgICAqIFRoZSBkZWZhdWx0IHZhbHVlIGlzIGBmYWxzZWAuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbmFibGVzIHRoZSBzZWxlY3Rpb24gb2YgbXVsdGlwbGUgZmlsZXNcbiAgICAgICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBmaWxlcHJvY2Vzc2luZ191cGxvYWQgJX0jdG9jLXVwbG9hZC1vZi1zaW5sZ2Utb3ItbXVsdGlwbGUtZmlsZXMpKS5cbiAgICAgICAgICogSWYgc2V0IHRvIGBmYWxzZWAsIG9ubHkgb25lIGZpbGUgY2FuIGJlIHNlbGVjdGVkIGF0IGEgdGltZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubXVsdGlwbGUgPSB0cnVlO1xuICAgICAgICAvKipcbiAgICAgICAgICogVG9nZ2xlcyB0aGUgdmlzaWJpbGl0eSBvZiB0aGUgZmlsZSBsaXN0LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5zaG93RmlsZUxpc3QgPSB0cnVlO1xuICAgICAgICAvKipcbiAgICAgICAgICogU3BlY2lmaWVzIHRoZSBbYHRhYmluZGV4YF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSFRNTC9HbG9iYWxfYXR0cmlidXRlcy90YWJpbmRleCkgb2YgdGhlIEZpbGVTZWxlY3QuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnRhYmluZGV4ID0gMDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEBoaWRkZW5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuZm9jdXNhYmxlSWQgPSBgay0ke2d1aWQoKX1gO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBuYXZpZ2F0ZXMgb3V0c2lkZSB0aGUgY29tcG9uZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkJsdXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSBjb21wb25lbnQgaXMgZm9jdXNlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMub25Gb2N1cyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gZmlsZXMgYXJlIHNlbGVjdGVkLiBJZiBwcmV2ZW50ZWQsIHRoZSBzZWxlY3RlZCBmaWxlcyB3aWxsIG5vdCBiZSBhZGRlZCB0byB0aGUgbGlzdC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiBhIGZpbGUgaXMgYWJvdXQgdG8gYmUgcmVtb3ZlZC4gSWYgcHJldmVudGVkLCB0aGUgZmlsZSB3aWxsIHJlbWFpbiBpbiB0aGUgbGlzdC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMucmVtb3ZlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdmFsdWUgb2YgdGhlIGNvbXBvbmVudCBoYXMgY2hhbmdlZCBhcyBhIHJlc3VsdCBvZiBhIHN1Y2Nlc3NmdWwgYHNlbGVjdGAgb3IgYHJlbW92ZWAgb3BlcmF0aW9uLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy52YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgdGhpcy5ob3N0RGVmYXVsdENsYXNzZXMgPSB0cnVlO1xuICAgICAgICAvKipcbiAgICAgICAgICogQGhpZGRlblxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5fcmVzdHJpY3Rpb25zID0ge1xuICAgICAgICAgICAgYWxsb3dlZEV4dGVuc2lvbnM6IFtdLFxuICAgICAgICAgICAgbWF4RmlsZVNpemU6IDAsXG4gICAgICAgICAgICBtaW5GaWxlU2l6ZTogMFxuICAgICAgICB9O1xuICAgICAgICB0aGlzLm9uVG91Y2hlZENhbGxiYWNrID0gKF8pID0+IHsgfTtcbiAgICAgICAgdGhpcy5vbkNoYW5nZUNhbGxiYWNrID0gKF8pID0+IHsgfTtcbiAgICAgICAgdGhpcy53cmFwcGVyID0gd3JhcHBlci5uYXRpdmVFbGVtZW50O1xuICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IGxvY2FsaXphdGlvbi5ydGwgPyAncnRsJyA6ICdsdHInO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb24uY29tcHV0ZUtleXModGhpcy5kaXJlY3Rpb24pO1xuICAgICAgICB0aGlzLmZpbGVMaXN0ID0gdGhpcy51cGxvYWRTZXJ2aWNlLmZpbGVzO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbkNoYW5nZVN1YnNjcmlwdGlvbiA9IGxvY2FsaXphdGlvbi5jaGFuZ2VzLnN1YnNjcmliZSgoeyBydGwgfSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInO1xuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uLmNvbXB1dGVLZXlzKHRoaXMuZGlyZWN0aW9uKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlQmx1cigpO1xuICAgICAgICB0aGlzLnN1YnNjcmliZUZvY3VzKCk7XG4gICAgICAgIHRoaXMuYXR0YWNoRXZlbnRIYW5kbGVycygpO1xuICAgICAgICB0aGlzLnNldERlZmF1bHRTZXR0aW5ncygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBgbmFtZWAgYXR0cmlidXRlIG9mIHRoZSBgaW5wdXRgIGVsZW1lbnQgb2YgdGhlIEZpbGVTZWxlY3QuXG4gICAgICovXG4gICAgc2V0IG5hbWUobmFtZSkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuc2F2ZUZpZWxkID0gbmFtZTtcbiAgICB9XG4gICAgZ2V0IG5hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuc2F2ZUZpZWxkO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSByZXN0cmljdGlvbnMgZm9yIHNlbGVjdGVkIGZpbGVzLlxuICAgICAqL1xuICAgIHNldCByZXN0cmljdGlvbnMocmVzdHJpY3Rpb25zKSB7XG4gICAgICAgIGxldCBwYXJzZWRSZXN0cmljdGlvbnMgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLl9yZXN0cmljdGlvbnMsIHJlc3RyaWN0aW9ucyk7XG4gICAgICAgIHRoaXMuX3Jlc3RyaWN0aW9ucyA9IHBhcnNlZFJlc3RyaWN0aW9ucztcbiAgICB9XG4gICAgZ2V0IHJlc3RyaWN0aW9ucygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3Jlc3RyaWN0aW9ucztcbiAgICB9XG4gICAgZ2V0IGhvc3REaXNhYmxlZENsYXNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZDtcbiAgICB9XG4gICAgZ2V0IGRpcigpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlyZWN0aW9uO1xuICAgIH1cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVBdHRyaWJ1dGUodGhpcy53cmFwcGVyLCBcInRhYmluZGV4XCIpO1xuICAgICAgICBpZiAodGhpcy56b25lSWQpIHtcbiAgICAgICAgICAgIHRoaXMuZHJvcFpvbmVTZXJ2aWNlLmFkZENvbXBvbmVudCh0aGlzLCB0aGlzLnpvbmVJZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHRleHRGb3Ioa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvbi5nZXQoa2V5KTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogRm9jdXNlcyB0aGUgdW5kZXJseWluZyBpbnB1dCBlbGVtZW50LlxuICAgICAqL1xuICAgIGZvY3VzKCkge1xuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZmlsZVNlbGVjdEJ1dHRvbi5uYXRpdmVFbGVtZW50LmZvY3VzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5maWxlTGlzdC5jbGVhcigpO1xuICAgICAgICBpZiAodGhpcy5ibHVyU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmJsdXJTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy53cmFwcGVyRm9jdXNTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMud3JhcHBlckZvY3VzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc2VsZWN0QnV0dG9uRm9jdXNTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMuc2VsZWN0QnV0dG9uRm9jdXNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodGhpcy5sb2NhbGl6YXRpb25DaGFuZ2VTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuc3Vicykge1xuICAgICAgICAgICAgdGhpcy5zdWJzLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGhhbmRsZUtleWRvd24oZXZlbnQpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoKGV2ZW50LmtleUNvZGUgPT09IEtleXMuRW50ZXIgfHwgZXZlbnQua2V5Q29kZSA9PT0gS2V5cy5TcGFjZSkgJiZcbiAgICAgICAgICAgIGV2ZW50LnRhcmdldCA9PT0gdGhpcy5maWxlU2VsZWN0QnV0dG9uLm5hdGl2ZUVsZW1lbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICB0aGlzLmZpbGVTZWxlY3QubmF0aXZlRWxlbWVudC5jbGljaygpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChoYXNDbGFzc2VzKGV2ZW50LnRhcmdldCwgVVBMT0FEX0NMQVNTRVMpIHx8XG4gICAgICAgICAgICAoIWlzRm9jdXNhYmxlKGV2ZW50LnRhcmdldCkgJiYgIWhhc0NsYXNzZXMoZXZlbnQudGFyZ2V0LCBJR05PUkVfVEFSR0VUX0NMQVNTRVMpKSkge1xuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uLnByb2Nlc3MoZXZlbnQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICB3cml0ZVZhbHVlKG5ld1ZhbHVlKSB7XG4gICAgICAgIGxldCBpc1ZhbGlkID0gdHJ1ZTtcbiAgICAgICAgaWYgKG5ld1ZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHtcbiAgICAgICAgICAgIG5ld1ZhbHVlLmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoIXZhbGlkYXRlSW5pdGlhbEZpbGVTZWxlY3RGaWxlKGZpbGUpKSB7XG4gICAgICAgICAgICAgICAgICAgIGlzVmFsaWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGlmIChpc1ZhbGlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFkZEluaXRpYWxGaWxlU2VsZWN0RmlsZXMobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbikge1xuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSBmbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuKSB7XG4gICAgICAgIHRoaXMub25Ub3VjaGVkQ2FsbGJhY2sgPSBmbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZCkge1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUmVtb3ZlcyBzcGVjaWZpYyBmaWxlIGZyb20gdGhlIGZpbGUgbGlzdC5cbiAgICAgKi9cbiAgICByZW1vdmVGaWxlQnlVaWQodWlkKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5yZW1vdmVGaWxlcyh1aWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBWaXN1YWxseSBjbGVhcnMgYWxsIGZpbGVzIGZyb20gdGhlIFVJLlxuICAgICAqL1xuICAgIGNsZWFyRmlsZXMoKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5jbGVhckZpbGVzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKiBVc2VkIHRvIGRldGVybWluZSBpZiB0aGUgY29tcG9uZW50IGlzIGVtcHR5LlxuICAgICAqL1xuICAgIGlzRW1wdHkoKSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIFVzZWQgYnkgdGhlIGV4dGVybmFsIGRyb3B6b25lIHRvIGFkZCBmaWxlcyB0byB0aGUgRmlsZVNlbGVjdFxuICAgICAqL1xuICAgIGFkZEZpbGVzKGZpbGVzKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5hZGRGaWxlcyhmaWxlcyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZXQgc2VsZWN0QnV0dG9uVGFiSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkID8gdW5kZWZpbmVkIDogdGhpcy50YWJpbmRleDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIG9uRmlsZVNlbGVjdEJ1dHRvbkZvY3VzKF9ldmVudCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZmlsZVNlbGVjdEJ1dHRvbi5uYXRpdmVFbGVtZW50LCAnay1zdGF0ZS1mb2N1c2VkJyk7XG4gICAgICAgIGlmICghdGhpcy5uYXZpZ2F0aW9uLmZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5mb2N1c2VkSW5kZXggPSAtMTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25GaWxlU2VsZWN0QnV0dG9uQmx1cihfZXZlbnQpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmZpbGVTZWxlY3RCdXR0b24ubmF0aXZlRWxlbWVudCwgJ2stc3RhdGUtZm9jdXNlZCcpO1xuICAgIH1cbiAgICBzdWJzY3JpYmVCbHVyKCkge1xuICAgICAgICBpZiAoIWlzRG9jdW1lbnRBdmFpbGFibGUoKSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuZG9jdW1lbnRDbGljayA9IGZyb21FdmVudChkb2N1bWVudCwgJ2NsaWNrJykucGlwZShmaWx0ZXIoKGV2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICEodGhpcy53cmFwcGVyICE9PSBldmVudC50YXJnZXQgJiYgdGhpcy53cmFwcGVyLmNvbnRhaW5zKGV2ZW50LnRhcmdldCkpO1xuICAgICAgICAgICAgfSkpO1xuICAgICAgICAgICAgdGhpcy5ibHVyU3Vic2NyaXB0aW9uID0gbWVyZ2UodGhpcy5kb2N1bWVudENsaWNrLCB0aGlzLm5hdmlnYXRpb24ub25UYWIpLnN1YnNjcmliZSgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMubmF2aWdhdGlvbi5mb2N1c2VkKSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRpb24uZm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkJsdXIuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN1YnNjcmliZUZvY3VzKCkge1xuICAgICAgICB0aGlzLndyYXBwZXJGb2N1c1N1YnNjcmlwdGlvbiA9IHRoaXMubmF2aWdhdGlvbi5vbldyYXBwZXJGb2N1cy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkZvY3VzLmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VsZWN0QnV0dG9uRm9jdXNTdWJzY3JpcHRpb24gPSB0aGlzLm5hdmlnYXRpb24ub25TZWxlY3RCdXR0b25Gb2N1cy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWxlU2VsZWN0QnV0dG9uLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGF0dGFjaEV2ZW50SGFuZGxlcnMoKSB7XG4gICAgICAgIHRoaXMuc3VicyA9IHRoaXMudXBsb2FkU2VydmljZS5jaGFuZ2VFdmVudC5zdWJzY3JpYmUoKGZpbGVzKSA9PiB7XG4gICAgICAgICAgICBsZXQgbW9kZWwgPSBbXTtcbiAgICAgICAgICAgIGlmIChmaWxlcyAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGZpbGVzLmZvckVhY2goKGZpbGUpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGZpbGUuc3RhdGUgPT09IEZpbGVTdGF0ZS5Jbml0aWFsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtb2RlbC5wdXNoKGZpbGUpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWxlLnN0YXRlID09PSBGaWxlU3RhdGUuU2VsZWN0ZWQgJiYgZmlsZS5yYXdGaWxlICYmICFmaWxlLnZhbGlkYXRpb25FcnJvcnMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1vZGVsLnB1c2goZmlsZS5yYXdGaWxlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKG1vZGVsLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIG1vZGVsID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMub25DaGFuZ2VDYWxsYmFjayhtb2RlbCk7XG4gICAgICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlLmVtaXQobW9kZWwpO1xuICAgICAgICB9KTtcbiAgICAgICAgdGhpcy5zdWJzLmFkZCh0aGlzLnVwbG9hZFNlcnZpY2UucmVtb3ZlRXZlbnQuc3Vic2NyaWJlKChhcmdzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlbW92ZS5lbWl0KGFyZ3MpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy51cGxvYWRTZXJ2aWNlLnNlbGVjdEV2ZW50LnN1YnNjcmliZSgoYXJncykgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QuZW1pdChhcmdzKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbiAgICBzZXREZWZhdWx0U2V0dGluZ3MoKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5hdXRvVXBsb2FkID0gZmFsc2U7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5jb21wb25lbnQgPSAnRmlsZVNlbGVjdCc7XG4gICAgfVxufVxuRmlsZVNlbGVjdENvbXBvbmVudC5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGV4cG9ydEFzOiAna2VuZG9GaWxlU2VsZWN0JyxcbiAgICAgICAgICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAgTG9jYWxpemF0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAgTmF2aWdhdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgIFVwbG9hZFNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgIERyb3Bab25lU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAgRklMRVNFTEVDVF9WQUxVRV9BQ0NFU1NPUixcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZTogTDEwTl9QUkVGSVgsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VWYWx1ZTogJ2tlbmRvLmZpbGVzZWxlY3QnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IEtlbmRvSW5wdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBGaWxlU2VsZWN0Q29tcG9uZW50KVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLWZpbGVzZWxlY3QnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICAgIDxuZy1jb250YWluZXIga2VuZG9GaWxlU2VsZWN0TG9jYWxpemVkTWVzc2FnZXNcbiAgICAgICAgICAgIGkxOG4tZHJvcEZpbGVzSGVyZT1cImtlbmRvLmZpbGVzZWxlY3QuZHJvcEZpbGVzSGVyZXxUaGUgZHJvcCB6b25lIGhpbnRcIlxuICAgICAgICAgICAgZHJvcEZpbGVzSGVyZT1cIkRyb3AgZmlsZXMgaGVyZSB0byBzZWxlY3RcIlxuXG4gICAgICAgICAgICBpMThuLWludmFsaWRGaWxlRXh0ZW5zaW9uPVwia2VuZG8uZmlsZXNlbGVjdC5pbnZhbGlkRmlsZUV4dGVuc2lvbnxUaGUgdGV4dCBmb3IgdGhlIGludmFsaWQgYWxsb3dlZCBleHRlbnNpb25zIHJlc3RyaWN0aW9uIG1lc3NhZ2VcIlxuICAgICAgICAgICAgaW52YWxpZEZpbGVFeHRlbnNpb249XCJGaWxlIHR5cGUgbm90IGFsbG93ZWQuXCJcblxuICAgICAgICAgICAgaTE4bi1pbnZhbGlkTWF4RmlsZVNpemU9XCJrZW5kby5maWxlc2VsZWN0LmludmFsaWRNYXhGaWxlU2l6ZXxUaGUgdGV4dCBmb3IgdGhlIGludmFsaWQgbWF4IGZpbGUgc2l6ZSByZXN0cmljdGlvbiBtZXNzYWdlXCJcbiAgICAgICAgICAgIGludmFsaWRNYXhGaWxlU2l6ZT1cIkZpbGUgc2l6ZSB0b28gbGFyZ2UuXCJcblxuICAgICAgICAgICAgaTE4bi1pbnZhbGlkTWluRmlsZVNpemU9XCJrZW5kby5maWxlc2VsZWN0LmludmFsaWRNaW5GaWxlU2l6ZXxUaGUgdGV4dCBmb3IgdGhlIGludmFsaWQgbWluIGZpbGUgc2l6ZSByZXN0cmljdGlvbiBtZXNzYWdlXCJcbiAgICAgICAgICAgIGludmFsaWRNaW5GaWxlU2l6ZT1cIkZpbGUgc2l6ZSB0b28gc21hbGwuXCJcblxuICAgICAgICAgICAgaTE4bi1yZW1vdmU9XCJrZW5kby5maWxlc2VsZWN0LnJlbW92ZXxUaGUgdGV4dCBmb3IgdGhlIFJlbW92ZSBidXR0b25cIlxuICAgICAgICAgICAgcmVtb3ZlPVwiUmVtb3ZlXCJcblxuICAgICAgICAgICAgaTE4bi1zZWxlY3Q9XCJrZW5kby5maWxlc2VsZWN0LnNlbGVjdHxUaGUgdGV4dCBmb3IgdGhlIFNlbGVjdCBidXR0b25cIlxuICAgICAgICAgICAgc2VsZWN0PVwiU2VsZWN0IGZpbGVzLi4uXCJcbiAgICAgICAgPlxuICAgICAgICA8L25nLWNvbnRhaW5lcj5cbiAgICAgICAgPGRpdiBrZW5kb0ZpbGVTZWxlY3RJbnRlcm5hbERyb3Bab25lXG4gICAgICAgICAgICBbcmVzdHJpY3Rpb25zXT1cInJlc3RyaWN0aW9uc1wiXG4gICAgICAgICAgICBbbXVsdGlwbGVdPVwibXVsdGlwbGVcIlxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCI+XG4gICAgICAgICAgICA8ZGl2IHJvbGU9XCJidXR0b25cIiAjZmlsZVNlbGVjdEJ1dHRvblxuICAgICAgICAgICAgICAgIFtpZF09XCJmb2N1c2FibGVJZFwiXG4gICAgICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJ0ZXh0Rm9yKCdzZWxlY3QnKVwiXG4gICAgICAgICAgICAgICAgW2F0dHIudGFiaW5kZXhdPVwic2VsZWN0QnV0dG9uVGFiSW5kZXhcIlxuICAgICAgICAgICAgICAgIChmb2N1cyk9XCJvbkZpbGVTZWxlY3RCdXR0b25Gb2N1cygkZXZlbnQpXCJcbiAgICAgICAgICAgICAgICAoYmx1cik9XCJvbkZpbGVTZWxlY3RCdXR0b25CbHVyKCRldmVudClcIlxuICAgICAgICAgICAgICAgIGNsYXNzPVwiay1idXR0b24gay11cGxvYWQtYnV0dG9uXCI+XG4gICAgICAgICAgICAgICAgPGlucHV0ICNmaWxlU2VsZWN0IGtlbmRvRmlsZVNlbGVjdFxuICAgICAgICAgICAgICAgICAgICBbYXR0ci5hY2NlcHRdPVwiYWNjZXB0ID8gYWNjZXB0IDogbnVsbFwiXG4gICAgICAgICAgICAgICAgICAgIFtkaXJdPVwiZGlyZWN0aW9uXCJcbiAgICAgICAgICAgICAgICAgICAgW3Jlc3RyaWN0aW9uc109XCJyZXN0cmljdGlvbnNcIlxuICAgICAgICAgICAgICAgICAgICBbbXVsdGlwbGVdPVwibXVsdGlwbGVcIlxuICAgICAgICAgICAgICAgICAgICBbZGlzYWJsZWRdPVwiZGlzYWJsZWRcIiAvPlxuICAgICAgICAgICAgICAgIDxzcGFuPnt7dGV4dEZvcignc2VsZWN0Jyl9fTwvc3Bhbj5cbiAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgPGRpdiBjbGFzcz1cImstZHJvcHpvbmUtaGludFwiPnt7dGV4dEZvcignZHJvcEZpbGVzSGVyZScpfX08L2Rpdj5cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDx1bCBrZW5kby11cGxvYWQtZmlsZS1saXN0XG4gICAgICAgICAgICBjbGFzcz1cImstdXBsb2FkLWZpbGVzIGstcmVzZXRcIlxuICAgICAgICAgICAgKm5nSWY9XCJzaG93RmlsZUxpc3QgJiYgZmlsZUxpc3QuY291bnQgPiAwXCJcbiAgICAgICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICAgICAgICBbZmlsZUxpc3RdPVwiZmlsZUxpc3QuZmlsZXNcIlxuICAgICAgICAgICAgW2ZpbGVUZW1wbGF0ZV09XCJmaWxlVGVtcGxhdGVcIj5cbiAgICAgICAgPC91bD5cbiAgICBgXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkZpbGVTZWxlY3RDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBVcGxvYWRTZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBMb2NhbGl6YXRpb25TZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBOYXZpZ2F0aW9uU2VydmljZSB9LFxuICAgIHsgdHlwZTogRHJvcFpvbmVTZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBOZ1pvbmUgfSxcbiAgICB7IHR5cGU6IFJlbmRlcmVyMiB9LFxuICAgIHsgdHlwZTogQ2hhbmdlRGV0ZWN0b3JSZWYgfSxcbiAgICB7IHR5cGU6IEVsZW1lbnRSZWYgfVxuXTtcbkZpbGVTZWxlY3RDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgYWNjZXB0OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBkaXNhYmxlZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgbXVsdGlwbGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIG5hbWU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHNob3dGaWxlTGlzdDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgdGFiaW5kZXg6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHJlc3RyaWN0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgem9uZUlkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmb2N1c2FibGVJZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZmlsZVRlbXBsYXRlOiBbeyB0eXBlOiBDb250ZW50Q2hpbGQsIGFyZ3M6IFtGaWxlVGVtcGxhdGVEaXJlY3RpdmUsXSB9XSxcbiAgICBmaWxlU2VsZWN0OiBbeyB0eXBlOiBWaWV3Q2hpbGQsIGFyZ3M6IFsnZmlsZVNlbGVjdCcsXSB9XSxcbiAgICBmaWxlU2VsZWN0QnV0dG9uOiBbeyB0eXBlOiBWaWV3Q2hpbGQsIGFyZ3M6IFsnZmlsZVNlbGVjdEJ1dHRvbicsXSB9XSxcbiAgICBvbkJsdXI6IFt7IHR5cGU6IE91dHB1dCwgYXJnczogWydibHVyJyxdIH1dLFxuICAgIG9uRm9jdXM6IFt7IHR5cGU6IE91dHB1dCwgYXJnczogWydmb2N1cycsXSB9XSxcbiAgICBzZWxlY3Q6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICByZW1vdmU6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICB2YWx1ZUNoYW5nZTogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIGhvc3REZWZhdWx0Q2xhc3NlczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay13aWRnZXQnLF0gfSwgeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLXVwbG9hZCcsXSB9XSxcbiAgICBob3N0RGlzYWJsZWRDbGFzczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1zdGF0ZS1kaXNhYmxlZCcsXSB9XSxcbiAgICBkaXI6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIuZGlyJyxdIH1dLFxuICAgIGhhbmRsZUtleWRvd246IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogWydrZXlkb3duJywgWyckZXZlbnQnXSxdIH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgTWVzc2FnZXMgZXh0ZW5kcyBDb21wb25lbnRNZXNzYWdlcyB7XG59XG5NZXNzYWdlcy5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBjYW5jZWw6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGNsZWFyU2VsZWN0ZWRGaWxlczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZHJvcEZpbGVzSGVyZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZXh0ZXJuYWxEcm9wRmlsZXNIZXJlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmaWxlc0JhdGNoU3RhdHVzOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmaWxlc0JhdGNoU3RhdHVzRmFpbGVkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmaWxlc0JhdGNoU3RhdHVzVXBsb2FkZWQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGZpbGVTdGF0dXNGYWlsZWQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGZpbGVTdGF0dXNVcGxvYWRlZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaGVhZGVyU3RhdHVzUGF1c2VkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBoZWFkZXJTdGF0dXNVcGxvYWRlZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaGVhZGVyU3RhdHVzVXBsb2FkaW5nOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBpbnZhbGlkRmlsZUV4dGVuc2lvbjogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaW52YWxpZE1heEZpbGVTaXplOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBpbnZhbGlkTWluRmlsZVNpemU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHBhdXNlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICByZW1vdmU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHJlc3VtZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgcmV0cnk6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHNlbGVjdDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgdXBsb2FkU2VsZWN0ZWRGaWxlczogW3sgdHlwZTogSW5wdXQgfV1cbn07XG5cbi8qKlxuICogQ3VzdG9tIGNvbXBvbmVudCBtZXNzYWdlcyBvdmVycmlkZSBkZWZhdWx0IGNvbXBvbmVudCBtZXNzYWdlcyAoW21vcmUgaW5mb3JtYXRpb24gYW5kIGV4YW1wbGVdKHslIHNsdWcgZ2xvYmFsaXphdGlvbl91cGxvYWQgJX0pKS5cbiAqXG4gKiBAZXhhbXBsZVxuICogYGBgaHRtbC1uby1ydW5cbiAqIDxrZW5kby1maWxlc2VsZWN0PlxuICogICAgIDxrZW5kby1maWxlc2VsZWN0LW1lc3NhZ2VzXG4gKiAgICAgICAgIFtkcm9wRmlsZXNIZXJlXT1cIidEcm9wIHlvdXIgZmlsZSBoZXJlJ1wiXG4gKiAgICAgICAgIFtzZWxlY3RdPVwiJ1VwbG9hZCBmaWxlJ1wiPlxuICogICAgIDwva2VuZG8tZmlsZXNlbGVjdC1tZXNzYWdlcz5cbiAqIDwva2VuZG8tZmlsZXNlbGVjdD5cbiAqIGBgYFxuICovXG5jbGFzcyBDdXN0b21NZXNzYWdlc0NvbXBvbmVudCBleHRlbmRzIE1lc3NhZ2VzIHtcbiAgICBjb25zdHJ1Y3RvcihzZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKCk7XG4gICAgICAgIHRoaXMuc2VydmljZSA9IHNlcnZpY2U7XG4gICAgfVxuICAgIGdldCBvdmVycmlkZSgpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxufVxuQ3VzdG9tTWVzc2FnZXNDb21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBwcm92aWRlcnM6IFtcbiAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgcHJvdmlkZTogTWVzc2FnZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBDdXN0b21NZXNzYWdlc0NvbXBvbmVudCkgLy8gdHNsaW50OmRpc2FibGUtbGluZTpuby1mb3J3YXJkLXJlZlxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXVwbG9hZC1tZXNzYWdlcywga2VuZG8tZmlsZXNlbGVjdC1tZXNzYWdlcywga2VuZG8tdXBsb2FkZHJvcHpvbmUtbWVzc2FnZXMnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5DdXN0b21NZXNzYWdlc0NvbXBvbmVudC5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfVxuXTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IElOVkFMSURNQVhGSUxFU0laRSA9IFwiaW52YWxpZE1heEZpbGVTaXplXCI7XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgSU5WQUxJRE1JTkZJTEVTSVpFID0gXCJpbnZhbGlkTWluRmlsZVNpemVcIjtcbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBJTlZBTElERklMRUVYVEVOU0lPTiA9IFwiaW52YWxpZEZpbGVFeHRlbnNpb25cIjtcbmNvbnN0IHZhbGlkYXRlRmlsZUV4dGVuc2lvbiA9IChmaWxlLCBhbGxvd2VkRXh0ZW5zaW9ucykgPT4ge1xuICAgIGlmIChhbGxvd2VkRXh0ZW5zaW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgIGlmIChhbGxvd2VkRXh0ZW5zaW9ucy5pbmRleE9mKGZpbGUuZXh0ZW5zaW9uLnRvTG93ZXJDYXNlKCkpIDwgMCkge1xuICAgICAgICAgICAgZmlsZS52YWxpZGF0aW9uRXJyb3JzID0gZmlsZS52YWxpZGF0aW9uRXJyb3JzIHx8IFtdO1xuICAgICAgICAgICAgaWYgKGZpbGUudmFsaWRhdGlvbkVycm9ycy5pbmRleE9mKElOVkFMSURGSUxFRVhURU5TSU9OKSA8IDApIHtcbiAgICAgICAgICAgICAgICBmaWxlLnZhbGlkYXRpb25FcnJvcnMucHVzaChJTlZBTElERklMRUVYVEVOU0lPTik7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG59O1xuY29uc3QgdmFsaWRhdGVGaWxlU2l6ZSA9IChmaWxlLCBtaW5GaWxlU2l6ZSwgbWF4RmlsZVNpemUpID0+IHtcbiAgICBpZiAobWluRmlsZVNpemUgIT09IDAgJiYgZmlsZS5zaXplIDwgbWluRmlsZVNpemUpIHtcbiAgICAgICAgZmlsZS52YWxpZGF0aW9uRXJyb3JzID0gZmlsZS52YWxpZGF0aW9uRXJyb3JzIHx8IFtdO1xuICAgICAgICBpZiAoZmlsZS52YWxpZGF0aW9uRXJyb3JzLmluZGV4T2YoSU5WQUxJRE1JTkZJTEVTSVpFKSA8IDApIHtcbiAgICAgICAgICAgIGZpbGUudmFsaWRhdGlvbkVycm9ycy5wdXNoKElOVkFMSURNSU5GSUxFU0laRSk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKG1heEZpbGVTaXplICE9PSAwICYmIGZpbGUuc2l6ZSA+IG1heEZpbGVTaXplKSB7XG4gICAgICAgIGZpbGUudmFsaWRhdGlvbkVycm9ycyA9IGZpbGUudmFsaWRhdGlvbkVycm9ycyB8fCBbXTtcbiAgICAgICAgaWYgKGZpbGUudmFsaWRhdGlvbkVycm9ycy5pbmRleE9mKElOVkFMSURNQVhGSUxFU0laRSkgPCAwKSB7XG4gICAgICAgICAgICBmaWxlLnZhbGlkYXRpb25FcnJvcnMucHVzaChJTlZBTElETUFYRklMRVNJWkUpO1xuICAgICAgICB9XG4gICAgfVxufTtcbmNvbnN0IHBhcnNlQWxsb3dlZEV4dGVuc2lvbnMgPSAoZXh0ZW5zaW9ucykgPT4ge1xuICAgIGNvbnN0IGFsbG93ZWRFeHRlbnNpb25zID0gZXh0ZW5zaW9ucy5tYXAoKGV4dCkgPT4ge1xuICAgICAgICB2YXIgcGFyc2VkRXh0ID0gKGV4dC5zdWJzdHJpbmcoMCwgMSkgPT09IFwiLlwiKSA/IGV4dCA6IChcIi5cIiArIGV4dCk7XG4gICAgICAgIHJldHVybiBwYXJzZWRFeHQudG9Mb3dlckNhc2UoKTtcbiAgICB9KTtcbiAgICByZXR1cm4gYWxsb3dlZEV4dGVuc2lvbnM7XG59O1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IHZhbGlkYXRlRmlsZXMgPSAoZmlsZXMsIHJlc3RyaWN0aW9uSW5mbykgPT4ge1xuICAgIGNvbnN0IGFsbG93ZWRFeHRlbnNpb25zID0gcGFyc2VBbGxvd2VkRXh0ZW5zaW9ucyhyZXN0cmljdGlvbkluZm8uYWxsb3dlZEV4dGVuc2lvbnMpO1xuICAgIGNvbnN0IG1heEZpbGVTaXplID0gcmVzdHJpY3Rpb25JbmZvLm1heEZpbGVTaXplO1xuICAgIGNvbnN0IG1pbkZpbGVTaXplID0gcmVzdHJpY3Rpb25JbmZvLm1pbkZpbGVTaXplO1xuICAgIGxldCBpO1xuICAgIGZvciAoaSA9IDA7IGkgPCBmaWxlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICB2YWxpZGF0ZUZpbGVFeHRlbnNpb24oZmlsZXNbaV0sIGFsbG93ZWRFeHRlbnNpb25zKTtcbiAgICAgICAgdmFsaWRhdGVGaWxlU2l6ZShmaWxlc1tpXSwgbWluRmlsZVNpemUsIG1heEZpbGVTaXplKTtcbiAgICB9XG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgRHJvcFpvbmVCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCByZW5kZXJlciwgaG92ZXJDbGFzcykge1xuICAgICAgICB0aGlzLmVsZW1lbnQgPSBlbGVtZW50O1xuICAgICAgICB0aGlzLnJlbmRlcmVyID0gcmVuZGVyZXI7XG4gICAgICAgIHRoaXMuaGlkZUludGVydmFsRWxlbWVudCA9IG51bGw7XG4gICAgICAgIHRoaXMuaG92ZXJDbGFzcyA9IGhvdmVyQ2xhc3M7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkVsZW1lbnREcmFnRW50ZXJMaXN0ZW5lcigpIHtcbiAgICAgICAgdGhpcy5hZGRDbGFzcyh0aGlzLmhvdmVyQ2xhc3MpO1xuICAgICAgICB0aGlzLmxhc3REcmFnRWxlbWVudCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmICghdGhpcy5oaWRlSW50ZXJ2YWxFbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLmhpZGVJbnRlcnZhbEVsZW1lbnQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuY2FsY3VsYXRlVGltZURpZmYodGhpcy5sYXN0RHJhZ0VsZW1lbnQpIDwgMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDbGFzcyh0aGlzLmhvdmVyQ2xhc3MpO1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5oaWRlSW50ZXJ2YWxFbGVtZW50KTtcbiAgICAgICAgICAgICAgICB0aGlzLmhpZGVJbnRlcnZhbEVsZW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkVsZW1lbnREcmFnT3Zlckxpc3RlbmVyKCkge1xuICAgICAgICB0aGlzLmxhc3REcmFnRWxlbWVudCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgY2FsY3VsYXRlVGltZURpZmYocHJldkV2ZW50KSB7XG4gICAgICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKSAtIHByZXZFdmVudC5nZXRUaW1lKCk7XG4gICAgfVxuICAgIGFkZENsYXNzKGNsYXNzTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLmFkZENsYXNzKHRoaXMuZWxlbWVudC5uYXRpdmVFbGVtZW50LCBjbGFzc05hbWUpO1xuICAgIH1cbiAgICByZW1vdmVDbGFzcyhjbGFzc05hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDbGFzcyh0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudCwgY2xhc3NOYW1lKTtcbiAgICB9XG59XG5Ecm9wWm9uZUJhc2UucHJvcERlY29yYXRvcnMgPSB7XG4gICAgb25FbGVtZW50RHJhZ0VudGVyTGlzdGVuZXI6IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogWydkcmFnZW50ZXInLF0gfV0sXG4gICAgb25FbGVtZW50RHJhZ092ZXJMaXN0ZW5lcjogW3sgdHlwZTogSG9zdExpc3RlbmVyLCBhcmdzOiBbJ2RyYWdvdmVyJyxdIH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgRHJvcFpvbmVJbnRlcm5hbERpcmVjdGl2ZSBleHRlbmRzIERyb3Bab25lQmFzZSB7XG4gICAgY29uc3RydWN0b3IoZWxlbWVudCwgcmVuZGVyZXIsIG5nWm9uZSwgdXBsb2FkU2VydmljZSkge1xuICAgICAgICBzdXBlcihlbGVtZW50LCByZW5kZXJlciwgJ2stZHJvcHpvbmUtaG92ZXInKTtcbiAgICAgICAgdGhpcy5uZ1pvbmUgPSBuZ1pvbmU7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZSA9IHVwbG9hZFNlcnZpY2U7XG4gICAgICAgIHRoaXMuaW5pdGlhbENsYXNzTmFtZSA9IHRydWU7XG4gICAgICAgIHRoaXMuaGlkZUludGVydmFsRG9jdW1lbnQgPSBudWxsO1xuICAgICAgICB0aGlzLmFjdGl2ZUNsYXNzID0gJ2stZHJvcHpvbmUtYWN0aXZlJztcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy51bnN1YnNjcmliZURvY3VtZW50RHJhZ0VudGVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ2RvY3VtZW50JywgJ2RyYWdlbnRlcicsICgpID0+IHRoaXMub25Eb2N1bWVudERyYWdFbnRlcigpKTtcbiAgICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmVEb2N1bWVudERyYWdPdmVyID0gdGhpcy5yZW5kZXJlci5saXN0ZW4oJ2RvY3VtZW50JywgJ2RyYWdvdmVyJywgKCkgPT4gdGhpcy5vbkRvY3VtZW50RHJhZ092ZXIoKSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgaWYgKHRoaXMudW5zdWJzY3JpYmVEb2N1bWVudERyYWdFbnRlcikge1xuICAgICAgICAgICAgICAgIHRoaXMudW5zdWJzY3JpYmVEb2N1bWVudERyYWdFbnRlcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHRoaXMudW5zdWJzY3JpYmVEb2N1bWVudERyYWdPdmVyKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51bnN1YnNjcmliZURvY3VtZW50RHJhZ092ZXIoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG9uRG9jdW1lbnREcmFnRW50ZXIoKSB7XG4gICAgICAgIHRoaXMuYWRkQ2xhc3ModGhpcy5hY3RpdmVDbGFzcyk7XG4gICAgICAgIHRoaXMubGFzdERyYWdEb2N1bWVudCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIGlmICghdGhpcy5oaWRlSW50ZXJ2YWxEb2N1bWVudCkge1xuICAgICAgICAgICAgdGhpcy5oaWRlSW50ZXJ2YWxEb2N1bWVudCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5jYWxjdWxhdGVUaW1lRGlmZih0aGlzLmxhc3REcmFnRG9jdW1lbnQpIDwgMTAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDbGFzcyh0aGlzLmFjdGl2ZUNsYXNzKTtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMuaGlkZUludGVydmFsRG9jdW1lbnQpO1xuICAgICAgICAgICAgICAgIHRoaXMuaGlkZUludGVydmFsRG9jdW1lbnQgPSBudWxsO1xuICAgICAgICAgICAgfSwgMTAwKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkRvY3VtZW50RHJhZ092ZXIoKSB7XG4gICAgICAgIHRoaXMubGFzdERyYWdEb2N1bWVudCA9IG5ldyBEYXRlKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgb25Ecm9wTGlzdGVuZXIoZXZlbnQpIHtcbiAgICAgICAgbGV0IGRyb3BwZWRGaWxlcyA9IGV2ZW50LmRhdGFUcmFuc2Zlci5maWxlcztcbiAgICAgICAgaWYgKGRyb3BwZWRGaWxlcy5sZW5ndGggPiAwICYmICF0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICBsZXQgZmlsZXMgPSBnZXRBbGxGaWxlSW5mbyhkcm9wcGVkRmlsZXMpO1xuICAgICAgICAgICAgZmlsZXMgPSBhc3NpZ25HdWlkVG9GaWxlcyhmaWxlcywgIXRoaXMudXBsb2FkU2VydmljZS5hc3luYy5iYXRjaCk7XG4gICAgICAgICAgICBpZiAoIXRoaXMubXVsdGlwbGUpIHtcbiAgICAgICAgICAgICAgICBmaWxlcy5zcGxpY2UoMSwgZmlsZXMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmNsZWFyRmlsZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbGlkYXRlRmlsZXMoZmlsZXMsIHRoaXMucmVzdHJpY3Rpb25zKTtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5hZGRGaWxlcyhmaWxlcyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbn1cbkRyb3Bab25lSW50ZXJuYWxEaXJlY3RpdmUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IERpcmVjdGl2ZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogYFxuICAgICAgW2tlbmRvVXBsb2FkSW50ZXJuYWxEcm9wWm9uZV0sXG4gICAgICBba2VuZG9GaWxlU2VsZWN0SW50ZXJuYWxEcm9wWm9uZV1cbiAgICBgXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkRyb3Bab25lSW50ZXJuYWxEaXJlY3RpdmUuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH0sXG4gICAgeyB0eXBlOiBSZW5kZXJlcjIgfSxcbiAgICB7IHR5cGU6IE5nWm9uZSB9LFxuICAgIHsgdHlwZTogVXBsb2FkU2VydmljZSB9XG5dO1xuRHJvcFpvbmVJbnRlcm5hbERpcmVjdGl2ZS5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBkaXNhYmxlZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgbXVsdGlwbGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHJlc3RyaWN0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaW5pdGlhbENsYXNzTmFtZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1kcm9wem9uZScsXSB9XSxcbiAgICBvbkRyb3BMaXN0ZW5lcjogW3sgdHlwZTogSG9zdExpc3RlbmVyLCBhcmdzOiBbJ2Ryb3AnLCBbJyRldmVudCddLF0gfV1cbn07XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jbGFzcyBGaWxlTGlzdEl0ZW1EaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKGVsLCBuYXZpZ2F0aW9uU2VydmljZSwgdXBsb2FkU2VydmljZSkge1xuICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlID0gbmF2aWdhdGlvblNlcnZpY2U7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZSA9IHVwbG9hZFNlcnZpY2U7XG4gICAgICAgIHRoaXMuZmlsZUNsYXNzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5mb2N1c2VkID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGVsO1xuICAgIH1cbiAgICBmb2N1cygpIHtcbiAgICAgICAgdGhpcy5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gICAgZ2V0IHVpZEF0dHJpYnV0ZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsZXNbMF0udWlkO1xuICAgIH1cbiAgICBnZXQgdGFiSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiBcIi0xXCI7XG4gICAgfVxuICAgIGdldCBrRmlsZUVycm9yKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWxlc1swXS5zdGF0ZSA9PT0gRmlsZVN0YXRlLkZhaWxlZDtcbiAgICB9XG4gICAgZ2V0IGtGaWxlSW52YWxpZCgpIHtcbiAgICAgICAgcmV0dXJuIGZpbGVzSGF2ZVZhbGlkYXRpb25FcnJvcnModGhpcy5maWxlcyk7XG4gICAgfVxuICAgIGdldCBrRmlsZVByb2dyZXNzKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWxlc1swXS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlVwbG9hZGluZyB8fFxuICAgICAgICAgICAgdGhpcy5maWxlc1swXS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlBhdXNlZDtcbiAgICB9XG4gICAgZ2V0IGtGaWxlU3VjY2VzcygpIHtcbiAgICAgICAgaWYgKHRoaXMudXBsb2FkU2VydmljZS5jb21wb25lbnQgPT09ICdVcGxvYWQnKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5maWxlc1swXS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlVwbG9hZGVkIHx8XG4gICAgICAgICAgICAgICAgdGhpcy5maWxlc1swXS5zdGF0ZSA9PT0gRmlsZVN0YXRlLkluaXRpYWw7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICBnZXQga1N0YXRlRm9jdXNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZm9jdXNlZDtcbiAgICB9XG4gICAgb25Gb2N1cygpIHtcbiAgICAgICAgdGhpcy5mb2N1c2VkID0gdHJ1ZTtcbiAgICB9XG4gICAgb25CbHVyKCkge1xuICAgICAgICB0aGlzLmZvY3VzZWQgPSBmYWxzZTtcbiAgICB9XG4gICAgb25DbGljayhldmVudCkge1xuICAgICAgICBpZiAoIWlzRm9jdXNhYmxlKGV2ZW50LnRhcmdldCkgJiYgIWhhc0NsYXNzZXMoZXZlbnQudGFyZ2V0LCBJR05PUkVfVEFSR0VUX0NMQVNTRVMpKSB7XG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb25TZXJ2aWNlLmZvY3VzZWRJbmRleCA9IHRoaXMuaW5kZXg7XG4gICAgICAgIH1cbiAgICB9XG59XG5GaWxlTGlzdEl0ZW1EaXJlY3RpdmUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IERpcmVjdGl2ZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ1trZW5kb1VwbG9hZEZpbGVMaXN0SXRlbV0nXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkZpbGVMaXN0SXRlbURpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IEVsZW1lbnRSZWYgfSxcbiAgICB7IHR5cGU6IE5hdmlnYXRpb25TZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBVcGxvYWRTZXJ2aWNlIH1cbl07XG5GaWxlTGlzdEl0ZW1EaXJlY3RpdmUucHJvcERlY29yYXRvcnMgPSB7XG4gICAgZmlsZXM6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGluZGV4OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmaWxlQ2xhc3M6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2NsYXNzLmstZmlsZScsXSB9XSxcbiAgICB1aWRBdHRyaWJ1dGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIuZGF0YS11aWQnLF0gfV0sXG4gICAgdGFiSW5kZXg6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIudGFiSW5kZXgnLF0gfV0sXG4gICAga0ZpbGVFcnJvcjogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1maWxlLWVycm9yJyxdIH1dLFxuICAgIGtGaWxlSW52YWxpZDogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1maWxlLWludmFsaWQnLF0gfV0sXG4gICAga0ZpbGVQcm9ncmVzczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1maWxlLXByb2dyZXNzJyxdIH1dLFxuICAgIGtGaWxlU3VjY2VzczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1maWxlLXN1Y2Nlc3MnLF0gfV0sXG4gICAga1N0YXRlRm9jdXNlZDogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1zdGF0ZS1mb2N1c2VkJyxdIH1dLFxuICAgIG9uRm9jdXM6IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogW1wiZm9jdXNcIixdIH1dLFxuICAgIG9uQmx1cjogW3sgdHlwZTogSG9zdExpc3RlbmVyLCBhcmdzOiBbXCJibHVyXCIsXSB9XSxcbiAgICBvbkNsaWNrOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsnY2xpY2snLCBbJyRldmVudCddLF0gfV1cbn07XG5cbi8qIHRzbGludDpkaXNhYmxlOmNvbXBvbmVudC1zZWxlY3RvciAqL1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIEZpbGVMaXN0Q29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcih1cGxvYWRTZXJ2aWNlLCBuYXZpZ2F0aW9uKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZSA9IHVwbG9hZFNlcnZpY2U7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG5hdmlnYXRpb247XG4gICAgICAgIHRoaXMub25JdGVtRm9jdXMoKTtcbiAgICAgICAgdGhpcy5vbkl0ZW1BY3Rpb24oKTtcbiAgICB9XG4gICAgb25JdGVtRm9jdXMoKSB7XG4gICAgICAgIHRoaXMuZm9jdXNTdWJzY3JpcHRpb24gPSB0aGlzLm5hdmlnYXRpb24ub25GaWxlRm9jdXMuc3Vic2NyaWJlKChpbmRleCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWxlTGlzdEl0ZW1zLnRvQXJyYXkoKVtpbmRleF0uZm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG9uSXRlbUFjdGlvbigpIHtcbiAgICAgICAgdGhpcy5hY3Rpb25TdWJzY3JpcHRpb24gPSB0aGlzLm5hdmlnYXRpb24ub25GaWxlQWN0aW9uLnN1YnNjcmliZSgoa2V5KSA9PiB7XG4gICAgICAgICAgICB0aGlzLml0ZW1BY3Rpb25IYW5kbGVyKGtleSk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBpdGVtQWN0aW9uSGFuZGxlcihrZXkpIHtcbiAgICAgICAgbGV0IGluZGV4ID0gdGhpcy5uYXZpZ2F0aW9uLmZvY3VzZWRJbmRleDtcbiAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLmZpbGVMaXN0SXRlbXMudG9BcnJheSgpW2luZGV4XTtcbiAgICAgICAgbGV0IHVpZCA9IGl0ZW0udWlkQXR0cmlidXRlO1xuICAgICAgICBsZXQgZmlsZXMgPSB0aGlzLnVwbG9hZFNlcnZpY2UuZmlsZXMuZ2V0KHVpZCk7XG4gICAgICAgIGlmIChrZXkgPT09IEtleXMuRXNjYXBlICYmIGZpbGVzWzBdLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuY2FuY2VsRmlsZXModWlkKTtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5mb2N1c1NlbGVjdEJ1dHRvbigpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChrZXkgPT09IEtleXMuRW50ZXIgJiYgZmlsZXNbMF0uc3RhdGUgPT09IEZpbGVTdGF0ZS5GYWlsZWQpIHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5yZXRyeUZpbGVzKHVpZCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGtleSA9PT0gS2V5cy5EZWxldGUpIHtcbiAgICAgICAgICAgIGlmIChmaWxlc1swXS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlVwbG9hZGluZykge1xuICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5jYW5jZWxGaWxlcyh1aWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5oYXNEZWxldGUoaXRlbSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UucmVtb3ZlRmlsZXModWlkKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5mb2N1c1NlbGVjdEJ1dHRvbigpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGhhc0RlbGV0ZShpdGVtKSB7XG4gICAgICAgIHJldHVybiBpdGVtLmVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdrLWRlbGV0ZScpLmxlbmd0aCA+IDA7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICB0aGlzLmZvY3VzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHRoaXMuYWN0aW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgfVxufVxuRmlsZUxpc3RDb21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ1trZW5kby11cGxvYWQtZmlsZS1saXN0XScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICA8bmctdGVtcGxhdGUgbmdGb3JcbiAgICAgIFtuZ0Zvck9mXT1cImZpbGVMaXN0XCJcbiAgICAgIGxldC1maWxlc1xuICAgICAgbGV0LWluZGV4PVwiaW5kZXhcIj5cbiAgICAgIDxsaSBrZW5kb1VwbG9hZEZpbGVMaXN0SXRlbSBbZmlsZXNdPSdmaWxlcycgW2luZGV4XT0naW5kZXgnPlxuICAgICAgICAgIDxrZW5kby11cGxvYWQtZmlsZS1saXN0LXNpbmdsZS1pdGVtXG4gICAgICAgICAgICBjbGFzcz0nay1maWxlLXNpbmdsZSdcbiAgICAgICAgICAgICpuZ0lmPSdmaWxlcy5sZW5ndGggPT09IDEgJiYgIWZpbGVUZW1wbGF0ZSdcbiAgICAgICAgICAgIFtkaXNhYmxlZF09J2Rpc2FibGVkJ1xuICAgICAgICAgICAgW2ZpbGVdPSdmaWxlc1swXSc+XG4gICAgICAgICAgPC9rZW5kby11cGxvYWQtZmlsZS1saXN0LXNpbmdsZS1pdGVtPlxuICAgICAgICAgIDxrZW5kby11cGxvYWQtZmlsZS1saXN0LW11bHRpcGxlLWl0ZW1zXG4gICAgICAgICAgICBjbGFzcz0nay1maWxlLW11bHRpcGxlJ1xuICAgICAgICAgICAgKm5nSWY9J2ZpbGVzLmxlbmd0aCA+IDEgJiYgIWZpbGVUZW1wbGF0ZSdcbiAgICAgICAgICAgIFtkaXNhYmxlZF09J2Rpc2FibGVkJ1xuICAgICAgICAgICAgW2ZpbGVzXT0nZmlsZXMnPlxuICAgICAgICAgIDwva2VuZG8tdXBsb2FkLWZpbGUtbGlzdC1tdWx0aXBsZS1pdGVtcz5cbiAgICAgICAgICA8bmctdGVtcGxhdGUgKm5nSWY9XCJmaWxlVGVtcGxhdGVcIlxuICAgICAgICAgICAgICBbdGVtcGxhdGVDb250ZXh0XT1cIntcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVJlZjogZmlsZVRlbXBsYXRlLnRlbXBsYXRlUmVmLFxuICAgICAgICAgICAgICAgIHN0YXRlOiBmaWxlc1swXS5zdGF0ZSxcbiAgICAgICAgICAgICAgICAkaW1wbGljaXQ6IGZpbGVzXG4gICAgICAgICAgICAgIH1cIj48L25nLXRlbXBsYXRlPlxuICAgICAgPC9saT5cbiAgICA8L25nLXRlbXBsYXRlPlxuICAgIGBcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuRmlsZUxpc3RDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBVcGxvYWRTZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBOYXZpZ2F0aW9uU2VydmljZSB9XG5dO1xuRmlsZUxpc3RDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgZGlzYWJsZWQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGZpbGVMaXN0OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmaWxlVGVtcGxhdGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGZpbGVMaXN0SXRlbXM6IFt7IHR5cGU6IFZpZXdDaGlsZHJlbiwgYXJnczogW0ZpbGVMaXN0SXRlbURpcmVjdGl2ZSxdIH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgRmlsZUxpc3RJdGVtQWN0aW9uQnV0dG9uQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcih1cGxvYWRTZXJ2aWNlLCBsb2NhbGl6YXRpb24pIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlID0gdXBsb2FkU2VydmljZTtcbiAgICAgICAgdGhpcy5sb2NhbGl6YXRpb24gPSBsb2NhbGl6YXRpb247XG4gICAgICAgIHRoaXMuYWN0aW9uRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnJldHJ5Rm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLnBhdXNlUmVzdW1lRm9jdXNlZCA9IGZhbHNlO1xuICAgIH1cbiAgICBvbkZvY3VzKHR5cGUpIHtcbiAgICAgICAgaWYgKHR5cGUgPT09ICdhY3Rpb24nKSB7XG4gICAgICAgICAgICB0aGlzLmFjdGlvbkZvY3VzZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlID09PSAncmV0cnknKSB7XG4gICAgICAgICAgICB0aGlzLnJldHJ5Rm9jdXNlZCA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGUgPT09ICdwYXVzZVJlc3VtZScpIHtcbiAgICAgICAgICAgIHRoaXMucGF1c2VSZXN1bWVGb2N1c2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBvbkJsdXIodHlwZSkge1xuICAgICAgICBpZiAodHlwZSA9PT0gJ3JldHJ5Jykge1xuICAgICAgICAgICAgdGhpcy5yZXRyeUZvY3VzZWQgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZSA9PT0gJ2FjdGlvbicpIHtcbiAgICAgICAgICAgIHRoaXMuYWN0aW9uRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlID09PSAncGF1c2VSZXN1bWUnKSB7XG4gICAgICAgICAgICB0aGlzLnBhdXNlUmVzdW1lRm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uUmV0cnlDbGljaygpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UucmV0cnlGaWxlcyh0aGlzLmZpbGUudWlkKTtcbiAgICB9XG4gICAgb25SZW1vdmVDYW5jZWxDbGljaygpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1aWQgPSB0aGlzLmZpbGUudWlkO1xuICAgICAgICBpZiAodGhpcy5maWxlLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuY2FuY2VsRmlsZXModWlkKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5yZW1vdmVGaWxlcyh1aWQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIG9uUGF1c2VSZXN1bWVDbGljaygpIHtcbiAgICAgICAgaWYgKHRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCB1aWQgPSB0aGlzLmZpbGUudWlkO1xuICAgICAgICBpZiAodGhpcy5maWxlLnN0YXRlID09PSBGaWxlU3RhdGUuUGF1c2VkKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UucmVzdW1lRmlsZSh1aWQpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLnBhdXNlRmlsZSh1aWQpO1xuICAgICAgICB9XG4gICAgfVxuICAgIGdldCBhY3Rpb25CdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlVwbG9hZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldCgnY2FuY2VsJyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldCgncmVtb3ZlJyk7XG4gICAgfVxuICAgIGdldCByZXRyeUJ1dHRvblRpdGxlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdyZXRyeScpO1xuICAgIH1cbiAgICBnZXQgcGF1c2VSZXN1bWVCdXR0b25UaXRsZSgpIHtcbiAgICAgICAgaWYgKHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlVwbG9hZGluZykge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldCgncGF1c2UnKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KCdyZXN1bWUnKTtcbiAgICB9XG4gICAgZ2V0IGlzVXBsb2FkaW5nKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWxlLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkaW5nO1xuICAgIH1cbiAgICBnZXQgaXNGYWlsZWQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbGUuc3RhdGUgPT09IEZpbGVTdGF0ZS5GYWlsZWQ7XG4gICAgfVxuICAgIGdldCBpc1BhdXNlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlBhdXNlZDtcbiAgICB9XG4gICAgZ2V0IGlzUmVzdW1hYmxlKCkge1xuICAgICAgICBjb25zdCBzZXJ2aWNlID0gdGhpcy51cGxvYWRTZXJ2aWNlO1xuICAgICAgICBjb25zdCBpc1Jlc3VtYWJsZSA9IHNlcnZpY2UuYXN5bmMuY2h1bmsgJiYgc2VydmljZS5jaHVuay5yZXN1bWFibGU7XG4gICAgICAgIGNvbnN0IGlzVXBsb2FkaW5nID0gKHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlBhdXNlZCkgfHwgKHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlVwbG9hZGluZyk7XG4gICAgICAgIHJldHVybiBpc1Jlc3VtYWJsZSAmJiBpc1VwbG9hZGluZztcbiAgICB9XG4gICAgZ2V0IGlzQWN0aW9uQnV0dG9uVmlzaWJsZSgpIHtcbiAgICAgICAgaWYgKCh0aGlzLmZpbGUuc3RhdGUgPT09IEZpbGVTdGF0ZS5VcGxvYWRlZCB8fCB0aGlzLmZpbGUuc3RhdGUgPT09IEZpbGVTdGF0ZS5Jbml0aWFsKSAmJlxuICAgICAgICAgICAgIXRoaXMudXBsb2FkU2VydmljZS5hc3luYy5yZW1vdmVVcmwgJiYgdGhpcy51cGxvYWRTZXJ2aWNlLmNvbXBvbmVudCA9PT0gJ1VwbG9hZCcpIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG59XG5GaWxlTGlzdEl0ZW1BY3Rpb25CdXR0b25Db21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXVwbG9hZC1maWxlLWxpc3QtaXRlbS1hY3Rpb24tYnV0dG9uJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogYFxuICAgICAgPHN0cm9uZyBjbGFzcz1cImstdXBsb2FkLXN0YXR1c1wiPlxuICAgICAgICA8c3BhbiBjbGFzcz1cImstdXBsb2FkLXBjdFwiICpuZ0lmPVwiaXNVcGxvYWRpbmcgfHwgaXNQYXVzZWRcIj57e3Byb2dyZXNzfX0lPC9zcGFuPlxuXG4gICAgICAgIDxidXR0b24gdHlwZT1cImJ1dHRvblwiICpuZ0lmPVwiaXNGYWlsZWRcIiBjbGFzcz1cImstYnV0dG9uIGstYnV0dG9uLWljb24gay1mbGF0IGstdXBsb2FkLWFjdGlvblwiXG4gICAgICAgICAgW25nQ2xhc3NdPVwieyAnay1zdGF0ZS1mb2N1c2VkJzogdGhpcy5yZXRyeUZvY3VzZWQgfVwiXG4gICAgICAgICAgW2F0dHIudGFiSW5kZXhdPVwiLTFcIlxuICAgICAgICAgIChmb2N1cyk9XCJvbkZvY3VzKCdyZXRyeScpXCJcbiAgICAgICAgICAoYmx1cik9XCJvbkJsdXIoJ3JldHJ5JylcIlxuICAgICAgICAgIChjbGljayk9XCJvblJldHJ5Q2xpY2soKVwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwiay1pY29uIGstcmV0cnkgay1pLXJlZnJlc2gtc21cIlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09XCJyZXRyeUJ1dHRvblRpdGxlXCJcbiAgICAgICAgICAgIFthdHRyLnRpdGxlXT1cInJldHJ5QnV0dG9uVGl0bGVcIj5cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvYnV0dG9uPlxuXG4gICAgICAgIDxidXR0b24gKm5nSWY9XCJpc1Jlc3VtYWJsZVwiIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImstYnV0dG9uIGstYnV0dG9uLWljb24gay1mbGF0IGstdXBsb2FkLWFjdGlvblwiXG4gICAgICAgICAgW25nQ2xhc3NdPVwieyAnay1zdGF0ZS1mb2N1c2VkJzogdGhpcy5wYXVzZVJlc3VtZUZvY3VzZWQgfVwiXG4gICAgICAgICAgW2F0dHIudGFiSW5kZXhdPVwiLTFcIlxuICAgICAgICAgIChmb2N1cyk9XCJvbkZvY3VzKCdwYXVzZVJlc3VtZScpXCJcbiAgICAgICAgICAoYmx1cik9XCJvbkJsdXIoJ3BhdXNlUmVzdW1lJylcIlxuICAgICAgICAgIChjbGljayk9XCJvblBhdXNlUmVzdW1lQ2xpY2soKVwiPlxuICAgICAgICAgIDxzcGFuIGNsYXNzPVwiay1pY29uXCJcbiAgICAgICAgICAgIFtuZ0NsYXNzXT1cIntcbiAgICAgICAgICAgICAgJ2staS1wbGF5LXNtJzogaXNQYXVzZWQsXG4gICAgICAgICAgICAgICdrLWktcGF1c2Utc20nOiAhaXNQYXVzZWRcbiAgICAgICAgICAgIH1cIlxuICAgICAgICAgICAgW2F0dHIuYXJpYS1sYWJlbF09J3BhdXNlUmVzdW1lQnV0dG9uVGl0bGUnXG4gICAgICAgICAgICBbYXR0ci50aXRsZV09J3BhdXNlUmVzdW1lQnV0dG9uVGl0bGUnPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgPC9idXR0b24+XG5cbiAgICAgICAgPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgKm5nSWY9XCJpc0FjdGlvbkJ1dHRvblZpc2libGVcIiBjbGFzcz1cImstYnV0dG9uIGstYnV0dG9uLWljb24gay1mbGF0IGstdXBsb2FkLWFjdGlvblwiXG4gICAgICAgICAgW25nQ2xhc3NdPVwieyAnay1zdGF0ZS1mb2N1c2VkJzogdGhpcy5hY3Rpb25Gb2N1c2VkIH1cIlxuICAgICAgICAgIFthdHRyLnRhYkluZGV4XT1cIi0xXCJcbiAgICAgICAgICAoZm9jdXMpPVwib25Gb2N1cygnYWN0aW9uJylcIlxuICAgICAgICAgIChibHVyKT1cIm9uQmx1cignYWN0aW9uJylcIlxuICAgICAgICAgIChjbGljayk9XCJvblJlbW92ZUNhbmNlbENsaWNrKClcIj5cbiAgICAgICAgICA8c3BhbiBjbGFzcz1cImstaWNvblwiXG4gICAgICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAgICdrLWktY2FuY2VsJzogaXNVcGxvYWRpbmcsXG4gICAgICAgICAgICAgICdrLWRlbGV0ZSBrLWkteCc6ICFpc1VwbG9hZGluZ1xuICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT0nYWN0aW9uQnV0dG9uVGl0bGUnXG4gICAgICAgICAgICBbYXR0ci50aXRsZV09J2FjdGlvbkJ1dHRvblRpdGxlJz5cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgPC9zdHJvbmc+XG4gICAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5GaWxlTGlzdEl0ZW1BY3Rpb25CdXR0b25Db21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBVcGxvYWRTZXJ2aWNlIH0sXG4gICAgeyB0eXBlOiBMb2NhbGl6YXRpb25TZXJ2aWNlIH1cbl07XG5GaWxlTGlzdEl0ZW1BY3Rpb25CdXR0b25Db21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgZmlsZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZGlzYWJsZWQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHByb2dyZXNzOiBbeyB0eXBlOiBJbnB1dCB9XVxufTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIEZpbGVMaXN0SXRlbUJhc2Uge1xuICAgIGNvbnN0cnVjdG9yKHVwbG9hZFNlcnZpY2UpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlID0gdXBsb2FkU2VydmljZTtcbiAgICAgICAgdGhpcy5wcm9ncmVzc0NvbXBsZXRlID0gMDtcbiAgICB9XG4gICAgc3Vic2NyaWJlVXBsb2FkUHJvZ3Jlc3ModXBsb2FkUHJvZ3Jlc3NIYW5kbGVyKSB7XG4gICAgICAgIHRoaXMudXBsb2FkUHJvZ3Jlc3NTdWJzY3JpcHRpb24gPSB0aGlzLnVwbG9hZFNlcnZpY2UudXBsb2FkUHJvZ3Jlc3NFdmVudC5zdWJzY3JpYmUodXBsb2FkUHJvZ3Jlc3NIYW5kbGVyKTtcbiAgICB9XG4gICAgZmlsZUhhc1ZhbGlkYXRpb25FcnJvcnMoZmlsZSkge1xuICAgICAgICByZXR1cm4gZmlsZUhhc1ZhbGlkYXRpb25FcnJvcnMoZmlsZSk7XG4gICAgfVxuICAgIGZpbGVzSGF2ZVZhbGlkYXRpb25FcnJvcnMoZmlsZXMpIHtcbiAgICAgICAgcmV0dXJuIGZpbGVzSGF2ZVZhbGlkYXRpb25FcnJvcnMoZmlsZXMpO1xuICAgIH1cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy51cGxvYWRQcm9ncmVzc1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgIH1cbiAgICBnZXRGaWxlVmFsaWRhdGlvbk1lc3NhZ2UoZmlsZSkge1xuICAgICAgICBsZXQgdmFsaWRhdGlvbk1lc3NhZ2U7XG4gICAgICAgIGlmIChmaWxlLnZhbGlkYXRpb25FcnJvcnMgJiYgZmlsZS52YWxpZGF0aW9uRXJyb3JzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHZhbGlkYXRpb25NZXNzYWdlID0gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KGZpbGUudmFsaWRhdGlvbkVycm9yc1swXSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHZhbGlkYXRpb25NZXNzYWdlO1xuICAgIH1cbiAgICBnZXRUb3RhbEZpbGVzU2l6ZU1lc3NhZ2UoZmlsZXMpIHtcbiAgICAgICAgcmV0dXJuIGdldFRvdGFsRmlsZXNTaXplTWVzc2FnZShmaWxlcyk7XG4gICAgfVxuICAgIHRleHRGb3Ioa2V5KSB7XG4gICAgICAgIHJldHVybiB0aGlzLmxvY2FsaXphdGlvbi5nZXQoa2V5KTtcbiAgICB9XG59XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jbGFzcyBGaWxlTGlzdE11bHRpcGxlSXRlbXNDb21wb25lbnQgZXh0ZW5kcyBGaWxlTGlzdEl0ZW1CYXNlIHtcbiAgICBjb25zdHJ1Y3Rvcihsb2NhbGl6YXRpb24sIHVwbG9hZFNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIodXBsb2FkU2VydmljZSk7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uID0gbG9jYWxpemF0aW9uO1xuICAgICAgICB0aGlzLnN1YnNjcmliZVVwbG9hZFByb2dyZXNzKChhcmdzKSA9PiB7XG4gICAgICAgICAgICBpZiAoYXJncy5maWxlc1swXS51aWQgPT09IHRoaXMuZmlsZXNbMF0udWlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0NvbXBsZXRlID0gYXJncy5wZXJjZW50Q29tcGxldGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgc2hvd1Byb2dyZXNzKCkge1xuICAgICAgICBjb25zdCBzaG93UHJvZ3Jlc3MgPSB0aGlzLmZpbGVzWzBdLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkaW5nIHx8IHRoaXMuZmlsZXNbMF0uc3RhdGUgPT09IEZpbGVTdGF0ZS5QYXVzZWQ7XG4gICAgICAgIHJldHVybiBzaG93UHJvZ3Jlc3MgPyAnYWN0aXZlJyA6ICdpbmFjdGl2ZSc7XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmZpbGVzSGF2ZUVycm9ycyA9IHN1cGVyLmZpbGVzSGF2ZVZhbGlkYXRpb25FcnJvcnModGhpcy5maWxlcyk7XG4gICAgfVxuICAgIGZpbGVTdGF0dXNUZXh0KGZpbGUpIHtcbiAgICAgICAgY29uc3QgZXJyb3JzID0gZmlsZS52YWxpZGF0aW9uRXJyb3JzO1xuICAgICAgICBpZiAoIWlzUHJlc2VudChlcnJvcnMpKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5nZXRUb3RhbEZpbGVzU2l6ZU1lc3NhZ2UoW2ZpbGVdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWxlVmFsaWRhdGlvbk1lc3NhZ2UoZmlsZSk7XG4gICAgfVxuICAgIGdldCBiYXRjaFN0YXR1c1RleHQoKSB7XG4gICAgICAgIGNvbnN0IHN0YXRlJCQxID0gdGhpcy5maWxlc1swXS5zdGF0ZTtcbiAgICAgICAgY29uc3QgZmlsZUNvdW50ID0gdGhpcy5maWxlcy5sZW5ndGg7XG4gICAgICAgIGlmIChzdGF0ZSQkMSA9PT0gRmlsZVN0YXRlLlVwbG9hZGVkKSB7XG4gICAgICAgICAgICByZXR1cm4gYCR7ZmlsZUNvdW50fSAke3RoaXMudGV4dEZvcignZmlsZXNCYXRjaFN0YXR1c1VwbG9hZGVkJyl9YDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc3RhdGUkJDEgPT09IEZpbGVTdGF0ZS5GYWlsZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBgJHtmaWxlQ291bnR9ICR7dGhpcy50ZXh0Rm9yKCdmaWxlc0JhdGNoU3RhdHVzRmFpbGVkJyl9YDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gYCR7ZmlsZUNvdW50fSAke3RoaXMudGV4dEZvcignZmlsZXNCYXRjaFN0YXR1cycpfWA7XG4gICAgfVxuICAgIGdldCBpc1VwbG9hZFN1Y2Nlc3NmdWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbGVzWzBdLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkZWQ7XG4gICAgfVxuICAgIGdldCBpc1VwbG9hZEZhaWxlZCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZmlsZXNbMF0uc3RhdGUgPT09IEZpbGVTdGF0ZS5GYWlsZWQ7XG4gICAgfVxufVxuRmlsZUxpc3RNdWx0aXBsZUl0ZW1zQ29tcG9uZW50LmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBDb21wb25lbnQsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgYW5pbWF0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICB0cmlnZ2VyKCdwcm9ncmVzc1N0YXRlJywgW1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdGUoJ2FjdGl2ZScsIHN0eWxlKHsgb3BhY2l0eTogMSB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSgnaW5hY3RpdmUnLCBzdHlsZSh7IG9wYWNpdHk6IDAgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiBhY3RpdmUnLCBzdHlsZSh7IG9wYWNpdHk6IDAgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbignaW5hY3RpdmUgPT4gYWN0aXZlJywgc3R5bGUoeyBvcGFjaXR5OiAxIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb24oJ2FjdGl2ZSA9PiBpbmFjdGl2ZScsIGFuaW1hdGUoJzFzIDJzIGVhc2Utb3V0JykpXG4gICAgICAgICAgICAgICAgICAgIF0pXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXVwbG9hZC1maWxlLWxpc3QtbXVsdGlwbGUtaXRlbXMnLFxuICAgICAgICAgICAgICAgIHRlbXBsYXRlOiBgXG4gICAgICA8ZGl2IGNsYXNzPVwiay1wcm9ncmVzc2JhclwiIFtAcHJvZ3Jlc3NTdGF0ZV09XCJzaG93UHJvZ3Jlc3NcIj5cbiAgICAgICAgPHNwYW4gY2xhc3M9XCJrLXByb2dyZXNzXCIgW3N0eWxlLndpZHRoXT1cInByb2dyZXNzQ29tcGxldGUgKyAnJSdcIj48L3NwYW4+XG4gICAgICA8L2Rpdj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiay1tdWx0aXBsZS1maWxlcy1ncm91cC13cmFwcGVyXCI+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiay1maWxlLWdyb3VwIGstaWNvbiBrLWktY29weVwiPjwvc3Bhbj5cbiAgICAgIDwvc3Bhbj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiay1tdWx0aXBsZS1maWxlcy13cmFwcGVyXCI+XG4gICAgICAgIDxzcGFuICpuZ0Zvcj1cImxldCBmaWxlIG9mIGZpbGVzXCIgY2xhc3M9XCJrLWZpbGUtbmFtZS1zaXplLXdyYXBwZXJcIj5cbiAgICAgICAgICAgIDxzcGFuIFt0aXRsZV09XCJmaWxlLm5hbWVcIiBjbGFzcz1cImstZmlsZS1uYW1lXCI+XG4gICAgICAgICAgICAgICAge3tmaWxlLm5hbWV9fVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgPHNwYW4gW25nQ2xhc3NdPVwie1xuICAgICAgICAgICAgICAgICAgICAnay10ZXh0LWVycm9yJzogZmlsZS52YWxpZGF0aW9uRXJyb3JzLFxuICAgICAgICAgICAgICAgICAgICAnay1maWxlLXZhbGlkYXRpb24tbWVzc2FnZSc6IGZpbGUudmFsaWRhdGlvbkVycm9ycyxcbiAgICAgICAgICAgICAgICAgICAgJ2stZmlsZS1zaXplJzogIWZpbGUudmFsaWRhdGlvbkVycm9yc1xuICAgICAgICAgICAgICAgICAgfVwiXG4gICAgICAgICAgICA+e3tmaWxlU3RhdHVzVGV4dChmaWxlKX19PC9zcGFuPlxuICAgICAgICA8L3NwYW4+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiay1maWxlLWluZm9ybWF0aW9uXCJcbiAgICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAnay10ZXh0LXN1Y2Nlc3MnOiBpc1VwbG9hZFN1Y2Nlc3NmdWwsXG4gICAgICAgICAgICAnay10ZXh0LWVycm9yJzogaXNVcGxvYWRGYWlsZWRcbiAgICAgICAgICB9XCJcbiAgICAgICAgPnt7YmF0Y2hTdGF0dXNUZXh0fX08L3NwYW4+XG4gICAgICA8L3NwYW4+XG4gICAgICA8a2VuZG8tdXBsb2FkLWZpbGUtbGlzdC1pdGVtLWFjdGlvbi1idXR0b25cbiAgICAgICAgW2ZpbGVdPSdmaWxlc1swXSdcbiAgICAgICAgW2Rpc2FibGVkXT0nZGlzYWJsZWQnXG4gICAgICAgIFtwcm9ncmVzc109J3Byb2dyZXNzQ29tcGxldGUnPlxuICAgICAgPC9rZW5kby11cGxvYWQtZmlsZS1saXN0LWl0ZW0tYWN0aW9uLWJ1dHRvbj5cbiAgICBgXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cbkZpbGVMaXN0TXVsdGlwbGVJdGVtc0NvbXBvbmVudC5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IFVwbG9hZFNlcnZpY2UgfVxuXTtcbkZpbGVMaXN0TXVsdGlwbGVJdGVtc0NvbXBvbmVudC5wcm9wRGVjb3JhdG9ycyA9IHtcbiAgICBkaXNhYmxlZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZmlsZXM6IFt7IHR5cGU6IElucHV0IH1dXG59O1xuXG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY2xhc3MgRmlsZUxpc3RTaW5nbGVJdGVtQ29tcG9uZW50IGV4dGVuZHMgRmlsZUxpc3RJdGVtQmFzZSB7XG4gICAgY29uc3RydWN0b3IobG9jYWxpemF0aW9uLCB1cGxvYWRTZXJ2aWNlKSB7XG4gICAgICAgIHN1cGVyKHVwbG9hZFNlcnZpY2UpO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVVcGxvYWRQcm9ncmVzcygoYXJncykgPT4ge1xuICAgICAgICAgICAgaWYgKGFyZ3MuZmlsZXNbMF0udWlkID09PSB0aGlzLmZpbGUudWlkKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5wcm9ncmVzc0NvbXBsZXRlID0gYXJncy5wZXJjZW50Q29tcGxldGU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgZmlsZVN0YXR1c1RleHQoKSB7XG4gICAgICAgIGNvbnN0IGVycm9ycyA9IHRoaXMuZmlsZS52YWxpZGF0aW9uRXJyb3JzO1xuICAgICAgICBpZiAodGhpcy5maWxlLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkZWQpIHtcbiAgICAgICAgICAgIHJldHVybiBgJHt0aGlzLnRleHRGb3IoJ2ZpbGVTdGF0dXNVcGxvYWRlZCcpfWA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLkZhaWxlZCkge1xuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMudGV4dEZvcignZmlsZVN0YXR1c0ZhaWxlZCcpfWA7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFpc1ByZXNlbnQoZXJyb3JzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuZ2V0VG90YWxGaWxlc1NpemVNZXNzYWdlKFt0aGlzLmZpbGVdKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcy5nZXRGaWxlVmFsaWRhdGlvbk1lc3NhZ2UodGhpcy5maWxlKTtcbiAgICB9XG4gICAgZ2V0IHNob3dQcm9ncmVzcygpIHtcbiAgICAgICAgY29uc3Qgc2hvd1Byb2dyZXNzID0gdGhpcy5maWxlLnN0YXRlID09PSBGaWxlU3RhdGUuVXBsb2FkaW5nIHx8IHRoaXMuZmlsZS5zdGF0ZSA9PT0gRmlsZVN0YXRlLlBhdXNlZDtcbiAgICAgICAgcmV0dXJuIHNob3dQcm9ncmVzcyA/ICdhY3RpdmUnIDogJ2luYWN0aXZlJztcbiAgICB9XG4gICAgZ2V0IGZpbGVHcm91cENsYXNzKCkge1xuICAgICAgICByZXR1cm4gZ2V0RmlsZUdyb3VwQ3NzQ2xhc3ModGhpcy5maWxlLmV4dGVuc2lvbiA/IHRoaXMuZmlsZS5leHRlbnNpb24gOiAnJyk7XG4gICAgfVxuICAgIGdldCBpc1VwbG9hZFN1Y2Nlc3NmdWwoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmZpbGUuc3RhdGUgPT09IEZpbGVTdGF0ZS5VcGxvYWRlZDtcbiAgICB9XG4gICAgZ2V0IGlzVXBsb2FkRmFpbGVkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5maWxlLnN0YXRlID09PSBGaWxlU3RhdGUuRmFpbGVkO1xuICAgIH1cbiAgICBnZXQgaXNOb3RZZXRVcGxvYWRlZCgpIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLmlzVXBsb2FkRmFpbGVkICYmICF0aGlzLmlzVXBsb2FkU3VjY2Vzc2Z1bDtcbiAgICB9XG59XG5GaWxlTGlzdFNpbmdsZUl0ZW1Db21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBhbmltYXRpb25zOiBbXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXIoJ3Byb2dyZXNzU3RhdGUnLCBbXG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0ZSgnYWN0aXZlJywgc3R5bGUoeyBvcGFjaXR5OiAxIH0pKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXRlKCdpbmFjdGl2ZScsIHN0eWxlKHsgb3BhY2l0eTogMCB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKCd2b2lkID0+IGFjdGl2ZScsIHN0eWxlKHsgb3BhY2l0eTogMCB9KSksXG4gICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uKCdpbmFjdGl2ZSA9PiBhY3RpdmUnLCBzdHlsZSh7IG9wYWNpdHk6IDEgfSkpLFxuICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbignYWN0aXZlID0+IGluYWN0aXZlJywgYW5pbWF0ZSgnMXMgMnMgZWFzZS1vdXQnKSlcbiAgICAgICAgICAgICAgICAgICAgXSlcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAna2VuZG8tdXBsb2FkLWZpbGUtbGlzdC1zaW5nbGUtaXRlbScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgIDxkaXYgY2xhc3M9XCJrLXByb2dyZXNzYmFyXCIgW0Bwcm9ncmVzc1N0YXRlXT1cInNob3dQcm9ncmVzc1wiPlxuICAgICAgICA8c3BhbiBjbGFzcz1cImstcHJvZ3Jlc3NcIiBbc3R5bGUud2lkdGhdPVwicHJvZ3Jlc3NDb21wbGV0ZSArICclJ1wiPjwvc3Bhbj5cbiAgICAgIDwvZGl2PlxuICAgICAgPHNwYW4gY2xhc3M9XCJrLWZpbGUtZ3JvdXAtd3JhcHBlclwiPlxuICAgICAgICA8c3BhbiBjbGFzcz1cImstZmlsZS1ncm91cCBrLWljb25cIiBbbmdDbGFzc109XCJmaWxlR3JvdXBDbGFzc1wiPjwvc3Bhbj5cbiAgICAgIDwvc3Bhbj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiay1maWxlLW5hbWUtc2l6ZS13cmFwcGVyXCI+XG4gICAgICAgIDxzcGFuIGNsYXNzPVwiay1maWxlLW5hbWVcIiBbdGl0bGVdPVwiZmlsZS5uYW1lXCI+e3sgZmlsZS5uYW1lIH19PC9zcGFuPlxuICAgICAgICA8c3BhbiBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAgICAgJ2stZmlsZS12YWxpZGF0aW9uLW1lc3NhZ2UnOiBmaWxlLnZhbGlkYXRpb25FcnJvcnMsXG4gICAgICAgICAgICAgICAgJ2stZmlsZS1zaXplJzogIWZpbGUudmFsaWRhdGlvbkVycm9ycyAmJiBpc05vdFlldFVwbG9hZGVkLFxuICAgICAgICAgICAgICAgICdrLXRleHQtc3VjY2Vzcyc6IGlzVXBsb2FkU3VjY2Vzc2Z1bCxcbiAgICAgICAgICAgICAgICAnay10ZXh0LWVycm9yJzogZmlsZS52YWxpZGF0aW9uRXJyb3JzIHx8IGlzVXBsb2FkRmFpbGVkLFxuICAgICAgICAgICAgICAgICdrLWZpbGUtaW5mb3JtYXRpb24nOiBpc1VwbG9hZFN1Y2Nlc3NmdWwgfHwgaXNVcGxvYWRGYWlsZWRcbiAgICAgICAgICAgICAgfVwiXG4gICAgICAgID57e2ZpbGVTdGF0dXNUZXh0fX08L3NwYW4+XG4gICAgICA8L3NwYW4+XG4gICAgICA8a2VuZG8tdXBsb2FkLWZpbGUtbGlzdC1pdGVtLWFjdGlvbi1idXR0b25cbiAgICAgICAgW2ZpbGVdPSdmaWxlJ1xuICAgICAgICBbZGlzYWJsZWRdPSdkaXNhYmxlZCdcbiAgICAgICAgW3Byb2dyZXNzXT0ncHJvZ3Jlc3NDb21wbGV0ZSc+XG4gICAgICA8L2tlbmRvLXVwbG9hZC1maWxlLWxpc3QtaXRlbS1hY3Rpb24tYnV0dG9uPlxuICAgIGBcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuRmlsZUxpc3RTaW5nbGVJdGVtQ29tcG9uZW50LmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogTG9jYWxpemF0aW9uU2VydmljZSB9LFxuICAgIHsgdHlwZTogVXBsb2FkU2VydmljZSB9XG5dO1xuRmlsZUxpc3RTaW5nbGVJdGVtQ29tcG9uZW50LnByb3BEZWNvcmF0b3JzID0ge1xuICAgIGRpc2FibGVkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBmaWxlOiBbeyB0eXBlOiBJbnB1dCB9XVxufTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIEZpbGVTZWxlY3REaXJlY3RpdmUge1xuICAgIGNvbnN0cnVjdG9yKHVwbG9hZFNlcnZpY2UsIG5hdmlnYXRpb24sIGVsKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZSA9IHVwbG9hZFNlcnZpY2U7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbiA9IG5hdmlnYXRpb247XG4gICAgICAgIHRoaXMudHlwZSA9IFwiZmlsZVwiO1xuICAgICAgICB0aGlzLmF1dG9jb21wbGV0ZSA9IFwib2ZmXCI7XG4gICAgICAgIHRoaXMudGFiSW5kZXggPSAtMTtcbiAgICAgICAgdGhpcy5lbGVtZW50ID0gZWw7XG4gICAgfVxuICAgIGdldCBuYW1lQXR0cmlidXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnNhdmVGaWVsZDtcbiAgICB9XG4gICAgZ2V0IG11bHRpcGxlQXR0cmlidXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5tdWx0aXBsZSA/IFwibXVsdGlwbGVcIiA6IG51bGw7XG4gICAgfVxuICAgIGdldCBkaXJBdHRyaWJ1dGUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpcjtcbiAgICB9XG4gICAgZ2V0IGRpc2FibGVkQXR0cmlidXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXNhYmxlZCA/IFwidHJ1ZVwiIDogbnVsbDtcbiAgICB9XG4gICAgb25JbnB1dENoYW5nZShldmVudCkge1xuICAgICAgICBjb25zdCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG4gICAgICAgIGNvbnN0IGNocm9tZSA9IC8oY2hyb21lKVsgXFwvXShbXFx3Ll0rKS9pO1xuICAgICAgICBjb25zdCBzYWZhcmkgPSAvKHdlYmtpdClbIFxcL10oW1xcdy5dKykvaTtcbiAgICAgICAgbGV0IHNlbGVjdGVkRmlsZXMgPSBpbnB1dEZpbGVzKGV2ZW50LnRhcmdldCk7XG4gICAgICAgIHNlbGVjdGVkRmlsZXMgPSBhc3NpZ25HdWlkVG9GaWxlcyhzZWxlY3RlZEZpbGVzLCAhdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLmJhdGNoKTtcbiAgICAgICAgdmFsaWRhdGVGaWxlcyhzZWxlY3RlZEZpbGVzLCB0aGlzLnJlc3RyaWN0aW9ucyk7XG4gICAgICAgIGlmICghdGhpcy5tdWx0aXBsZSkge1xuICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmNsZWFyRmlsZXMoKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYWRkRmlsZXMoc2VsZWN0ZWRGaWxlcyk7XG4gICAgICAgIC8qXG4gICAgICAgIENocm9tZSBhbmQgSW50ZXJuZXQgRXhwbG9yZXIgZG8gbm90IHRyaWdnZXIgYSBgY2hhbmdlYCBldmVudFxuICAgICAgICB3aGVuIGEgZmlsZSB3aXRoIHRoZSBzYW1lIG5hbWUgaXMgc2VsZWN0ZWQgYSBudW1iZXIgb2YgY29uc2VjdXRpdmUgdGltZXMuXG4gICAgICAgIEFzIGEgd29ya2Fyb3VuZCwgY2xlYXIgdGhlIGlucHV0IHZhbHVlIGFmdGVyIGhhbmRsaW5nIHRoZSBmaWxlLlxuICAgICAgICAqL1xuICAgICAgICBjb25zdCBuYXRpdmUgPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICAgICAgaWYgKCEoIXVhLm1hdGNoKGNocm9tZSkgJiYgdWEubWF0Y2goc2FmYXJpKSkpIHtcbiAgICAgICAgICAgIG5hdGl2ZS50eXBlID0gXCJcIjtcbiAgICAgICAgICAgIG5hdGl2ZS50eXBlID0gXCJmaWxlXCI7XG4gICAgICAgIH1cbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm5hdmlnYXRpb24uZm9jdXNlZEluZGV4ID0gLTE7XG4gICAgICAgIH0pO1xuICAgIH1cbn1cbkZpbGVTZWxlY3REaXJlY3RpdmUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IERpcmVjdGl2ZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ1trZW5kb0ZpbGVTZWxlY3RdJ1xuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5GaWxlU2VsZWN0RGlyZWN0aXZlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogVXBsb2FkU2VydmljZSB9LFxuICAgIHsgdHlwZTogTmF2aWdhdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IEVsZW1lbnRSZWYgfVxuXTtcbkZpbGVTZWxlY3REaXJlY3RpdmUucHJvcERlY29yYXRvcnMgPSB7XG4gICAgZGlyOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBkaXNhYmxlZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgbXVsdGlwbGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHJlc3RyaWN0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgdHlwZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFtcImF0dHIudHlwZVwiLF0gfV0sXG4gICAgYXV0b2NvbXBsZXRlOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogW1wiYXR0ci5hdXRvY29tcGxldGVcIixdIH1dLFxuICAgIHRhYkluZGV4OiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogW1wiYXR0ci50YWJpbmRleFwiLF0gfV0sXG4gICAgbmFtZUF0dHJpYnV0ZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFtcImF0dHIubmFtZVwiLF0gfV0sXG4gICAgbXVsdGlwbGVBdHRyaWJ1dGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbXCJhdHRyLm11bHRpcGxlXCIsXSB9XSxcbiAgICBkaXJBdHRyaWJ1dGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbXCJhdHRyLmRpclwiLF0gfV0sXG4gICAgZGlzYWJsZWRBdHRyaWJ1dGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbXCJhdHRyLmRpc2FibGVkXCIsXSB9XSxcbiAgICBvbklucHV0Q2hhbmdlOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFtcImNoYW5nZVwiLCBbXCIkZXZlbnRcIl0sXSB9XVxufTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlIGV4dGVuZHMgTWVzc2FnZXMge1xuICAgIGNvbnN0cnVjdG9yKHNlcnZpY2UpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gc2VydmljZTtcbiAgICB9XG59XG5Mb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZS5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogRGlyZWN0aXZlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwcm92aWRlOiBNZXNzYWdlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgIHVzZUV4aXN0aW5nOiBmb3J3YXJkUmVmKCgpID0+IExvY2FsaXplZE1lc3NhZ2VzRGlyZWN0aXZlKSAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLWZvcndhcmQtcmVmXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiBgXG4gICAgW2tlbmRvVXBsb2FkTG9jYWxpemVkTWVzc2FnZXNdLFxuICAgIFtrZW5kb0ZpbGVTZWxlY3RMb2NhbGl6ZWRNZXNzYWdlc10sXG4gICAgW2tlbmRvVXBsb2FkRHJvcFpvbmVMb2NhbGl6ZWRNZXNzYWdlc11cbiAgYFxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5Mb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfVxuXTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIFRlbXBsYXRlQ29udGV4dERpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3Iodmlld0NvbnRhaW5lclJlZikge1xuICAgICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYgPSB2aWV3Q29udGFpbmVyUmVmO1xuICAgIH1cbiAgICBzZXQgdGVtcGxhdGVDb250ZXh0KGNvbnRleHQpIHtcbiAgICAgICAgaWYgKHRoaXMuaW5zZXJ0ZWRWaWV3UmVmKSB7XG4gICAgICAgICAgICB0aGlzLnZpZXdDb250YWluZXJSZWYucmVtb3ZlKHRoaXMudmlld0NvbnRhaW5lclJlZi5pbmRleE9mKHRoaXMuaW5zZXJ0ZWRWaWV3UmVmKSk7XG4gICAgICAgICAgICB0aGlzLmluc2VydGVkVmlld1JlZiA9IHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGV4dC50ZW1wbGF0ZVJlZikge1xuICAgICAgICAgICAgdGhpcy5pbnNlcnRlZFZpZXdSZWYgPSB0aGlzLnZpZXdDb250YWluZXJSZWYuY3JlYXRlRW1iZWRkZWRWaWV3KGNvbnRleHQudGVtcGxhdGVSZWYsIGNvbnRleHQpO1xuICAgICAgICB9XG4gICAgfVxufVxuVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBEaXJlY3RpdmUsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdbdGVtcGxhdGVDb250ZXh0XScgLy8gdHNsaW50OmRpc2FibGUtbGluZTpkaXJlY3RpdmUtc2VsZWN0b3JcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlLmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogVmlld0NvbnRhaW5lclJlZiB9XG5dO1xuVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlLnByb3BEZWNvcmF0b3JzID0ge1xuICAgIHRlbXBsYXRlQ29udGV4dDogW3sgdHlwZTogSW5wdXQgfV1cbn07XG5cbi8qIHRzbGludDpkaXNhYmxlOiBuby11c2UtYmVmb3JlLWRlY2xhcmUgKi9cbi8qKlxuICogQGhpZGRlblxuICovXG5jb25zdCBVUExPQURfVkFMVUVfQUNDRVNTT1IgPSB7XG4gICAgbXVsdGk6IHRydWUsXG4gICAgcHJvdmlkZTogTkdfVkFMVUVfQUNDRVNTT1IsXG4gICAgdXNlRXhpc3Rpbmc6IGZvcndhcmRSZWYoKCkgPT4gVXBsb2FkQ29tcG9uZW50KSAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOm5vLWZvcndhcmQtcmVmXG59O1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbS2VuZG8gVUkgVXBsb2FkIGNvbXBvbmVudCBmb3IgQW5ndWxhcl0oeyUgc2x1ZyBvdmVydmlld191cGxvYWQgJX0pLlxuICovXG5jbGFzcyBVcGxvYWRDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHVwbG9hZFNlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmF2aWdhdGlvbiwgZHJvcFpvbmVTZXJ2aWNlLCBfbmdab25lLCByZW5kZXJlciwgY2RyLCB3cmFwcGVyKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZSA9IHVwbG9hZFNlcnZpY2U7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uID0gbG9jYWxpemF0aW9uO1xuICAgICAgICB0aGlzLm5hdmlnYXRpb24gPSBuYXZpZ2F0aW9uO1xuICAgICAgICB0aGlzLmRyb3Bab25lU2VydmljZSA9IGRyb3Bab25lU2VydmljZTtcbiAgICAgICAgdGhpcy5fbmdab25lID0gX25nWm9uZTtcbiAgICAgICAgdGhpcy5yZW5kZXJlciA9IHJlbmRlcmVyO1xuICAgICAgICB0aGlzLmNkciA9IGNkcjtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVuYWJsZXMgdGhlIGNodW5rIGZ1bmN0aW9uYWxpdHkgb2YgdGhlIFVwbG9hZC5cbiAgICAgICAgICpcbiAgICAgICAgICogVGhlIGRlZmF1bHQgdmFsdWUgaXMgYGZhbHNlYC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY2h1bmthYmxlID0gZmFsc2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBFbmFibGVzIHRoZSBzZWxlY3Rpb24gb2YgbXVsdGlwbGUgZmlsZXNcbiAgICAgICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBmaWxlcHJvY2Vzc2luZ191cGxvYWQgJX0jdG9jLXVwbG9hZC1vZi1zaW5sZ2Utb3ItbXVsdGlwbGUtZmlsZXMpKS5cbiAgICAgICAgICogSWYgc2V0IHRvIGBmYWxzZWAsIG9ubHkgb25lIGZpbGUgY2FuIGJlIHNlbGVjdGVkIGF0IGEgdGltZS5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubXVsdGlwbGUgPSB0cnVlO1xuICAgICAgICAvKipcbiAgICAgICAgICogRGlzYWJsZXMgdGhlIFVwbG9hZCAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGRpc2FibGVkc3RhdGVfdXBsb2FkICV9KSkuXG4gICAgICAgICAqIFRoZSBkZWZhdWx0IHZhbHVlIGlzIGBmYWxzZWAuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gZmFsc2U7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBUb2dnbGVzIHRoZSB2aXNpYmlsaXR5IG9mIHRoZSBmaWxlIGxpc3QuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnNob3dGaWxlTGlzdCA9IHRydWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBTcGVjaWZpZXMgdGhlIFtgdGFiaW5kZXhgXShodHRwczovL2RldmVsb3Blci5tb3ppbGxhLm9yZy9lbi1VUy9kb2NzL1dlYi9IVE1ML0dsb2JhbF9hdHRyaWJ1dGVzL3RhYmluZGV4KSBvZiB0aGUgY29tcG9uZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy50YWJpbmRleCA9IDA7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmZvY3VzYWJsZUlkID0gYGstJHtndWlkKCl9YDtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIFNwZWNpZmllcyB0aGUgcG9zc2libGUgbGF5b3V0IG9mIHRoZSBhY3Rpb24gYnV0dG9ucy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuYWN0aW9uc0xheW91dCA9ICdlbmQnO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXNlciBuYXZpZ2F0ZXMgb3V0c2lkZSB0aGUgY29tcG9uZW50LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkJsdXIgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1cGxvYWQgaXMgY2FuY2VsZWQgd2hpbGUgaW4gcHJvZ3Jlc3MuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLmNhbmNlbCA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGZpbGUgbGlzdCBpcyBhYm91dCB0byBiZSBjbGVhcmVkLiBJZiBwcmV2ZW50ZWQsIHRoZSBmaWxlcyB3aWxsIG5vdCBiZSBjbGVhcmVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5jbGVhciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gYWxsIGFjdGl2ZSB1cGxvYWRzIGFyZSBjb21wbGV0ZWQgZWl0aGVyIHN1Y2Nlc3NmdWxseSBvciB3aXRoIGVycm9ycy5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuY29tcGxldGUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIGFuIGB1cGxvYWRgIG9yIGByZW1vdmVgIG9wZXJhdGlvbiBoYXMgZmFpbGVkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5lcnJvciA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gdGhlIGNvbXBvbmVudCBpcyBmb2N1c2VkLlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5vbkZvY3VzID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiB0aGUgdXBsb2FkIG9mIGEgZmlsZSBoYXMgYmVlbiBwYXVzZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnBhdXNlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiBhbiB1cGxvYWRlZCBmaWxlIGlzIGFib3V0IHRvIGJlIHJlbW92ZWQuIElmIHByZXZlbnRlZCwgdGhlIGZpbGVzIHdpbGwgcmVtYWluIGluIHRoZSBsaXN0LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5yZW1vdmUgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB1cGxvYWQgb2YgYSBmaWxlIGhhcyBiZWVuIHJlc3VtZWQuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnJlc3VtZSA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gZmlsZXMgYXJlIHNlbGVjdGVkLiBJZiBwcmV2ZW50ZWQsIHRoZSBzZWxlY3RlZCBmaWxlcyB3aWxsIG5vdCBiZSBhZGRlZCB0byB0aGUgbGlzdC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc2VsZWN0ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICAvKipcbiAgICAgICAgICogRmlyZXMgd2hlbiBhbiBgdXBsb2FkYCBvciBgcmVtb3ZlYCBvcGVyYXRpb24gaXMgc3VjY2Vzc2Z1bGx5IGNvbXBsZXRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMuc3VjY2VzcyA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIEZpcmVzIHdoZW4gb25lIG9yIG1vcmUgZmlsZXMgYXJlIGFib3V0IHRvIGJlIHVwbG9hZGVkLiBJZiBwcmV2ZW50ZWQsIHRoZSBmaWxlcyB3aWxsIG5laXRoZXIgYmUgdXBsb2FkZWQsIG5vciBhZGRlZCB0byB0aGUgZmlsZSBsaXN0LlxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy51cGxvYWQgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIG9uZSBvciBtb3JlIGZpbGVzIGFyZSBiZWluZyB1cGxvYWRlZC5cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMudXBsb2FkUHJvZ3Jlc3MgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBGaXJlcyB3aGVuIHRoZSB2YWx1ZSBvZiB0aGUgY29tcG9uZW50IGhhcyBjaGFuZ2VkIGFzIGEgcmVzdWx0IG9mIGEgc3VjY2Vzc2Z1bCBgdXBsb2FkYCwgYHJlbW92ZWAgb3IgYGNsZWFyYCBvcGVyYXRpb24uXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLnZhbHVlQ2hhbmdlID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuICAgICAgICB0aGlzLmhvc3REZWZhdWx0Q2xhc3NlcyA9IHRydWU7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBAaGlkZGVuXG4gICAgICAgICAqL1xuICAgICAgICB0aGlzLl9yZXN0cmljdGlvbnMgPSB7XG4gICAgICAgICAgICBhbGxvd2VkRXh0ZW5zaW9uczogW10sXG4gICAgICAgICAgICBtYXhGaWxlU2l6ZTogMCxcbiAgICAgICAgICAgIG1pbkZpbGVTaXplOiAwXG4gICAgICAgIH07XG4gICAgICAgIHRoaXMub25Ub3VjaGVkQ2FsbGJhY2sgPSAoXykgPT4geyB9O1xuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSAoXykgPT4geyB9O1xuICAgICAgICB0aGlzLmZpbGVMaXN0ID0gdGhpcy51cGxvYWRTZXJ2aWNlLmZpbGVzO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbkNoYW5nZVN1YnNjcmlwdGlvbiA9IGxvY2FsaXphdGlvbi5jaGFuZ2VzLnN1YnNjcmliZSgoeyBydGwgfSkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kaXJlY3Rpb24gPSBydGwgPyAncnRsJyA6ICdsdHInO1xuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uLmNvbXB1dGVLZXlzKHRoaXMuZGlyZWN0aW9uKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZGlyZWN0aW9uID0gbG9jYWxpemF0aW9uLnJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbi5jb21wdXRlS2V5cyh0aGlzLmRpcmVjdGlvbik7XG4gICAgICAgIHRoaXMud3JhcHBlciA9IHdyYXBwZXIubmF0aXZlRWxlbWVudDtcbiAgICAgICAgdGhpcy5zdWJzY3JpYmVCbHVyKCk7XG4gICAgICAgIHRoaXMuc3Vic2NyaWJlRm9jdXMoKTtcbiAgICAgICAgdGhpcy5hdHRhY2hFdmVudEhhbmRsZXJzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJ5IGRlZmF1bHQsIHRoZSBzZWxlY3RlZCBmaWxlcyBhcmUgaW1tZWRpYXRlbHkgdXBsb2FkZWRcbiAgICAgKiAoW3NlZSBleGFtcGxlXSh7JSBzbHVnIGZpbGVwcm9jZXNzaW5nX3VwbG9hZCAlfSN0b2MtYXV0b21hdGljLXVwbG9hZC1vZi1maWxlcykpLlxuICAgICAqIFRvIGNoYW5nZSB0aGlzIGJlaGF2aW9yLCBzZXQgYGF1dG9VcGxvYWRgIHRvIGBmYWxzZWAuXG4gICAgICovXG4gICAgc2V0IGF1dG9VcGxvYWQoYXV0b1VwbG9hZCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuYXV0b1VwbG9hZCA9IGF1dG9VcGxvYWQ7XG4gICAgfVxuICAgIGdldCBhdXRvVXBsb2FkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLmF1dG9VcGxvYWQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFdoZW4gZW5hYmxlZCwgYWxsIGZpbGVzIGluIHRoZSBzZWxlY3Rpb24gYXJlIHVwbG9hZGVkIGluIG9uZSByZXF1ZXN0XG4gICAgICogKFtzZWUgZXhhbXBsZV0oeyUgc2x1ZyBmaWxlcHJvY2Vzc2luZ191cGxvYWQgJX0jdG9jLXVwbG9hZC1vZi1iYXRjaGVzLW9mLWZpbGVzKSkuXG4gICAgICogQW55IGZpbGVzIHRoYXQgYXJlIHNlbGVjdGVkIG9uZSBhZnRlciB0aGUgb3RoZXIgYXJlIHVwbG9hZGVkIGluIHNlcGFyYXRlIHJlcXVlc3RzLlxuICAgICAqL1xuICAgIHNldCBiYXRjaChiYXRjaCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuYmF0Y2ggPSBiYXRjaDtcbiAgICB9XG4gICAgZ2V0IGJhdGNoKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLmJhdGNoO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBDb25maWd1cmVzIHdoZXRoZXIgY3JlZGVudGlhbHMgKGNvb2tpZXMsIGhlYWRlcnMpIHdpbGwgYmUgc2VudCBmb3IgY3Jvc3Mtc2l0ZSByZXF1ZXN0c1xuICAgICAqIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgY3JlZGVudGlhbHNfdXBsb2FkICV9I3RvYy1hdHRhY2hpbmctY3JlZGVudGlhbHMtdG8tcmVxdWVzdHMpKS5cbiAgICAgKiBUaGUgZGVmYXVsdCB2YWx1ZXMgaXMgYHRydWVgLiBTZXR0aW5nIGB3aXRoQ3JlZGVudGlhbHNgIGhhcyBubyBlZmZlY3Qgb24gc2FtZS1zaXRlIHJlcXVlc3RzLlxuICAgICAqIFRvIGFkZCBjcmVkZW50aWFscyB0byB0aGUgcmVxdWVzdCwgdXNlIHRoZSBgc2F2ZUhlYWRlcnNgIG9yIGByZW1vdmVIZWFkZXJzYCBwcm9wZXJ0eSxcbiAgICAgKiBvciB0aGUgW2B1cGxvYWRgXSh7JSBzbHVnIGFwaV91cGxvYWRfdXBsb2FkZXZlbnQgJX0pIGV2ZW50LlxuICAgICAqL1xuICAgIHNldCB3aXRoQ3JlZGVudGlhbHMod2l0aENyZWRlbnRpYWxzKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy53aXRoQ3JlZGVudGlhbHMgPSB3aXRoQ3JlZGVudGlhbHM7XG4gICAgfVxuICAgIGdldCB3aXRoQ3JlZGVudGlhbHMoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMud2l0aENyZWRlbnRpYWxzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBbYEZvcm1EYXRhYF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0Zvcm1EYXRhKSBrZXkgd2hpY2ggY29udGFpbnMgdGhlIGZpbGVzIHN1Ym1pdHRlZCB0byBgc2F2ZVVybGAuXG4gICAgICogVGhlIGRlZmF1bHQgdmFsdWUgaXMgYGZpbGVzYC5cbiAgICAgKi9cbiAgICBzZXQgc2F2ZUZpZWxkKHNhdmVGaWVsZCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuc2F2ZUZpZWxkID0gc2F2ZUZpZWxkO1xuICAgIH1cbiAgICBnZXQgc2F2ZUZpZWxkKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnNhdmVGaWVsZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlcyB0aGUgW2BIdHRwSGVhZGVyc2BdKGh0dHBzOi8vYW5ndWxhci5pby9hcGkvY29tbW9uL2h0dHAvSHR0cEhlYWRlcnMpXG4gICAgICogdGhhdCBhcmUgYXR0YWNoZWQgdG8gZWFjaCB1cGxvYWQgcmVxdWVzdC5cbiAgICAgKi9cbiAgICBzZXQgc2F2ZUhlYWRlcnMoc2F2ZUhlYWRlcnMpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnNhdmVIZWFkZXJzID0gc2F2ZUhlYWRlcnM7XG4gICAgfVxuICAgIGdldCBzYXZlSGVhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5zYXZlSGVhZGVycztcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgW2BSZXF1ZXN0TWV0aG9kYF0oaHR0cHM6Ly9hbmd1bGFyLmlvL2FwaS9odHRwL1JlcXVlc3RNZXRob2QpIG9mIHRoZSB1cGxvYWQgcmVxdWVzdC5cbiAgICAgKiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBgUE9TVGAuXG4gICAgICovXG4gICAgc2V0IHNhdmVNZXRob2Qoc2F2ZU1ldGhvZCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuc2F2ZU1ldGhvZCA9IHNhdmVNZXRob2Q7XG4gICAgfVxuICAgIGdldCBzYXZlTWV0aG9kKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnNhdmVNZXRob2Q7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNldHMgdGhlIFVSTCBvZiB0aGUgZW5kcG9pbnQgZm9yIHRoZSB1cGxvYWQgcmVxdWVzdC5cbiAgICAgKiBUaGUgcmVxdWVzdCBbYEZvcm1EYXRhYF0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvQVBJL0Zvcm1EYXRhKSBrZXkgaXMgbmFtZWQgYWZ0ZXIgdGhlIGBzYXZlRmllbGRgIHByb3BlcnR5LlxuICAgICAqIEl0IGNvbnRhaW5zIHRoZSBsaXN0IG9mIGZpbGVzIHRvIGJlIHVwbG9hZGVkLlxuICAgICAqL1xuICAgIHNldCBzYXZlVXJsKHNhdmVVcmwpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnNhdmVVcmwgPSBzYXZlVXJsO1xuICAgIH1cbiAgICBnZXQgc2F2ZVVybCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5zYXZlVXJsO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBleHBlY3RlZCBbYHJlc3BvbnNlIHR5cGVgXShodHRwczovL2FuZ3VsYXIuaW8vYXBpL2NvbW1vbi9odHRwL0h0dHBSZXF1ZXN0I3Jlc3BvbnNlVHlwZSkgb2YgdGhlIHNlcnZlci5cbiAgICAgKiBJdCBpcyB1c2VkIHRvIHBhcnNlIHRoZSByZXNwb25zZSBhcHByb3ByaWF0ZWx5LlxuICAgICAqIFRoZSBkZWZhdWx0IHZhbHVlIGlzIGBqc29uYC5cbiAgICAgKi9cbiAgICBzZXQgcmVzcG9uc2VUeXBlKHJlc3BvbnNlVHlwZSkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMucmVzcG9uc2VUeXBlID0gcmVzcG9uc2VUeXBlO1xuICAgIH1cbiAgICBnZXQgcmVzcG9uc2VUeXBlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnJlc3BvbnNlVHlwZTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogU2V0cyB0aGUgW2BGb3JtRGF0YWBdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Gb3JtRGF0YSkga2V5XG4gICAgICogd2hpY2ggY29udGFpbnMgdGhlIGxpc3Qgb2YgZmlsZSBuYW1lcyB0aGF0IGFyZSBzdWJtaXR0ZWQgdG8gYHJlbW92ZVVybGAuXG4gICAgICogVGhlIGRlZmF1bHQgdmFsdWUgaXMgYGZpbGVOYW1lc2AuXG4gICAgICovXG4gICAgc2V0IHJlbW92ZUZpZWxkKHJlbW92ZUZpZWxkKSB7IHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5yZW1vdmVGaWVsZCA9IHJlbW92ZUZpZWxkOyB9XG4gICAgZ2V0IHJlbW92ZUZpZWxkKCkgeyByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnJlbW92ZUZpZWxkOyB9XG4gICAgLyoqXG4gICAgICogQ29uZmlndXJlcyB0aGUgW2BIdHRwSGVhZGVyc2BdKGh0dHBzOi8vYW5ndWxhci5pby9hcGkvY29tbW9uL2h0dHAvSHR0cEhlYWRlcnMpXG4gICAgICogdGhhdCBhcmUgYXR0YWNoZWQgdG8gZWFjaCBgcmVtb3ZlYCByZXF1ZXN0LlxuICAgICAqL1xuICAgIHNldCByZW1vdmVIZWFkZXJzKHJlbW92ZUhlYWRlcnMpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnJlbW92ZUhlYWRlcnMgPSByZW1vdmVIZWFkZXJzO1xuICAgIH1cbiAgICBnZXQgcmVtb3ZlSGVhZGVycygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5yZW1vdmVIZWFkZXJzO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBbYFJlcXVlc3RNZXRob2RgXShodHRwczovL2FuZ3VsYXIuaW8vYXBpL2h0dHAvUmVxdWVzdE1ldGhvZCkgb2YgdGhlIGByZW1vdmVgIHJlcXVlc3QuXG4gICAgICogVGhlIGRlZmF1bHQgdmFsdWUgaXMgYFBPU1RgLlxuICAgICAqL1xuICAgIHNldCByZW1vdmVNZXRob2QocmVtb3ZlTWV0aG9kKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5yZW1vdmVNZXRob2QgPSByZW1vdmVNZXRob2Q7XG4gICAgfVxuICAgIGdldCByZW1vdmVNZXRob2QoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMucmVtb3ZlTWV0aG9kO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSBVUkwgb2YgdGhlIGVuZHBvaW50IGZvciB0aGUgYHJlbW92ZWAgcmVxdWVzdC5cbiAgICAgKiBUaGUgW2BGb3JtRGF0YWBdKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9Gb3JtRGF0YSkgcmVxdWVzdCBrZXkgaXMgbmFtZWQgYWZ0ZXIgdGhlIGByZW1vdmVGaWVsZGAgcHJvcGVydHkuXG4gICAgICogSXQgY29udGFpbnMgdGhlIGxpc3Qgb2YgZmlsZSBuYW1lcyB3aGljaCB3aWxsIGJlIHJlbW92ZWQuXG4gICAgICovXG4gICAgc2V0IHJlbW92ZVVybChyZW1vdmVVcmwpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLnJlbW92ZVVybCA9IHJlbW92ZVVybDtcbiAgICB9XG4gICAgZ2V0IHJlbW92ZVVybCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudXBsb2FkU2VydmljZS5hc3luYy5yZW1vdmVVcmw7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFNwZWNpZmllcyBpZiB0aGUgc2VsZWN0ZWQgZmlsZXMgYXJlIHVwbG9hZGVkIHNpbXVsdGFuZW91c2x5IG9yIG9uZSBieSBvbmUuXG4gICAgICpcbiAgICAgKiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBgdHJ1ZWAuXG4gICAgICovXG4gICAgc2V0IGNvbmN1cnJlbnQoY29uY3VycmVudCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuYXN5bmMuY29uY3VycmVudCA9IGNvbmN1cnJlbnQ7XG4gICAgfVxuICAgIGdldCBjb25jdXJyZW50KCkge1xuICAgICAgICByZXR1cm4gdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLmNvbmN1cnJlbnQ7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBzZXQgdGFiSW5kZXgodGFiSW5kZXgpIHtcbiAgICAgICAgdGhpcy50YWJpbmRleCA9IHRhYkluZGV4O1xuICAgIH1cbiAgICBnZXQgdGFiSW5kZXgoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLnRhYmluZGV4O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBTZXRzIHRoZSByZXN0cmljdGlvbnMgZm9yIHNlbGVjdGVkIGZpbGVzIChbc2VlIGV4YW1wbGVdKHslIHNsdWcgYXBpX3VwbG9hZF9maWxlcmVzdHJpY3Rpb25zICV9KSkuXG4gICAgICovXG4gICAgc2V0IHJlc3RyaWN0aW9ucyhyZXN0cmljdGlvbnMpIHtcbiAgICAgICAgbGV0IHBhcnNlZFJlc3RyaWN0aW9ucyA9IE9iamVjdC5hc3NpZ24oe30sIHRoaXMuX3Jlc3RyaWN0aW9ucywgcmVzdHJpY3Rpb25zKTtcbiAgICAgICAgdGhpcy5fcmVzdHJpY3Rpb25zID0gcGFyc2VkUmVzdHJpY3Rpb25zO1xuICAgIH1cbiAgICBnZXQgcmVzdHJpY3Rpb25zKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5fcmVzdHJpY3Rpb25zO1xuICAgIH1cbiAgICBnZXQgaG9zdERpc2FibGVkQ2xhc3MoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRpc2FibGVkO1xuICAgIH1cbiAgICBnZXQgZGlyKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb247XG4gICAgfVxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLnZlcmlmeVNldHRpbmdzKCk7XG4gICAgICAgIHRoaXMucmVuZGVyZXIucmVtb3ZlQXR0cmlidXRlKHRoaXMud3JhcHBlciwgXCJ0YWJpbmRleFwiKTtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLnNldENodW5rU2V0dGluZ3ModGhpcy5jaHVua2FibGUpO1xuICAgICAgICBpZiAodGhpcy56b25lSWQpIHtcbiAgICAgICAgICAgIHRoaXMuZHJvcFpvbmVTZXJ2aWNlLmFkZENvbXBvbmVudCh0aGlzLCB0aGlzLnpvbmVJZCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbmdPbkNoYW5nZXMoY2hhbmdlcykge1xuICAgICAgICBpZiAoaXNDaGFuZ2VkKFwiY2h1bmthYmxlXCIsIGNoYW5nZXMpKSB7XG4gICAgICAgICAgICBjb25zdCBuZXdDaHVua2FibGUgPSBjaGFuZ2VzLmNodW5rYWJsZS5jdXJyZW50VmFsdWU7XG4gICAgICAgICAgICBpZiAodHlwZW9mIG5ld0NodW5rYWJsZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLmNodW5rID0gbmV3Q2h1bmthYmxlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHR5cGVvZiBuZXdDaHVua2FibGUgPT09IFwib2JqZWN0XCIgJiYgbmV3Q2h1bmthYmxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFzeW5jLmNodW5rID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuY2h1bmsgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnVwbG9hZFNlcnZpY2UuY2h1bmssIG5ld0NodW5rYWJsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuZmlsZUxpc3QuY2xlYXIoKTtcbiAgICAgICAgaWYgKHRoaXMuYmx1clN1YnNjcmlwdGlvbikge1xuICAgICAgICAgICAgdGhpcy5ibHVyU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMud3JhcHBlckZvY3VzU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLndyYXBwZXJGb2N1c1N1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnNlbGVjdEJ1dHRvbkZvY3VzU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLnNlbGVjdEJ1dHRvbkZvY3VzU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICB0aGlzLmxvY2FsaXphdGlvbkNoYW5nZVN1YnNjcmlwdGlvbi51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLnN1YnMpIHtcbiAgICAgICAgICAgIHRoaXMuc3Vicy51bnN1YnNjcmliZSgpO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBoYW5kbGVLZXlkb3duKGV2ZW50KSB7XG4gICAgICAgIGlmICh0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKChldmVudC5rZXlDb2RlID09PSBLZXlzLkVudGVyIHx8IGV2ZW50LmtleUNvZGUgPT09IEtleXMuU3BhY2UpICYmXG4gICAgICAgICAgICBldmVudC50YXJnZXQgPT09IHRoaXMuZmlsZVNlbGVjdEJ1dHRvbi5uYXRpdmVFbGVtZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgdGhpcy5maWxlU2VsZWN0Lm5hdGl2ZUVsZW1lbnQuY2xpY2soKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoaGFzQ2xhc3NlcyhldmVudC50YXJnZXQsIFVQTE9BRF9DTEFTU0VTKSB8fFxuICAgICAgICAgICAgKCFpc0ZvY3VzYWJsZShldmVudC50YXJnZXQpICYmICFoYXNDbGFzc2VzKGV2ZW50LnRhcmdldCwgSUdOT1JFX1RBUkdFVF9DTEFTU0VTKSkpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5wcm9jZXNzKGV2ZW50KTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgd3JpdGVWYWx1ZShuZXdWYWx1ZSkge1xuICAgICAgICBsZXQgaXNWYWxpZCA9IHRydWU7XG4gICAgICAgIGlmIChuZXdWYWx1ZSBpbnN0YW5jZW9mIEFycmF5KSB7XG4gICAgICAgICAgICBuZXdWYWx1ZS5mb3JFYWNoKChmaWxlKSA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKCF2YWxpZGF0ZUluaXRpYWxGaWxlSW5mbyhmaWxlKSkge1xuICAgICAgICAgICAgICAgICAgICBpc1ZhbGlkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZiAoaXNWYWxpZCkge1xuICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5hZGRJbml0aWFsRmlsZXMobmV3VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmIChuZXdWYWx1ZSA9PT0gbnVsbCkge1xuICAgICAgICAgICAgdGhpcy5maWxlTGlzdC5jbGVhcigpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY2RyLm1hcmtGb3JDaGVjaygpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgcmVnaXN0ZXJPbkNoYW5nZShmbikge1xuICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2sgPSBmbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHJlZ2lzdGVyT25Ub3VjaGVkKGZuKSB7XG4gICAgICAgIHRoaXMub25Ub3VjaGVkQ2FsbGJhY2sgPSBmbjtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIHNldERpc2FibGVkU3RhdGUoaXNEaXNhYmxlZCkge1xuICAgICAgICB0aGlzLmRpc2FibGVkID0gaXNEaXNhYmxlZDtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqL1xuICAgIGdldCBzZWxlY3RCdXR0b25UYWJJbmRleCgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuZGlzYWJsZWQgPyB1bmRlZmluZWQgOiB0aGlzLnRhYkluZGV4O1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25GaWxlU2VsZWN0QnV0dG9uRm9jdXMoX2V2ZW50KSB7XG4gICAgICAgIHRoaXMucmVuZGVyZXIuYWRkQ2xhc3ModGhpcy5maWxlU2VsZWN0QnV0dG9uLm5hdGl2ZUVsZW1lbnQsICdrLXN0YXRlLWZvY3VzZWQnKTtcbiAgICAgICAgaWYgKCF0aGlzLm5hdmlnYXRpb24uZm9jdXNlZCkge1xuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uLmZvY3VzZWRJbmRleCA9IC0xO1xuICAgICAgICB9XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkZpbGVTZWxlY3RCdXR0b25CbHVyKF9ldmVudCkge1xuICAgICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNsYXNzKHRoaXMuZmlsZVNlbGVjdEJ1dHRvbi5uYXRpdmVFbGVtZW50LCAnay1zdGF0ZS1mb2N1c2VkJyk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZXQgc2hvd0FjdGlvbkJ1dHRvbnMoKSB7XG4gICAgICAgIGxldCBhcmVWaXNpYmxlID0gZmFsc2U7XG4gICAgICAgIGlmICghdGhpcy5hdXRvVXBsb2FkKSB7XG4gICAgICAgICAgICBjb25zdCBoYXNGaWxlc1RvVXBsb2FkID0gdGhpcy5maWxlTGlzdC5maWxlc1RvVXBsb2FkLmxlbmd0aCA+IDA7XG4gICAgICAgICAgICBjb25zdCB1cGxvYWRpbmdGaWxlcyA9IHRoaXMuZmlsZUxpc3QuaGFzRmlsZVdpdGhTdGF0ZShbRmlsZVN0YXRlLlVwbG9hZGluZ10pO1xuICAgICAgICAgICAgaWYgKHRoaXMuY29uY3VycmVudCAmJiBoYXNGaWxlc1RvVXBsb2FkKSB7XG4gICAgICAgICAgICAgICAgYXJlVmlzaWJsZSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXRoaXMuY29uY3VycmVudCAmJiBoYXNGaWxlc1RvVXBsb2FkICYmICF1cGxvYWRpbmdGaWxlcykge1xuICAgICAgICAgICAgICAgIGFyZVZpc2libGUgPSB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMubmF2aWdhdGlvbi5hY3Rpb25CdXR0b25zVmlzaWJsZSA9IGFyZVZpc2libGU7XG4gICAgICAgIHJldHVybiBhcmVWaXNpYmxlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgZ2V0IHNob3dUb3RhbFN0YXR1cygpIHtcbiAgICAgICAgY29uc3Qgc3RhdGVzID0gW1xuICAgICAgICAgICAgRmlsZVN0YXRlLlVwbG9hZGVkLFxuICAgICAgICAgICAgRmlsZVN0YXRlLlVwbG9hZGluZyxcbiAgICAgICAgICAgIEZpbGVTdGF0ZS5GYWlsZWQsXG4gICAgICAgICAgICBGaWxlU3RhdGUuUGF1c2VkXG4gICAgICAgIF07XG4gICAgICAgIGlmICh0aGlzLmZpbGVMaXN0Lmhhc0ZpbGVXaXRoU3RhdGUoc3RhdGVzKSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgdGV4dEZvcihrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldChrZXkpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBGb2N1c2VzIHRoZSB1bmRlcmx5aW5nIGlucHV0IGVsZW1lbnQuXG4gICAgICovXG4gICAgZm9jdXMoKSB7XG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWxlU2VsZWN0QnV0dG9uLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKiBAZGVwcmVjYXRlZFxuICAgICAqL1xuICAgIGZvY3VzQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLmZvY3VzKCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEJsdXJzIHRoZSBVcGxvYWQgaWYgaXQgd2FzIHByZXZpb3VzbHkgZm9jdXNlZC5cbiAgICAgKi9cbiAgICBibHVyKCkge1xuICAgICAgICBpZiAodGhpcy5uYXZpZ2F0aW9uLmZvY3VzZWQpIHtcbiAgICAgICAgICAgIHRoaXMubmF2aWdhdGlvbi5mb2N1c2VkID0gZmFsc2U7XG4gICAgICAgICAgICBkb2N1bWVudC5hY3RpdmVFbGVtZW50LmJsdXIoKTtcbiAgICAgICAgICAgIHRoaXMub25CbHVyLmVtaXQoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICogQGRlcHJlY2F0ZWRcbiAgICAgKi9cbiAgICBibHVyQ29tcG9uZW50KCkge1xuICAgICAgICB0aGlzLmJsdXIoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogUGF1c2VzIHRoZSB1cGxvYWQgcHJvY2VzcyBvZiBhIGZpbGUgdGhhdCBpcyBjdXJyZW50bHkgdXBsb2FkaW5nLlxuICAgICAqIFRoZSBgcGF1c2VGaWxlQnlVaWRgIG1ldGhvZCByZXF1aXJlcyB0aGUgYGNodW5rYWJsZWAgb3B0aW9uIG9mIHRoZSBVcGxvYWQgdG8gYmUgZW5hYmxlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1aWQgLSBUaGUgYHVpZGAgb2YgdGhlIGZpbGUgdGhhdCB3aWxsIGJlIHBhdXNlZC5cbiAgICAgKi9cbiAgICBwYXVzZUZpbGVCeVVpZCh1aWQpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLnBhdXNlRmlsZSh1aWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBSZXN1bWVzIHRoZSB1cGxvYWQgcHJvY2VzcyBmb3IgYSBmaWxlIHRoYXQgaGFzIGJlZW4gcHJldmlvdXNseSBwYXVzZWQuXG4gICAgICogVGhlIGByZXN1bWVGaWxlQnlVaWRgIG1ldGhvZCByZXF1aXJlcyB0aGUgYGNodW5rYWJsZWAgb3B0aW9uIG9mIHRoZSBVcGxvYWQgdG8gYmUgZW5hYmxlZC5cbiAgICAgKlxuICAgICAqIEBwYXJhbSB1aWQgLSBUaGUgYHVpZGAgb2YgdGhlIGZpbGUgdGhhdCB3aWxsIGJlIHJlc3VtZWQuXG4gICAgICovXG4gICAgcmVzdW1lRmlsZUJ5VWlkKHVpZCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UucmVzdW1lRmlsZSh1aWQpO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBUcmlnZ2VycyB0aGUgcmVtb3ZhbCBvZiBhIGZpbGUgb3IgYSBiYXRjaCBvZiBmaWxlcy5cbiAgICAgKiBAcGFyYW0gdWlkIC0gVGhlIGB1aWRgIG9mIHRoZSBmaWxlIG9yIGEgYmF0Y2ggb2YgZmlsZXMgdGhhdCB3aWxsIGJlIHJlbW92ZWQuXG4gICAgICovXG4gICAgcmVtb3ZlRmlsZXNCeVVpZCh1aWQpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLnJlbW92ZUZpbGVzKHVpZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIFRyaWdnZXJzIGFub3RoZXIgdXBsb2FkIGF0dGVtcHQgb2YgYW4gdW5zdWNjZXNzZnVsbHkgdXBsb2FkZWQgZmlsZSBvciBhIGJhdGNoIG9mIGZpbGVzLlxuICAgICAqIEBwYXJhbSB1aWQgLSBUaGUgYHVpZGAgb2YgdGhlIGZpbGUgb3IgYSBiYXRjaCBvZiBmaWxlcyB0byBiZSByZXRyaWVkLlxuICAgICAqL1xuICAgIHJldHJ5VXBsb2FkQnlVaWQodWlkKSB7XG4gICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5yZXRyeUZpbGVzKHVpZCk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIENhbmNlbHMgdGhlIHVwbG9hZCBvZiBhIGZpbGUgb3IgYSBiYXRjaCBvZiBmaWxlcy5cbiAgICAgKiBAcGFyYW0gdWlkIC0gVGhlIGB1aWRgIG9mIHRoZSBmaWxlIG9yIGEgYmF0Y2ggb2YgZmlsZXMgdGhhdCB3aWxsIGJlIGNhbmNlbGVkLlxuICAgICAqL1xuICAgIGNhbmNlbFVwbG9hZEJ5VWlkKHVpZCkge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UuY2FuY2VsRmlsZXModWlkKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogVXBsb2FkcyB0aGUgY3VycmVudGx5IHNlbGVjdGVkIGZpbGVzIHdoaWNoIHBhc3MgdGhlIHNldCByZXN0cmljdGlvbnMuXG4gICAgICovXG4gICAgdXBsb2FkRmlsZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmZpbGVMaXN0LmZpbGVzVG9VcGxvYWQubGVuZ3RoKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UudXBsb2FkRmlsZXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICAvKipcbiAgICAgKiBWaXN1YWxseSBjbGVhcnMgYWxsIGZpbGVzIGZyb20gdGhlIFVJIHdpdGhvdXQgaXNzdWluZyByZXF1ZXN0cyB0byB0aGUgcmVtb3ZlIGhhbmRsZXIuXG4gICAgICovXG4gICAgY2xlYXJGaWxlcygpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmNsZWFyRmlsZXMoKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIFVzZWQgYnkgdGhlIGV4dGVybmFsIGRyb3B6b25lIHRvIGFkZCBmaWxlcyB0byB0aGUgVXBsb2FkXG4gICAgICovXG4gICAgYWRkRmlsZXMoZmlsZXMpIHtcbiAgICAgICAgdGhpcy51cGxvYWRTZXJ2aWNlLmFkZEZpbGVzKGZpbGVzKTtcbiAgICB9XG4gICAgLyoqXG4gICAgICogQGhpZGRlblxuICAgICAqIFVzZWQgdG8gZGV0ZXJtaW5lIGlmIHRoZSBjb21wb25lbnQgaXMgZW1wdHkuXG4gICAgICovXG4gICAgaXNFbXB0eSgpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICB2ZXJpZnlTZXR0aW5ncygpIHtcbiAgICAgICAgaWYgKGlzRGV2TW9kZSgpKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5iYXRjaCAmJiB0aGlzLmNodW5rYWJsZSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBmaWxlIGNodW5raW5nIGZ1bmN0aW9uYWxpdHkgcmVxdWlyZXMgdGhlIGJhdGNoIHNldHRpbmcgdG8gYmUgZGlzYWJsZWQuJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3Vic2NyaWJlQmx1cigpIHtcbiAgICAgICAgaWYgKCFpc0RvY3VtZW50QXZhaWxhYmxlKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5kb2N1bWVudENsaWNrID0gZnJvbUV2ZW50KGRvY3VtZW50LCAnY2xpY2snKS5waXBlKGZpbHRlcigoZXZlbnQpID0+IHtcbiAgICAgICAgICAgICAgICByZXR1cm4gISh0aGlzLndyYXBwZXIgIT09IGV2ZW50LnRhcmdldCAmJiB0aGlzLndyYXBwZXIuY29udGFpbnMoZXZlbnQudGFyZ2V0KSk7XG4gICAgICAgICAgICB9KSk7XG4gICAgICAgICAgICB0aGlzLmJsdXJTdWJzY3JpcHRpb24gPSBtZXJnZSh0aGlzLmRvY3VtZW50Q2xpY2ssIHRoaXMubmF2aWdhdGlvbi5vblRhYikuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5uYXZpZ2F0aW9uLmZvY3VzZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fbmdab25lLnJ1bigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0aGlzLm5hdmlnYXRpb24uZm9jdXNlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vblRvdWNoZWRDYWxsYmFjaygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkJsdXIuZW1pdCgpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHN1YnNjcmliZUZvY3VzKCkge1xuICAgICAgICB0aGlzLndyYXBwZXJGb2N1c1N1YnNjcmlwdGlvbiA9IHRoaXMubmF2aWdhdGlvbi5vbldyYXBwZXJGb2N1cy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5vbkZvY3VzLmVtaXQoKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2VsZWN0QnV0dG9uRm9jdXNTdWJzY3JpcHRpb24gPSB0aGlzLm5hdmlnYXRpb24ub25TZWxlY3RCdXR0b25Gb2N1cy5zdWJzY3JpYmUoKCkgPT4ge1xuICAgICAgICAgICAgdGhpcy5maWxlU2VsZWN0QnV0dG9uLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGF0dGFjaEV2ZW50SGFuZGxlcnMoKSB7XG4gICAgICAgIHRoaXMuc3VicyA9IHRoaXMudXBsb2FkU2VydmljZS5jYW5jZWxFdmVudC5zdWJzY3JpYmUoKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY2FuY2VsLmVtaXQoYXJncyk7XG4gICAgICAgIH0pO1xuICAgICAgICB0aGlzLnN1YnMuYWRkKHRoaXMudXBsb2FkU2VydmljZS5jaGFuZ2VFdmVudC5zdWJzY3JpYmUoKGZpbGVzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLm9uQ2hhbmdlQ2FsbGJhY2soZmlsZXMpO1xuICAgICAgICAgICAgdGhpcy52YWx1ZUNoYW5nZS5lbWl0KGZpbGVzKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnMuYWRkKHRoaXMudXBsb2FkU2VydmljZS5jbGVhckV2ZW50LnN1YnNjcmliZSgoYXJncykgPT4ge1xuICAgICAgICAgICAgdGhpcy5jbGVhci5lbWl0KGFyZ3MpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy51cGxvYWRTZXJ2aWNlLmNvbXBsZXRlRXZlbnQuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICAgIHRoaXMuY29tcGxldGUuZW1pdCgpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy51cGxvYWRTZXJ2aWNlLmVycm9yRXZlbnQuc3Vic2NyaWJlKChhcmdzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmVycm9yLmVtaXQoYXJncyk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzLmFkZCh0aGlzLnVwbG9hZFNlcnZpY2UucGF1c2VFdmVudC5zdWJzY3JpYmUoKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIHRoaXMucGF1c2UuZW1pdChhcmdzKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnMuYWRkKHRoaXMudXBsb2FkU2VydmljZS5yZW1vdmVFdmVudC5zdWJzY3JpYmUoKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIHRoaXMucmVtb3ZlLmVtaXQoYXJncyk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzLmFkZCh0aGlzLnVwbG9hZFNlcnZpY2UucmVzdW1lRXZlbnQuc3Vic2NyaWJlKChhcmdzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnJlc3VtZS5lbWl0KGFyZ3MpO1xuICAgICAgICB9KSk7XG4gICAgICAgIHRoaXMuc3Vicy5hZGQodGhpcy51cGxvYWRTZXJ2aWNlLnNlbGVjdEV2ZW50LnN1YnNjcmliZSgoYXJncykgPT4ge1xuICAgICAgICAgICAgdGhpcy5zZWxlY3QuZW1pdChhcmdzKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnMuYWRkKHRoaXMudXBsb2FkU2VydmljZS5zdWNjZXNzRXZlbnQuc3Vic2NyaWJlKChhcmdzKSA9PiB7XG4gICAgICAgICAgICB0aGlzLnN1Y2Nlc3MuZW1pdChhcmdzKTtcbiAgICAgICAgfSkpO1xuICAgICAgICB0aGlzLnN1YnMuYWRkKHRoaXMudXBsb2FkU2VydmljZS51cGxvYWRFdmVudC5zdWJzY3JpYmUoKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkLmVtaXQoYXJncyk7XG4gICAgICAgIH0pKTtcbiAgICAgICAgdGhpcy5zdWJzLmFkZCh0aGlzLnVwbG9hZFNlcnZpY2UudXBsb2FkUHJvZ3Jlc3NFdmVudC5zdWJzY3JpYmUoKGFyZ3MpID0+IHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkUHJvZ3Jlc3MuZW1pdChhcmdzKTtcbiAgICAgICAgfSkpO1xuICAgIH1cbn1cblVwbG9hZENvbXBvbmVudC5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGV4cG9ydEFzOiAna2VuZG9VcGxvYWQnLFxuICAgICAgICAgICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgICAgICAgICBMb2NhbGl6YXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICBOYXZpZ2F0aW9uU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAgVXBsb2FkU2VydmljZSxcbiAgICAgICAgICAgICAgICAgICAgRHJvcFpvbmVTZXJ2aWNlLFxuICAgICAgICAgICAgICAgICAgICBVUExPQURfVkFMVUVfQUNDRVNTT1IsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby51cGxvYWQnXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IEtlbmRvSW5wdXQsXG4gICAgICAgICAgICAgICAgICAgICAgICB1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBVcGxvYWRDb21wb25lbnQpXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAna2VuZG8tdXBsb2FkJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogYFxuICAgIDxuZy1jb250YWluZXIga2VuZG9VcGxvYWRMb2NhbGl6ZWRNZXNzYWdlc1xuICAgICAgaTE4bi1jYW5jZWw9XCJrZW5kby51cGxvYWQuY2FuY2VsfFRoZSB0ZXh0IGZvciB0aGUgQ2FuY2VsIGJ1dHRvblwiXG4gICAgICBjYW5jZWw9XCJDYW5jZWxcIlxuXG4gICAgICBpMThuLWNsZWFyU2VsZWN0ZWRGaWxlcz1cImtlbmRvLnVwbG9hZC5jbGVhclNlbGVjdGVkRmlsZXN8VGhlIHRleHQgZm9yIHRoZSBDbGVhciBidXR0b25cIlxuICAgICAgY2xlYXJTZWxlY3RlZEZpbGVzPVwiQ2xlYXJcIlxuXG4gICAgICBpMThuLWRyb3BGaWxlc0hlcmU9XCJrZW5kby51cGxvYWQuZHJvcEZpbGVzSGVyZXxUaGUgZHJvcCB6b25lIGhpbnRcIlxuICAgICAgZHJvcEZpbGVzSGVyZT1cIkRyb3AgZmlsZXMgaGVyZSB0byB1cGxvYWRcIlxuXG4gICAgICBpMThuLWZpbGVzQmF0Y2hTdGF0dXM9XCJrZW5kby51cGxvYWQuZmlsZXNCYXRjaFN0YXR1c3xUaGUgc3RhdHVzIG1lc3NhZ2UgZm9yIGEgYmF0Y2ggb2YgZmlsZXNcIlxuICAgICAgZmlsZXNCYXRjaFN0YXR1cz1cImZpbGVzXCJcblxuICAgICAgaTE4bi1maWxlc0JhdGNoU3RhdHVzRmFpbGVkPVwia2VuZG8udXBsb2FkLmZpbGVzQmF0Y2hTdGF0dXNGYWlsZWR8VGhlIHN0YXR1cyBtZXNzYWdlIGZvciBhIGJhdGNoIG9mIGZpbGVzIGFmdGVyIGZhaWxlZCB1cGxvYWRcIlxuICAgICAgZmlsZXNCYXRjaFN0YXR1c0ZhaWxlZD1cImZpbGVzIGZhaWxlZCB0byB1cGxvYWQuXCJcblxuICAgICAgaTE4bi1maWxlc0JhdGNoU3RhdHVzVXBsb2FkZWQ9XCJrZW5kby51cGxvYWQuZmlsZXNCYXRjaFN0YXR1c1VwbG9hZGVkfFRoZSBzdGF0dXMgbWVzc2FnZSBmb3IgYSBiYXRjaCBvZiBmaWxlcyBhZnRlciBzdWNjZXNzZnVsIHVwbG9hZFwiXG4gICAgICBmaWxlc0JhdGNoU3RhdHVzVXBsb2FkZWQ9XCJmaWxlcyBzdWNjZXNzZnVsbHkgdXBsb2FkZWQuXCJcblxuICAgICAgaTE4bi1maWxlU3RhdHVzRmFpbGVkPVwia2VuZG8udXBsb2FkLmZpbGVTdGF0dXNGYWlsZWR8VGhlIGZpbGUgc3RhdHVzIG1lc3NhZ2UgYWZ0ZXIgZmFpbGVkIHVwbG9hZFwiXG4gICAgICBmaWxlU3RhdHVzRmFpbGVkPVwiRmlsZSBmYWlsZWQgdG8gdXBsb2FkLlwiXG5cbiAgICAgIGkxOG4tZmlsZVN0YXR1c1VwbG9hZGVkPVwia2VuZG8udXBsb2FkLmZpbGVTdGF0dXNVcGxvYWRlZHxUaGUgZmlsZSBzdGF0dXMgbWVzc2FnZSBhZnRlciBzdWNjZXNzZnVsIHVwbG9hZFwiXG4gICAgICBmaWxlU3RhdHVzVXBsb2FkZWQ9XCJGaWxlIHN1Y2Nlc3NmdWxseSB1cGxvYWRlZC5cIlxuXG4gICAgICBpMThuLWhlYWRlclN0YXR1c1BhdXNlZD1cImtlbmRvLnVwbG9hZC5oZWFkZXJTdGF0dXNQYXVzZWR8VGhlIGhlYWRlciBzdGF0dXMgbWVzc2FnZSB3aGVuIHRoZSBmaWxlIHVwbG9hZCBpcyBwYXVzZWRcIlxuICAgICAgaGVhZGVyU3RhdHVzUGF1c2VkPVwiUGF1c2VkXCJcblxuICAgICAgaTE4bi1oZWFkZXJTdGF0dXNVcGxvYWRlZD1cImtlbmRvLnVwbG9hZC5oZWFkZXJTdGF0dXNVcGxvYWRlZHxUaGUgaGVhZGVyIHN0YXR1cyBtZXNzYWdlIGFmdGVyIGZpbGUgdXBsb2FkIGNvbXBsZXRpb25cIlxuICAgICAgaGVhZGVyU3RhdHVzVXBsb2FkZWQ9XCJEb25lXCJcblxuICAgICAgaTE4bi1oZWFkZXJTdGF0dXNVcGxvYWRpbmc9XCJrZW5kby51cGxvYWQuaGVhZGVyU3RhdHVzVXBsb2FkaW5nfFRoZSBoZWFkZXIgc3RhdHVzIG1lc3NhZ2UgZHVyaW5nIGZpbGUgdXBsb2FkXCJcbiAgICAgIGhlYWRlclN0YXR1c1VwbG9hZGluZz1cIlVwbG9hZGluZy4uLlwiXG5cbiAgICAgIGkxOG4taW52YWxpZEZpbGVFeHRlbnNpb249XCJrZW5kby51cGxvYWQuaW52YWxpZEZpbGVFeHRlbnNpb258VGhlIHRleHQgZm9yIHRoZSBpbnZhbGlkIGFsbG93ZWQgZXh0ZW5zaW9ucyByZXN0cmljdGlvbiBtZXNzYWdlXCJcbiAgICAgIGludmFsaWRGaWxlRXh0ZW5zaW9uPVwiRmlsZSB0eXBlIG5vdCBhbGxvd2VkLlwiXG5cbiAgICAgIGkxOG4taW52YWxpZE1heEZpbGVTaXplPVwia2VuZG8udXBsb2FkLmludmFsaWRNYXhGaWxlU2l6ZXxUaGUgdGV4dCBmb3IgdGhlIGludmFsaWQgbWF4IGZpbGUgc2l6ZSByZXN0cmljdGlvbiBtZXNzYWdlXCJcbiAgICAgIGludmFsaWRNYXhGaWxlU2l6ZT1cIkZpbGUgc2l6ZSB0b28gbGFyZ2UuXCJcblxuICAgICAgaTE4bi1pbnZhbGlkTWluRmlsZVNpemU9XCJrZW5kby51cGxvYWQuaW52YWxpZE1pbkZpbGVTaXplfFRoZSB0ZXh0IGZvciB0aGUgaW52YWxpZCBtaW4gZmlsZSBzaXplIHJlc3RyaWN0aW9uIG1lc3NhZ2VcIlxuICAgICAgaW52YWxpZE1pbkZpbGVTaXplPVwiRmlsZSBzaXplIHRvbyBzbWFsbC5cIlxuXG4gICAgICBpMThuLXBhdXNlPVwia2VuZG8udXBsb2FkLnBhdXNlfFRoZSB0ZXh0IGZvciB0aGUgUGF1c2UgYnV0dG9uXCJcbiAgICAgIHBhdXNlPVwiUGF1c2VcIlxuXG4gICAgICBpMThuLXJlbW92ZT1cImtlbmRvLnVwbG9hZC5yZW1vdmV8VGhlIHRleHQgZm9yIHRoZSBSZW1vdmUgYnV0dG9uXCJcbiAgICAgIHJlbW92ZT1cIlJlbW92ZVwiXG5cbiAgICAgIGkxOG4tcmVzdW1lPVwia2VuZG8udXBsb2FkLnJlc3VtZXxUaGUgdGV4dCBmb3IgdGhlIFJlc3VtZSBidXR0b25cIlxuICAgICAgcmVzdW1lPVwiUmVzdW1lXCJcblxuICAgICAgaTE4bi1yZXRyeT1cImtlbmRvLnVwbG9hZC5yZXRyeXxUaGUgdGV4dCBmb3IgdGhlIFJldHJ5IGJ1dHRvblwiXG4gICAgICByZXRyeT1cIlJldHJ5XCJcblxuICAgICAgaTE4bi1zZWxlY3Q9XCJrZW5kby51cGxvYWQuc2VsZWN0fFRoZSB0ZXh0IGZvciB0aGUgU2VsZWN0IGJ1dHRvblwiXG4gICAgICBzZWxlY3Q9XCJTZWxlY3QgZmlsZXMuLi5cIlxuXG4gICAgICBpMThuLXVwbG9hZFNlbGVjdGVkRmlsZXM9XCJrZW5kby51cGxvYWQudXBsb2FkU2VsZWN0ZWRGaWxlc3xUaGUgdGV4dCBmb3IgdGhlIFVwbG9hZCBmaWxlcyBidXR0b25cIlxuICAgICAgdXBsb2FkU2VsZWN0ZWRGaWxlcz1cIlVwbG9hZFwiXG4gICAgPlxuICAgIDwvbmctY29udGFpbmVyPlxuICAgIDxkaXYga2VuZG9VcGxvYWRJbnRlcm5hbERyb3Bab25lXG4gICAgICBbcmVzdHJpY3Rpb25zXT1cInJlc3RyaWN0aW9uc1wiXG4gICAgICBbbXVsdGlwbGVdPVwibXVsdGlwbGVcIlxuICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCI+XG4gICAgICAgIDxkaXYgcm9sZT1cImJ1dHRvblwiICNmaWxlU2VsZWN0QnV0dG9uXG4gICAgICAgICAgICAgW2lkXT1cImZvY3VzYWJsZUlkXCJcbiAgICAgICAgICAgICBbYXR0ci5hcmlhLWxhYmVsXT1cInRleHRGb3IoJ3NlbGVjdCcpXCJcbiAgICAgICAgICAgICBbYXR0ci50YWJpbmRleF09XCJzZWxlY3RCdXR0b25UYWJJbmRleFwiXG4gICAgICAgICAgICAgKGZvY3VzKT1cIm9uRmlsZVNlbGVjdEJ1dHRvbkZvY3VzKCRldmVudClcIlxuICAgICAgICAgICAgIChibHVyKT1cIm9uRmlsZVNlbGVjdEJ1dHRvbkJsdXIoJGV2ZW50KVwiXG4gICAgICAgICAgICAgY2xhc3M9XCJrLWJ1dHRvbiBrLXVwbG9hZC1idXR0b25cIj5cbiAgICAgICAgICA8aW5wdXQgI2ZpbGVTZWxlY3Qga2VuZG9GaWxlU2VsZWN0XG4gICAgICAgICAgICBbYXR0ci5hY2NlcHRdPVwiYWNjZXB0ID8gYWNjZXB0IDogbnVsbFwiXG4gICAgICAgICAgICBbZGlyXT1cImRpcmVjdGlvblwiXG4gICAgICAgICAgICBbcmVzdHJpY3Rpb25zXT1cInJlc3RyaWN0aW9uc1wiXG4gICAgICAgICAgICBbbXVsdGlwbGVdPVwibXVsdGlwbGVcIlxuICAgICAgICAgICAgW2Rpc2FibGVkXT1cImRpc2FibGVkXCIgLz5cbiAgICAgICAgICA8c3Bhbj57e3RleHRGb3IoJ3NlbGVjdCcpfX08L3NwYW4+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8a2VuZG8tdXBsb2FkLXN0YXR1cy10b3RhbCAqbmdJZj1cInNob3dUb3RhbFN0YXR1c1wiXG4gICAgICAgICAgY2xhc3M9XCJrLXVwbG9hZC1zdGF0dXMgay11cGxvYWQtc3RhdHVzLXRvdGFsXCJcbiAgICAgICAgICBbZmlsZUxpc3RdPVwiZmlsZUxpc3RcIj5cbiAgICAgICAgPC9rZW5kby11cGxvYWQtc3RhdHVzLXRvdGFsPlxuICAgICAgICA8ZGl2IGNsYXNzPVwiay1kcm9wem9uZS1oaW50XCI+e3t0ZXh0Rm9yKCdkcm9wRmlsZXNIZXJlJyl9fTwvZGl2PlxuICAgIDwvZGl2PlxuICAgIDx1bCBrZW5kby11cGxvYWQtZmlsZS1saXN0ICpuZ0lmPVwic2hvd0ZpbGVMaXN0ICYmIGZpbGVMaXN0LmNvdW50ID4gMFwiXG4gICAgICAgIGNsYXNzPVwiay11cGxvYWQtZmlsZXMgay1yZXNldFwiXG4gICAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICAgIFtmaWxlTGlzdF09XCJmaWxlTGlzdC5maWxlc1wiXG4gICAgICAgIFtmaWxlVGVtcGxhdGVdPVwiZmlsZVRlbXBsYXRlXCI+XG4gICAgPC91bD5cbiAgICA8a2VuZG8tdXBsb2FkLWFjdGlvbi1idXR0b25zXG4gICAgICAqbmdJZj1cInNob3dBY3Rpb25CdXR0b25zXCJcbiAgICAgIFtkaXNhYmxlZF09XCJkaXNhYmxlZFwiXG4gICAgICBbYWN0aW9uc0xheW91dF09XCJhY3Rpb25zTGF5b3V0XCI+XG4gICAgPC9rZW5kby11cGxvYWQtYWN0aW9uLWJ1dHRvbnM+XG4gIGBcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuVXBsb2FkQ29tcG9uZW50LmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogVXBsb2FkU2VydmljZSB9LFxuICAgIHsgdHlwZTogTG9jYWxpemF0aW9uU2VydmljZSB9LFxuICAgIHsgdHlwZTogTmF2aWdhdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IERyb3Bab25lU2VydmljZSB9LFxuICAgIHsgdHlwZTogTmdab25lIH0sXG4gICAgeyB0eXBlOiBSZW5kZXJlcjIgfSxcbiAgICB7IHR5cGU6IENoYW5nZURldGVjdG9yUmVmIH0sXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH1cbl07XG5VcGxvYWRDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgYXV0b1VwbG9hZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgYmF0Y2g6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHdpdGhDcmVkZW50aWFsczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgc2F2ZUZpZWxkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBzYXZlSGVhZGVyczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgc2F2ZU1ldGhvZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgc2F2ZVVybDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgcmVzcG9uc2VUeXBlOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICByZW1vdmVGaWVsZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgcmVtb3ZlSGVhZGVyczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgcmVtb3ZlTWV0aG9kOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICByZW1vdmVVcmw6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGNodW5rYWJsZTogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgY29uY3VycmVudDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgbXVsdGlwbGU6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGRpc2FibGVkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBzaG93RmlsZUxpc3Q6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHRhYmluZGV4OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICB6b25lSWQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHRhYkluZGV4OiBbeyB0eXBlOiBJbnB1dCwgYXJnczogWyd0YWJJbmRleCcsXSB9XSxcbiAgICBhY2NlcHQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIHJlc3RyaWN0aW9uczogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgZm9jdXNhYmxlSWQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGFjdGlvbnNMYXlvdXQ6IFt7IHR5cGU6IElucHV0IH1dLFxuICAgIGZpbGVUZW1wbGF0ZTogW3sgdHlwZTogQ29udGVudENoaWxkLCBhcmdzOiBbRmlsZVRlbXBsYXRlRGlyZWN0aXZlLF0gfV0sXG4gICAgZmlsZVNlbGVjdDogW3sgdHlwZTogVmlld0NoaWxkLCBhcmdzOiBbJ2ZpbGVTZWxlY3QnLF0gfV0sXG4gICAgZmlsZVNlbGVjdEJ1dHRvbjogW3sgdHlwZTogVmlld0NoaWxkLCBhcmdzOiBbJ2ZpbGVTZWxlY3RCdXR0b24nLF0gfV0sXG4gICAgb25CbHVyOiBbeyB0eXBlOiBPdXRwdXQsIGFyZ3M6IFsnYmx1cicsXSB9XSxcbiAgICBjYW5jZWw6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBjbGVhcjogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIGNvbXBsZXRlOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgZXJyb3I6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBvbkZvY3VzOiBbeyB0eXBlOiBPdXRwdXQsIGFyZ3M6IFsnZm9jdXMnLF0gfV0sXG4gICAgcGF1c2U6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICByZW1vdmU6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICByZXN1bWU6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBzZWxlY3Q6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICBzdWNjZXNzOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgdXBsb2FkOiBbeyB0eXBlOiBPdXRwdXQgfV0sXG4gICAgdXBsb2FkUHJvZ3Jlc3M6IFt7IHR5cGU6IE91dHB1dCB9XSxcbiAgICB2YWx1ZUNoYW5nZTogW3sgdHlwZTogT3V0cHV0IH1dLFxuICAgIGhvc3REZWZhdWx0Q2xhc3NlczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay13aWRnZXQnLF0gfSwgeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLXVwbG9hZCcsXSB9XSxcbiAgICBob3N0RGlzYWJsZWRDbGFzczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1zdGF0ZS1kaXNhYmxlZCcsXSB9XSxcbiAgICBkaXI6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIuZGlyJyxdIH1dLFxuICAgIGhhbmRsZUtleWRvd246IFt7IHR5cGU6IEhvc3RMaXN0ZW5lciwgYXJnczogWydrZXlkb3duJywgWyckZXZlbnQnXSxdIH1dXG59O1xuXG5jbGFzcyBVcGxvYWREcm9wWm9uZURpcmVjdGl2ZSB7XG4gICAgY29uc3RydWN0b3IoZHJvcFpvbmVTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuZHJvcFpvbmVTZXJ2aWNlID0gZHJvcFpvbmVTZXJ2aWNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25FbGVtZW50RHJhZ0VudGVyKCkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBvbkVsZW1lbnREcmFnT3ZlcigpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgICAvKipcbiAgICAgKiBAaGlkZGVuXG4gICAgICovXG4gICAgb25Ecm9wTGlzdGVuZXIoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgY29tcG9uZW50cyA9IHRoaXMuY29tcG9uZW50SW5zdGFuY2U7XG4gICAgICAgIGlmICghaXNQcmVzZW50KGNvbXBvbmVudHMpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29tcG9uZW50cy5mb3JFYWNoKChjb21wb25lbnQpID0+IHtcbiAgICAgICAgICAgIGxldCBkcm9wcGVkRmlsZXMgPSBldmVudC5kYXRhVHJhbnNmZXIuZmlsZXM7XG4gICAgICAgICAgICBpZiAoZHJvcHBlZEZpbGVzLmxlbmd0aCA+IDAgJiYgIWNvbXBvbmVudC5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgIGxldCBmaWxlcyA9IGdldEFsbEZpbGVJbmZvKGRyb3BwZWRGaWxlcyk7XG4gICAgICAgICAgICAgICAgaWYgKGNvbXBvbmVudCBpbnN0YW5jZW9mIFVwbG9hZENvbXBvbmVudCkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlcyA9IGFzc2lnbkd1aWRUb0ZpbGVzKGZpbGVzLCAhY29tcG9uZW50LmJhdGNoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbGVzID0gYXNzaWduR3VpZFRvRmlsZXMoZmlsZXMsIHRydWUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAoIWNvbXBvbmVudC5tdWx0aXBsZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWxlcy5zcGxpY2UoMSwgZmlsZXMubGVuZ3RoIC0gMSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbXBvbmVudC5jbGVhckZpbGVzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhbGlkYXRlRmlsZXMoZmlsZXMsIGNvbXBvbmVudC5yZXN0cmljdGlvbnMpO1xuICAgICAgICAgICAgICAgIGNvbXBvbmVudC5hZGRGaWxlcyhmaWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZXQgY29tcG9uZW50SW5zdGFuY2UoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmRyb3Bab25lU2VydmljZS5nZXRDb21wb25lbnRzKHRoaXMuem9uZUlkKTtcbiAgICB9XG59XG5VcGxvYWREcm9wWm9uZURpcmVjdGl2ZS5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogRGlyZWN0aXZlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIHByb3ZpZGVyczogW1xuICAgICAgICAgICAgICAgICAgICBEcm9wWm9uZVNlcnZpY2VcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnW2tlbmRvVXBsb2FkRHJvcFpvbmVdLCBba2VuZG9GaWxlU2VsZWN0RHJvcFpvbmVdJ1xuICAgICAgICAgICAgfSxdIH0sXG5dO1xuLyoqIEBub2NvbGxhcHNlICovXG5VcGxvYWREcm9wWm9uZURpcmVjdGl2ZS5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IERyb3Bab25lU2VydmljZSB9XG5dO1xuVXBsb2FkRHJvcFpvbmVEaXJlY3RpdmUucHJvcERlY29yYXRvcnMgPSB7XG4gICAgem9uZUlkOiBbeyB0eXBlOiBJbnB1dCwgYXJnczogWydrZW5kb1VwbG9hZERyb3Bab25lJyxdIH1dLFxuICAgIG9uRWxlbWVudERyYWdFbnRlcjogW3sgdHlwZTogSG9zdExpc3RlbmVyLCBhcmdzOiBbJ2RyYWdlbnRlcicsXSB9XSxcbiAgICBvbkVsZW1lbnREcmFnT3ZlcjogW3sgdHlwZTogSG9zdExpc3RlbmVyLCBhcmdzOiBbJ2RyYWdvdmVyJyxdIH1dLFxuICAgIG9uRHJvcExpc3RlbmVyOiBbeyB0eXBlOiBIb3N0TGlzdGVuZXIsIGFyZ3M6IFsnZHJvcCcsIFsnJGV2ZW50J10sXSB9XVxufTtcblxuLyogdHNsaW50OmRpc2FibGU6IG5vLXVzZS1iZWZvcmUtZGVjbGFyZSAqL1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbS2VuZG8gVUkgVXBsb2FkRHJvcFpvbmUgY29tcG9uZW50IGZvciBBbmd1bGFyXSh7JSBzbHVnIG92ZXJ2aWV3X3VwbG9hZCAlfSkuXG4gKi9cbmNsYXNzIFVwbG9hZERyb3Bab25lQ29tcG9uZW50IGV4dGVuZHMgRHJvcFpvbmVCYXNlIHtcbiAgICBjb25zdHJ1Y3RvcihlbGVtZW50LCByZW5kZXJlciwgbG9jYWxpemF0aW9uKSB7XG4gICAgICAgIHN1cGVyKGVsZW1lbnQsIHJlbmRlcmVyLCAnay1leHRlcm5hbC1kcm9wem9uZS1ob3ZlcicpO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgdGhpcy5ob3N0Q2xhc3MgPSB0cnVlO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbkNoYW5nZVN1YnNjcmlwdGlvbiA9IHRoaXMubG9jYWxpemF0aW9uLmNoYW5nZXMuc3Vic2NyaWJlKCh7IHJ0bCB9KSA9PiB7XG4gICAgICAgICAgICB0aGlzLmRpcmVjdGlvbiA9IHJ0bCA/ICdydGwnIDogJ2x0cic7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXQgZGlyQXR0cmlidXRlKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5kaXJlY3Rpb247XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICB0ZXh0Rm9yKGtleSkge1xuICAgICAgICByZXR1cm4gdGhpcy5sb2NhbGl6YXRpb24uZ2V0KGtleSk7XG4gICAgfVxuICAgIC8qKlxuICAgICAqIEBoaWRkZW5cbiAgICAgKi9cbiAgICBnZXQgaWNvbkNsYXNzZXMoKSB7XG4gICAgICAgIGlmICh0aGlzLmljb24pIHtcbiAgICAgICAgICAgIHJldHVybiBgay1pY29uIGstaS0ke3RoaXMuaWNvbn1gO1xuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmljb25DbGFzcykge1xuICAgICAgICAgICAgcmV0dXJuIGAke3RoaXMuaWNvbkNsYXNzfWA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuICdrLWljb24gay1pLXVwbG9hZCc7XG4gICAgfVxuICAgIG5nT25EZXN0cm95KCkge1xuICAgICAgICBpZiAodGhpcy5sb2NhbGl6YXRpb25DaGFuZ2VTdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICAgIHRoaXMubG9jYWxpemF0aW9uQ2hhbmdlU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5VcGxvYWREcm9wWm9uZUNvbXBvbmVudC5kZWNvcmF0b3JzID0gW1xuICAgIHsgdHlwZTogQ29tcG9uZW50LCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGV4cG9ydEFzOiAna2VuZG9VcGxvYWREcm9wWm9uZScsXG4gICAgICAgICAgICAgICAgcHJvdmlkZXJzOiBbXG4gICAgICAgICAgICAgICAgICAgIExvY2FsaXphdGlvblNlcnZpY2UsXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHByb3ZpZGU6IEwxME5fUFJFRklYLFxuICAgICAgICAgICAgICAgICAgICAgICAgdXNlVmFsdWU6ICdrZW5kby51cGxvYWRkcm9wem9uZSdcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdrZW5kby11cGxvYWRkcm9wem9uZScsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICA8bmctY29udGFpbmVyIGtlbmRvVXBsb2FkRHJvcFpvbmVMb2NhbGl6ZWRNZXNzYWdlc1xuICAgICAgaTE4bi1leHRlcm5hbERyb3BGaWxlc0hlcmU9J2tlbmRvLnVwbG9hZGRyb3B6b25lLmV4dGVybmFsRHJvcEZpbGVzSGVyZXxTZXRzIHRoZSBleHRlcm5hbCBkcm9wLXpvbmUgaGludCdcbiAgICAgIGV4dGVybmFsRHJvcEZpbGVzSGVyZT0nRHJhZyBhbmQgZHJvcCBmaWxlcyBoZXJlIHRvIHVwbG9hZCdcbiAgICA+XG4gICAgPC9uZy1jb250YWluZXI+XG4gICAgPGRpdiBjbGFzcz0nay1kcm9wem9uZS1pbm5lcicgW2tlbmRvVXBsb2FkRHJvcFpvbmVdPVwiem9uZUlkXCI+XG4gICAgICA8c3BhbiBbbmdDbGFzc109XCJpY29uQ2xhc3Nlc1wiPjwvc3Bhbj5cbiAgICAgIDxzcGFuIGNsYXNzPVwiay1kcm9wem9uZS1oaW50XCI+e3sgdGV4dEZvcignZXh0ZXJuYWxEcm9wRmlsZXNIZXJlJykgfX08L3NwYW4+XG4gICAgICA8c3BhbiBjbGFzcz1cImstZHJvcHpvbmUtbm90ZVwiPlxuICAgICAgICA8bmctY29udGVudD48L25nLWNvbnRlbnQ+XG4gICAgICA8L3NwYW4+XG4gICAgPC9kaXY+XG4gIGBcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuVXBsb2FkRHJvcFpvbmVDb21wb25lbnQuY3RvclBhcmFtZXRlcnMgPSAoKSA9PiBbXG4gICAgeyB0eXBlOiBFbGVtZW50UmVmIH0sXG4gICAgeyB0eXBlOiBSZW5kZXJlcjIgfSxcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfVxuXTtcblVwbG9hZERyb3Bab25lQ29tcG9uZW50LnByb3BEZWNvcmF0b3JzID0ge1xuICAgIGhvc3RDbGFzczogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1leHRlcm5hbC1kcm9wem9uZScsXSB9XSxcbiAgICBkaXJBdHRyaWJ1dGU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2F0dHIuZGlyJyxdIH1dLFxuICAgIHpvbmVJZDogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaWNvbjogW3sgdHlwZTogSW5wdXQgfV0sXG4gICAgaWNvbkNsYXNzOiBbeyB0eXBlOiBJbnB1dCB9XVxufTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNvbnN0IFNIQVJFRF9ERUNMQVJBVElPTlMgPSBbXG4gICAgRHJvcFpvbmVJbnRlcm5hbERpcmVjdGl2ZSxcbiAgICBGaWxlTGlzdENvbXBvbmVudCxcbiAgICBGaWxlTGlzdEl0ZW1EaXJlY3RpdmUsXG4gICAgRmlsZUxpc3RJdGVtQWN0aW9uQnV0dG9uQ29tcG9uZW50LFxuICAgIEZpbGVMaXN0TXVsdGlwbGVJdGVtc0NvbXBvbmVudCxcbiAgICBGaWxlTGlzdFNpbmdsZUl0ZW1Db21wb25lbnQsXG4gICAgRmlsZVNlbGVjdERpcmVjdGl2ZSxcbiAgICBMb2NhbGl6ZWRNZXNzYWdlc0RpcmVjdGl2ZSxcbiAgICBUZW1wbGF0ZUNvbnRleHREaXJlY3RpdmVcbl07XG4vKipcbiAqIEBoaWRkZW5cbiAqL1xuY29uc3QgUFVCTElDX0RJUkVDVElWRVMgPSBbXG4gICAgRmlsZVRlbXBsYXRlRGlyZWN0aXZlLFxuICAgIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50LFxuICAgIFVwbG9hZERyb3Bab25lRGlyZWN0aXZlLFxuICAgIFVwbG9hZERyb3Bab25lQ29tcG9uZW50XG5dO1xuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIFNoYXJlZE1vZHVsZSB7XG59XG5TaGFyZWRNb2R1bGUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IE5nTW9kdWxlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogW1xuICAgICAgICAgICAgICAgICAgICBQVUJMSUNfRElSRUNUSVZFUyxcbiAgICAgICAgICAgICAgICAgICAgU0hBUkVEX0RFQ0xBUkFUSU9OU1xuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgZXhwb3J0czogW1xuICAgICAgICAgICAgICAgICAgICBQVUJMSUNfRElSRUNUSVZFUyxcbiAgICAgICAgICAgICAgICAgICAgU0hBUkVEX0RFQ0xBUkFUSU9OUyxcbiAgICAgICAgICAgICAgICAgICAgQ29tbW9uTW9kdWxlXG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBpbXBvcnRzOiBbQ29tbW9uTW9kdWxlXVxuICAgICAgICAgICAgfSxdIH0sXG5dO1xuXG5jb25zdCBGSUxFU0VMRUNUX0RFQ0xBUkFUSU9OUyA9IFtcbiAgICBGaWxlU2VsZWN0Q29tcG9uZW50XG5dO1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbTmdNb2R1bGVdKGh0dHBzOi8vYW5ndWxhci5pby9hcGkvY29yZS9OZ01vZHVsZSkgZGVmaW5pdGlvbiBmb3IgdGhlIEZpbGVTZWxlY3QgY29tcG9uZW50LlxuICovXG5jbGFzcyBGaWxlU2VsZWN0TW9kdWxlIHtcbn1cbkZpbGVTZWxlY3RNb2R1bGUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IE5nTW9kdWxlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogW0ZJTEVTRUxFQ1RfREVDTEFSQVRJT05TXSxcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBbXG4gICAgICAgICAgICAgICAgICAgIFBVQkxJQ19ESVJFQ1RJVkVTLFxuICAgICAgICAgICAgICAgICAgICBGSUxFU0VMRUNUX0RFQ0xBUkFUSU9OU1xuICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgaW1wb3J0czogW1NoYXJlZE1vZHVsZV1cbiAgICAgICAgICAgIH0sXSB9LFxuXTtcblxuLyoqXG4gKiBAaGlkZGVuXG4gKi9cbmNsYXNzIFVwbG9hZEFjdGlvbkJ1dHRvbnNDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKHVwbG9hZFNlcnZpY2UsIGxvY2FsaXphdGlvbiwgbmF2aWdhdGlvbikge1xuICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UgPSB1cGxvYWRTZXJ2aWNlO1xuICAgICAgICB0aGlzLmxvY2FsaXphdGlvbiA9IGxvY2FsaXphdGlvbjtcbiAgICAgICAgdGhpcy5uYXZpZ2F0aW9uID0gbmF2aWdhdGlvbjtcbiAgICAgICAgdGhpcy5ob3N0RGVmYXVsdENsYXNzID0gdHJ1ZTtcbiAgICAgICAgdGhpcy5vbkFjdGlvbigpO1xuICAgICAgICB0aGlzLm9uRm9jdXMoKTtcbiAgICB9XG4gICAgZ2V0IGFjdGlvbkJ1dHRvbnNFbmRDbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbnNMYXlvdXQgPT09ICdlbmQnO1xuICAgIH1cbiAgICBnZXQgYWN0aW9uQnV0dG9uc1N0cmV0Y2hlZENsYXNzTmFtZSgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWN0aW9uc0xheW91dCA9PT0gJ3N0cmV0Y2hlZCc7XG4gICAgfVxuICAgIGdldCBhY3Rpb25CdXR0b25zU3RhcnRDbGFzc05hbWUoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLmFjdGlvbnNMYXlvdXQgPT09ICdzdGFydCc7XG4gICAgfVxuICAgIGdldCBhY3Rpb25CdXR0b25zQ2VudGVyQ2xhc3NOYW1lKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5hY3Rpb25zTGF5b3V0ID09PSAnY2VudGVyJztcbiAgICB9XG4gICAgb25BY3Rpb24oKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uU3Vic2NyaXB0aW9uID0gdGhpcy5uYXZpZ2F0aW9uLm9uQWN0aW9uQnV0dG9uQWN0aW9uLnN1YnNjcmliZSgoYnV0dG9uKSA9PiB7XG4gICAgICAgICAgICBpZiAoYnV0dG9uID09PSBcImNsZWFyXCIpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmNsZWFyRmlsZXMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHRoaXMucGVyZm9ybVVwbG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdGhpcy5uYXZpZ2F0aW9uLmZvY3VzU2VsZWN0QnV0dG9uKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvbkZvY3VzKCkge1xuICAgICAgICB0aGlzLmZvY3VzU3Vic2NyaXB0aW9uID0gdGhpcy5uYXZpZ2F0aW9uLm9uQWN0aW9uQnV0dG9uRm9jdXMuc3Vic2NyaWJlKChidXR0b24pID0+IHtcbiAgICAgICAgICAgIHRoaXMuZm9jdXNCdXR0b24oYnV0dG9uKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZvY3VzQnV0dG9uKGJ1dHRvbikge1xuICAgICAgICBjb25zdCBlbCA9IChidXR0b24gPT09IFwiY2xlYXJcIikgPyB0aGlzLmNsZWFyQnV0dG9uIDogdGhpcy51cGxvYWRCdXR0b247XG4gICAgICAgIGVsLm5hdGl2ZUVsZW1lbnQuZm9jdXMoKTtcbiAgICB9XG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuYWN0aW9uU3Vic2NyaXB0aW9uLnVuc3Vic2NyaWJlKCk7XG4gICAgICAgIHRoaXMuZm9jdXNTdWJzY3JpcHRpb24udW5zdWJzY3JpYmUoKTtcbiAgICB9XG4gICAgcGVyZm9ybVVwbG9hZChfZXZlbnQpIHtcbiAgICAgICAgaWYgKCF0aGlzLmRpc2FibGVkKSB7XG4gICAgICAgICAgICB0aGlzLnVwbG9hZFNlcnZpY2UudXBsb2FkRmlsZXMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhckZpbGVzKF9ldmVudCkge1xuICAgICAgICBpZiAoIXRoaXMuZGlzYWJsZWQpIHtcbiAgICAgICAgICAgIHRoaXMudXBsb2FkU2VydmljZS5jbGVhckZpbGVzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdGV4dEZvcihrZXkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMubG9jYWxpemF0aW9uLmdldChrZXkpO1xuICAgIH1cbn1cblVwbG9hZEFjdGlvbkJ1dHRvbnNDb21wb25lbnQuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IENvbXBvbmVudCwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBzZWxlY3RvcjogJ2tlbmRvLXVwbG9hZC1hY3Rpb24tYnV0dG9ucycsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGU6IGBcbiAgICAgICAgPGJ1dHRvbiAjY2xlYXJCdXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiay1idXR0b24gay1jbGVhci1zZWxlY3RlZFwiXG4gICAgICAgICAgICBbYXR0ci50YWJJbmRleF09XCItMVwiXG4gICAgICAgICAgICAoY2xpY2spPVwiY2xlYXJGaWxlcygkZXZlbnQpXCI+XG4gICAgICAgICAgICAgICAge3t0ZXh0Rm9yKCdjbGVhclNlbGVjdGVkRmlsZXMnKX19XG4gICAgICAgIDwvYnV0dG9uPlxuICAgICAgICA8YnV0dG9uICN1cGxvYWRCdXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiay1idXR0b24gay1wcmltYXJ5IGstdXBsb2FkLXNlbGVjdGVkXCJcbiAgICAgICAgICAgIFthdHRyLnRhYkluZGV4XT1cIi0xXCJcbiAgICAgICAgICAgIChjbGljayk9XCJwZXJmb3JtVXBsb2FkKCRldmVudClcIj5cbiAgICAgICAgICAgICAgICB7e3RleHRGb3IoJ3VwbG9hZFNlbGVjdGVkRmlsZXMnKX19XG4gICAgICAgIDwvYnV0dG9uPlxuICAgIGBcbiAgICAgICAgICAgIH0sXSB9LFxuXTtcbi8qKiBAbm9jb2xsYXBzZSAqL1xuVXBsb2FkQWN0aW9uQnV0dG9uc0NvbXBvbmVudC5jdG9yUGFyYW1ldGVycyA9ICgpID0+IFtcbiAgICB7IHR5cGU6IFVwbG9hZFNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IExvY2FsaXphdGlvblNlcnZpY2UgfSxcbiAgICB7IHR5cGU6IE5hdmlnYXRpb25TZXJ2aWNlIH1cbl07XG5VcGxvYWRBY3Rpb25CdXR0b25zQ29tcG9uZW50LnByb3BEZWNvcmF0b3JzID0ge1xuICAgIGRpc2FibGVkOiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBhY3Rpb25zTGF5b3V0OiBbeyB0eXBlOiBJbnB1dCB9XSxcbiAgICBjbGVhckJ1dHRvbjogW3sgdHlwZTogVmlld0NoaWxkLCBhcmdzOiBbJ2NsZWFyQnV0dG9uJyxdIH1dLFxuICAgIHVwbG9hZEJ1dHRvbjogW3sgdHlwZTogVmlld0NoaWxkLCBhcmdzOiBbJ3VwbG9hZEJ1dHRvbicsXSB9XSxcbiAgICBob3N0RGVmYXVsdENsYXNzOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLWFjdGlvbnMnLF0gfV0sXG4gICAgYWN0aW9uQnV0dG9uc0VuZENsYXNzTmFtZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1hY3Rpb25zLWVuZCcsXSB9XSxcbiAgICBhY3Rpb25CdXR0b25zU3RyZXRjaGVkQ2xhc3NOYW1lOiBbeyB0eXBlOiBIb3N0QmluZGluZywgYXJnczogWydjbGFzcy5rLWFjdGlvbnMtc3RyZXRjaGVkJyxdIH1dLFxuICAgIGFjdGlvbkJ1dHRvbnNTdGFydENsYXNzTmFtZTogW3sgdHlwZTogSG9zdEJpbmRpbmcsIGFyZ3M6IFsnY2xhc3Muay1hY3Rpb25zLXN0YXJ0JyxdIH1dLFxuICAgIGFjdGlvbkJ1dHRvbnNDZW50ZXJDbGFzc05hbWU6IFt7IHR5cGU6IEhvc3RCaW5kaW5nLCBhcmdzOiBbJ2NsYXNzLmstYWN0aW9ucy1jZW50ZXInLF0gfV1cbn07XG5cbi8qKlxuICogQGhpZGRlblxuICovXG5jbGFzcyBVcGxvYWRTdGF0dXNUb3RhbENvbXBvbmVudCB7XG4gICAgY29uc3RydWN0b3IobG9jYWxpemF0aW9uKSB7XG4gICAgICAgIHRoaXMubG9jYWxpemF0aW9uID0gbG9jYWxpemF0aW9uO1xuICAgIH1cbiAgICBuZ0RvQ2hlY2soKSB7XG4gICAgICAgIHRoaXMuaXNQYXVzZWQgPSB0aGlzLmZpbGVMaXN0Lmhhc0ZpbGVXaXRoU3RhdGUoW0ZpbGVTdGF0ZS5QYXVzZWRdKTtcbiAgICAgICAgdGhpcy5pc0ZhaWxlZCA9IHRoaXMuZmlsZUxpc3QuaGFzRmlsZVdpdGhTdGF0ZShbRmlsZVN0YXRlLkZhaWxlZF0pO1xuICAgICAgICB0aGlzLmlzVXBsb2FkaW5nID0gdGhpcy5maWxlTGlzdC5oYXNGaWxlV2l0aFN0YXRlKFtGaWxlU3RhdGUuVXBsb2FkaW5nXSk7XG4gICAgICAgIGlmICh0aGlzLmlzUGF1c2VkICYmICF0aGlzLmlzVXBsb2FkaW5nKSB7XG4gICAgICAgICAgICB0aGlzLnN0YXR1c1RleHQgPSB0aGlzLmxvY2FsaXphdGlvbi5nZXQoJ2hlYWRlclN0YXR1c1BhdXNlZCcpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5zdGF0dXNUZXh0ID0gdGhpcy5pc1VwbG9hZGluZyA/IHRoaXMubG9jYWxpemF0aW9uLmdldCgnaGVhZGVyU3RhdHVzVXBsb2FkaW5nJylcbiAgICAgICAgICAgICAgICA6IHRoaXMubG9jYWxpemF0aW9uLmdldCgnaGVhZGVyU3RhdHVzVXBsb2FkZWQnKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblVwbG9hZFN0YXR1c1RvdGFsQ29tcG9uZW50LmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBDb21wb25lbnQsIGFyZ3M6IFt7XG4gICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdrZW5kby11cGxvYWQtc3RhdHVzLXRvdGFsJyxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZTogYFxuICAgICAgICA8c3BhbiBjbGFzcz1cImstaWNvblwiXG4gICAgICAgICAgICBbbmdDbGFzc109XCJ7XG4gICAgICAgICAgICAgICAgJ2staS1jaGVja21hcmsnOiAhdGhpcy5pc1VwbG9hZGluZyAmJiAhdGhpcy5pc0ZhaWxlZCxcbiAgICAgICAgICAgICAgICAnay1pLWV4Y2VwdGlvbic6ICF0aGlzLmlzVXBsb2FkaW5nICYmIHRoaXMuaXNGYWlsZWQsXG4gICAgICAgICAgICAgICAgJ2staS11cGxvYWQnOiB0aGlzLmlzVXBsb2FkaW5nLFxuICAgICAgICAgICAgICAgICdrLWktcGF1c2Utc20nOiB0aGlzLmlzUGF1c2VkXG4gICAgICAgICAgICB9XCI+XG4gICAgICAgIDwvc3Bhbj5cbiAgICAgICAge3tzdGF0dXNUZXh0fX1cbiAgICBgXG4gICAgICAgICAgICB9LF0gfSxcbl07XG4vKiogQG5vY29sbGFwc2UgKi9cblVwbG9hZFN0YXR1c1RvdGFsQ29tcG9uZW50LmN0b3JQYXJhbWV0ZXJzID0gKCkgPT4gW1xuICAgIHsgdHlwZTogTG9jYWxpemF0aW9uU2VydmljZSB9XG5dO1xuVXBsb2FkU3RhdHVzVG90YWxDb21wb25lbnQucHJvcERlY29yYXRvcnMgPSB7XG4gICAgZmlsZUxpc3Q6IFt7IHR5cGU6IElucHV0IH1dXG59O1xuXG5jb25zdCBVUExPQURfREVDTEFSQVRJT05TID0gW1xuICAgIFVwbG9hZENvbXBvbmVudCxcbiAgICBVcGxvYWRBY3Rpb25CdXR0b25zQ29tcG9uZW50LFxuICAgIFVwbG9hZFN0YXR1c1RvdGFsQ29tcG9uZW50XG5dO1xuLyoqXG4gKiBSZXByZXNlbnRzIHRoZSBbTmdNb2R1bGVdKGh0dHBzOi8vYW5ndWxhci5pby9hcGkvY29yZS9OZ01vZHVsZSkgZGVmaW5pdGlvbiBmb3IgdGhlIFVwbG9hZCBjb21wb25lbnQuXG4gKi9cbmNsYXNzIFVwbG9hZE1vZHVsZSB7XG59XG5VcGxvYWRNb2R1bGUuZGVjb3JhdG9ycyA9IFtcbiAgICB7IHR5cGU6IE5nTW9kdWxlLCBhcmdzOiBbe1xuICAgICAgICAgICAgICAgIGRlY2xhcmF0aW9uczogW1VQTE9BRF9ERUNMQVJBVElPTlNdLFxuICAgICAgICAgICAgICAgIGV4cG9ydHM6IFtcbiAgICAgICAgICAgICAgICAgICAgUFVCTElDX0RJUkVDVElWRVMsXG4gICAgICAgICAgICAgICAgICAgIFVQTE9BRF9ERUNMQVJBVElPTlNcbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIGltcG9ydHM6IFtTaGFyZWRNb2R1bGVdXG4gICAgICAgICAgICB9LF0gfSxcbl07XG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgW05nTW9kdWxlXSh7eyBzaXRlLmRhdGEudXJscy5hbmd1bGFyWyduZ21vZHVsZWFwaSddIH19KVxuICogZGVmaW5pdGlvbiBmb3IgdGhlIFVwbG9hZHMgY29tcG9uZW50cy5cbiAqXG4gKiBAZXhhbXBsZVxuICpcbiAqIGBgYHRzLW5vLXJ1blxuICogaW1wb3J0IHsgVXBsb2Fkc01vZHVsZSB9IGZyb20gJ0Bwcm9ncmVzcy9rZW5kby1hbmd1bGFyLXVwbG9hZCc7XG4gKlxuICogaW1wb3J0IHsgcGxhdGZvcm1Ccm93c2VyRHluYW1pYyB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXItZHluYW1pYyc7XG4gKiBpbXBvcnQgeyBOZ01vZHVsZSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuICpcbiAqIGltcG9ydCB7IEFwcENvbXBvbmVudCB9IGZyb20gJy4vYXBwLmNvbXBvbmVudCc7XG4gKlxuICogX0BOZ01vZHVsZSh7XG4gKiAgICAgZGVjbGFyYXRpb25zOiBbQXBwQ29tcG9uZW50XSxcbiAqICAgICBpbXBvcnRzOiAgICAgIFtCcm93c2VyTW9kdWxlLCBVcGxvYWRzTW9kdWxlXSxcbiAqICAgICBib290c3RyYXA6ICAgIFtBcHBDb21wb25lbnRdXG4gKiB9KVxuICogZXhwb3J0IGNsYXNzIEFwcE1vZHVsZSB7fVxuICpcbiAqIHBsYXRmb3JtQnJvd3NlckR5bmFtaWMoKS5ib290c3RyYXBNb2R1bGUoQXBwTW9kdWxlKTtcbiAqXG4gKiBgYGBcbiAqL1xuY2xhc3MgVXBsb2Fkc01vZHVsZSB7XG59XG5VcGxvYWRzTW9kdWxlLmRlY29yYXRvcnMgPSBbXG4gICAgeyB0eXBlOiBOZ01vZHVsZSwgYXJnczogW3tcbiAgICAgICAgICAgICAgICBleHBvcnRzOiBbXG4gICAgICAgICAgICAgICAgICAgIEZpbGVTZWxlY3RNb2R1bGUsXG4gICAgICAgICAgICAgICAgICAgIFVwbG9hZE1vZHVsZVxuICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgIH0sXSB9LFxuXTtcblxuLyoqXG4gKiBHZW5lcmF0ZWQgYnVuZGxlIGluZGV4LiBEbyBub3QgZWRpdC5cbiAqL1xuXG5leHBvcnQgeyBEcm9wWm9uZUJhc2UsIERyb3Bab25lSW50ZXJuYWxEaXJlY3RpdmUsIERyb3Bab25lU2VydmljZSwgUHJldmVudGFibGVFdmVudCwgRklMRVNFTEVDVF9WQUxVRV9BQ0NFU1NPUiwgTG9jYWxpemVkTWVzc2FnZXNEaXJlY3RpdmUsIE1lc3NhZ2VzLCBOYXZpZ2F0aW9uU2VydmljZSwgRmlsZUxpc3RJdGVtRGlyZWN0aXZlLCBGaWxlTGlzdEl0ZW1CYXNlLCBQVUJMSUNfRElSRUNUSVZFUywgU0hBUkVEX0RFQ0xBUkFUSU9OUywgU2hhcmVkTW9kdWxlLCBVUExPQURfVkFMVUVfQUNDRVNTT1IsIFVwbG9hZFNlcnZpY2UsIEZpbGVTZWxlY3RNb2R1bGUsIFVwbG9hZE1vZHVsZSwgVXBsb2Fkc01vZHVsZSwgVXBsb2FkQ29tcG9uZW50LCBGaWxlU2VsZWN0Q29tcG9uZW50LCBVcGxvYWREcm9wWm9uZUNvbXBvbmVudCwgRmlsZVNlbGVjdERpcmVjdGl2ZSwgRmlsZUxpc3RDb21wb25lbnQsIEZpbGVMaXN0U2luZ2xlSXRlbUNvbXBvbmVudCwgRmlsZUxpc3RJdGVtQWN0aW9uQnV0dG9uQ29tcG9uZW50LCBGaWxlTGlzdE11bHRpcGxlSXRlbXNDb21wb25lbnQsIEZpbGVUZW1wbGF0ZURpcmVjdGl2ZSwgVGVtcGxhdGVDb250ZXh0RGlyZWN0aXZlLCBVcGxvYWRTdGF0dXNUb3RhbENvbXBvbmVudCwgVXBsb2FkQWN0aW9uQnV0dG9uc0NvbXBvbmVudCwgVXBsb2FkRHJvcFpvbmVEaXJlY3RpdmUsIEN1c3RvbU1lc3NhZ2VzQ29tcG9uZW50LCBDYW5jZWxFdmVudCwgQ2xlYXJFdmVudCwgRXJyb3JFdmVudCwgUGF1c2VFdmVudCwgUmVtb3ZlRXZlbnQsIFJlc3VtZUV2ZW50LCBTZWxlY3RFdmVudCwgU3VjY2Vzc0V2ZW50LCBVcGxvYWRFdmVudCwgVXBsb2FkUHJvZ3Jlc3NFdmVudCwgRmlsZVN0YXRlIH07XG4iXX0=